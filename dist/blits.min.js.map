{"version":3,"file":"blits.min.js","sources":["../src/lib/symbols.js","../src/settings.js","../src/lib/log.js","../src/lib/colors/htmlColors.js","../src/lib/colors/colors.js","../src/lib/codegenerator/generator.js","../src/lib/componentId.js","../src/lib/hooks.js","../src/lib/reactivity/effect.js","../src/lib/reactivity/reactive.js","../src/lib/lifecycle.js","../node_modules/@lightningjs/renderer/dist/src/utils.js","../node_modules/@lightningjs/renderer/dist/src/common/EventEmitter.js","../node_modules/@lightningjs/renderer/dist/src/core/lib/utils.js","../node_modules/@lightningjs/renderer/dist/src/core/lib/Matrix3d.js","../node_modules/@lightningjs/renderer/dist/src/core/lib/RenderCoords.js","../node_modules/@lightningjs/renderer/dist/src/core/utils.js","../node_modules/@lightningjs/renderer/dist/src/core/animations/CoreAnimation.js","../node_modules/@lightningjs/renderer/dist/src/core/animations/CoreAnimationController.js","../node_modules/@lightningjs/renderer/dist/src/core/CoreNode.js","../node_modules/@lightningjs/renderer/dist/src/main-api/Inspector.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/CoreContextTexture.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/CoreRenderer.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/CoreRenderOp.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/CoreShader.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/internal/ShaderUtils.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/WebGlCoreShader.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/WebGlCoreRenderOp.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/internal/RendererUtils.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/WebGlCoreCtxTexture.js","../node_modules/@lightningjs/renderer/dist/src/core/textures/Texture.js","../node_modules/@lightningjs/renderer/dist/src/core/textures/ColorTexture.js","../node_modules/@lightningjs/renderer/dist/src/core/textures/SubTexture.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/WebGlCoreCtxSubTexture.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/DefaultShader.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/DefaultShaderBatched.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/ShaderEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/DynamicShader.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/RoundedRectangle.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/SdfShader.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/EffectUtils.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/RadiusEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/BorderEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/LinearGradientEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/GrayscaleEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/BorderRightEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/BorderTopEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/BorderBottomEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/BorderLeftEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/GlitchEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/FadeOutEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/RadialGradientEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/RadialProgressEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/shaders/effects/HolePunchEffect.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/canvas/shaders/UnsupportedShader.js","../node_modules/@lightningjs/renderer/dist/src/main-api/ShaderController.js","../node_modules/@lightningjs/renderer/dist/src/main-api/DynamicShaderController.js","../node_modules/@lightningjs/renderer/dist/src/core/CoreShaderManager.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/internal/BufferCollection.js","../node_modules/@lightningjs/renderer/dist/src/core/lib/WebGlContextWrapper.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/internal/WebGlUtils.js","../node_modules/@lightningjs/renderer/dist/src/core/textures/RenderTexture.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/WebGlCoreCtxRenderTexture.js","../node_modules/@lightningjs/renderer/dist/src/core/lib/textureCompression.js","../node_modules/@lightningjs/renderer/dist/src/core/textures/ImageTexture.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/webgl/WebGlCoreRenderer.js","../node_modules/@lightningjs/renderer/dist/src/core/animations/AnimationManager.js","../node_modules/@lightningjs/renderer/dist/src/core/lib/ImageWorker.js","../node_modules/@lightningjs/renderer/dist/src/core/textures/NoiseTexture.js","../node_modules/@lightningjs/renderer/dist/src/core/CoreTextureManager.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/TrFontManager.js","../node_modules/memize/dist/index.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/TextRenderer.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/font-face-types/TrFontFace.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/SpecialCodepoints.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/font-face-types/SdfTrFontFace/internal/FontShaper.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/font-face-types/SdfTrFontFace/internal/SdfFontShaper.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/font-face-types/SdfTrFontFace/SdfTrFontFace.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/PeekableGenerator.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/getUnicodeCodepoints.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/layoutText.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/measureText.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/setRenderWindow.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/util.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/TextRenderingUtils.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/SdfTextRenderer.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/constants.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/SdfTextRenderer/internal/getStartConditions.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/font-face-types/WebTrFontFace.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/LightningTextTextureRenderer.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/TextTextureRendererUtils.js","../node_modules/@lightningjs/renderer/dist/src/core/text-rendering/renderers/CanvasTextRenderer.js","../node_modules/@lightningjs/renderer/dist/src/core/lib/ContextSpy.js","../node_modules/@lightningjs/renderer/dist/src/core/TextureMemoryManager.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/canvas/internal/ColorUtils.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/canvas/CanvasCoreTexture.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/canvas/CanvasCoreRenderer.js","../node_modules/@lightningjs/renderer/dist/src/core/renderers/canvas/internal/C2DShaderUtils.js","../node_modules/@lightningjs/renderer/dist/src/core/CoreTextNode.js","../node_modules/@lightningjs/renderer/dist/src/core/Stage.js","../node_modules/@lightningjs/renderer/dist/src/core/platform.js","../node_modules/@lightningjs/renderer/dist/src/main-api/utils.js","../node_modules/@lightningjs/renderer/dist/src/main-api/Renderer.js","../src/lib/utils.js","../src/engines/L3/fontLoader.js","../src/engines/L3/shaderLoader.js","../src/engines/L3/launch.js","../src/engines/L3/element.js","../src/engines/L3/index.js","../src/launch.js","../src/router/transitions/fadeInOut.js","../src/announcer/speechSynthesis.js","../src/announcer/announcer.js","../src/router/router.js","../src/focus.js","../src/lib/eventListeners.js","../src/component/base/methods.js","../src/component/base/timeouts_intervals.js","../src/component/base/events.js","../src/component/base/log.js","../src/component/base/router.js","../src/component/base/announcer.js","../src/component/base/utils.js","../src/component/base/index.js","../src/component/setup/props.js","../src/component/setup/state.js","../src/component/setup/computed.js","../src/component/setup/watch.js","../src/component/setup/index.js","../src/component/setup/methods.js","../src/component/setup/routes.js","../src/component/setup/input.js","../src/components/Image.js","../src/components/Circle.js","../src/components/RouterView.js","../src/components/Sprite.js","../src/components/FPScounter.js","../public/assets/fps_sprite.base64.js","../src/components/Layout.js","../src/component.js","../src/lib/templateparser/parser.js","../src/components/index.js","../index.js","../src/application.js"],"sourcesContent":["export default {\n  currentView: Symbol('currentView'),\n  cursorTagStart: Symbol('cursorTagStart'),\n  computedKeys: Symbol('computedKeys'),\n  destroy: Symbol('destroy'),\n  getChildren: Symbol('getChildren'),\n  holder: Symbol('holder'),\n  id: Symbol('id'),\n  identifier: Symbol('identifier'),\n  index: Symbol('index'),\n  init: Symbol('init'),\n  inputEvents: Symbol('inputEvents'),\n  intervals: Symbol('intervals'),\n  level: Symbol('level'),\n  methodKeys: Symbol('methodKeys'),\n  originalState: Symbol('originalState'),\n  propKeys: Symbol('propKeys'),\n  raw: Symbol('raw'),\n  ready: Symbol('ready'),\n  renderer: Symbol('renderer'),\n  routes: Symbol('routes'),\n  settings: Symbol('settings'),\n  state: Symbol('state'),\n  stateKeys: Symbol('stateKeys'),\n  textnode: Symbol('textnode'),\n  timeouts: Symbol('timeouts'),\n  type: Symbol('type'),\n  watchers: Symbol('watchers'),\n  watchKeys: Symbol('watchKeys'),\n  wrapper: Symbol('wrapper'),\n\n  /* Utilizing the global Symbol registry for the following purposes */\n\n  // Symbol 'children' utilized within generated code\n  children: Symbol.for('children'),\n  // Symbol 'components' utilized within generated code\n  components: Symbol.for('components'),\n  // Symbol 'isSlot' utilized within generated code\n  isSlot: Symbol.for('isSlot'),\n  // Symbol 'props' utilized within generated code\n  props: Symbol.for('props'),\n  // Symbol 'slots' utilized within generated code\n  slots: Symbol.for('slots'),\n  // Symbol 'componentType' utilized within generated code\n  componentType: Symbol.for('componentType'),\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from './lib/symbols.js'\n\nconst settings = {\n  [symbols.settings]: {},\n  get(key, defaultValue = null) {\n    if (key in this[symbols.settings]) {\n      return this[symbols.settings][key]\n    } else {\n      return defaultValue\n    }\n  },\n  set(key, value) {\n    if (typeof key === 'object') {\n      Object.keys(key).forEach((k) => {\n        this.set(k, key[k])\n      })\n    } else {\n      this[symbols.settings][key] = value\n    }\n  },\n}\n\nexport default settings\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Settings from '../settings.js'\n\nconst n = () => {}\n\nconst time = () =>\n  new Date().toLocaleTimeString([], {\n    hour: '2-digit',\n    minute: '2-digit',\n    second: '2-digit',\n  })\n\nconst logger = (context) => {\n  const level = Settings.get('debugLevel')\n  const log = {}\n\n  Object.defineProperty(log, 'info', {\n    get() {\n      return (\n        ((level >= 1 || (Array.isArray(level) && level.indexOf('info') > -1)) &&\n          console.info.bind(\n            window.console,\n            `%c ⚡️ ${context} %c ${time()}`,\n            'background-color: #0284c7; color: white; padding: 3px 6px 3px 1px; border-radius: 3px',\n            'color: ##94a3b8;'\n          )) ||\n        n\n      )\n    },\n  })\n\n  Object.defineProperty(log, 'warn', {\n    get() {\n      return (\n        ((level >= 1 || (Array.isArray(level) && level.indexOf('warn') > -1)) &&\n          console.warn.bind(\n            window.console,\n            `%c ⚡️ ${context} %c ${time()}`,\n            'background-color: #fbbf24; color: white; padding: 3px 6px 3px 1px; border-radius: 3px',\n            'color: ##94a3b8;'\n          )) ||\n        n\n      )\n    },\n  })\n\n  Object.defineProperty(log, 'error', {\n    get() {\n      return (\n        ((level >= 1 || (Array.isArray(level) && level.indexOf('error') > -1)) &&\n          console.error.bind(\n            window.console,\n            `%c ⚡️ ${context} %c ${time()}`,\n            'background-color: #dc2626; color: white; padding: 3px 6px 3px 1px; border-radius: 3px',\n            'color: ##94a3b8;'\n          )) ||\n        n\n      )\n    },\n  })\n\n  Object.defineProperty(log, 'debug', {\n    get() {\n      return (\n        ((level >= 2 || (Array.isArray(level) && level.indexOf('debug') > -1)) &&\n          console.debug.bind(\n            window.console,\n            `%c ⚡️ ${context} %c (${new Date().toLocaleTimeString([], {\n              hour: '2-digit',\n              minute: '2-digit',\n              second: '2-digit',\n            })})`,\n            'background-color: #e2e8f0; color: #334155; padding: 3px 6px 3px 1px; border-radius: 3px',\n            'color: ##94a3b8;'\n          )) ||\n        n\n      )\n    },\n  })\n\n  return log\n}\n\nexport default logger\n\nexport let Log\n// review this pattern\nexport const initLog = () => {\n  Log = logger('Blits')\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport default {\n  aliceblue: '0xf0f8ffff',\n  antiquewhite: '0xfaebd7ff',\n  aqua: '0xffffff00',\n  aquamarine: '0x7fffd4ff',\n  azure: '0xf0ffffff',\n  beige: '0xf5f5dcff',\n  bisque: '0xffe4c4ff',\n  black: '0x000000ff',\n  blanchedalmond: '0xffebcdff',\n  blue: '0x0000ffff',\n  blueviolet: '0x8a2be2ff',\n  brown: '0xa52a2aff',\n  burlywood: '0xdeb887ff',\n  cadetblue: '0x5f9ea0ff',\n  chartreuse: '0x7fff00ff',\n  chocolate: '0xd2691eff',\n  coral: '0xff7f50ff',\n  cornflowerblue: '0x6495edff',\n  cornsilk: '0xfff8dcff',\n  crimson: '0xdc143cff',\n  cyan: '0x00ffffff',\n  darkblue: '0x00008bff',\n  darkcyan: '0x008b8bff',\n  darkgoldenrod: '0xb8860bff',\n  darkgray: '0xa9a9a9ff',\n  darkgreen: '0x006400ff',\n  darkgrey: '0xa9a9a9ff',\n  darkkhaki: '0xbdb76bff',\n  darkmagenta: '0x8b008bff',\n  darkolivegreen: '0x556b2fff',\n  darkorange: '0xff8c00ff',\n  darkorchid: '0x9932ccff',\n  darkred: '0x8b0000ff',\n  darksalmon: '0xe9967aff',\n  darkseagreen: '0x8fbc8fff',\n  darkslateblue: '0x483d8bff',\n  darkslategray: '0x2f4f4fff',\n  darkslategrey: '0x2f4f4fff',\n  darkturquoise: '0x00ced1ff',\n  darkviolet: '0x9400d3ff',\n  deeppink: '0xff1493ff',\n  deepskyblue: '0x00bfffff',\n  dimgray: '0x696969ff',\n  dimgrey: '0x696969ff',\n  dodgerblue: '0x1e90ffff',\n  firebrick: '0xb22222ff',\n  floralwhite: '0xfffaf0ff',\n  forestgreen: '0x228b22ff',\n  fuchsia: '0xff00ffff',\n  gainsboro: '0xdcdcdcff',\n  ghostwhite: '0xf8f8ffff',\n  gold: '0xffd700ff',\n  goldenrod: '0xdaa520ff',\n  gray: '0x808080ff',\n  green: '0x008000ff',\n  greenyellow: '0xadff2fff',\n  grey: '0x808080ff',\n  honeydew: '0xf0fff0ff',\n  hotpink: '0xff69b4ff',\n  indianred: '0xcd5c5cff',\n  indigo: '0x4b0082ff',\n  ivory: '0xfffff0ff',\n  khaki: '0xf0e68cff',\n  lavender: '0xe6e6faff',\n  lavenderblush: '0xfff0f5ff',\n  lawngreen: '0x7cfc00ff',\n  lemonchiffon: '0xfffacdff',\n  lightblue: '0xadd8e6ff',\n  lightcoral: '0xf08080ff',\n  lightcyan: '0xe0ffffff',\n  lightgoldenrodyellow: '0xfafad2ff',\n  lightgray: '0xd3d3d3ff',\n  lightgreen: '0x90ee90ff',\n  lightgrey: '0xd3d3d3ff',\n  lightpink: '0xffb6c1ff',\n  lightsalmon: '0xffa07aff',\n  lightseagreen: '0x20b2aaff',\n  lightskyblue: '0x87cefaff',\n  lightslategray: '0x778899ff',\n  lightslategrey: '0x778899ff',\n  lightsteelblue: '0xb0c4deff',\n  lightyellow: '0xffffe0ff',\n  lime: '0x00ff00ff',\n  limegreen: '0x32cd32ff',\n  linen: '0xfaf0e6ff',\n  magenta: '0xff00ffff',\n  maroon: '0x800000ff',\n  mediumaquamarine: '0x66cdaaff',\n  mediumblue: '0x0000cdff',\n  mediumorchid: '0xba55d3ff',\n  mediumpurple: '0x9370dbff',\n  mediumseagreen: '0x3cb371ff',\n  mediumslateblue: '0x7b68eeff',\n  mediumspringgreen: '0x00fa9aff',\n  mediumturquoise: '0x48d1ccff',\n  mediumvioletred: '0xc71585ff',\n  midnightblue: '0x191970ff',\n  mintcream: '0xf5fffaff',\n  mistyrose: '0xffe4e1ff',\n  moccasin: '0xffe4b5ff',\n  navajowhite: '0xffdeadff',\n  navy: '0x000080ff',\n  oldlace: '0xfdf5e6ff',\n  olive: '0x808000ff',\n  olivedrab: '0x6b8e23ff',\n  orange: '0xffa500ff',\n  orangered: '0xff4500ff',\n  orchid: '0xda70d6ff',\n  palegoldenrod: '0xeee8aaff',\n  palegreen: '0x98fb98ff',\n  paleturquoise: '0xafeeeeff',\n  palevioletred: '0xdb7093ff',\n  papayawhip: '0xffefd5ff',\n  peachpuff: '0xffdab9ff',\n  peru: '0xcd853fff',\n  pink: '0xffc0cbff',\n  plum: '0xdda0ddff',\n  powderblue: '0xb0e0e6ff',\n  purple: '0x800080ff',\n  rebeccapurple: '0x663399ff',\n  red: '0xff0000ff',\n  rosybrown: '0xbc8f8fff',\n  royalblue: '0x4169e1ff',\n  saddlebrown: '0x8b4513ff',\n  salmon: '0xfa8072ff',\n  sandybrown: '0xf4a460ff',\n  seagreen: '0x2e8b57ff',\n  seashell: '0xfff5eeff',\n  sienna: '0xa0522dff',\n  silver: '0xc0c0c0ff',\n  skyblue: '0x87ceebff',\n  slateblue: '0x6a5acdff',\n  slategray: '0x708090ff',\n  slategrey: '0x708090ff',\n  snow: '0xfffafaff',\n  springgreen: '0x00ff7fff',\n  steelblue: '0x4682b4ff',\n  tan: '0xd2b48cff',\n  teal: '0x008080ff',\n  thistle: '0xd8bfd8ff',\n  tomato: '0xff6347ff',\n  transparent: '0x00000000',\n  turquoise: '0x40e0d0ff',\n  violet: '0xee82eeff',\n  wheat: '0xf5deb3ff',\n  white: '0xffffffff',\n  whitesmoke: '0xf5f5f5ff',\n  yellow: '0xffff00ff',\n  yellowgreen: '0x9acd32ff',\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport colorsMap from './htmlColors.js'\n\nconst hex = /^#?([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i\nconst rgba =\n  /^(rgba?)\\((\\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\s*),(\\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\s*),(\\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\s*)(,(\\s*(-?\\d+(?:\\.\\d+)?)\\s*))?\\)$/\nconst hsla =\n  /^(hsla?)\\((\\s*(360|3[0-5][0-9]|[12]?[0-9]{1,2})\\s*),(\\s*(100|[1-9]?[0-9])\\s*)%,(\\s*(100|[1-9]?[0-9])\\s*)%(,(\\s*(1|0(?:\\.\\d+)?)\\s*))?\\)$/\n\nconst hexLookup = {}\n\nconst decimalToHex = (decimal) => {\n  if (hexLookup[decimal] !== undefined) {\n    return hexLookup[decimal]\n  }\n\n  const resp = parseInt(decimal).toString(16).padStart(2, '0')\n  hexLookup[decimal] = resp\n  return resp\n}\n\nexport default {\n  normalize: (color = '', defaultColor = '0xffffffff') => {\n    color = color.toString()\n\n    // its mappable, map it\n    if (colorsMap[color] !== undefined) {\n      return colorsMap[color]\n    }\n\n    // its a 0xRRGGBBAA color, store it and return it\n    if (color.startsWith('0x') && color.length === 10) {\n      colorsMap[color] = color\n      return color\n    }\n\n    // check for hex color\n    if (hex.test(color)) {\n      color = color.replace('#', '').toLowerCase()\n      if (color.length === 3) {\n        color = color\n          .split('')\n          .map((c) => c + c)\n          .join('')\n      }\n\n      const colorRGBA = '0x' + color.padEnd(8, 'f')\n      colorsMap[color] = colorRGBA\n      return colorRGBA\n    }\n\n    //rgb/a\n    const rgbaMatch = rgba.exec(color)\n    if (rgbaMatch) {\n      const r = decimalToHex(rgbaMatch[3])\n      const g = decimalToHex(rgbaMatch[5])\n      const b = decimalToHex(rgbaMatch[7])\n      let a = 'ff'\n\n      if (rgbaMatch[10] && rgbaMatch[1] === 'rgba') {\n        const alpha = Math.min(Math.max(Math.round(parseFloat(rgbaMatch[10]) * 255), 0), 255)\n        a = decimalToHex(alpha)\n      }\n\n      const resp = '0x' + r + g + b + a\n      colorsMap[color] = resp\n      return resp\n    }\n\n    if (hsla.test(color)) {\n      console.warn('HSL(A) color format is not supported yet')\n      return '0xffffffff'\n    }\n\n    return defaultColor\n  },\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nlet counter\n\nexport default function (templateObject = { children: [] }) {\n  const ctx = {\n    renderCode: ['const elms = []', 'let componentType', 'const rootComponent = component'],\n    effectsCode: [],\n    context: { props: [], components: this.components },\n  }\n\n  counter = -1\n  generateCode.call(ctx, templateObject)\n  ctx.renderCode.push('return elms')\n\n  return {\n    render: new Function('parent', 'component', 'context', 'components', ctx.renderCode.join('\\n')),\n    effects: ctx.effectsCode.map(\n      (code) =>\n        new Function('component', 'elms', 'context', 'components', 'rootComponent', 'effect', code)\n    ),\n    context: ctx.context,\n  }\n}\n\nconst generateElementCode = function (\n  templateObject,\n  parent = false,\n  options = { key: false, component: 'component.', forceEffect: false, forloop: false }\n) {\n  const renderCode = options.forceEffect ? this.effectsCode : this.renderCode\n  if (parent) {\n    renderCode.push(`parent = ${parent}`)\n  }\n\n  if ('key' in templateObject) options.key = interpolate(templateObject.key, options.component)\n  const elm = options.key ? `elms[${counter}][${options.key}]` : `elms[${counter}]`\n\n  if (options.key) {\n    renderCode.push(`\n      if(elms[${counter}] === undefined) {\n        elms[${counter}] = {}\n      }\n    `)\n  }\n\n  renderCode.push(`const elementConfig${counter} = {}`)\n\n  if (options.forloop) {\n    renderCode.push(`if(!${elm}) {`)\n  }\n\n  renderCode.push(`\n    ${elm} = this.element({parent: parent || 'root'}, component)\n  `)\n\n  if (options.forloop) {\n    renderCode.push('}')\n  }\n\n  const children = templateObject['children']\n  delete templateObject['children']\n\n  if (templateObject[Symbol.for('componentType')] === 'Slot') {\n    renderCode.push(`elementConfig${counter}[Symbol.for('isSlot')] = true`)\n  }\n\n  Object.keys(templateObject).forEach((key) => {\n    if (key === 'slot') {\n      renderCode.push(`\n        console.log(component, component[Symbol.for('slots')])\n        elementConfig${counter}['parent'] = component[Symbol.for('slots')].filter(slot => slot.ref === '${templateObject.slot}').shift() || component[Symbol.for('slots')][0] || parent\n      `)\n    }\n\n    if (key === 'key') return\n\n    if (isReactiveKey(key)) {\n      if (options.holder && key === ':color') return\n      this.effectsCode.push(\n        `${elm}.set('${key.substring(1)}', ${interpolate(templateObject[key], options.component)})`\n      )\n      renderCode.push(\n        `elementConfig${counter}['${key.substring(1)}'] = ${interpolate(\n          templateObject[key],\n          options.component\n        )}`\n      )\n    } else {\n      renderCode.push(\n        `elementConfig${counter}['${key}'] = ${cast(templateObject[key], key, options.component)}`\n      )\n    }\n  })\n\n  if (options.holder === true) {\n    renderCode.push(`\n    if(typeof cmp${counter} !== 'undefined') {\n      for(let key in cmp${counter}.config.props) {\n        delete elementConfig${counter}[cmp${counter}.config.props[key]]\n      }\n    }\n    `)\n  }\n\n  if (options.forloop) {\n    renderCode.push(`if(!${elm}.nodeId) {`)\n  }\n\n  renderCode.push(`${elm}.populate(elementConfig${counter})`)\n\n  if (options.forloop) {\n    renderCode.push('}')\n  }\n\n  if (children) {\n    generateCode.call(this, { children }, `${elm}`, options)\n  }\n}\n\nconst generateComponentCode = function (\n  templateObject,\n  parent = false,\n  options = {\n    key: false,\n    component: 'component.',\n    forceEffect: false,\n    holder: false,\n    forloop: false,\n  }\n) {\n  const renderCode = options.forceEffect ? this.effectsCode : this.renderCode\n\n  renderCode.push(`\n    const cmp${counter} =\n      (context.components && context.components['${\n        templateObject[Symbol.for('componentType')]\n      }']) || components['${templateObject[Symbol.for('componentType')]}']\n  `)\n\n  if ('key' in templateObject) {\n    options.key = interpolate(templateObject.key, options.component)\n  }\n\n  const children = templateObject.children\n  delete templateObject.children\n  generateElementCode.call(this, templateObject, parent, { ...options, ...{ holder: true } })\n\n  parent = options.key ? `elms[${counter}][${options.key}]` : `elms[${counter}]`\n\n  counter++\n\n  const elm = options.key ? `elms[${counter}][${options.key}]` : `elms[${counter}]`\n\n  if (options.key) {\n    renderCode.push(`\n      if(elms[${counter}] === undefined) {\n        elms[${counter}] = {}\n      }\n    `)\n  }\n\n  if (parent) {\n    renderCode.push(`parent = ${parent}`)\n  }\n\n  renderCode.push(`const props${counter} = {}`)\n  Object.keys(templateObject).forEach((key) => {\n    if (isReactiveKey(key)) {\n      this.effectsCode.push(`\n        ${elm}[Symbol.for('props')]['${key.substring(1)}'] = ${interpolate(\n        templateObject[key],\n        options.component\n      )}`)\n      renderCode.push(\n        `props${counter}['${key.substring(1)}'] = ${interpolate(\n          templateObject[key],\n          options.component\n        )}`\n      )\n    } else {\n      renderCode.push(\n        `props${counter}['${key}'] = ${cast(templateObject[key], key, options.component)}`\n      )\n    }\n  })\n\n  if (options.forloop) {\n    renderCode.push(`if(!${elm}) {`)\n  }\n\n  renderCode.push(`\n    componentType = props${counter}['is'] || '${templateObject[Symbol.for('componentType')]}'\n\n    let component${counter}\n    if(typeof componentType === 'string') {\n      component${counter} = context.components && context.components[componentType] || components[componentType]\n      if(!component${counter}) {\n        throw new Error('Component \"${templateObject[Symbol.for('componentType')]}\" not found')\n      }\n    } else if(typeof componentType === 'function' && componentType.name === 'factory') {\n      component${counter} = componentType\n    }\n\n    ${elm} = component${counter}.call(null, {props: props${counter}}, ${parent}, component)\n\n    if (${elm}[Symbol.for('slots')][0]) {\n      parent = ${elm}[Symbol.for('slots')][0]\n      component = ${elm}\n    } else {\n      parent = ${elm}[Symbol.for('children')][0]\n    }\n  `)\n\n  if (options.forloop) {\n    renderCode.push('}')\n  }\n\n  if (children) {\n    counter++\n    generateElementCode.call(this, { children }, false, { ...options })\n  }\n  // if (!options.forloop) {\n  //   renderCode.push(`\n  //   component = rootComponent\n  // `)\n  // }\n}\n\nconst generateForLoopCode = function (templateObject, parent) {\n  const forLoop = templateObject[':for']\n  delete templateObject[':for']\n\n  const regex = /(.+)\\s+in\\s+(.+)/gi\n  //   const regex = /(:?\\(*)(.+)\\s+in\\s+(.+)/gi\n\n  const result = regex.exec(forLoop)\n\n  // can be improved with a smarter regex\n  const [item, index = 'index'] = result[1]\n    .replace('(', '')\n    .replace(')', '')\n    .split(/\\s*,\\s*/)\n\n  // local context\n  const ctx = {\n    renderCode: ['let componentType'],\n    effectsCode: [],\n    context: { props: [], components: this.components },\n  }\n\n  if (parent) {\n    ctx.renderCode.push(`let parent = ${parent}`)\n  }\n\n  const forStartCounter = counter\n\n  // reference all reactive attributes (except those referencing the iterator item),\n  // to ensure that reactivity is registered, even when the initial array is empty\n  Object.keys(templateObject).forEach((k) => {\n    if (isReactiveKey(k) && templateObject[k].indexOf('$' + item) === -1) {\n      ctx.renderCode.push(`\n        void ${interpolate(templateObject[k], 'component.')}\n      `)\n    }\n  })\n\n  ctx.renderCode.push(`\n    const collection = ${cast(result[2], ':for')} || []\n    const keys = new Set()\n    for(let __index = 0; __index < collection.length; __index++) {\n      parent = ${parent}\n      const scope = Object.create(component)\n      scope['key'] = __index\n      scope['${index}'] = __index\n      scope['${item}'] = collection[__index]\n    `)\n\n  if ('ref' in templateObject && templateObject.ref.indexOf('$') === -1) {\n    // automatically map the ref for each item in the loop based on the given ref key\n    ctx.renderCode.push(`\n      scope['__ref'] = '${templateObject.ref}' + __index\n    `)\n    templateObject.ref = '$__ref'\n  }\n\n  if ('key' in templateObject) {\n    ctx.renderCode.push(`\n      scope.key = '' + ${interpolate(templateObject.key, 'scope.')}\n    `)\n  }\n  ctx.renderCode.push(`\n    keys.add(scope.key)\n  `)\n\n  if (\n    templateObject[Symbol.for('componentType')] === 'Element' ||\n    templateObject[Symbol.for('componentType')] === 'Slot' ||\n    templateObject[Symbol.for('componentType')] === 'Text'\n  ) {\n    generateElementCode.call(ctx, templateObject, parent, {\n      key: 'scope.key',\n      component: 'scope.',\n      forceEffect: false,\n      forloop: true,\n    })\n  } else {\n    generateComponentCode.call(ctx, templateObject, false, {\n      key: 'scope.key',\n      component: 'scope.',\n      forceEffect: false,\n      forloop: true,\n    })\n  }\n\n  ctx.renderCode.push(`if(!elms[${counter}][scope.key].___hasEffect) {`)\n\n  ctx.effectsCode.forEach((effect) => {\n    ctx.renderCode.push(`\n        effect(() => {\n          ${effect}\n        })\n    `)\n  })\n\n  ctx.renderCode.push(`\n    elms[${counter}][scope.key].___hasEffect = true\n  }\n  `)\n\n  ctx.renderCode.push('}')\n\n  const forEndCounter = counter\n  ctx.renderCode.push(`\n   component = rootComponent\n   if(elms[${forStartCounter}]) {\n      const all = Object.keys(elms[${forStartCounter}])\n      let i = all.length\n      while (i--) {\n        const key = all[i]\n        if (!keys.has(key)) {\n    `)\n  for (let i = forStartCounter; i <= forEndCounter; i++) {\n    ctx.renderCode.push(`\n      elms[${i}][key] && elms[${i}][key].destroy()\n      delete elms[${i}][key]\n    `)\n  }\n  ctx.renderCode.push(`\n        }\n      }\n      if(elms[${forStartCounter}][0] && elms[${forStartCounter}][0].forComponent && elms[${forStartCounter}][0].forComponent.___layout) {\n        elms[${forStartCounter}][0].forComponent.___layout()\n      }\n    }\n  `)\n  this.effectsCode.push(ctx.renderCode.join('\\n'))\n}\n\nconst generateCode = function (templateObject, parent = false, options = {}) {\n  templateObject.children &&\n    templateObject.children.forEach((childTemplateObject) => {\n      counter++\n\n      if (Object.keys(childTemplateObject).indexOf(':for') > -1) {\n        generateForLoopCode.call(this, childTemplateObject, parent)\n      } else {\n        if (\n          childTemplateObject[Symbol.for('componentType')] === 'Element' ||\n          childTemplateObject[Symbol.for('componentType')] === 'Slot' ||\n          childTemplateObject[Symbol.for('componentType')] === 'Text'\n        ) {\n          if (childTemplateObject[Symbol.for('componentType')] === 'Text') {\n            childTemplateObject.__textnode = 'true'\n          }\n          generateElementCode.call(this, childTemplateObject, parent, options)\n        } else {\n          generateComponentCode.call(this, childTemplateObject, parent, options)\n        }\n      }\n    })\n}\n\nconst interpolate = (val, component = 'component.') => {\n  const replaceString = /('.*?')+/gi\n  const replaceDollar = /\\$/gi\n  const matches = val.matchAll(replaceString)\n  const restore = []\n\n  let i = 0\n\n  // replace string and store in temp\n  for (const match of matches) {\n    restore.push(match[0])\n    val = val.replace(match[0], `[@@REPLACEMENT${i}@@]`)\n    i++\n  }\n\n  // replace remaining dollar signs\n  val = val.replace(replaceDollar, component)\n\n  // restore string replacemenet\n  restore.forEach((el, idx) => {\n    val = val.replace(`[@@REPLACEMENT${idx}@@]`, el)\n  })\n\n  return val\n}\n\nconst cast = (val = '', key = false, component = 'component.') => {\n  let castedValue\n\n  // inline content\n  if (key === 'content') {\n    if (val.startsWith('$')) {\n      castedValue = `${component}${val.replace('$', '')}`\n    } else {\n      // unescaped single quotes must be escaped while preserving escaped backslashes\n      const escapedVal = val\n        .replace(/\\\\\\\\/g, '__DOUBLE_BACKSLASH__')\n        .replace(/(^|[^\\\\])'/g, \"$1\\\\'\")\n        .replace(/__DOUBLE_BACKSLASH__/g, '\\\\\\\\')\n      castedValue = `'${parseInlineContent(escapedVal, component)}'`\n    }\n  }\n  // numeric\n  else if (key !== 'color' && !isNaN(parseFloat(val))) {\n    castedValue = parseFloat(val)\n    if (val.endsWith('%')) {\n      const map = {\n        w: 'width',\n        width: 'width',\n        x: 'width',\n        h: 'height',\n        height: 'height',\n        y: 'height',\n      }\n      const base = map[key]\n      if (base) {\n        castedValue = `parent.node.${base} * (${castedValue} / 100)`\n      }\n    }\n  }\n  // boolean true\n  else if (val.toLowerCase() === 'true') {\n    castedValue = true\n  }\n  // boolean false\n  else if (val.toLowerCase() === 'false') {\n    castedValue = false\n  }\n  // @-listener\n  else if (key.startsWith('@') && val) {\n    const c = component.slice(0, -1)\n    castedValue = `${c}['${val.replace('$', '')}'] && ${c}['${val.replace('$', '')}'].bind(${c})`\n  }\n  // dynamic value\n  else if (val.startsWith('$')) {\n    castedValue = `${component}${val.replace('$', '')}`\n  }\n  // static string\n  else {\n    castedValue = `\"${val}\"`\n  }\n\n  return castedValue\n}\n\nconst isReactiveKey = (str) => str.startsWith(':')\n\nconst parseInlineContent = (val, component) => {\n  const dynamicParts = /\\{\\{\\s*(\\$\\S+)\\s*\\}\\}/g\n  const matches = [...val.matchAll(dynamicParts)]\n\n  if (matches.length) {\n    for (let [match, arg] of matches) {\n      val = val.replace(match, `${arg.replace('$', `'+${component}`)}+'`)\n    }\n  }\n  return val\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst counters = {}\nlet counter = 0\n\nexport const createHumanReadableId = (name) => {\n  return `BlitsComponent::${name}_${(counters[name] = (counters[name] || 0) + 1)}`\n}\n\nexport const createInternalId = () => {\n  return ++counter\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from './symbols.js'\n\nconst cbs = {}\n\nexport const emit = (hook, identifier, scope, data = []) => {\n  cbs[identifier] && cbs[identifier][hook] && cbs[identifier][hook].apply(scope, data)\n}\n\nexport const privateEmit = (hook, identifier, scope) => {\n  const symHook = symbols[hook]\n  cbs[identifier] && cbs[identifier][symHook] && cbs[identifier][symHook].apply(scope)\n}\n\nexport const registerHooks = (hooks = {}, identifier) => {\n  cbs[identifier] = {}\n  // Combines enumerable keys and symbol properties of the 'hooks' object\n  const hookKeys = [...Object.keys(hooks), ...Object.getOwnPropertySymbols(hooks)]\n  hookKeys.forEach((hook) => {\n    if (typeof hooks[hook] === 'function') cbs[identifier][hook] = hooks[hook]\n  })\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nlet currentEffect = null\n\nlet paused = false\n\nexport const pauseTracking = () => {\n  paused = true\n}\n\nexport const resumeTracking = () => {\n  paused = false\n  for (let i = 0; i < trackQueue.length; i++) {\n    const item = trackQueue[i]\n    currentEffect = item.currentEffect\n    track(item.target, item.key)\n  }\n  trackQueue.length = 0\n}\n\nconst objectMap = new WeakMap()\n\nconst trackQueue = []\n\nexport const track = (target, key) => {\n  if (currentEffect) {\n    if (paused) {\n      trackQueue.push({ target, key, currentEffect })\n      return\n    }\n    let effectsMap = objectMap.get(target)\n    if (!effectsMap) {\n      effectsMap = new Map()\n      objectMap.set(target, effectsMap)\n    }\n    let effects = effectsMap.get(key)\n    if (!effects) {\n      effects = new Set()\n      effectsMap.set(key, effects)\n    }\n    effects.add(currentEffect)\n  }\n}\n\nexport const trigger = (target, key, force = false) => {\n  if (paused) return\n  const effectsMap = objectMap.get(target)\n  if (!effectsMap) {\n    return\n  }\n  const effects = effectsMap.get(key)\n  if (effects) {\n    for (let effect of effects) {\n      effect(force)\n    }\n  }\n}\n\nexport const effect = (effect) => {\n  currentEffect = effect\n  currentEffect()\n  currentEffect = null\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { track, trigger, pauseTracking, resumeTracking } from './effect.js'\nimport symbols from '../symbols.js'\n\nconst arrayPatchMethods = ['push', 'pop', 'shift', 'unshift', 'splice']\n\nconst proxyMap = new WeakMap()\n\nconst getProxy = (obj) => {\n  return proxyMap.get(obj)\n}\n\nconst getRaw = (value) => {\n  const raw = value && value[symbols.raw]\n  return raw ? getRaw(raw) : value\n}\n\nconst reactiveProxy = (original, _parent = null, _key) => {\n  // don't create a proxy when a Blits component or an Image Texture\n  // is assigned to a state variable\n  if (\n    (typeof original === 'object' && original[symbols.id]) ||\n    original.constructor.name === '_ImageTexture'\n  ) {\n    return original\n  }\n\n  // if original object is already a proxy, don't create a new one but return the existing one instead\n  const existingProxy = getProxy(original)\n  if (existingProxy) {\n    return existingProxy\n  }\n\n  const handler = {\n    get(target, key, receiver) {\n      // return the original object instead of the proxied\n      if (key === symbols.raw) {\n        return original\n      }\n\n      // handling arrays\n      if (Array.isArray(target)) {\n        // augment array path methods (that change the length of the array)\n        if (arrayPatchMethods.indexOf(key) > -1) {\n          return function (...args) {\n            pauseTracking()\n            const result = target[key].apply(this, args)\n            // trigger a change on the parent object and the key\n            // i.e. when pushing a new item to `obj.data`, _parent will equal `obj`\n            // and _key will equal `data`\n            resumeTracking()\n            trigger(_parent, _key)\n            return result\n          }\n        } else {\n          if (typeof target[key] === 'object' && target[key] !== null) {\n            if (Array.isArray(target[key])) {\n              track(target, key)\n            }\n            // create a new reactive proxy\n            return reactiveProxy(target[key], target, key)\n          }\n          return Reflect.get(target, key, receiver)\n        }\n      }\n\n      // handling objects (but not null values, which have object type in JS)\n      if (typeof target[key] === 'object' && target[key] !== null) {\n        if (Array.isArray(target[key])) {\n          track(target, key)\n        }\n        // create a new reactive proxy\n        return reactiveProxy(target[key], target, key)\n      }\n\n      // handling all other types\n      // track the key on the target\n      track(target, key)\n      // return the reflected value\n      return Reflect.get(target, key, receiver)\n    },\n    set(target, key, value, receiver) {\n      // get the raw values (without proxy wrapper) so we can compare them\n      const oldRawValue = getRaw(target[key])\n      const rawValue = getRaw(value)\n\n      let result = true\n      if (oldRawValue !== rawValue) {\n        result = Reflect.set(target, key, value, receiver)\n      }\n\n      if (result && oldRawValue !== rawValue) {\n        // if we're assigning an array key directly trigger reactivity on the parent key as well\n        if (Array.isArray(target) && key in target) {\n          trigger(_parent, _key, true)\n        }\n        trigger(target, key, true)\n      }\n      return result\n    },\n  }\n\n  const proxy = new Proxy(original, handler)\n  proxyMap.set(original, proxy)\n  return proxy\n}\n\nconst reactiveDefineProperty = (target) => {\n  Object.keys(target).forEach((key) => {\n    let internalValue = target[key]\n\n    if (target[key] !== null && typeof target[key] === 'object') {\n      if (Object.getPrototypeOf(target[key]) === Object.prototype) {\n        return reactiveDefineProperty(target[key])\n      } else if (Array.isArray(target[key])) {\n        for (let i = 0; i < arrayPatchMethods.length - 1; i++) {\n          target[key][arrayPatchMethods[i]] = function (v) {\n            Array.prototype[arrayPatchMethods[i]].call(this, v)\n            trigger(target, key)\n          }\n        }\n      }\n    }\n\n    Object.defineProperty(target, key, {\n      enumerable: true,\n      configurable: true,\n      get() {\n        track(target, key)\n        return internalValue\n      },\n      set(newValue) {\n        // todo: support assigning array (as we do with proxies)\n        let oldValue = internalValue\n        if (oldValue !== newValue) {\n          internalValue = newValue\n          trigger(target, key)\n        }\n      },\n    })\n  })\n\n  return target\n}\n\nexport const reactive = (target, mode = 'Proxy') => {\n  return mode === 'defineProperty' ? reactiveDefineProperty(target) : reactiveProxy(target)\n}\n\nexport const memo = (raw) => {\n  const r = {\n    get value() {\n      track(r, 'value')\n      return raw\n    },\n    set value(v) {\n      raw = v\n      trigger(r, 'value')\n    },\n  }\n  return r\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from './log.js'\nimport { emit, privateEmit } from './hooks.js'\nimport symbols from './symbols.js'\n\nconst states = [\n  'init', // fired upon component instantiation\n  'ready', // fired when component instantiated, reactivity setup done and template spawned\n  'focus', // fired when receiving focus (can occur multiple times)\n  'unfocus', // fired when losing focus (can occur multiple times)\n  'destroy', // fired when component is destroyed and removed\n  'attach', // fired when entering the viewport margin and attached to the render tree\n  'detach', // fired when leaving the viewport margin and detached from the render tree\n  'enter', // fired when entering the visible viewport\n  'exit', // fired when leaving the visible viewport\n]\n\nexport default {\n  previous: null,\n  current: null,\n  get state() {\n    return this.current\n  },\n  set state(v) {\n    if (states.indexOf(v) > -1 && (v !== this.current || v === 'focus')) {\n      Log.debug(\n        `Setting lifecycle state from ${this.current} to ${v} for ${this.component.componentId}`\n      )\n      this.previous = this.current\n      this.current = v\n      // emit 'private' hook\n      privateEmit(v, this.component[symbols.identifier], this.component)\n      // emit 'public' hook\n      emit(v, this.component[symbols.identifier], this.component)\n    }\n  },\n}\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport function createWebGLContext(canvas, contextSpy) {\n    const config = {\n        alpha: true,\n        antialias: false,\n        depth: false,\n        stencil: true,\n        desynchronized: false,\n        // Disabled because it prevents Visual Regression Tests from working\n        // failIfMajorPerformanceCaveat: true,\n        powerPreference: 'high-performance',\n        premultipliedAlpha: true,\n        preserveDrawingBuffer: false,\n    };\n    const gl = \n    // TODO: Remove this assertion once this issue is fixed in TypeScript\n    // https://github.com/microsoft/TypeScript/issues/53614\n    (canvas.getContext('webgl', config) ||\n        canvas.getContext('experimental-webgl', config));\n    if (!gl) {\n        throw new Error('Unable to create WebGL context');\n    }\n    if (contextSpy) {\n        // Proxy the GL context to log all GL calls\n        return new Proxy(gl, {\n            get(target, prop) {\n                const value = target[prop];\n                if (typeof value === 'function') {\n                    contextSpy.increment(String(prop));\n                    return value.bind(target);\n                }\n                return value;\n            },\n        });\n    }\n    return gl;\n}\n/**\n * Asserts a condition is truthy, otherwise throws an error\n *\n * @remarks\n * Useful at the top of functions to ensure certain conditions, arguments and\n * properties are set/met before continuing. When using this function,\n * TypeScript will narrow away falsy types from the condition.\n *\n * @param condition\n * @param message\n * @returns\n */\nexport function assertTruthy(condition, message) {\n    if (isProductionEnvironment())\n        return;\n    if (!condition) {\n        throw new Error(message || 'Assertion failed');\n    }\n}\n/**\n * Merges two colors based on a given progress value.\n *\n * This function takes two colors (c1 and c2) represented as 32-bit integers\n * in RGBA format and blends them based on the provided progress value (p).\n * The result is a new color that is a weighted combination of the input colors,\n * where the weight is determined by the progress value.\n *\n * @param {number} c1 - The first color in RGBA format (32-bit integer).\n * @param {number} c2 - The second color in RGBA format (32-bit integer).\n * @param {number} p - The progress value between 0 and 1.\n * @returns {number} The merged color as a 32-bit integer in RGBA format.\n */\nexport function mergeColorProgress(rgba1, rgba2, p) {\n    const r1 = Math.trunc(rgba1 >>> 24);\n    const g1 = Math.trunc((rgba1 >>> 16) & 0xff);\n    const b1 = Math.trunc((rgba1 >>> 8) & 0xff);\n    const a1 = Math.trunc(rgba1 & 0xff);\n    const r2 = Math.trunc(rgba2 >>> 24);\n    const g2 = Math.trunc((rgba2 >>> 16) & 0xff);\n    const b2 = Math.trunc((rgba2 >>> 8) & 0xff);\n    const a2 = Math.trunc(rgba2 & 0xff);\n    const r = Math.round(r2 * p + r1 * (1 - p));\n    const g = Math.round(g2 * p + g1 * (1 - p));\n    const b = Math.round(b2 * p + b1 * (1 - p));\n    const a = Math.round(a2 * p + a1 * (1 - p));\n    return ((r << 24) | (g << 16) | (b << 8) | a) >>> 0;\n}\n/**\n * Given an RGBA encoded number, returns back the RGBA number with it's alpha\n * component multiplied by the passed `alpha` parameter.\n *\n * @internalRemarks\n * This method does NOT premultiply the alpha into the color channels. If that\n * is required (for internal use only) use {@link mergeColorAlphaPremultiplied}\n * instead.\n *\n * @param rgba RGBA encoded number\n * @param alpha Normalized alpha value (Range: 0.0 - 1.0)\n * @returns\n */\nexport function mergeColorAlpha(rgba, alpha) {\n    const r = rgba >>> 24;\n    const g = (rgba >>> 16) & 0xff;\n    const b = (rgba >>> 8) & 0xff;\n    const a = Math.trunc((rgba & 0xff) * alpha);\n    return ((r << 24) | (g << 16) | (b << 8) | a) >>> 0;\n}\nlet premultiplyRGB = true;\n/**\n * RGB components should not be premultiplied when using Canvas renderer\n * @param mode  Renderer mode\n */\nexport function setPremultiplyMode(mode) {\n    premultiplyRGB = mode === 'webgl';\n}\n/**\n * Given an RGBA encoded number, returns back the RGBA number with it's alpha\n * component multiplied by the passed `alpha` parameter.\n *\n * For the webGl renderer, each color channel is premultiplied by the final alpha value.\n *\n * @remarks\n * If `flipEndianess` is set to true, the function will returned an ABGR encoded number\n * which is useful when the color value needs to be passed into a shader attribute.\n *\n * NOTE: Depending on the mode set by {@link setPremultiplyMode}, this method returns\n * a PREMULTIPLIED alpha color which is generally only useful in the context of the\n * internal rendering process. Use {@link mergeColorAlpha} if you need to blend an alpha\n * value into a color in the context of the Renderer's main API.\n *\n * @internalRemarks\n * Do not expose this method in the main API because Renderer users should instead use\n * {@link mergeColorAlpha} to manipulate the alpha value of a color.\n *\n * @internal\n * @param rgba RGBA encoded number\n * @param alpha Normalized alpha value (Range: 0.0 - 1.0)\n * @param flipEndianess Flip the endianess. RGBA becomes encoded as ABGR (for inserting colors into shader attributes)\n * @returns\n */\nexport function mergeColorAlphaPremultiplied(rgba, alpha, flipEndianess = false) {\n    const newAlpha = ((rgba & 0xff) / 255) * alpha;\n    const rgbAlpha = premultiplyRGB ? newAlpha : 1;\n    const r = Math.trunc((rgba >>> 24) * rgbAlpha);\n    const g = Math.trunc(((rgba >>> 16) & 0xff) * rgbAlpha);\n    const b = Math.trunc(((rgba >>> 8) & 0xff) * rgbAlpha);\n    const a = Math.trunc(newAlpha * 255);\n    if (flipEndianess) {\n        return ((a << 24) | (b << 16) | (g << 8) | r) >>> 0;\n    }\n    return ((r << 24) | (g << 16) | (b << 8) | a) >>> 0;\n}\n/**\n * Returns true if the given object has the given \"own\" property.\n *\n * @param obj\n * @param prop\n * @returns\n */\nexport function hasOwn(obj, prop) {\n    return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n/**\n * Converts degrees to radians\n *\n * @param degrees\n * @returns\n */\nexport function deg2Rad(degrees) {\n    return (degrees * Math.PI) / 180;\n}\n/**\n * Returns image aspect ratio\n *\n * @param width\n * @param height\n * @returns\n */\nexport function getImageAspectRatio(width, height) {\n    return width / height;\n}\n/**\n * Checks import.meta if env is production\n *\n * @returns\n */\nexport function isProductionEnvironment() {\n    return import.meta.env && import.meta.env.PROD;\n}\n/**\n * Returns a new unique ID\n */\nlet nextId = 1;\nexport function getNewId() {\n    return nextId++;\n}\n//# sourceMappingURL=utils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * EventEmitter base class\n */\nexport class EventEmitter {\n    eventListeners = {};\n    on(event, listener) {\n        let listeners = this.eventListeners[event];\n        if (!listeners) {\n            listeners = [];\n        }\n        listeners.push(listener);\n        this.eventListeners[event] = listeners;\n    }\n    off(event, listener) {\n        const listeners = this.eventListeners[event];\n        if (!listeners) {\n            return;\n        }\n        if (!listener) {\n            delete this.eventListeners[event];\n            return;\n        }\n        const index = listeners.indexOf(listener);\n        if (index >= 0) {\n            listeners.splice(index, 1);\n        }\n    }\n    once(event, listener) {\n        const onceListener = (target, data) => {\n            this.off(event, onceListener);\n            listener(target, data);\n        };\n        this.on(event, onceListener);\n    }\n    emit(event, data) {\n        const listeners = this.eventListeners[event];\n        if (!listeners) {\n            return;\n        }\n        [...listeners].forEach((listener) => {\n            listener(this, data);\n        });\n    }\n    removeAllListeners() {\n        this.eventListeners = {};\n    }\n}\n//# sourceMappingURL=EventEmitter.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport const PROTOCOL_REGEX = /^(data|ftps?|https?):/;\nexport const getNormalizedRgbaComponents = (rgba) => {\n    const r = rgba >>> 24;\n    const g = (rgba >>> 16) & 0xff;\n    const b = (rgba >>> 8) & 0xff;\n    const a = rgba & 0xff;\n    return [r / 255, g / 255, b / 255, a / 255];\n};\nexport const getRgbaComponents = (rgba) => {\n    const r = rgba >>> 24;\n    const g = (rgba >>> 16) & 0xff;\n    const b = (rgba >>> 8) & 0xff;\n    const a = rgba & 0xff;\n    return [r, g, b, a];\n};\nexport const norm = (rgba) => {\n    const r = rgba >>> 24;\n    const g = (rgba >>> 16) & 0xff;\n    const b = (rgba >>> 8) & 0xff;\n    const a = rgba & 0xff;\n    const rgbaArr = [r / 255, g / 255, b / 255, a / 255];\n    rgbaArr[0] = Math.max(0, Math.min(255, rgbaArr[0]));\n    rgbaArr[1] = Math.max(0, Math.min(255, rgbaArr[1]));\n    rgbaArr[2] = Math.max(0, Math.min(255, rgbaArr[2]));\n    rgbaArr[3] = Math.max(0, Math.min(255, rgbaArr[3]));\n    let v = ((rgbaArr[3] | 0) << 24) +\n        ((rgbaArr[0] | 0) << 16) +\n        ((rgbaArr[1] | 0) << 8) +\n        (rgbaArr[2] | 0);\n    if (v < 0) {\n        v = 0xffffffff + v + 1;\n    }\n    return v;\n};\nexport function getNormalizedAlphaComponent(rgba) {\n    return (rgba & 0xff) / 255.0;\n}\n/**\n * Get a CSS color string from a RGBA color\n *\n * @param color\n * @returns\n */\nexport function getRgbaString(color) {\n    const r = Math.floor(color[0] * 255.0);\n    const g = Math.floor(color[1] * 255.0);\n    const b = Math.floor(color[2] * 255.0);\n    const a = Math.floor(color[3] * 255.0);\n    return `rgba(${r},${g},${b},${a.toFixed(4)})`;\n}\nexport function createBound(x1, y1, x2, y2, out) {\n    if (out) {\n        out.x1 = x1;\n        out.y1 = y1;\n        out.x2 = x2;\n        out.y2 = y2;\n        return out;\n    }\n    return {\n        x1,\n        y1,\n        x2,\n        y2,\n    };\n}\nexport function intersectBound(a, b, out) {\n    const intersection = createBound(Math.max(a.x1, b.x1), Math.max(a.y1, b.y1), Math.min(a.x2, b.x2), Math.min(a.y2, b.y2), out);\n    if (intersection.x1 < intersection.x2 && intersection.y1 < intersection.y2) {\n        return intersection;\n    }\n    return createBound(0, 0, 0, 0, intersection);\n}\nexport function boundsOverlap(a, b) {\n    return a.x1 < b.x2 && a.x2 > b.x1 && a.y1 < b.y2 && a.y2 > b.y1;\n}\nexport function convertBoundToRect(bound, out) {\n    if (out) {\n        out.x = bound.x1;\n        out.y = bound.y1;\n        out.width = bound.x2 - bound.x1;\n        out.height = bound.y2 - bound.y1;\n        return out;\n    }\n    return {\n        x: bound.x1,\n        y: bound.y1,\n        width: bound.x2 - bound.x1,\n        height: bound.y2 - bound.y1,\n    };\n}\nexport function intersectRect(a, b, out) {\n    const x = Math.max(a.x, b.x);\n    const y = Math.max(a.y, b.y);\n    const width = Math.min(a.x + a.width, b.x + b.width) - x;\n    const height = Math.min(a.y + a.height, b.y + b.height) - y;\n    if (width > 0 && height > 0) {\n        if (out) {\n            out.x = x;\n            out.y = y;\n            out.width = width;\n            out.height = height;\n            return out;\n        }\n        return {\n            x,\n            y,\n            width,\n            height,\n        };\n    }\n    if (out) {\n        out.x = 0;\n        out.y = 0;\n        out.width = 0;\n        out.height = 0;\n        return out;\n    }\n    return {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n    };\n}\nexport function copyRect(a, out) {\n    if (out) {\n        out.x = a.x;\n        out.y = a.y;\n        out.width = a.width;\n        out.height = a.height;\n        return out;\n    }\n    return {\n        x: a.x,\n        y: a.y,\n        width: a.width,\n        height: a.height,\n    };\n}\nexport function compareRect(a, b) {\n    if (a === b) {\n        return true;\n    }\n    if (a === null || b === null) {\n        return false;\n    }\n    return (a.x === b.x && a.y === b.y && a.width === b.width && a.height === b.height);\n}\nexport function boundInsideBound(bound1, bound2) {\n    return (bound1.x1 <= bound2.x2 &&\n        bound1.y1 <= bound2.y2 &&\n        bound1.x2 >= bound2.x1 &&\n        bound1.y2 >= bound2.y1);\n}\nexport function isBoundPositive(bound) {\n    return bound.x1 < bound.x2 && bound.y1 < bound.y2;\n}\nexport function isRectPositive(rect) {\n    return rect.width > 0 && rect.height > 0;\n}\nexport function convertUrlToAbsolute(url) {\n    // handle local file imports if the url isn't remote resource or data blob\n    if (self.location.protocol === 'file:' && !PROTOCOL_REGEX.test(url)) {\n        const path = self.location.pathname.split('/');\n        path.pop();\n        const basePath = path.join('/');\n        const baseUrl = self.location.protocol + '//' + basePath;\n        // check if url has a leading dot\n        if (url.charAt(0) === '.') {\n            url = url.slice(1);\n        }\n        // check if url has a leading slash\n        if (url.charAt(0) === '/') {\n            url = url.slice(1);\n        }\n        return baseUrl + '/' + url;\n    }\n    const absoluteUrl = new URL(url, self.location.href);\n    return absoluteUrl.href;\n}\n//# sourceMappingURL=utils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * A 3D matrix representing a 2D graphics transformation\n *\n * @remarks\n * For convenience, entries in the first two rows can be accessed by the following\n * properties:\n * | ta tb tx |\n * | tc td ty |\n * | 0  0  1  |\n *\n * This matrix is optimized for 2D transformations and hence the last row will\n * always be considered [0, 0 ,1].\n *\n * To access a column major array for WebGL, use the {@link getFloatArr} method.\n */\nexport class Matrix3d {\n    ta;\n    tb;\n    tx;\n    tc;\n    td;\n    ty;\n    _floatArr = null;\n    /**\n     * Potential Mutation Flag\n     *\n     * @remarks\n     * This flag is set to true whenever the matrix is potentially modified.\n     * We don't waste CPU trying to identify if each operation actually modifies\n     * the matrix. Instead, we set this flag to true whenever we think the matrix\n     * is modified. This signals that the `floatArr` should to be updated.\n     */\n    mutation;\n    /**\n     * Creates a new 3x3 matrix.\n     *\n     * @param entries Row-major 3x3 matrix\n     */\n    constructor() {\n        this.ta = 0;\n        this.tb = 0;\n        this.tx = 0;\n        this.tc = 0;\n        this.td = 0;\n        this.ty = 0;\n        this.mutation = true;\n    }\n    /**\n     * Returns a temporary matrix that can be used for calculations.\n     *\n     * @remarks\n     * This is useful for avoiding allocations in tight loops.\n     *\n     * The matrix is not guaranteed to be the same between calls.\n     *\n     * @returns\n     */\n    static get temp() {\n        return tempMatrix;\n    }\n    static multiply(a, b, out) {\n        const e0 = a.ta * b.ta + a.tb * b.tc;\n        const e1 = a.ta * b.tb + a.tb * b.td;\n        const e2 = a.ta * b.tx + a.tb * b.ty + a.tx;\n        const e3 = a.tc * b.ta + a.td * b.tc;\n        const e4 = a.tc * b.tb + a.td * b.td;\n        const e5 = a.tc * b.tx + a.td * b.ty + a.ty;\n        if (!out) {\n            out = new Matrix3d();\n        }\n        out.ta = e0;\n        out.tb = e1;\n        out.tx = e2;\n        out.tc = e3;\n        out.td = e4;\n        out.ty = e5;\n        out.mutation = true;\n        return out;\n    }\n    static identity(out) {\n        if (!out) {\n            out = new Matrix3d();\n        }\n        out.ta = 1;\n        out.tb = 0;\n        out.tx = 0;\n        out.tc = 0;\n        out.td = 1;\n        out.ty = 0;\n        out.mutation = true;\n        return out;\n    }\n    static translate(x, y, out) {\n        if (!out) {\n            out = new Matrix3d();\n        }\n        out.ta = 1;\n        out.tb = 0;\n        out.tx = x;\n        out.tc = 0;\n        out.td = 1;\n        out.ty = y;\n        out.mutation = true;\n        return out;\n    }\n    static scale(sx, sy, out) {\n        if (!out) {\n            out = new Matrix3d();\n        }\n        out.ta = sx;\n        out.tb = 0;\n        out.tx = 0;\n        out.tc = 0;\n        out.td = sy;\n        out.ty = 0;\n        out.mutation = true;\n        return out;\n    }\n    static rotate(angle, out) {\n        const cos = Math.cos(angle);\n        const sin = Math.sin(angle);\n        if (!out) {\n            out = new Matrix3d();\n        }\n        out.ta = cos;\n        out.tb = -sin;\n        out.tx = 0;\n        out.tc = sin;\n        out.td = cos;\n        out.ty = 0;\n        out.mutation = true;\n        return out;\n    }\n    static copy(src, dst) {\n        if (!dst) {\n            dst = new Matrix3d();\n        }\n        dst.ta = src.ta;\n        dst.tc = src.tc;\n        dst.tb = src.tb;\n        dst.td = src.td;\n        dst.tx = src.tx;\n        dst.ty = src.ty;\n        dst.mutation = true;\n        return dst;\n    }\n    translate(x, y) {\n        this.tx = this.ta * x + this.tb * y + this.tx;\n        this.ty = this.tc * x + this.td * y + this.ty;\n        this.mutation = true;\n        return this;\n    }\n    scale(sx, sy) {\n        this.ta = this.ta * sx;\n        this.tb = this.tb * sy;\n        this.tc = this.tc * sx;\n        this.td = this.td * sy;\n        this.mutation = true;\n        return this;\n    }\n    rotate(angle) {\n        if (angle === 0 || !((angle % Math.PI) * 2)) {\n            return this;\n        }\n        const cos = Math.cos(angle);\n        const sin = Math.sin(angle);\n        const e0 = this.ta * cos + this.tb * sin;\n        const e1 = this.tb * cos - this.ta * sin;\n        const e3 = this.tc * cos + this.td * sin;\n        const e4 = this.td * cos - this.tc * sin;\n        this.ta = e0;\n        this.tb = e1;\n        this.tc = e3;\n        this.td = e4;\n        this.mutation = true;\n        return this;\n    }\n    multiply(other) {\n        return Matrix3d.multiply(this, other, this);\n    }\n    /**\n     * Returns the matrix as a Float32Array in column-major order.\n     *\n     * @remarks\n     * This method is optimized to avoid unnecessary allocations. The same array\n     * is returned every time this method is called, and is updated in place.\n     *\n     * WARNING: Use the array only for passing directly to a WebGL shader uniform\n     * during a frame render. Do not modify or hold onto the array for longer than\n     * a frame.\n     */\n    getFloatArr() {\n        if (!this._floatArr) {\n            this._floatArr = new Float32Array(9);\n        }\n        if (this.mutation) {\n            this._floatArr[0] = this.ta;\n            this._floatArr[1] = this.tc;\n            this._floatArr[2] = 0;\n            this._floatArr[3] = this.tb;\n            this._floatArr[4] = this.td;\n            this._floatArr[5] = 0;\n            this._floatArr[6] = this.tx;\n            this._floatArr[7] = this.ty;\n            this._floatArr[8] = 1;\n            this.mutation = false;\n        }\n        return this._floatArr;\n    }\n}\nconst tempMatrix = new Matrix3d();\n//# sourceMappingURL=Matrix3d.js.map","const rx1 = 0;\nconst rx2 = 2;\nconst rx3 = 4;\nconst rx4 = 6;\nconst ry1 = 1;\nconst ry2 = 3;\nconst ry3 = 5;\nconst ry4 = 7;\nexport class RenderCoords {\n    data;\n    constructor(entries) {\n        this.data = new Float32Array(8);\n        if (entries) {\n            this.data[rx1] = entries[rx1];\n            this.data[rx2] = entries[rx2];\n            this.data[rx3] = entries[rx3];\n            this.data[rx4] = entries[rx4];\n            this.data[ry1] = entries[ry1];\n            this.data[ry2] = entries[ry2];\n            this.data[ry3] = entries[ry3];\n            this.data[ry4] = entries[ry4];\n        }\n    }\n    static translate(x1, y1, x2, y2, x3, y3, x4, y4, out) {\n        if (!out) {\n            out = new RenderCoords();\n        }\n        out.data[rx1] = x1;\n        out.data[rx2] = x2;\n        out.data[rx3] = x3;\n        out.data[rx4] = x4;\n        out.data[ry1] = y1;\n        out.data[ry2] = y2;\n        out.data[ry3] = y3;\n        out.data[ry4] = y4;\n        return out;\n    }\n    get x1() {\n        return this.data[rx1];\n    }\n    get x2() {\n        return this.data[rx2];\n    }\n    get x3() {\n        return this.data[rx3];\n    }\n    get x4() {\n        return this.data[rx4];\n    }\n    get y1() {\n        return this.data[ry1];\n    }\n    get y2() {\n        return this.data[ry2];\n    }\n    get y3() {\n        return this.data[ry3];\n    }\n    get y4() {\n        return this.data[ry4];\n    }\n}\n//# sourceMappingURL=RenderCoords.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Core Utility Functions\n *\n * @module\n */\nexport const EPSILON = 0.000001;\nexport let ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport const RANDOM = Math.random;\nexport const ANGLE_ORDER = 'zyx';\nconst degree = Math.PI / 180;\nexport const setMatrixArrayType = (type) => {\n    ARRAY_TYPE = type;\n};\nexport const toRadian = (a) => {\n    return a * degree;\n};\nexport const equals = (a, b) => {\n    return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n};\nexport const rand = (min, max) => {\n    return Math.floor(Math.random() * (max - min + 1) + min);\n};\nexport const isPowerOfTwo = (value) => {\n    return value && !(value & (value - 1));\n};\nconst getTimingBezier = (a, b, c, d) => {\n    const xc = 3.0 * a;\n    const xb = 3.0 * (c - a) - xc;\n    const xa = 1.0 - xc - xb;\n    const yc = 3.0 * b;\n    const yb = 3.0 * (d - b) - yc;\n    const ya = 1.0 - yc - yb;\n    return function (time) {\n        if (time >= 1.0) {\n            return 1;\n        }\n        if (time <= 0) {\n            return 0;\n        }\n        let t = 0.5, cbx, cbxd, dx;\n        for (let it = 0; it < 20; it++) {\n            cbx = t * (t * (t * xa + xb) + xc);\n            dx = time - cbx;\n            if (dx > -1e-8 && dx < 1e-8) {\n                return t * (t * (t * ya + yb) + yc);\n            }\n            // Cubic bezier derivative.\n            cbxd = t * (t * (3 * xa) + 2 * xb) + xc;\n            if (cbxd > 1e-10 && cbxd < 1e-10) {\n                // Problematic. Fall back to binary search method.\n                break;\n            }\n            t += dx / cbxd;\n        }\n        // Fallback: binary search method. This is more reliable when there are near-0 slopes.\n        let minT = 0;\n        let maxT = 1;\n        for (let it = 0; it < 20; it++) {\n            t = 0.5 * (minT + maxT);\n            cbx = t * (t * (t * xa + xb) + xc);\n            dx = time - cbx;\n            if (dx > -1e-8 && dx < 1e-8) {\n                // Solution found!\n                return t * (t * (t * ya + yb) + yc);\n            }\n            if (dx < 0) {\n                maxT = t;\n            }\n            else {\n                minT = t;\n            }\n        }\n    };\n};\nconst timingMapping = {};\nconst timingLookup = {\n    ease: [0.25, 0.1, 0.25, 1.0],\n    'ease-in': [0.42, 0, 1.0, 1.0],\n    'ease-out': [0, 0, 0.58, 1.0],\n    'ease-in-out': [0.42, 0, 0.58, 1.0],\n    'ease-in-sine': [0.12, 0, 0.39, 0],\n    'ease-out-sine': [0.12, 0, 0.39, 0],\n    'ease-in-out-sine': [0.37, 0, 0.63, 1],\n    'ease-in-cubic': [0.32, 0, 0.67, 0],\n    'ease-out-cubic': [0.33, 1, 0.68, 1],\n    'ease-in-out-cubic': [0.65, 0, 0.35, 1],\n    'ease-in-circ': [0.55, 0, 1, 0.45],\n    'ease-out-circ': [0, 0.55, 0.45, 1],\n    'ease-in-out-circ': [0.85, 0, 0.15, 1],\n    'ease-in-back': [0.36, 0, 0.66, -0.56],\n    'ease-out-back': [0.34, 1.56, 0.64, 1],\n    'ease-in-out-back': [0.68, -0.6, 0.32, 1.6],\n};\nconst defaultTiming = (t) => t;\nconst parseCubicBezier = (str) => {\n    //cubic-bezier(0.84, 0.52, 0.56, 0.6)\n    const regex = /-?\\d*\\.?\\d+/g;\n    const match = str.match(regex);\n    if (match) {\n        const [num1, num2, num3, num4] = match;\n        const a = parseFloat(num1 || '0.42');\n        const b = parseFloat(num2 || '0');\n        const c = parseFloat(num3 || '1');\n        const d = parseFloat(num4 || '1');\n        const timing = getTimingBezier(a, b, c, d);\n        timingMapping[str] = timing;\n        return timing;\n    }\n    // parse failed, return linear\n    console.warn('Unknown cubic-bezier timing: ' + str);\n    return defaultTiming;\n};\nexport const getTimingFunction = (str) => {\n    if (str === 'linear') {\n        return defaultTiming;\n    }\n    if (timingMapping[str] !== undefined) {\n        return timingMapping[str] || defaultTiming;\n    }\n    if (str === 'step-start') {\n        return () => {\n            return 1;\n        };\n    }\n    if (str === 'step-end') {\n        return (time) => {\n            return time === 1 ? 1 : 0;\n        };\n    }\n    const lookup = timingLookup[str];\n    if (lookup !== undefined) {\n        const [a, b, c, d] = lookup;\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore - TS doesn't understand that we've checked for undefined\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n        const timing = getTimingBezier(a, b, c, d);\n        timingMapping[str] = timing;\n        return timing;\n    }\n    if (str.startsWith('cubic-bezier')) {\n        return parseCubicBezier(str);\n    }\n    console.warn('Unknown timing function: ' + str);\n    return defaultTiming;\n};\n/**\n * Convert bytes to string of megabytes with 2 decimal points\n *\n * @param bytes\n * @returns\n */\nexport function bytesToMb(bytes) {\n    return (bytes / 1024 / 1024).toFixed(2);\n}\n//# sourceMappingURL=utils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {} from '../CoreNode.js';\nimport { getTimingFunction } from '../utils.js';\nimport { mergeColorProgress } from '../../utils.js';\nimport { EventEmitter } from '../../common/EventEmitter.js';\nexport class CoreAnimation extends EventEmitter {\n    node;\n    props;\n    settings;\n    progress = 0;\n    delayFor = 0;\n    timingFunction;\n    propValuesMap = {};\n    dynPropValuesMap = undefined;\n    constructor(node, props, settings) {\n        super();\n        this.node = node;\n        this.props = props;\n        for (const key in props) {\n            if (key !== 'shaderProps') {\n                if (this.propValuesMap['props'] === undefined) {\n                    this.propValuesMap['props'] = {};\n                }\n                this.propValuesMap['props'][key] = {\n                    start: node[key],\n                    target: props[key],\n                };\n            }\n            else if (node.shader.type !== 'DynamicShader') {\n                this.propValuesMap['shaderProps'] = {};\n                for (const key in props.shaderProps) {\n                    this.propValuesMap['shaderProps'][key] = {\n                        start: node.shader.props[key],\n                        target: props.shaderProps[key],\n                    };\n                }\n            }\n            else {\n                const shaderPropKeys = Object.keys(props.shaderProps);\n                const spLength = shaderPropKeys.length;\n                this.dynPropValuesMap = {};\n                for (let j = 0; j < spLength; j++) {\n                    const effectName = shaderPropKeys[j];\n                    const effect = props.shaderProps[effectName];\n                    this.dynPropValuesMap[effectName] = {};\n                    const effectProps = Object.entries(effect);\n                    const eLength = effectProps.length;\n                    for (let k = 0; k < eLength; k++) {\n                        const [key, value] = effectProps[k];\n                        this.dynPropValuesMap[effectName][key] = {\n                            start: node.shader.props[effectName][key],\n                            target: value,\n                        };\n                    }\n                }\n            }\n        }\n        const easing = settings.easing || 'linear';\n        const delay = settings.delay ?? 0;\n        this.settings = {\n            duration: settings.duration ?? 0,\n            delay,\n            easing,\n            loop: settings.loop ?? false,\n            repeat: settings.repeat ?? 0,\n            repeatDelay: settings.repeatDelay ?? 0,\n            stopMethod: settings.stopMethod ?? false,\n        };\n        this.timingFunction = getTimingFunction(easing);\n        this.delayFor = delay;\n    }\n    reset() {\n        this.progress = 0;\n        this.delayFor = this.settings.delay || 0;\n        this.update(0);\n    }\n    restoreValues(target, valueMap) {\n        const entries = Object.entries(valueMap);\n        const eLength = entries.length;\n        for (let i = 0; i < eLength; i++) {\n            const [key, value] = entries[i];\n            target[key] = value.start;\n        }\n    }\n    restore() {\n        this.reset();\n        if (this.propValuesMap['props'] !== undefined) {\n            this.restoreValues(this.node, this.propValuesMap['props']);\n        }\n        if (this.propValuesMap['shaderProps'] !== undefined) {\n            this.restoreValues(this.node.shader.props, this.propValuesMap['shaderProps']);\n        }\n        if (this.dynPropValuesMap !== undefined) {\n            const dynEntries = Object.keys(this.dynPropValuesMap);\n            const dynEntriesL = dynEntries.length;\n            if (dynEntriesL > 0) {\n                for (let i = 0; i < dynEntriesL; i++) {\n                    const key = dynEntries[i];\n                    this.restoreValues(this.node.shader.props[key], this.dynPropValuesMap[key]);\n                }\n            }\n        }\n    }\n    reverseValues(valueMap) {\n        const entries = Object.entries(valueMap);\n        const eLength = entries.length;\n        for (let i = 0; i < eLength; i++) {\n            const [key, value] = entries[i];\n            valueMap[key] = {\n                start: value.target,\n                target: value.start,\n            };\n        }\n    }\n    reverse() {\n        this.progress = 0;\n        if (this.propValuesMap['props'] !== undefined) {\n            this.reverseValues(this.propValuesMap['props']);\n        }\n        if (this.propValuesMap['shaderProps'] !== undefined) {\n            this.reverseValues(this.propValuesMap['shaderProps']);\n        }\n        if (this.dynPropValuesMap !== undefined) {\n            const dynEntries = Object.keys(this.dynPropValuesMap);\n            const dynEntriesL = dynEntries.length;\n            if (dynEntriesL > 0) {\n                for (let i = 0; i < dynEntriesL; i++) {\n                    const key = dynEntries[i];\n                    this.reverseValues(this.dynPropValuesMap[key]);\n                }\n            }\n        }\n        // restore stop method if we are not looping\n        if (!this.settings.loop) {\n            this.settings.stopMethod = false;\n        }\n    }\n    applyEasing(p, s, e) {\n        return (this.timingFunction(p) || p) * (e - s) + s;\n    }\n    updateValue(propName, propValue, startValue, easing) {\n        if (this.progress === 1) {\n            return propValue;\n        }\n        if (this.progress === 0) {\n            return startValue;\n        }\n        const endValue = propValue;\n        if (propName.indexOf('color') !== -1) {\n            if (startValue === endValue) {\n                return startValue;\n            }\n            if (easing) {\n                const easingProgressValue = this.timingFunction(this.progress) || this.progress;\n                return mergeColorProgress(startValue, endValue, easingProgressValue);\n            }\n            return mergeColorProgress(startValue, endValue, this.progress);\n        }\n        if (easing) {\n            return this.applyEasing(this.progress, startValue, endValue);\n        }\n        return startValue + (endValue - startValue) * this.progress;\n    }\n    updateValues(target, valueMap, easing) {\n        const entries = Object.entries(valueMap);\n        const eLength = entries.length;\n        for (let i = 0; i < eLength; i++) {\n            const [key, value] = entries[i];\n            target[key] = this.updateValue(key, value.target, value.start, easing);\n        }\n    }\n    update(dt) {\n        const { duration, loop, easing, stopMethod } = this.settings;\n        const { delayFor } = this;\n        if (duration === 0 && delayFor === 0) {\n            this.emit('finished', {});\n            return;\n        }\n        if (this.delayFor > 0) {\n            this.delayFor -= dt;\n            if (this.delayFor >= 0) {\n                // Either no or more delay left. Exit.\n                return;\n            }\n            else {\n                // We went beyond the delay time, add it back to dt so we can continue\n                // with the animation.\n                dt = -this.delayFor;\n                this.delayFor = 0;\n            }\n        }\n        if (duration === 0) {\n            // No duration, we are done.\n            this.emit('finished', {});\n            return;\n        }\n        if (this.progress === 0) {\n            // Progress is 0, we are starting the post-delay part of the animation.\n            this.emit('animating', {});\n        }\n        this.progress += dt / duration;\n        if (this.progress > 1) {\n            this.progress = loop ? 0 : 1;\n            if (stopMethod) {\n                // If there's a stop method emit finished so the stop method can be applied.\n                // TODO: We should probably reevaluate how stopMethod is implemented as currently\n                // stop method 'reset' does not work when looping.\n                this.emit('finished', {});\n                return;\n            }\n        }\n        if (this.propValuesMap['props'] !== undefined) {\n            this.updateValues(this.node, this.propValuesMap['props'], easing);\n        }\n        if (this.propValuesMap['shaderProps'] !== undefined) {\n            this.updateValues(this.node.shader.props, this.propValuesMap['shaderProps'], easing);\n        }\n        if (this.dynPropValuesMap !== undefined) {\n            const dynEntries = Object.keys(this.dynPropValuesMap);\n            const dynEntriesL = dynEntries.length;\n            if (dynEntriesL > 0) {\n                for (let i = 0; i < dynEntriesL; i++) {\n                    const key = dynEntries[i];\n                    this.updateValues(this.node.shader.props[key], this.dynPropValuesMap[key], easing);\n                }\n            }\n        }\n        if (this.progress === 1) {\n            this.emit('finished', {});\n        }\n    }\n}\n//# sourceMappingURL=CoreAnimation.js.map","/* eslint-disable @typescript-eslint/unbound-method */\n/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../utils.js';\nimport { EventEmitter } from '../../common/EventEmitter.js';\nexport class CoreAnimationController extends EventEmitter {\n    manager;\n    animation;\n    stoppedPromise;\n    /**\n     * If this is null, then the animation is in a finished / stopped state.\n     */\n    stoppedResolve = null;\n    state;\n    constructor(manager, animation) {\n        super();\n        this.manager = manager;\n        this.animation = animation;\n        this.state = 'stopped';\n        // Initial stopped promise is resolved (since the animation is stopped)\n        this.stoppedPromise = Promise.resolve();\n        // Bind event handlers\n        this.onAnimating = this.onAnimating.bind(this);\n        this.onFinished = this.onFinished.bind(this);\n    }\n    start() {\n        if (this.state !== 'running') {\n            this.makeStoppedPromise();\n            this.registerAnimation();\n            this.state = 'running';\n        }\n        return this;\n    }\n    stop() {\n        this.unregisterAnimation();\n        if (this.stoppedResolve !== null) {\n            this.stoppedResolve();\n            this.stoppedResolve = null;\n            this.emit('stopped', this);\n        }\n        this.animation.reset();\n        this.state = 'stopped';\n        return this;\n    }\n    pause() {\n        this.unregisterAnimation();\n        this.state = 'paused';\n        return this;\n    }\n    restore() {\n        this.stoppedResolve = null;\n        this.animation.restore();\n        return this;\n    }\n    waitUntilStopped() {\n        return this.stoppedPromise;\n    }\n    registerAnimation() {\n        // Hook up event listeners\n        this.animation.once('finished', this.onFinished);\n        this.animation.on('animating', this.onAnimating);\n        // Then register the animation\n        this.manager.registerAnimation(this.animation);\n    }\n    unregisterAnimation() {\n        // First unregister the animation\n        this.manager.unregisterAnimation(this.animation);\n        // Then unhook event listeners\n        this.animation.off('finished', this.onFinished);\n        this.animation.off('animating', this.onAnimating);\n    }\n    makeStoppedPromise() {\n        if (this.stoppedResolve === null) {\n            this.stoppedPromise = new Promise((resolve) => {\n                this.stoppedResolve = resolve;\n            });\n        }\n    }\n    onFinished() {\n        assertTruthy(this.stoppedResolve);\n        // If the animation is looping, then we need to restart it.\n        const { loop, stopMethod } = this.animation.settings;\n        if (stopMethod === 'reverse') {\n            this.animation.reverse();\n            return;\n        }\n        if (loop) {\n            return;\n        }\n        // unregister animation\n        this.unregisterAnimation();\n        // resolve promise\n        this.stoppedResolve();\n        this.stoppedResolve = null;\n        this.emit('stopped', this);\n        this.state = 'stopped';\n    }\n    onAnimating() {\n        this.emit('animating', this);\n    }\n}\n//# sourceMappingURL=CoreAnimationController.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy, getNewId, mergeColorAlphaPremultiplied, } from '../utils.js';\nimport { EventEmitter } from '../common/EventEmitter.js';\nimport { copyRect, intersectRect, createBound, boundInsideBound, } from './lib/utils.js';\nimport { Matrix3d } from './lib/Matrix3d.js';\nimport { RenderCoords } from './lib/RenderCoords.js';\nimport { CoreAnimation } from './animations/CoreAnimation.js';\nimport { CoreAnimationController } from './animations/CoreAnimationController.js';\nexport var CoreNodeRenderState;\n(function (CoreNodeRenderState) {\n    CoreNodeRenderState[CoreNodeRenderState[\"Init\"] = 0] = \"Init\";\n    CoreNodeRenderState[CoreNodeRenderState[\"OutOfBounds\"] = 2] = \"OutOfBounds\";\n    CoreNodeRenderState[CoreNodeRenderState[\"InBounds\"] = 4] = \"InBounds\";\n    CoreNodeRenderState[CoreNodeRenderState[\"InViewport\"] = 8] = \"InViewport\";\n})(CoreNodeRenderState || (CoreNodeRenderState = {}));\nconst CoreNodeRenderStateMap = new Map();\nCoreNodeRenderStateMap.set(CoreNodeRenderState.Init, 'init');\nCoreNodeRenderStateMap.set(CoreNodeRenderState.OutOfBounds, 'outOfBounds');\nCoreNodeRenderStateMap.set(CoreNodeRenderState.InBounds, 'inBounds');\nCoreNodeRenderStateMap.set(CoreNodeRenderState.InViewport, 'inViewport');\nexport var UpdateType;\n(function (UpdateType) {\n    /**\n     * Child updates\n     */\n    UpdateType[UpdateType[\"Children\"] = 1] = \"Children\";\n    /**\n     * Scale/Rotate transform update\n     *\n     * @remarks\n     * CoreNode Properties Updated:\n     * - `scaleRotateTransform`\n     */\n    UpdateType[UpdateType[\"ScaleRotate\"] = 2] = \"ScaleRotate\";\n    /**\n     * Translate transform update (x/y/width/height/pivot/mount)\n     *\n     * @remarks\n     * CoreNode Properties Updated:\n     * - `localTransform`\n     */\n    UpdateType[UpdateType[\"Local\"] = 4] = \"Local\";\n    /**\n     * Global Transform update\n     *\n     * @remarks\n     * CoreNode Properties Updated:\n     * - `globalTransform`\n     * - `renderCoords`\n     * - `renderBound`\n     */\n    UpdateType[UpdateType[\"Global\"] = 8] = \"Global\";\n    /**\n     * Clipping rect update\n     *\n     * @remarks\n     * CoreNode Properties Updated:\n     * - `clippingRect`\n     */\n    UpdateType[UpdateType[\"Clipping\"] = 16] = \"Clipping\";\n    /**\n     * Calculated ZIndex update\n     *\n     * @remarks\n     * CoreNode Properties Updated:\n     * - `calcZIndex`\n     */\n    UpdateType[UpdateType[\"CalculatedZIndex\"] = 32] = \"CalculatedZIndex\";\n    /**\n     * Z-Index Sorted Children update\n     *\n     * @remarks\n     * CoreNode Properties Updated:\n     * - `children` (sorts children by their `calcZIndex`)\n     */\n    UpdateType[UpdateType[\"ZIndexSortedChildren\"] = 64] = \"ZIndexSortedChildren\";\n    /**\n     * Premultiplied Colors update\n     *\n     * @remarks\n     * CoreNode Properties Updated:\n     * - `premultipliedColorTl`\n     * - `premultipliedColorTr`\n     * - `premultipliedColorBl`\n     * - `premultipliedColorBr`\n     */\n    UpdateType[UpdateType[\"PremultipliedColors\"] = 128] = \"PremultipliedColors\";\n    /**\n     * World Alpha update\n     *\n     * @remarks\n     * CoreNode Properties Updated:\n     * - `worldAlpha` = `parent.worldAlpha` * `alpha`\n     */\n    UpdateType[UpdateType[\"WorldAlpha\"] = 256] = \"WorldAlpha\";\n    /**\n     * Render State update\n     *\n     * @remarks\n     * CoreNode Properties Updated:\n     * - `renderState`\n     */\n    UpdateType[UpdateType[\"RenderState\"] = 512] = \"RenderState\";\n    /**\n     * Is Renderable update\n     *\n     * @remarks\n     * CoreNode Properties Updated:\n     * - `isRenderable`\n     */\n    UpdateType[UpdateType[\"IsRenderable\"] = 1024] = \"IsRenderable\";\n    /**\n     * Render Texture update\n     */\n    UpdateType[UpdateType[\"RenderTexture\"] = 2048] = \"RenderTexture\";\n    /**\n     * Track if parent has render texture\n     */\n    UpdateType[UpdateType[\"ParentRenderTexture\"] = 4096] = \"ParentRenderTexture\";\n    /**\n     * None\n     */\n    UpdateType[UpdateType[\"None\"] = 0] = \"None\";\n    /**\n     * All\n     */\n    UpdateType[UpdateType[\"All\"] = 8191] = \"All\";\n})(UpdateType || (UpdateType = {}));\n/**\n * A visual Node in the Renderer scene graph.\n *\n * @remarks\n * CoreNode is an internally used class that represents a Renderer Node in the\n * scene graph. See INode.ts for the public APIs exposed to Renderer users\n * that include generic types for Shaders.\n */\nexport class CoreNode extends EventEmitter {\n    stage;\n    children = [];\n    _id = getNewId();\n    props;\n    updateType = UpdateType.All;\n    globalTransform;\n    scaleRotateTransform;\n    localTransform;\n    renderCoords;\n    renderBound;\n    strictBound;\n    preloadBound;\n    clippingRect = {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        valid: false,\n    };\n    isRenderable = false;\n    renderState = CoreNodeRenderState.Init;\n    worldAlpha = 1;\n    premultipliedColorTl = 0;\n    premultipliedColorTr = 0;\n    premultipliedColorBl = 0;\n    premultipliedColorBr = 0;\n    calcZIndex = 0;\n    hasRTTupdates = false;\n    parentHasRenderTexture = false;\n    constructor(stage, props) {\n        super();\n        this.stage = stage;\n        this.props = {\n            ...props,\n            parent: null,\n            texture: null,\n            src: null,\n            rtt: false,\n        };\n        // Assign props to instance\n        this.parent = props.parent;\n        this.texture = props.texture;\n        this.src = props.src;\n        this.rtt = props.rtt;\n        this.updateScaleRotateTransform();\n    }\n    //#region Textures\n    loadTexture() {\n        const { texture } = this.props;\n        assertTruthy(texture);\n        // If texture is already loaded / failed, trigger loaded event manually\n        // so that users get a consistent event experience.\n        // We do this in a microtask to allow listeners to be attached in the same\n        // synchronous task after calling loadTexture()\n        queueMicrotask(() => {\n            // Preload texture if required\n            if (this.textureOptions.preload) {\n                texture.ctxTexture.load();\n            }\n            if (texture.state === 'loaded') {\n                assertTruthy(texture.dimensions);\n                this.onTextureLoaded(texture, texture.dimensions);\n            }\n            else if (texture.state === 'failed') {\n                assertTruthy(texture.error);\n                this.onTextureFailed(texture, texture.error);\n            }\n            else if (texture.state === 'freed') {\n                this.onTextureFreed(texture);\n            }\n            texture.on('loaded', this.onTextureLoaded);\n            texture.on('failed', this.onTextureFailed);\n            texture.on('freed', this.onTextureFreed);\n        });\n    }\n    unloadTexture() {\n        if (this.texture) {\n            this.texture.off('loaded', this.onTextureLoaded);\n            this.texture.off('failed', this.onTextureFailed);\n            this.texture.off('freed', this.onTextureFreed);\n            this.texture.setRenderableOwner(this, false);\n        }\n    }\n    autosizeNode(dimensions) {\n        if (this.autosize) {\n            this.width = dimensions.width;\n            this.height = dimensions.height;\n        }\n    }\n    onTextureLoaded = (_, dimensions) => {\n        this.autosizeNode(dimensions);\n        // Texture was loaded. In case the RAF loop has already stopped, we request\n        // a render to ensure the texture is rendered.\n        this.stage.requestRender();\n        // If parent has a render texture, flag that we need to update\n        // @todo: Reserve type for RTT updates\n        if (this.parentHasRenderTexture) {\n            this.setRTTUpdates(1);\n        }\n        this.emit('loaded', {\n            type: 'texture',\n            dimensions,\n        });\n        // Trigger a local update if the texture is loaded and the resizeMode is 'contain'\n        if (this.props.textureOptions?.resizeMode?.type === 'contain') {\n            this.setUpdateType(UpdateType.Local);\n        }\n    };\n    onTextureFailed = (_, error) => {\n        this.emit('failed', {\n            type: 'texture',\n            error,\n        });\n    };\n    onTextureFreed = () => {\n        this.emit('freed', {\n            type: 'texture',\n        });\n    };\n    //#endregion Textures\n    /**\n     * Change types types is used to determine the scope of the changes being applied\n     *\n     * @remarks\n     * See {@link UpdateType} for more information on each type\n     *\n     * @param type\n     */\n    setUpdateType(type) {\n        this.updateType |= type;\n        // If we're updating this node at all, we need to inform the parent\n        // (and all ancestors) that their children need updating as well\n        const parent = this.props.parent;\n        if (parent && !(parent.updateType & UpdateType.Children)) {\n            parent.setUpdateType(UpdateType.Children);\n        }\n        // If node is part of RTT texture\n        // Flag that we need to update\n        if (this.parentHasRenderTexture) {\n            this.setRTTUpdates(type);\n        }\n    }\n    sortChildren() {\n        this.children.sort((a, b) => a.calcZIndex - b.calcZIndex);\n    }\n    updateScaleRotateTransform() {\n        const { rotation, scaleX, scaleY } = this.props;\n        // optimize simple translation cases\n        if (rotation === 0 && scaleX === 1 && scaleY === 1) {\n            this.scaleRotateTransform = undefined;\n            return;\n        }\n        this.scaleRotateTransform = Matrix3d.rotate(rotation, this.scaleRotateTransform).scale(scaleX, scaleY);\n    }\n    updateLocalTransform() {\n        const { x, y, width, height } = this.props;\n        const mountTranslateX = this.props.mountX * width;\n        const mountTranslateY = this.props.mountY * height;\n        if (this.scaleRotateTransform) {\n            const pivotTranslateX = this.props.pivotX * width;\n            const pivotTranslateY = this.props.pivotY * height;\n            this.localTransform = Matrix3d.translate(x - mountTranslateX + pivotTranslateX, y - mountTranslateY + pivotTranslateY, this.localTransform)\n                .multiply(this.scaleRotateTransform)\n                .translate(-pivotTranslateX, -pivotTranslateY);\n        }\n        else {\n            this.localTransform = Matrix3d.translate(x - mountTranslateX, y - mountTranslateY, this.localTransform);\n        }\n        // Handle 'contain' resize mode\n        const texture = this.props.texture;\n        if (texture &&\n            texture.dimensions &&\n            this.props.textureOptions?.resizeMode?.type === 'contain') {\n            let resizeModeScaleX = 1;\n            let resizeModeScaleY = 1;\n            let extraX = 0;\n            let extraY = 0;\n            const { width: tw, height: th } = texture.dimensions;\n            const txAspectRatio = tw / th;\n            const nodeAspectRatio = width / height;\n            if (txAspectRatio > nodeAspectRatio) {\n                // Texture is wider than node\n                // Center the node vertically (shift down by extraY)\n                // Scale the node vertically to maintain original aspect ratio\n                const scaleX = width / tw;\n                const scaledTxHeight = th * scaleX;\n                extraY = (height - scaledTxHeight) / 2;\n                resizeModeScaleY = scaledTxHeight / height;\n            }\n            else {\n                // Texture is taller than node (or equal)\n                // Center the node horizontally (shift right by extraX)\n                // Scale the node horizontally to maintain original aspect ratio\n                const scaleY = height / th;\n                const scaledTxWidth = tw * scaleY;\n                extraX = (width - scaledTxWidth) / 2;\n                resizeModeScaleX = scaledTxWidth / width;\n            }\n            // Apply the extra translation and scale to the local transform\n            this.localTransform\n                .translate(extraX, extraY)\n                .scale(resizeModeScaleX, resizeModeScaleY);\n        }\n        this.setUpdateType(UpdateType.Global);\n    }\n    /**\n     * @todo: test for correct calculation flag\n     * @param delta\n     */\n    update(delta, parentClippingRect) {\n        if (this.updateType & UpdateType.ScaleRotate) {\n            this.updateScaleRotateTransform();\n            this.setUpdateType(UpdateType.Local);\n        }\n        if (this.updateType & UpdateType.Local) {\n            this.updateLocalTransform();\n            this.setUpdateType(UpdateType.Global);\n        }\n        const parent = this.props.parent;\n        let childUpdateType = UpdateType.None;\n        if (this.updateType & UpdateType.ParentRenderTexture) {\n            let p = this.parent;\n            while (p) {\n                if (p.rtt) {\n                    this.parentHasRenderTexture = true;\n                }\n                p = p.parent;\n            }\n        }\n        // If we have render texture updates and not already running a full update\n        if (this.updateType ^ UpdateType.All &&\n            this.updateType & UpdateType.RenderTexture) {\n            this.children.forEach((child) => {\n                child.setUpdateType(UpdateType.All);\n            });\n        }\n        if (this.updateType & UpdateType.Global) {\n            assertTruthy(this.localTransform);\n            this.globalTransform = Matrix3d.copy(parent?.globalTransform || this.localTransform, this.globalTransform);\n            if (this.parentHasRenderTexture && this.props.parent?.rtt) {\n                this.globalTransform = Matrix3d.identity();\n            }\n            if (parent) {\n                this.globalTransform.multiply(this.localTransform);\n            }\n            this.calculateRenderCoords();\n            this.updateBoundingRect();\n            this.setUpdateType(UpdateType.Clipping | UpdateType.RenderState | UpdateType.Children);\n            childUpdateType |= UpdateType.Global;\n        }\n        if (this.updateType & UpdateType.Clipping) {\n            this.calculateClippingRect(parentClippingRect);\n            this.setUpdateType(UpdateType.Children);\n            childUpdateType |= UpdateType.Clipping;\n        }\n        if (this.updateType & UpdateType.WorldAlpha) {\n            if (parent) {\n                this.worldAlpha = parent.worldAlpha * this.props.alpha;\n            }\n            else {\n                this.worldAlpha = this.props.alpha;\n            }\n            this.setUpdateType(UpdateType.Children |\n                UpdateType.PremultipliedColors |\n                UpdateType.IsRenderable);\n            childUpdateType |= UpdateType.WorldAlpha;\n        }\n        if (this.updateType & UpdateType.PremultipliedColors) {\n            this.premultipliedColorTl = mergeColorAlphaPremultiplied(this.props.colorTl, this.worldAlpha, true);\n            // If all the colors are the same just sent them all to the same value\n            if (this.props.colorTl === this.props.colorTr &&\n                this.props.colorBl === this.props.colorBr &&\n                this.props.colorTl === this.props.colorBl) {\n                this.premultipliedColorTr =\n                    this.premultipliedColorBl =\n                        this.premultipliedColorBr =\n                            this.premultipliedColorTl;\n            }\n            else {\n                this.premultipliedColorTr = mergeColorAlphaPremultiplied(this.props.colorTr, this.worldAlpha, true);\n                this.premultipliedColorBl = mergeColorAlphaPremultiplied(this.props.colorBl, this.worldAlpha, true);\n                this.premultipliedColorBr = mergeColorAlphaPremultiplied(this.props.colorBr, this.worldAlpha, true);\n            }\n        }\n        if (this.updateType & UpdateType.RenderState) {\n            this.updateRenderState(parentClippingRect);\n            this.setUpdateType(UpdateType.IsRenderable);\n        }\n        if (this.updateType & UpdateType.IsRenderable) {\n            this.updateIsRenderable();\n        }\n        // No need to update zIndex if there is no parent\n        if (parent && this.updateType & UpdateType.CalculatedZIndex) {\n            this.calculateZIndex();\n            // Tell parent to re-sort children\n            parent.setUpdateType(UpdateType.ZIndexSortedChildren);\n        }\n        if (this.updateType & UpdateType.Children &&\n            this.children.length &&\n            !this.rtt) {\n            this.children.forEach((child) => {\n                // Trigger the depenedent update types on the child\n                child.setUpdateType(childUpdateType);\n                // If child has no updates, skip\n                if (child.updateType === 0) {\n                    return;\n                }\n                child.update(delta, this.clippingRect);\n            });\n        }\n        // Sorting children MUST happen after children have been updated so\n        // that they have the oppotunity to update their calculated zIndex.\n        if (this.updateType & UpdateType.ZIndexSortedChildren) {\n            // reorder z-index\n            this.sortChildren();\n        }\n        // reset update type\n        this.updateType = 0;\n    }\n    //check if CoreNode is renderable based on props\n    checkRenderProps() {\n        if (this.props.texture) {\n            return true;\n        }\n        if (!this.props.width || !this.props.height) {\n            return false;\n        }\n        if (this.props.shader !== this.stage.defShaderCtr) {\n            return true;\n        }\n        if (this.props.clipping) {\n            return true;\n        }\n        if (this.props.color !== 0) {\n            return true;\n        }\n        // Consider removing these checks and just using the color property check above.\n        // Maybe add a forceRender prop for nodes that should always render.\n        if (this.props.colorTop !== 0) {\n            return true;\n        }\n        if (this.props.colorBottom !== 0) {\n            return true;\n        }\n        if (this.props.colorLeft !== 0) {\n            return true;\n        }\n        if (this.props.colorRight !== 0) {\n            return true;\n        }\n        if (this.props.colorTl !== 0) {\n            return true;\n        }\n        if (this.props.colorTr !== 0) {\n            return true;\n        }\n        if (this.props.colorBl !== 0) {\n            return true;\n        }\n        if (this.props.colorBr !== 0) {\n            return true;\n        }\n        return false;\n    }\n    checkRenderBounds(parentClippingRect) {\n        assertTruthy(this.renderBound);\n        const rectW = parentClippingRect.width || this.stage.root.width;\n        const rectH = parentClippingRect.height || this.stage.root.height;\n        this.strictBound = createBound(parentClippingRect.x, parentClippingRect.y, parentClippingRect.x + rectW, parentClippingRect.y + rectH, this.strictBound);\n        if (boundInsideBound(this.renderBound, this.strictBound)) {\n            return CoreNodeRenderState.InViewport;\n        }\n        const renderM = this.stage.boundsMargin;\n        this.preloadBound = createBound(this.strictBound.x1 - renderM[3], this.strictBound.y1 - renderM[0], this.strictBound.x2 + renderM[1], this.strictBound.y2 + renderM[2], this.preloadBound);\n        if (boundInsideBound(this.renderBound, this.preloadBound)) {\n            return CoreNodeRenderState.InBounds;\n        }\n        return CoreNodeRenderState.OutOfBounds;\n    }\n    updateRenderState(parentClippingRect) {\n        const renderState = this.checkRenderBounds(parentClippingRect);\n        if (renderState === this.renderState) {\n            return;\n        }\n        const previous = this.renderState;\n        this.renderState = renderState;\n        const event = CoreNodeRenderStateMap.get(renderState);\n        assertTruthy(event);\n        this.emit(event, {\n            previous,\n            current: renderState,\n        });\n    }\n    /**\n     * This function updates the `isRenderable` property based on certain conditions.\n     *\n     * @returns\n     */\n    updateIsRenderable() {\n        let newIsRenderable;\n        if (this.worldAlpha === 0 || !this.checkRenderProps()) {\n            newIsRenderable = false;\n        }\n        else {\n            newIsRenderable = this.renderState > CoreNodeRenderState.OutOfBounds;\n        }\n        if (this.isRenderable !== newIsRenderable) {\n            this.isRenderable = newIsRenderable;\n            this.onChangeIsRenderable(newIsRenderable);\n        }\n    }\n    onChangeIsRenderable(isRenderable) {\n        this.texture?.setRenderableOwner(this, isRenderable);\n    }\n    calculateRenderCoords() {\n        const { width, height, globalTransform: transform } = this;\n        assertTruthy(transform);\n        const { tx, ty, ta, tb, tc, td } = transform;\n        if (tb === 0 && tc === 0) {\n            const minX = tx;\n            const maxX = tx + width * ta;\n            const minY = ty;\n            const maxY = ty + height * td;\n            this.renderCoords = RenderCoords.translate(\n            //top-left\n            minX, minY, \n            //top-right\n            maxX, minY, \n            //bottom-right\n            maxX, maxY, \n            //bottom-left\n            minX, maxY, this.renderCoords);\n        }\n        else {\n            this.renderCoords = RenderCoords.translate(\n            //top-left\n            tx, ty, \n            //top-right\n            tx + width * ta, ty + width * tc, \n            //bottom-right\n            tx + width * ta + height * tb, ty + width * tc + height * td, \n            //bottom-left\n            tx + height * tb, ty + height * td, this.renderCoords);\n        }\n    }\n    updateBoundingRect() {\n        const { renderCoords, globalTransform: transform } = this;\n        assertTruthy(transform);\n        assertTruthy(renderCoords);\n        const { tb, tc } = transform;\n        const { x1, y1, x3, y3 } = renderCoords;\n        if (tb === 0 || tc === 0) {\n            this.renderBound = createBound(x1, y1, x3, y3, this.renderBound);\n        }\n        else {\n            const { x2, x4, y2, y4 } = renderCoords;\n            this.renderBound = createBound(Math.min(x1, x2, x3, x4), Math.min(y1, y2, y3, y4), Math.max(x1, x2, x3, x4), Math.max(y1, y2, y3, y4), this.renderBound);\n        }\n    }\n    /**\n     * This function calculates the clipping rectangle for a node.\n     *\n     * The function then checks if the node is rotated. If the node requires clipping and is not rotated, a new clipping rectangle is created based on the node's global transform and dimensions.\n     * If a parent clipping rectangle exists, it is intersected with the node's clipping rectangle (if it exists), or replaces the node's clipping rectangle.\n     *\n     * Finally, the node's parentClippingRect and clippingRect properties are updated.\n     */\n    calculateClippingRect(parentClippingRect) {\n        assertTruthy(this.globalTransform);\n        const { clippingRect, props, globalTransform: gt } = this;\n        const { clipping } = props;\n        const isRotated = gt.tb !== 0 || gt.tc !== 0;\n        if (clipping && !isRotated) {\n            clippingRect.x = gt.tx;\n            clippingRect.y = gt.ty;\n            clippingRect.width = this.width * gt.ta;\n            clippingRect.height = this.height * gt.td;\n            clippingRect.valid = true;\n        }\n        else {\n            clippingRect.valid = false;\n        }\n        if (parentClippingRect.valid && clippingRect.valid) {\n            // Intersect parent clipping rect with node clipping rect\n            intersectRect(parentClippingRect, clippingRect, clippingRect);\n        }\n        else if (parentClippingRect.valid) {\n            // Copy parent clipping rect\n            copyRect(parentClippingRect, clippingRect);\n            clippingRect.valid = true;\n        }\n    }\n    calculateZIndex() {\n        const props = this.props;\n        const z = props.zIndex || 0;\n        const p = props.parent?.zIndex || 0;\n        let zIndex = z;\n        if (props.parent?.zIndexLocked) {\n            zIndex = z < p ? z : p;\n        }\n        this.calcZIndex = zIndex;\n    }\n    /**\n     * Destroy the node and cleanup all resources\n     */\n    destroy() {\n        this.unloadTexture();\n        this.clippingRect.valid = false;\n        this.isRenderable = false;\n        delete this.renderCoords;\n        delete this.renderBound;\n        delete this.strictBound;\n        delete this.preloadBound;\n        delete this.globalTransform;\n        delete this.scaleRotateTransform;\n        delete this.localTransform;\n        this.props.texture = null;\n        this.props.shader = this.stage.defShaderCtr;\n        const children = [...this.children];\n        for (let i = 0; i < children.length; i++) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            children[i].destroy();\n        }\n        // This very action will also remove the node from the parent's children array\n        this.parent = null;\n        if (this.rtt) {\n            this.stage.renderer.removeRTTNode(this);\n        }\n        this.removeAllListeners();\n    }\n    renderQuads(renderer) {\n        const { texture, width, height, textureOptions, rtt, shader } = this.props;\n        // Prevent quad rendering if parent has a render texture\n        // and renderer is not currently rendering to a texture\n        if (this.parentHasRenderTexture) {\n            if (!renderer.renderToTextureActive) {\n                return;\n            }\n            // Prevent quad rendering if parent render texture is not the active render texture\n            if (this.parentRenderTexture !== renderer.activeRttNode) {\n                return;\n            }\n        }\n        const { premultipliedColorTl, premultipliedColorTr, premultipliedColorBl, premultipliedColorBr, } = this;\n        const { zIndex, worldAlpha, globalTransform: gt, clippingRect, renderCoords, } = this;\n        assertTruthy(gt);\n        assertTruthy(renderCoords);\n        // add to list of renderables to be sorted before rendering\n        renderer.addQuad({\n            width,\n            height,\n            colorTl: premultipliedColorTl,\n            colorTr: premultipliedColorTr,\n            colorBl: premultipliedColorBl,\n            colorBr: premultipliedColorBr,\n            texture,\n            textureOptions,\n            zIndex,\n            shader: shader.shader,\n            shaderProps: shader.getResolvedProps(),\n            alpha: worldAlpha,\n            clippingRect,\n            tx: gt.tx,\n            ty: gt.ty,\n            ta: gt.ta,\n            tb: gt.tb,\n            tc: gt.tc,\n            td: gt.td,\n            renderCoords,\n            rtt,\n            parentHasRenderTexture: this.parentHasRenderTexture,\n            framebufferDimensions: this.framebufferDimensions,\n        });\n    }\n    //#region Properties\n    get id() {\n        return this._id;\n    }\n    get x() {\n        return this.props.x;\n    }\n    set x(value) {\n        if (this.props.x !== value) {\n            this.props.x = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get absX() {\n        return (this.props.x +\n            (this.props.parent?.absX || this.props.parent?.globalTransform?.tx || 0));\n    }\n    get absY() {\n        return this.props.y + (this.props.parent?.absY ?? 0);\n    }\n    get y() {\n        return this.props.y;\n    }\n    set y(value) {\n        if (this.props.y !== value) {\n            this.props.y = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get width() {\n        return this.props.width;\n    }\n    set width(value) {\n        if (this.props.width !== value) {\n            this.props.width = value;\n            this.setUpdateType(UpdateType.Local);\n            if (this.props.rtt) {\n                this.texture = this.stage.txManager.loadTexture('RenderTexture', {\n                    width: this.width,\n                    height: this.height,\n                });\n                this.textureOptions.preload = true;\n                this.setUpdateType(UpdateType.RenderTexture);\n            }\n        }\n    }\n    get height() {\n        return this.props.height;\n    }\n    set height(value) {\n        if (this.props.height !== value) {\n            this.props.height = value;\n            this.setUpdateType(UpdateType.Local);\n            if (this.props.rtt) {\n                this.texture = this.stage.txManager.loadTexture('RenderTexture', {\n                    width: this.width,\n                    height: this.height,\n                });\n                this.textureOptions.preload = true;\n                this.setUpdateType(UpdateType.RenderTexture);\n            }\n        }\n    }\n    get scale() {\n        // The CoreNode `scale` property is only used by Animations.\n        // Unlike INode, `null` should never be possibility for Animations.\n        return this.scaleX;\n    }\n    set scale(value) {\n        // The CoreNode `scale` property is only used by Animations.\n        // Unlike INode, `null` should never be possibility for Animations.\n        this.scaleX = value;\n        this.scaleY = value;\n    }\n    get scaleX() {\n        return this.props.scaleX;\n    }\n    set scaleX(value) {\n        if (this.props.scaleX !== value) {\n            this.props.scaleX = value;\n            this.setUpdateType(UpdateType.ScaleRotate);\n        }\n    }\n    get scaleY() {\n        return this.props.scaleY;\n    }\n    set scaleY(value) {\n        if (this.props.scaleY !== value) {\n            this.props.scaleY = value;\n            this.setUpdateType(UpdateType.ScaleRotate);\n        }\n    }\n    get mount() {\n        return this.props.mount;\n    }\n    set mount(value) {\n        if (this.props.mountX !== value || this.props.mountY !== value) {\n            this.props.mountX = value;\n            this.props.mountY = value;\n            this.props.mount = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get mountX() {\n        return this.props.mountX;\n    }\n    set mountX(value) {\n        if (this.props.mountX !== value) {\n            this.props.mountX = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get mountY() {\n        return this.props.mountY;\n    }\n    set mountY(value) {\n        if (this.props.mountY !== value) {\n            this.props.mountY = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get pivot() {\n        return this.props.pivot;\n    }\n    set pivot(value) {\n        if (this.props.pivotX !== value || this.props.pivotY !== value) {\n            this.props.pivotX = value;\n            this.props.pivotY = value;\n            this.props.pivot = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get pivotX() {\n        return this.props.pivotX;\n    }\n    set pivotX(value) {\n        if (this.props.pivotX !== value) {\n            this.props.pivotX = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get pivotY() {\n        return this.props.pivotY;\n    }\n    set pivotY(value) {\n        if (this.props.pivotY !== value) {\n            this.props.pivotY = value;\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get rotation() {\n        return this.props.rotation;\n    }\n    set rotation(value) {\n        if (this.props.rotation !== value) {\n            this.props.rotation = value;\n            this.setUpdateType(UpdateType.ScaleRotate);\n        }\n    }\n    get alpha() {\n        return this.props.alpha;\n    }\n    set alpha(value) {\n        this.props.alpha = value;\n        this.setUpdateType(UpdateType.PremultipliedColors | UpdateType.WorldAlpha);\n    }\n    get autosize() {\n        return this.props.autosize;\n    }\n    set autosize(value) {\n        this.props.autosize = value;\n    }\n    get clipping() {\n        return this.props.clipping;\n    }\n    set clipping(value) {\n        this.props.clipping = value;\n        this.setUpdateType(UpdateType.Clipping);\n    }\n    get color() {\n        return this.props.color;\n    }\n    set color(value) {\n        this.colorTop = value;\n        this.colorBottom = value;\n        this.colorLeft = value;\n        this.colorRight = value;\n        this.props.color = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorTop() {\n        return this.props.colorTop;\n    }\n    set colorTop(value) {\n        if (this.props.colorTl !== value || this.props.colorTr !== value) {\n            this.colorTl = value;\n            this.colorTr = value;\n        }\n        this.props.colorTop = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorBottom() {\n        return this.props.colorBottom;\n    }\n    set colorBottom(value) {\n        if (this.props.colorBl !== value || this.props.colorBr !== value) {\n            this.colorBl = value;\n            this.colorBr = value;\n        }\n        this.props.colorBottom = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorLeft() {\n        return this.props.colorLeft;\n    }\n    set colorLeft(value) {\n        if (this.props.colorTl !== value || this.props.colorBl !== value) {\n            this.colorTl = value;\n            this.colorBl = value;\n        }\n        this.props.colorLeft = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorRight() {\n        return this.props.colorRight;\n    }\n    set colorRight(value) {\n        if (this.props.colorTr !== value || this.props.colorBr !== value) {\n            this.colorTr = value;\n            this.colorBr = value;\n        }\n        this.props.colorRight = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorTl() {\n        return this.props.colorTl;\n    }\n    set colorTl(value) {\n        this.props.colorTl = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorTr() {\n        return this.props.colorTr;\n    }\n    set colorTr(value) {\n        this.props.colorTr = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorBl() {\n        return this.props.colorBl;\n    }\n    set colorBl(value) {\n        this.props.colorBl = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    get colorBr() {\n        return this.props.colorBr;\n    }\n    set colorBr(value) {\n        this.props.colorBr = value;\n        this.setUpdateType(UpdateType.PremultipliedColors);\n    }\n    // we're only interested in parent zIndex to test\n    // if we should use node zIndex is higher then parent zIndex\n    get zIndexLocked() {\n        return this.props.zIndexLocked || 0;\n    }\n    set zIndexLocked(value) {\n        this.props.zIndexLocked = value;\n        this.setUpdateType(UpdateType.CalculatedZIndex | UpdateType.Children);\n        this.children.forEach((child) => {\n            child.setUpdateType(UpdateType.CalculatedZIndex);\n        });\n    }\n    get zIndex() {\n        return this.props.zIndex;\n    }\n    set zIndex(value) {\n        this.props.zIndex = value;\n        this.setUpdateType(UpdateType.CalculatedZIndex | UpdateType.Children);\n        this.children.forEach((child) => {\n            child.setUpdateType(UpdateType.CalculatedZIndex);\n        });\n    }\n    get parent() {\n        return this.props.parent;\n    }\n    set parent(newParent) {\n        const oldParent = this.props.parent;\n        if (oldParent === newParent) {\n            return;\n        }\n        this.props.parent = newParent;\n        if (oldParent) {\n            const index = oldParent.children.indexOf(this);\n            assertTruthy(index !== -1, \"CoreNode.parent: Node not found in old parent's children!\");\n            oldParent.children.splice(index, 1);\n            oldParent.setUpdateType(UpdateType.Children | UpdateType.ZIndexSortedChildren);\n        }\n        if (newParent) {\n            newParent.children.push(this);\n            // Since this node has a new parent, to be safe, have it do a full update.\n            this.setUpdateType(UpdateType.All);\n            // Tell parent that it's children need to be updated and sorted.\n            newParent.setUpdateType(UpdateType.Children | UpdateType.ZIndexSortedChildren);\n            if (newParent.rtt || newParent.parentHasRenderTexture) {\n                this.setRTTUpdates(UpdateType.All);\n            }\n        }\n        this.updateScaleRotateTransform();\n    }\n    get rtt() {\n        return this.props.rtt;\n    }\n    set rtt(value) {\n        if (this.props.rtt === true) {\n            this.props.rtt = value;\n            // unload texture if we used to have a render texture\n            if (value === false && this.texture !== null) {\n                this.unloadTexture();\n                this.setUpdateType(UpdateType.All);\n                this.children.forEach((child) => {\n                    child.parentHasRenderTexture = false;\n                });\n                this.stage.renderer?.removeRTTNode(this);\n                return;\n            }\n        }\n        // if the new value is false and we didnt have rtt previously, we don't need to do anything\n        if (value === false) {\n            return;\n        }\n        // load texture\n        this.texture = this.stage.txManager.loadTexture('RenderTexture', {\n            width: this.width,\n            height: this.height,\n        });\n        this.textureOptions.preload = true;\n        this.props.rtt = true;\n        this.hasRTTupdates = true;\n        this.setUpdateType(UpdateType.All);\n        this.children.forEach((child) => {\n            child.setUpdateType(UpdateType.All);\n        });\n        // Store RTT nodes in a separate list\n        this.stage.renderer?.renderToTexture(this);\n    }\n    get shader() {\n        return this.props.shader;\n    }\n    set shader(value) {\n        if (this.props.shader === value) {\n            return;\n        }\n        this.props.shader = value;\n        this.setUpdateType(UpdateType.IsRenderable);\n    }\n    get src() {\n        return this.props.src;\n    }\n    set src(imageUrl) {\n        if (this.props.src === imageUrl) {\n            return;\n        }\n        this.props.src = imageUrl;\n        if (!imageUrl) {\n            this.texture = null;\n            return;\n        }\n        this.texture = this.stage.txManager.loadTexture('ImageTexture', {\n            src: imageUrl,\n        });\n    }\n    /**\n     * Returns the framebuffer dimensions of the node.\n     * If the node has a render texture, the dimensions are the same as the node's dimensions.\n     * If the node does not have a render texture, the dimensions are inherited from the parent.\n     * If the node parent has a render texture and the node is a render texture, the nodes dimensions are used.\n     */\n    get framebufferDimensions() {\n        if (this.parentHasRenderTexture && !this.rtt && this.parent) {\n            return this.parent.framebufferDimensions;\n        }\n        return { width: this.width, height: this.height };\n    }\n    /**\n     * Returns the parent render texture node if it exists.\n     */\n    get parentRenderTexture() {\n        let parent = this.parent;\n        while (parent) {\n            if (parent.rtt) {\n                return parent;\n            }\n            parent = parent.parent;\n        }\n        return null;\n    }\n    get texture() {\n        return this.props.texture;\n    }\n    set texture(value) {\n        if (this.props.texture === value) {\n            return;\n        }\n        const oldTexture = this.props.texture;\n        if (oldTexture) {\n            oldTexture.setRenderableOwner(this, false);\n            this.unloadTexture();\n        }\n        this.props.texture = value;\n        if (value) {\n            value.setRenderableOwner(this, this.isRenderable);\n            this.loadTexture();\n        }\n        this.setUpdateType(UpdateType.IsRenderable);\n    }\n    set textureOptions(value) {\n        this.props.textureOptions = value;\n    }\n    get textureOptions() {\n        return this.props.textureOptions;\n    }\n    setRTTUpdates(type) {\n        this.hasRTTupdates = true;\n        this.parent?.setRTTUpdates(type);\n    }\n    animate(props, settings) {\n        const animation = new CoreAnimation(this, props, settings);\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call\n        const controller = new CoreAnimationController(this.stage.animationManager, animation);\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return controller;\n    }\n    flush() {\n        // no-op\n    }\n}\n//# sourceMappingURL=CoreNode.js.map","import { CoreNode, } from '../core/CoreNode.js';\nimport {} from './Renderer.js';\nimport { isProductionEnvironment } from '../utils.js';\nconst stylePropertyMap = {\n    alpha: (v) => {\n        if (v === 1) {\n            return null;\n        }\n        return { prop: 'opacity', value: `${v}` };\n    },\n    x: (x) => {\n        return { prop: 'left', value: `${x}px` };\n    },\n    y: (y) => {\n        return { prop: 'top', value: `${y}px` };\n    },\n    width: (w) => {\n        if (w === 0) {\n            return null;\n        }\n        return { prop: 'width', value: `${w}px` };\n    },\n    height: (h) => {\n        if (h === 0) {\n            return null;\n        }\n        return { prop: 'height', value: `${h}px` };\n    },\n    zIndex: () => 'zIndex',\n    fontFamily: () => 'font-family',\n    fontSize: () => 'font-size',\n    fontStyle: () => 'font-style',\n    fontWeight: () => 'font-weight',\n    fontStretch: () => 'font-stretch',\n    lineHeight: () => 'line-height',\n    letterSpacing: () => 'letter-spacing',\n    textAlign: () => 'text-align',\n    overflowSuffix: () => 'overflow-suffix',\n    maxLines: () => 'max-lines',\n    contain: () => 'contain',\n    verticalAlign: () => 'vertical-align',\n    clipping: (v) => {\n        if (v === false) {\n            return null;\n        }\n        return { prop: 'overflow', value: v ? 'hidden' : 'visible' };\n    },\n    rotation: (v) => {\n        if (v === 0) {\n            return null;\n        }\n        return { prop: 'transform', value: `rotate(${v}rad)` };\n    },\n    scale: (v) => {\n        if (v === 1) {\n            return null;\n        }\n        return { prop: 'transform', value: `scale(${v})` };\n    },\n    scaleX: (v) => {\n        if (v === 1) {\n            return null;\n        }\n        return { prop: 'transform', value: `scaleX(${v})` };\n    },\n    scaleY: (v) => {\n        if (v === 1) {\n            return null;\n        }\n        return { prop: 'transform', value: `scaleY(${v})` };\n    },\n    color: (v) => {\n        if (v === 0) {\n            return null;\n        }\n        return { prop: 'color', value: convertColorToRgba(v) };\n    },\n};\nconst convertColorToRgba = (color) => {\n    const a = (color & 0xff) / 255;\n    const b = (color >> 8) & 0xff;\n    const g = (color >> 16) & 0xff;\n    const r = (color >> 24) & 0xff;\n    return `rgba(${r},${g},${b},${a})`;\n};\nconst domPropertyMap = {\n    id: 'id',\n};\nconst gradientColorPropertyMap = [\n    'colorTop',\n    'colorBottom',\n    'colorLeft',\n    'colorRight',\n    'colorTl',\n    'colorTr',\n    'colorBl',\n    'colorBr',\n];\nexport class Inspector {\n    root = null;\n    canvas = null;\n    height = 1080;\n    width = 1920;\n    scaleX = 1;\n    scaleY = 1;\n    constructor(canvas, settings) {\n        if (isProductionEnvironment())\n            return;\n        if (!settings) {\n            throw new Error('settings is required');\n        }\n        // calc dimensions based on the devicePixelRatio\n        this.height = Math.ceil(settings.appHeight ?? 1080 / (settings.deviceLogicalPixelRatio ?? 1));\n        this.width = Math.ceil(settings.appWidth ?? 1900 / (settings.deviceLogicalPixelRatio ?? 1));\n        this.scaleX = settings.deviceLogicalPixelRatio ?? 1;\n        this.scaleY = settings.deviceLogicalPixelRatio ?? 1;\n        this.canvas = canvas;\n        this.root = document.createElement('div');\n        this.setRootPosition();\n        document.body.appendChild(this.root);\n        //listen for changes on canvas\n        const mutationObserver = new MutationObserver(this.setRootPosition.bind(this));\n        mutationObserver.observe(canvas, {\n            attributes: true,\n            childList: false,\n            subtree: false,\n        });\n        // Create a ResizeObserver to watch for changes in the element's size\n        const resizeObserver = new ResizeObserver(this.setRootPosition.bind(this));\n        resizeObserver.observe(canvas);\n        //listen for changes on window\n        window.addEventListener('resize', this.setRootPosition.bind(this));\n        console.warn('Inspector is enabled, this will impact performance');\n    }\n    setRootPosition() {\n        if (this.root === null || this.canvas === null) {\n            return;\n        }\n        // get the world position of the canvas object, so we can match the inspector to it\n        const rect = this.canvas.getBoundingClientRect();\n        const top = document.documentElement.scrollTop + rect.top;\n        const left = document.documentElement.scrollLeft + rect.left;\n        this.root.id = 'root';\n        this.root.style.left = `${left}px`;\n        this.root.style.top = `${top}px`;\n        this.root.style.width = `${this.width}px`;\n        this.root.style.height = `${this.height}px`;\n        this.root.style.position = 'absolute';\n        this.root.style.transformOrigin = '0 0 0';\n        this.root.style.transform = `scale(${this.scaleX}, ${this.scaleY})`;\n        this.root.style.overflow = 'hidden';\n        this.root.style.zIndex = '65534';\n    }\n    createDiv(id, properties) {\n        const div = document.createElement('div');\n        div.style.position = 'absolute';\n        div.id = id.toString();\n        // set initial properties\n        for (const key in properties) {\n            this.updateNodeProperty(div, \n            // really typescript? really?\n            key, properties[key]);\n        }\n        return div;\n    }\n    createNode(node) {\n        const div = this.createDiv(node.id, node.props);\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n        div.node = node;\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n        node.div = div;\n        return this.createProxy(node, div);\n    }\n    createTextNode(node) {\n        const div = this.createDiv(node.id, node.props);\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n        div.node = node;\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n        node.div = div;\n        return this.createProxy(node, div);\n    }\n    createProxy(node, div) {\n        return new Proxy(node, {\n            set: (target, property, value) => {\n                this.updateNodeProperty(div, property, value);\n                return Reflect.set(target, property, value);\n            },\n            get: (target, property, receiver) => {\n                if (property === 'destroy') {\n                    this.destroyNode(target.id);\n                }\n                if (property === 'animate') {\n                    return (props, settings) => {\n                        const anim = target.animate(props, settings);\n                        // Trap the animate start function so we can update the inspector accordingly\n                        return new Proxy(anim, {\n                            get: (target, property, receiver) => {\n                                if (property === 'start') {\n                                    this.animateNode(div, props, settings);\n                                }\n                                return Reflect.get(target, property, receiver);\n                            },\n                        });\n                    };\n                }\n                return Reflect.get(target, property, receiver);\n            },\n        });\n    }\n    destroyNode(id) {\n        const div = document.getElementById(id.toString());\n        div?.remove();\n    }\n    updateNodeProperty(div, property, \n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    value) {\n        if (this.root === null || value === undefined || value === null) {\n            return;\n        }\n        /**\n         * Special case for parent property\n         */\n        if (property === 'parent') {\n            const parentId = value.id;\n            // only way to detect if the parent is the root node\n            // if you are reading this and have a better way, please let me know\n            if (parentId === 1) {\n                this.root.appendChild(div);\n                return;\n            }\n            const parent = document.getElementById(parentId.toString());\n            parent?.appendChild(div);\n            return;\n        }\n        // special case for text\n        if (property === 'text') {\n            div.innerHTML = String(value);\n            // hide text because we can't render SDF fonts\n            // it would look weird and obstruct the WebGL rendering\n            div.style.visibility = 'hidden';\n            return;\n        }\n        // special case for images\n        // we're not setting any CSS properties to avoid images getting loaded twice\n        // as the renderer will handle the loading of the image. Setting it to `data-src`\n        if (property === 'src' && value) {\n            div.setAttribute(`data-src`, String(value));\n            return;\n        }\n        // special case for color gradients (normal colors are handled by the stylePropertyMap)\n        // FIXME the renderer seems to return the same number for all colors\n        // if (gradientColorPropertyMap.includes(property as string)) {\n        //   const color = convertColorToRgba(value as number);\n        //   div.setAttribute(`data-${property}`, color);\n        //   return;\n        // }\n        // CSS mappable attribute\n        if (stylePropertyMap[property]) {\n            const mappedStyleResponse = stylePropertyMap[property]?.(value);\n            if (mappedStyleResponse === null) {\n                return;\n            }\n            if (typeof mappedStyleResponse === 'string') {\n                div.style.setProperty(mappedStyleResponse, String(value));\n                return;\n            }\n            if (typeof mappedStyleResponse === 'object') {\n                div.style.setProperty(mappedStyleResponse.prop, mappedStyleResponse.value);\n            }\n            return;\n        }\n        // DOM properties\n        if (domPropertyMap[property]) {\n            const domProperty = domPropertyMap[property];\n            if (!domProperty) {\n                return;\n            }\n            div.setAttribute(String(domProperty), String(value));\n            return;\n        }\n        // custom data properties\n        if (property === 'data') {\n            for (const key in value) {\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n                const keyValue = value[key];\n                if (keyValue === undefined) {\n                    div.removeAttribute(`data-${key}`);\n                }\n                else {\n                    div.setAttribute(`data-${key}`, String(keyValue));\n                }\n            }\n            return;\n        }\n    }\n    // simple animation handler\n    animateNode(div, props, settings) {\n        const { duration = 1000, delay = 0,\n        // easing = 'linear',\n        // repeat = 0,\n        // loop = false,\n        // stopMethod = false,\n         } = settings;\n        const { x, y, width, height, alpha = 1, rotation = 0, scale = 1, color, } = props;\n        // ignoring loops and repeats for now, as that might be a bit too much for the inspector\n        function animate() {\n            setTimeout(() => {\n                div.style.top = `${y}px`;\n                div.style.left = `${x}px`;\n                div.style.width = `${width}px`;\n                div.style.height = `${height}px`;\n                div.style.opacity = `${alpha}`;\n                div.style.rotate = `${rotation}rad`;\n                div.style.scale = `${scale}`;\n                div.style.color = convertColorToRgba(color);\n            }, duration);\n        }\n        setTimeout(animate, delay);\n    }\n}\n//# sourceMappingURL=Inspector.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport class CoreContextTexture {\n    textureSource;\n    memManager;\n    constructor(memManager, textureSource) {\n        this.memManager = memManager;\n        this.textureSource = textureSource;\n    }\n    setTextureMemUse(byteSize) {\n        this.memManager.setTextureMemUse(this.textureSource, byteSize);\n    }\n    get renderable() {\n        return this.textureSource.renderable;\n    }\n}\n//# sourceMappingURL=CoreContextTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { CoreContextTexture } from './CoreContextTexture.js';\nexport class CoreRenderer {\n    options;\n    mode;\n    stage;\n    //// Core Managers\n    txManager;\n    txMemManager;\n    shManager;\n    rttNodes = [];\n    constructor(options) {\n        this.options = options;\n        this.stage = options.stage;\n        this.txManager = options.txManager;\n        this.txMemManager = options.txMemManager;\n        this.shManager = options.shManager;\n    }\n}\n//# sourceMappingURL=CoreRenderer.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport class CoreRenderOp {\n}\n//# sourceMappingURL=CoreRenderOp.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport class CoreShader {\n    // abstract draw(): void;\n    static makeCacheKey(props) {\n        return false;\n    }\n    static resolveDefaults(props) {\n        return {};\n    }\n}\n//# sourceMappingURL=CoreShader.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n//#endregion Types\nexport function createShader(glw, type, source) {\n    const shader = glw.createShader(type);\n    if (!shader) {\n        throw new Error();\n    }\n    glw.shaderSource(shader, source);\n    glw.compileShader(shader);\n    const success = glw.getShaderParameter(shader, glw.COMPILE_STATUS);\n    if (success) {\n        return shader;\n    }\n    console.log(glw.getShaderInfoLog(shader));\n    glw.deleteShader(shader);\n}\nexport function createProgram(glw, vertexShader, fragmentShader) {\n    const program = glw.createProgram();\n    if (!program) {\n        throw new Error();\n    }\n    glw.attachShader(program, vertexShader);\n    glw.attachShader(program, fragmentShader);\n    glw.linkProgram(program);\n    const success = glw.getProgramParameter(program, glw.LINK_STATUS);\n    if (success) {\n        return program;\n    }\n    console.log(glw.getProgramInfoLog(program));\n    glw.deleteProgram(program);\n    return undefined;\n}\n//# sourceMappingURL=ShaderUtils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy, hasOwn } from '../../../utils.js';\nimport { CoreShader } from '../CoreShader.js';\nimport { createProgram, createShader, } from './internal/ShaderUtils.js';\nimport { isWebGl2 } from './internal/WebGlUtils.js';\nexport class WebGlCoreShader extends CoreShader {\n    boundBufferCollection = null;\n    buffersBound = false;\n    program;\n    /**\n     * Vertex Array Object\n     *\n     * @remarks\n     * Used by WebGL2 Only\n     */\n    vao;\n    renderer;\n    glw;\n    attributeBuffers;\n    attributeLocations;\n    attributeNames;\n    uniformLocations;\n    uniformTypes;\n    supportsIndexedTextures;\n    constructor(options) {\n        super();\n        const renderer = (this.renderer = options.renderer);\n        const glw = (this.glw = this.renderer.glw);\n        this.supportsIndexedTextures = options.supportsIndexedTextures || false;\n        // Check that extensions are supported\n        const webGl2 = glw.isWebGl2();\n        const requiredExtensions = (webGl2 && options.webgl2Extensions) ||\n            (!webGl2 && options.webgl1Extensions) ||\n            [];\n        const glVersion = webGl2 ? '2.0' : '1.0';\n        requiredExtensions.forEach((extensionName) => {\n            if (!glw.getExtension(extensionName)) {\n                throw new Error(`Shader \"${this.constructor.name}\" requires extension \"${extensionName}\" for WebGL ${glVersion} but wasn't found`);\n            }\n        });\n        // Gather shader sources\n        // - If WebGL 2 and special WebGL 2 sources are provided, we copy those sources and delete\n        // the extra copy of them to save memory.\n        // TODO: This could be further made optimal by just caching the compiled shaders and completely deleting\n        // the source code\n        const shaderSources = options.shaderSources ||\n            this.constructor.shaderSources;\n        if (!shaderSources) {\n            throw new Error(`Shader \"${this.constructor.name}\" is missing shaderSources.`);\n        }\n        else if (webGl2 && shaderSources?.webGl2) {\n            shaderSources.fragment = shaderSources.webGl2.fragment;\n            shaderSources.vertex = shaderSources.webGl2.vertex;\n            delete shaderSources.webGl2;\n        }\n        const textureUnits = renderer.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS;\n        const vertexSource = shaderSources.vertex instanceof Function\n            ? shaderSources.vertex(textureUnits)\n            : shaderSources.vertex;\n        const fragmentSource = shaderSources.fragment instanceof Function\n            ? shaderSources.fragment(textureUnits)\n            : shaderSources.fragment;\n        const vertexShader = createShader(glw, glw.VERTEX_SHADER, vertexSource);\n        const fragmentShader = createShader(glw, glw.FRAGMENT_SHADER, fragmentSource);\n        if (!vertexShader || !fragmentShader) {\n            throw new Error();\n        }\n        const program = createProgram(glw, vertexShader, fragmentShader);\n        if (!program) {\n            throw new Error();\n        }\n        this.program = program;\n        if (webGl2) {\n            const vao = glw.createVertexArray();\n            if (!vao) {\n                throw new Error();\n            }\n            this.vao = vao;\n            glw.bindVertexArray(this.vao);\n        }\n        this.attributeLocations = {};\n        this.attributeBuffers = {};\n        this.attributeNames = [];\n        [...options.attributes].forEach((attributeName) => {\n            const location = glw.getAttribLocation(this.program, attributeName);\n            if (location < 0) {\n                throw new Error(`${this.constructor.name}: Vertex shader must have an attribute \"${attributeName}\"!`);\n            }\n            const buffer = glw.createBuffer();\n            if (!buffer) {\n                throw new Error(`${this.constructor.name}: Could not create buffer for attribute \"${attributeName}\"`);\n            }\n            this.attributeLocations[attributeName] = location;\n            this.attributeBuffers[attributeName] = buffer;\n            this.attributeNames.push(attributeName);\n        });\n        this.uniformLocations = {};\n        this.uniformTypes = {};\n        options.uniforms.forEach((uniform) => {\n            const location = glw.getUniformLocation(this.program, uniform.name);\n            this.uniformTypes[uniform.name] = uniform.uniform;\n            if (!location) {\n                console.warn(`Shader \"${this.constructor.name}\" could not get uniform location for \"${uniform.name}\"`);\n                return;\n            }\n            this.uniformLocations[uniform.name] = location;\n        });\n    }\n    bindBufferAttribute(location, buffer, attribute) {\n        const { glw } = this;\n        glw.enableVertexAttribArray(location);\n        glw.vertexAttribPointer(buffer, location, attribute.size, attribute.type, attribute.normalized, attribute.stride, attribute.offset);\n    }\n    disableAttribute(location) {\n        this.glw.disableVertexAttribArray(location);\n    }\n    disableAttributes() {\n        for (const loc in this.attributeLocations) {\n            this.disableAttribute(this.attributeLocations[loc]);\n        }\n        this.boundBufferCollection = null;\n    }\n    /**\n     * Given two sets of Shader props destined for this Shader, determine if they can be batched together\n     * to reduce the number of draw calls.\n     *\n     * @remarks\n     * This is used by the {@link WebGlCoreRenderer} to determine if it can batch multiple consecutive draw\n     * calls into a single draw call.\n     *\n     * By default, this returns false (meaning no batching is allowed), but can be\n     * overridden by child classes to provide more efficient batching.\n     *\n     * @param propsA\n     * @param propsB\n     * @returns\n     */\n    canBatchShaderProps(propsA, propsB) {\n        return false;\n    }\n    bindRenderOp(renderOp, props) {\n        this.bindBufferCollection(renderOp.buffers);\n        if (renderOp.textures.length > 0) {\n            this.bindTextures(renderOp.textures);\n        }\n        const { glw, parentHasRenderTexture, renderToTexture } = renderOp;\n        // Skip if the parent and current operation both have render textures\n        if (renderToTexture && parentHasRenderTexture) {\n            return;\n        }\n        // Bind render texture framebuffer dimensions as resolution\n        // if the parent has a render texture\n        if (parentHasRenderTexture) {\n            const { width, height } = renderOp.framebufferDimensions || {};\n            // Force pixel ratio to 1.0 for render textures since they are always 1:1\n            // the final render texture will be rendered to the screen with the correct pixel ratio\n            this.setUniform('u_pixelRatio', 1.0);\n            // Set resolution to the framebuffer dimensions\n            this.setUniform('u_resolution', new Float32Array([width ?? 0, height ?? 0]));\n        }\n        else {\n            this.setUniform('u_pixelRatio', renderOp.options.pixelRatio);\n            this.setUniform('u_resolution', new Float32Array([glw.canvas.width, glw.canvas.height]));\n        }\n        if (props) {\n            // Bind optional automatic uniforms\n            // These are only bound if their keys are present in the props.\n            if (hasOwn(props, '$dimensions')) {\n                let dimensions = props.$dimensions;\n                if (!dimensions) {\n                    dimensions = renderOp.dimensions;\n                }\n                this.setUniform('u_dimensions', [dimensions.width, dimensions.height]);\n            }\n            if (hasOwn(props, '$alpha')) {\n                let alpha = props.$alpha;\n                if (!alpha) {\n                    alpha = renderOp.alpha;\n                }\n                this.setUniform('u_alpha', alpha);\n            }\n            this.bindProps(props);\n        }\n    }\n    setUniform(name, ...value) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion, @typescript-eslint/no-unsafe-argument\n        this.glw.setUniform(this.uniformTypes[name], this.uniformLocations[name], ...value);\n    }\n    bindBufferCollection(buffer) {\n        if (this.boundBufferCollection === buffer) {\n            return;\n        }\n        for (const attributeName in this.attributeLocations) {\n            const resolvedBuffer = buffer.getBuffer(attributeName);\n            const resolvedInfo = buffer.getAttributeInfo(attributeName);\n            assertTruthy(resolvedBuffer, `Buffer for \"${attributeName}\" not found`);\n            assertTruthy(resolvedInfo);\n            this.bindBufferAttribute(this.attributeLocations[attributeName], resolvedBuffer, resolvedInfo);\n        }\n        this.boundBufferCollection = buffer;\n    }\n    bindProps(props) {\n        // Implement in child class\n    }\n    bindTextures(textures) {\n        // no defaults\n    }\n    attach() {\n        this.glw.useProgram(this.program);\n        this.glw.useProgram(this.program);\n        if (this.glw.isWebGl2() && this.vao) {\n            this.glw.bindVertexArray(this.vao);\n        }\n    }\n    detach() {\n        this.disableAttributes();\n    }\n    static shaderSources;\n}\n//# sourceMappingURL=WebGlCoreShader.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { CoreRenderOp } from '../CoreRenderOp.js';\nimport { WebGlCoreShader } from './WebGlCoreShader.js';\nconst MAX_TEXTURES = 8; // TODO: get from gl\n/**\n * Can render multiple quads with multiple textures (up to vertex shader texture limit)\n *\n */\nexport class WebGlCoreRenderOp extends CoreRenderOp {\n    glw;\n    options;\n    buffers;\n    shader;\n    shaderProps;\n    alpha;\n    clippingRect;\n    dimensions;\n    bufferIdx;\n    zIndex;\n    renderToTexture;\n    parentHasRenderTexture;\n    framebufferDimensions;\n    length = 0;\n    numQuads = 0;\n    textures = [];\n    maxTextures;\n    constructor(glw, options, buffers, shader, shaderProps, alpha, clippingRect, dimensions, bufferIdx, zIndex, renderToTexture, parentHasRenderTexture, framebufferDimensions) {\n        super();\n        this.glw = glw;\n        this.options = options;\n        this.buffers = buffers;\n        this.shader = shader;\n        this.shaderProps = shaderProps;\n        this.alpha = alpha;\n        this.clippingRect = clippingRect;\n        this.dimensions = dimensions;\n        this.bufferIdx = bufferIdx;\n        this.zIndex = zIndex;\n        this.renderToTexture = renderToTexture;\n        this.parentHasRenderTexture = parentHasRenderTexture;\n        this.framebufferDimensions = framebufferDimensions;\n        this.maxTextures = shader.supportsIndexedTextures\n            ? glw.getParameter(glw.MAX_VERTEX_TEXTURE_IMAGE_UNITS)\n            : 1;\n    }\n    addTexture(texture) {\n        const { textures, maxTextures } = this;\n        const existingIdx = textures.findIndex((t) => t === texture);\n        if (existingIdx !== -1) {\n            return existingIdx;\n        }\n        const newIdx = textures.length;\n        if (newIdx >= maxTextures) {\n            return 0xffffffff;\n        }\n        this.textures.push(texture);\n        return newIdx;\n    }\n    draw() {\n        const { glw, shader, shaderProps, options } = this;\n        const { shManager } = options;\n        shManager.useShader(shader);\n        shader.bindRenderOp(this, shaderProps);\n        // TODO: Reduce calculations required\n        const quadIdx = (this.bufferIdx / 24) * 6 * 2;\n        // Clipping\n        if (this.clippingRect.valid) {\n            const { x, y, width, height } = this.clippingRect;\n            const pixelRatio = options.pixelRatio;\n            const canvasHeight = options.canvas.height;\n            const clipX = Math.round(x * pixelRatio);\n            const clipWidth = Math.round(width * pixelRatio);\n            const clipHeight = Math.round(height * pixelRatio);\n            const clipY = Math.round(canvasHeight - clipHeight - y * pixelRatio);\n            glw.setScissorTest(true);\n            glw.scissor(clipX, clipY, clipWidth, clipHeight);\n        }\n        else {\n            glw.setScissorTest(false);\n        }\n        glw.drawElements(glw.TRIANGLES, 6 * this.numQuads, glw.UNSIGNED_SHORT, quadIdx);\n    }\n}\n//# sourceMappingURL=WebGlCoreRenderOp.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Get device specific webgl parameters\n * @param glw\n */\nexport function getWebGlParameters(glw) {\n    const params = {\n        MAX_RENDERBUFFER_SIZE: 0,\n        MAX_TEXTURE_SIZE: 0,\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-explicit-any\n        MAX_VIEWPORT_DIMS: 0,\n        MAX_VERTEX_TEXTURE_IMAGE_UNITS: 0,\n        MAX_TEXTURE_IMAGE_UNITS: 0,\n        MAX_COMBINED_TEXTURE_IMAGE_UNITS: 0,\n        MAX_VERTEX_ATTRIBS: 0,\n        MAX_VARYING_VECTORS: 0,\n        MAX_VERTEX_UNIFORM_VECTORS: 0,\n        MAX_FRAGMENT_UNIFORM_VECTORS: 0,\n    };\n    // Map over all parameters and get them\n    const keys = Object.keys(params);\n    keys.forEach((key) => {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        params[key] = glw.getParameter(glw[key]);\n    });\n    return params;\n}\n/**\n * Get device webgl extensions\n * @param glw\n */\nexport function getWebGlExtensions(glw) {\n    const extensions = {\n        ANGLE_instanced_arrays: null,\n        WEBGL_compressed_texture_s3tc: null,\n        WEBGL_compressed_texture_astc: null,\n        WEBGL_compressed_texture_etc: null,\n        WEBGL_compressed_texture_etc1: null,\n        WEBGL_compressed_texture_pvrtc: null,\n        WEBKIT_WEBGL_compressed_texture_pvrtc: null,\n        WEBGL_compressed_texture_s3tc_srgb: null,\n        OES_vertex_array_object: null,\n    };\n    // Map over all extensions and get them\n    const keys = Object.keys(extensions);\n    keys.forEach((key) => {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        extensions[key] = glw.getExtension(key);\n    });\n    return extensions;\n}\n/**\n * Allocate big memory chunk that we\n * can re-use to draw quads\n *\n * @param glw\n * @param size\n */\nexport function createIndexBuffer(glw, size) {\n    const maxQuads = ~~(size / 80);\n    const indices = new Uint16Array(maxQuads * 6);\n    for (let i = 0, j = 0; i < maxQuads; i += 6, j += 4) {\n        indices[i] = j;\n        indices[i + 1] = j + 1;\n        indices[i + 2] = j + 2;\n        indices[i + 3] = j + 2;\n        indices[i + 4] = j + 1;\n        indices[i + 5] = j + 3;\n    }\n    const buffer = glw.createBuffer();\n    glw.elementArrayBufferData(buffer, indices, glw.STATIC_DRAW);\n}\n/**\n * Checks if an object is of type HTMLImageElement.\n * This is used because we cant check for HTMLImageElement directly when the\n * renderer is running in a seperate web worker context.\n *\n * @param obj\n * @returns\n */\nexport function isHTMLImageElement(obj) {\n    return (obj !== null &&\n        typeof obj === 'object' &&\n        obj.constructor &&\n        obj.constructor.name === 'HTMLImageElement');\n}\n//# sourceMappingURL=RendererUtils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../../utils.js';\nimport { isPowerOfTwo } from '../../utils.js';\nimport { CoreContextTexture } from '../CoreContextTexture.js';\nimport { isHTMLImageElement } from './internal/RendererUtils.js';\nconst TRANSPARENT_TEXTURE_DATA = new Uint8Array([0, 0, 0, 0]);\n/**\n * A wrapper around a WebGLTexture that handles loading the texture data\n * from a Texture source and uploading it to the GPU as well as freeing\n * the uploaded texture.\n *\n * @remarks\n * When accessing the ctxTexture property, the texture will be loaded if\n * it hasn't been already. ctxTexture will always return a valid WebGLTexture\n * and trigger the loading/uploading of the texture's data if it hasn't been\n * loaded yet.\n */\nexport class WebGlCoreCtxTexture extends CoreContextTexture {\n    glw;\n    _nativeCtxTexture = null;\n    _state = 'freed';\n    _w = 0;\n    _h = 0;\n    constructor(glw, memManager, textureSource) {\n        super(memManager, textureSource);\n        this.glw = glw;\n    }\n    get ctxTexture() {\n        if (this._state === 'freed') {\n            this.load();\n        }\n        assertTruthy(this._nativeCtxTexture);\n        return this._nativeCtxTexture;\n    }\n    get w() {\n        return this._w;\n    }\n    get h() {\n        return this._h;\n    }\n    /**\n     * Load the texture data from the Texture source and upload it to the GPU\n     *\n     * @remarks\n     * This method is called automatically when accessing the ctxTexture property\n     * if the texture hasn't been loaded yet. But it can also be called manually\n     * to force the texture to be pre-loaded prior to accessing the ctxTexture\n     * property.\n     */\n    load() {\n        // If the texture is already loading or loaded, don't load it again.\n        if (this._state === 'loading' || this._state === 'loaded') {\n            return;\n        }\n        this._state = 'loading';\n        this.textureSource.setState('loading');\n        this._nativeCtxTexture = this.createNativeCtxTexture();\n        this.onLoadRequest()\n            .then(({ width, height }) => {\n            // If the texture has been freed while loading, return early.\n            if (this._state === 'freed') {\n                return;\n            }\n            this._state = 'loaded';\n            this._w = width;\n            this._h = height;\n            // Update the texture source's width and height so that it can be used\n            // for rendering.\n            this.textureSource.setState('loaded', { width, height });\n        })\n            .catch((err) => {\n            // If the texture has been freed while loading, return early.\n            if (this._state === 'freed') {\n                return;\n            }\n            this._state = 'failed';\n            this.textureSource.setState('failed', err);\n            console.error(err);\n        });\n    }\n    /**\n     * Called when the texture data needs to be loaded and uploaded to a texture\n     */\n    async onLoadRequest() {\n        const { glw } = this;\n        // Set to a 1x1 transparent texture\n        glw.texImage2D(0, glw.RGBA, 1, 1, 0, glw.RGBA, glw.UNSIGNED_BYTE, null);\n        this.setTextureMemUse(TRANSPARENT_TEXTURE_DATA.byteLength);\n        const textureData = await this.textureSource?.getTextureData();\n        // If the texture has been freed while loading, return early.\n        if (!this._nativeCtxTexture) {\n            assertTruthy(this._state === 'freed');\n            return { width: 0, height: 0 };\n        }\n        let width = 0;\n        let height = 0;\n        assertTruthy(this._nativeCtxTexture);\n        glw.activeTexture(0);\n        // If textureData is null, the texture is empty (0, 0) and we don't need to\n        // upload any data to the GPU.\n        if (textureData.data instanceof ImageBitmap ||\n            textureData.data instanceof ImageData ||\n            // not using typeof HTMLImageElement due to web worker\n            isHTMLImageElement(textureData.data)) {\n            const data = textureData.data;\n            width = data.width;\n            height = data.height;\n            glw.bindTexture(this._nativeCtxTexture);\n            glw.pixelStorei(glw.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !!textureData.premultiplyAlpha);\n            glw.texImage2D(0, glw.RGBA, glw.RGBA, glw.UNSIGNED_BYTE, data);\n            this.setTextureMemUse(width * height * 4);\n            // generate mipmaps for power-of-2 textures or in WebGL2RenderingContext\n            if (glw.isWebGl2() || (isPowerOfTwo(width) && isPowerOfTwo(height))) {\n                glw.generateMipmap();\n            }\n        }\n        else if (textureData.data === null) {\n            width = 0;\n            height = 0;\n            // Reset to a 1x1 transparent texture\n            glw.bindTexture(this._nativeCtxTexture);\n            glw.texImage2D(0, glw.RGBA, 1, 1, 0, glw.RGBA, glw.UNSIGNED_BYTE, TRANSPARENT_TEXTURE_DATA);\n            this.setTextureMemUse(TRANSPARENT_TEXTURE_DATA.byteLength);\n        }\n        else if ('mipmaps' in textureData.data && textureData.data.mipmaps) {\n            const { mipmaps, width = 0, height = 0, type, glInternalFormat, } = textureData.data;\n            const view = type === 'ktx'\n                ? new DataView(mipmaps[0] ?? new ArrayBuffer(0))\n                : mipmaps[0];\n            glw.bindTexture(this._nativeCtxTexture);\n            glw.compressedTexImage2D(0, glInternalFormat, width, height, 0, view);\n            glw.texParameteri(glw.TEXTURE_WRAP_S, glw.CLAMP_TO_EDGE);\n            glw.texParameteri(glw.TEXTURE_WRAP_T, glw.CLAMP_TO_EDGE);\n            glw.texParameteri(glw.TEXTURE_MAG_FILTER, glw.LINEAR);\n            glw.texParameteri(glw.TEXTURE_MIN_FILTER, glw.LINEAR);\n            this.setTextureMemUse(view.byteLength);\n        }\n        else {\n            console.error(`WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned`, textureData);\n        }\n        return {\n            width,\n            height,\n        };\n    }\n    /**\n     * Free the WebGLTexture from the GPU\n     *\n     * @returns\n     */\n    free() {\n        if (this._state === 'freed') {\n            return;\n        }\n        this._state = 'freed';\n        this.textureSource.setState('freed');\n        this._w = 0;\n        this._h = 0;\n        if (!this._nativeCtxTexture) {\n            return;\n        }\n        const { glw } = this;\n        glw.deleteTexture(this._nativeCtxTexture);\n        this.setTextureMemUse(0);\n        this._nativeCtxTexture = null;\n    }\n    /**\n     * Create native context texture\n     *\n     * @remarks\n     * When this method returns the returned texture will be bound to the GL context state.\n     *\n     * @param width\n     * @param height\n     * @returns\n     */\n    createNativeCtxTexture() {\n        const { glw } = this;\n        const nativeTexture = glw.createTexture();\n        if (!nativeTexture) {\n            throw new Error('Could not create WebGL Texture');\n        }\n        // On initial load request, create a 1x1 transparent texture to use until\n        // the texture data is finally loaded.\n        glw.activeTexture(0);\n        glw.bindTexture(nativeTexture);\n        // linear texture filtering\n        glw.texParameteri(glw.TEXTURE_MAG_FILTER, glw.LINEAR);\n        glw.texParameteri(glw.TEXTURE_MIN_FILTER, glw.LINEAR);\n        // texture wrapping method\n        glw.texParameteri(glw.TEXTURE_WRAP_S, glw.CLAMP_TO_EDGE);\n        glw.texParameteri(glw.TEXTURE_WRAP_T, glw.CLAMP_TO_EDGE);\n        return nativeTexture;\n    }\n}\n//# sourceMappingURL=WebGlCoreCtxTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { EventEmitter } from '../../common/EventEmitter.js';\n/**\n * Represents a source of texture data for a CoreContextTexture.\n *\n * @remarks\n * Texture sources are used to populate a CoreContextTexture when that texture\n * is loaded. Texture data retrieved by the CoreContextTexture by the\n * `getTextureData` method. It's the responsibility of the concerete `Texture`\n * subclass to implement this method appropriately.\n */\nexport class Texture extends EventEmitter {\n    txManager;\n    /**\n     * The dimensions of the texture\n     *\n     * @remarks\n     * Until the texture data is loaded for the first time the value will be\n     * `null`.\n     */\n    dimensions = null;\n    error = null;\n    state = 'freed';\n    renderableOwners = new Set();\n    renderable = false;\n    lastRenderableChangeTime = 0;\n    constructor(txManager) {\n        super();\n        this.txManager = txManager;\n    }\n    /**\n     * Add/remove an owner to/from the Texture based on its renderability.\n     *\n     * @remarks\n     * Any object can own a texture, be it a CoreNode or even the state object\n     * from a Text Renderer.\n     *\n     * When the reference to the texture that an owner object holds is replaced\n     * or cleared it must call this with `renderable=false` to release the owner\n     * association.\n     *\n     * @param owner\n     * @param renderable\n     */\n    setRenderableOwner(owner, renderable) {\n        const oldSize = this.renderableOwners.size;\n        if (renderable) {\n            this.renderableOwners.add(owner);\n            const newSize = this.renderableOwners.size;\n            if (newSize > oldSize && newSize === 1) {\n                // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n                this.renderable = true;\n                this.lastRenderableChangeTime = this.txManager.frameTime;\n                this.onChangeIsRenderable?.(true);\n            }\n        }\n        else {\n            this.renderableOwners.delete(owner);\n            const newSize = this.renderableOwners.size;\n            if (newSize < oldSize && newSize === 0) {\n                // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n                this.renderable = false;\n                this.lastRenderableChangeTime = this.txManager.frameTime;\n                this.onChangeIsRenderable?.(false);\n            }\n        }\n    }\n    /**\n     * Get the CoreContextTexture for this Texture\n     *\n     * @remarks\n     * Each Texture has a corresponding CoreContextTexture that is used to\n     * manage the texture's native data depending on the renderer's mode\n     * (WebGL, Canvas, etc).\n     *\n     * The Texture and CoreContextTexture are always linked together in a 1:1\n     * relationship.\n     */\n    get ctxTexture() {\n        // The first time this is called, create the ctxTexture\n        const ctxTexture = this.txManager.renderer.createCtxTexture(this);\n        // And replace this getter with the value for future calls\n        Object.defineProperty(this, 'ctxTexture', { value: ctxTexture });\n        return ctxTexture;\n    }\n    /**\n     * Set the state of the texture\n     *\n     * @remark\n     * Intended for internal-use only but declared public so that it can be set\n     * by it's associated {@link CoreContextTexture}\n     *\n     * @param state\n     * @param args\n     */\n    setState(state, ...args) {\n        if (this.state !== state) {\n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n            this.state = state;\n            if (state === 'loaded') {\n                const loadedArgs = args;\n                this.dimensions = loadedArgs[0];\n            }\n            else if (state === 'failed') {\n                const failedArgs = args;\n                this.error = failedArgs[0];\n            }\n            this.emit(state, ...args);\n        }\n    }\n    /**\n     * Make a cache key for this texture.\n     *\n     * @remarks\n     * Each concrete `Texture` subclass must implement this method to provide an\n     * appropriate cache key for the texture type including the texture's\n     * properties that uniquely identify a copy of the texture. If the texture\n     * type does not support caching, then this method should return `false`.\n     *\n     * @param props\n     * @returns\n     * A cache key for this texture or `false` if the texture type does not\n     * support caching.\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    static makeCacheKey(props) {\n        return false;\n    }\n    /**\n     * Resolve the default values for the texture's properties.\n     *\n     * @remarks\n     * Each concrete `Texture` subclass must implement this method to provide\n     * default values for the texture's optional properties.\n     *\n     * @param props\n     * @returns\n     * The default values for the texture's properties.\n     */\n    static resolveDefaults(\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    props) {\n        return {};\n    }\n}\n//# sourceMappingURL=Texture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Texture } from './Texture.js';\n/**\n * Texture consisting of only a 1x1 color pixel\n *\n * @remarks\n * The pixel color is set with the {@link ColorTextureProps.color} prop.\n *\n * This is the default texture used for a Node if it's\n * {@link INodeProps.texture} prop is set to `null` (the default)\n *\n * Generally the 1x1 color pixel is stretched to whatever the set dimensions of\n * a Node are.\n */\nexport class ColorTexture extends Texture {\n    props;\n    constructor(txManager, props) {\n        super(txManager);\n        this.props = ColorTexture.resolveDefaults(props || {});\n    }\n    get color() {\n        return this.props.color;\n    }\n    set color(color) {\n        this.props.color = color;\n    }\n    async getTextureData() {\n        const pixelData32 = new Uint32Array([this.color]);\n        const pixelData8 = new Uint8ClampedArray(pixelData32.buffer);\n        return {\n            data: new ImageData(pixelData8, 1, 1),\n            premultiplyAlpha: true,\n        };\n    }\n    static makeCacheKey(props) {\n        const resolvedProps = ColorTexture.resolveDefaults(props);\n        return `ColorTexture,${resolvedProps.color}`;\n    }\n    static resolveDefaults(props) {\n        return {\n            color: props.color || 0xffffffff,\n        };\n    }\n    static z$__type__Props;\n}\n//# sourceMappingURL=ColorTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Texture, } from './Texture.js';\n/**\n * A Texture that is a sub-region of another Texture.\n *\n * @remarks\n * The parent texture can be a Sprite Sheet/Texture Atlas and set using the\n * {@link SubTextureProps.texture} prop. The sub-region relative to the parent\n * texture is defined with the {@link SubTextureProps.x},\n * {@link SubTextureProps.y}, {@link SubTextureProps.width}, and\n * {@link SubTextureProps.height} pixel values.\n */\nexport class SubTexture extends Texture {\n    props;\n    parentTexture;\n    constructor(txManager, props) {\n        super(txManager);\n        this.props = SubTexture.resolveDefaults(props || {});\n        this.parentTexture = this.props.texture;\n        // If parent texture is already loaded / failed, trigger loaded event manually\n        // so that users get a consistent event experience.\n        // We do this in a microtask to allow listeners to be attached in the same\n        // synchronous task after calling loadTexture()\n        queueMicrotask(() => {\n            const parentTx = this.parentTexture;\n            if (parentTx.state === 'loaded') {\n                this.onParentTxLoaded(parentTx, parentTx.dimensions);\n            }\n            else if (parentTx.state === 'failed') {\n                this.onParentTxFailed(parentTx, parentTx.error);\n            }\n            parentTx.on('loaded', this.onParentTxLoaded);\n            parentTx.on('failed', this.onParentTxFailed);\n        });\n    }\n    onParentTxLoaded = () => {\n        // We ignore the parent's passed dimensions, and simply use the SubTexture's\n        // configured dimensions (because that's all that matters here)\n        this.setState('loaded', {\n            width: this.props.width,\n            height: this.props.height,\n        });\n    };\n    onParentTxFailed = (target, error) => {\n        this.setState('failed', error);\n    };\n    onChangeIsRenderable(isRenderable) {\n        // Propagate the renderable owner change to the parent texture\n        this.parentTexture.setRenderableOwner(this, isRenderable);\n    }\n    async getTextureData() {\n        return {\n            data: this.props,\n        };\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    static makeCacheKey(props) {\n        return false;\n    }\n    static resolveDefaults(props) {\n        return {\n            texture: props.texture,\n            x: props.x || 0,\n            y: props.y || 0,\n            width: props.width || 0,\n            height: props.height || 0,\n        };\n    }\n    static z$__type__Props;\n}\n//# sourceMappingURL=SubTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { WebGlCoreCtxTexture } from './WebGlCoreCtxTexture.js';\nexport class WebGlCoreCtxSubTexture extends WebGlCoreCtxTexture {\n    constructor(glw, memManager, textureSource) {\n        super(glw, memManager, textureSource);\n    }\n    async onLoadRequest() {\n        const props = await this.textureSource.getTextureData();\n        return {\n            width: props.data?.width || 0,\n            height: props.data?.height || 0,\n        };\n    }\n}\n//# sourceMappingURL=WebGlCoreCtxSubTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { WebGlCoreShader } from '../WebGlCoreShader.js';\nexport class DefaultShader extends WebGlCoreShader {\n    constructor(renderer) {\n        super({\n            renderer,\n            attributes: ['a_position', 'a_textureCoordinate', 'a_color'],\n            uniforms: [\n                { name: 'u_resolution', uniform: 'uniform2fv' },\n                { name: 'u_pixelRatio', uniform: 'uniform1f' },\n                { name: 'u_texture', uniform: 'uniform2fv' },\n            ],\n        });\n    }\n    bindTextures(textures) {\n        const { glw } = this;\n        glw.activeTexture(0);\n        glw.bindTexture(textures[0].ctxTexture);\n    }\n    static shaderSources = {\n        vertex: `\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio;\n        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);\n\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);\n        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;\n      }\n    `,\n        fragment: `\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n          vec4 color = texture2D(u_texture, v_textureCoordinate);\n          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);\n      }\n    `,\n    };\n}\n//# sourceMappingURL=DefaultShader.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { WebGlCoreShader } from '../WebGlCoreShader.js';\n// import type { Texture } from '../textures/Texture';\nexport class DefaultShaderBatched extends WebGlCoreShader {\n    supportsIndexedTextures = true;\n    constructor(renderer) {\n        super({\n            renderer,\n            attributes: [\n                'a_position',\n                'a_textureCoordinate',\n                'a_color',\n                'a_textureIndex',\n            ],\n            uniforms: [\n                { name: 'u_resolution', uniform: 'uniform2fv' },\n                { name: 'u_pixelRatio', uniform: 'uniform1f' },\n                { name: 'u_textures[0]', uniform: 'uniform1iv' },\n            ],\n        });\n    }\n    bindTextures(texture) {\n        const { renderer, glw } = this;\n        if (texture.length > renderer.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS) {\n            throw new Error(`DefaultShaderBatched: Cannot bind more than ${renderer.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS} textures`);\n        }\n        texture.forEach((t, i) => {\n            glw.activeTexture(i);\n            glw.bindTexture(t.ctxTexture);\n        });\n        const samplers = Array.from(Array(texture.length).keys());\n        this.setUniform('u_textures[0]', samplers);\n    }\n    static shaderSources = {\n        vertex: `\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_textureCoordinate;\n      attribute vec2 a_position;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      void main(){\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_textureIndex = a_textureIndex;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    `,\n        fragment: (textureUnits) => `\n      #define txUnits ${textureUnits}\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_image;\n      uniform sampler2D u_textures[txUnits];\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      vec4 sampleFromTexture(sampler2D textures[${textureUnits}], int idx, vec2 uv) {\n        ${Array.from(Array(textureUnits).keys())\n            .map((idx) => `\n          ${idx !== 0 ? 'else ' : ''}if (idx == ${idx}) {\n            return texture2D(textures[${idx}], uv);\n          }\n        `)\n            .join('')}\n        return texture2D(textures[0], uv);\n      }\n\n      void main(){\n        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);\n      }\n    `,\n    };\n}\n//# sourceMappingURL=DefaultShaderBatched.js.map","export class ShaderEffect {\n    priority = 1;\n    name = '';\n    ref;\n    target;\n    passParameters = '';\n    declaredUniforms = '';\n    uniformInfo = {};\n    static uniforms = {};\n    static methods;\n    static onShaderMask;\n    static onColorize;\n    static onEffectMask;\n    static getEffectKey(props) {\n        return '';\n    }\n    static getMethodParameters(uniforms, props) {\n        const res = [];\n        for (const u in uniforms) {\n            const uni = uniforms[u];\n            let define = '';\n            if (uni.size) {\n                define = `[${uni.size(props)}]`;\n            }\n            res.push(`${uni.type} ${u}${define}`);\n        }\n        return res.join(',');\n    }\n    constructor(options) {\n        const { ref, target, props = {} } = options;\n        this.ref = ref;\n        this.target = target;\n        const uniformInfo = {};\n        const passParameters = [];\n        let declaredUniforms = '';\n        const uniforms = this.constructor.uniforms || {};\n        for (const u in uniforms) {\n            const unif = uniforms[u];\n            const uniType = unif.type;\n            //make unique uniform name\n            const uniformName = `${ref}_${u}`;\n            let define = '';\n            if (unif.size) {\n                define = `[${unif.size(props)}]`;\n            }\n            passParameters.push(uniformName);\n            declaredUniforms += `uniform ${uniType} ${uniformName}${define};`;\n            uniformInfo[u] = { name: uniformName, uniform: uniforms[u].method };\n        }\n        this.passParameters = passParameters.join(',');\n        this.declaredUniforms = declaredUniforms;\n        this.uniformInfo = uniformInfo;\n    }\n    static resolveDefaults(props) {\n        return {};\n    }\n    static makeEffectKey(props) {\n        return false;\n    }\n}\n//# sourceMappingURL=ShaderEffect.js.map","import { WebGlCoreShader, } from '../WebGlCoreShader.js';\nimport { ShaderEffect, } from './effects/ShaderEffect.js';\nimport { assertTruthy } from '../../../../utils.js';\nconst effectCache = new Map();\nconst getResolvedEffect = (effects, effectContructors) => {\n    const key = JSON.stringify(effects);\n    if (effectCache.has(key)) {\n        return effectCache.get(key);\n    }\n    effects = effects ?? [];\n    const resolvedEffects = [];\n    const effectsLength = effects.length;\n    let i = 0;\n    for (; i < effectsLength; i++) {\n        const { name, type, props } = effects[i];\n        const resolvedEffect = {\n            name,\n            type,\n            props: {},\n        };\n        const effectConstructor = effectContructors[type];\n        const defaultPropValues = effectConstructor.resolveDefaults(props);\n        const uniforms = effectConstructor.uniforms;\n        const uniformKeys = Object.keys(uniforms);\n        const uniformsLength = uniformKeys.length;\n        let j = 0;\n        for (; j < uniformsLength; j++) {\n            const key = uniformKeys[j];\n            const uniform = uniforms[key];\n            const result = {\n                value: defaultPropValues[key],\n                programValue: undefined,\n                updateOnBind: uniform.updateOnBind || false,\n                hasValidator: uniform.validator !== undefined,\n                hasProgramValueUpdater: uniform.updateProgramValue !== undefined,\n            };\n            const validatedValue = (result.hasValidator &&\n                uniform.validator(defaultPropValues[key], defaultPropValues)) ||\n                defaultPropValues[key];\n            if (defaultPropValues[key] !== validatedValue) {\n                result.validatedValue = validatedValue;\n            }\n            if (result.hasProgramValueUpdater) {\n                uniform.updateProgramValue(result);\n            }\n            if (result.programValue === undefined) {\n                result.programValue = result.value;\n            }\n            resolvedEffect.props[key] = result;\n        }\n        resolvedEffects.push(resolvedEffect);\n    }\n    effectCache.set(key, resolvedEffects);\n    return resolvedEffects;\n};\nexport class DynamicShader extends WebGlCoreShader {\n    effects = [];\n    constructor(renderer, props, effectContructors) {\n        const shader = DynamicShader.createShader(props, effectContructors);\n        super({\n            renderer,\n            attributes: ['a_position', 'a_textureCoordinate', 'a_color'],\n            uniforms: [\n                { name: 'u_resolution', uniform: 'uniform2fv' },\n                { name: 'u_pixelRatio', uniform: 'uniform1f' },\n                { name: 'u_texture', uniform: 'uniform2fv' },\n                { name: 'u_dimensions', uniform: 'uniform2fv' },\n                { name: 'u_alpha', uniform: 'uniform1f' },\n                ...shader.uniforms,\n            ],\n            shaderSources: {\n                vertex: shader.vertex,\n                fragment: shader.fragment,\n            },\n        });\n        this.effects = shader.effects;\n    }\n    bindTextures(textures) {\n        const { glw } = this;\n        glw.activeTexture(0);\n        glw.bindTexture(textures[0].ctxTexture);\n    }\n    bindProps(props) {\n        const effects = props.effects;\n        const effectsL = effects.length;\n        let i = 0;\n        for (; i < effectsL; i++) {\n            const effect = effects[i];\n            const uniformInfo = this.effects[i].uniformInfo;\n            const propKeys = Object.keys(effect.props);\n            const propsLength = propKeys.length;\n            let j = 0;\n            for (; j < propsLength; j++) {\n                const key = propKeys[j];\n                const prop = effect.props[key];\n                if (prop.updateOnBind === true) {\n                    const uniform = this.renderer.shManager.getRegisteredEffects()[effect.type]?.uniforms[key];\n                    uniform?.updateProgramValue(effect.props[key], props);\n                }\n                this.setUniform(uniformInfo[key].name, effect.props[key].programValue);\n            }\n        }\n    }\n    canBatchShaderProps(propsA, propsB) {\n        if (propsA.$dimensions.width !== propsB.$dimensions.width ||\n            propsA.$dimensions.height !== propsB.$dimensions.height ||\n            propsA.effects.length !== propsB.effects.length) {\n            return false;\n        }\n        const propsEffectsLen = propsA.effects.length;\n        let i = 0;\n        for (; i < propsEffectsLen; i++) {\n            const effectA = propsA.effects[i];\n            const effectB = propsB.effects[i];\n            if (effectA.type !== effectB.type) {\n                return false;\n            }\n            for (const key in effectA.props) {\n                if ((effectB.props && !effectB.props[key]) ||\n                    effectA.props[key].value !==\n                        effectB.props[key].value) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    static createShader(props, effectContructors) {\n        //counts duplicate effects\n        const effectNameCount = {};\n        const methods = {};\n        let declareUniforms = '';\n        const uniforms = [];\n        const uFx = [];\n        const effects = props.effects.map((effect) => {\n            const baseClass = effectContructors[effect.type];\n            const key = baseClass.getEffectKey(effect.props || {});\n            effectNameCount[key] = effectNameCount[key] ? ++effectNameCount[key] : 1;\n            const nr = effectNameCount[key];\n            if (nr === 1) {\n                uFx.push({ key, type: effect.type, props: effect.props });\n            }\n            //initialize new effect class;\n            const fxClass = new baseClass({\n                ref: `${key}${nr === 1 ? '' : nr}`,\n                target: key,\n                props: effect.props,\n            });\n            declareUniforms += fxClass.declaredUniforms;\n            uniforms.push(...Object.values(fxClass.uniformInfo));\n            return fxClass;\n        });\n        //build source\n        let effectMethods = '';\n        uFx?.forEach((fx) => {\n            const fxClass = effectContructors[fx.type];\n            const fxProps = fxClass.resolveDefaults((fx.props ?? {}));\n            const remap = [];\n            for (const m in fxClass.methods) {\n                let cm = m;\n                const fxMethod = fxClass.methods[m];\n                if (methods[m] && methods[m] !== fxMethod) {\n                    cm = DynamicShader.resolveMethodDuplicate(m, fxMethod, methods);\n                }\n                methods[cm] = fxMethod.replace('function', cm);\n                remap.push({ m, cm });\n            }\n            let onShaderMask = fxClass.onShaderMask instanceof Function\n                ? fxClass.onShaderMask(fxProps)\n                : fxClass.onShaderMask;\n            let onColorize = fxClass.onColorize instanceof Function\n                ? fxClass.onColorize(fxProps)\n                : fxClass.onColorize;\n            let onEffectMask = fxClass.onEffectMask instanceof Function\n                ? fxClass.onEffectMask(fxProps)\n                : fxClass.onEffectMask;\n            remap.forEach((r) => {\n                const { m, cm } = r;\n                const reg = new RegExp(`\\\\$${m}`, 'g');\n                if (onShaderMask) {\n                    onShaderMask = onShaderMask.replace(reg, cm);\n                }\n                if (onColorize) {\n                    onColorize = onColorize.replace(reg, cm);\n                }\n                if (onEffectMask) {\n                    onEffectMask = onEffectMask.replace(reg, cm);\n                }\n            });\n            const methodParameters = fxClass.getMethodParameters(fxClass.uniforms, fxProps);\n            const pm = methodParameters.length > 0 ? `, ${methodParameters}` : '';\n            if (onShaderMask) {\n                effectMethods += `\n        float fx_${fx.key}_onShaderMask(float shaderMask ${pm}) {\n          ${onShaderMask}\n        }\n        `;\n            }\n            if (onColorize) {\n                effectMethods += `\n          vec4 fx_${fx.key}_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor${pm}) {\n            ${onColorize}\n          }\n        `;\n            }\n            if (onEffectMask) {\n                effectMethods += `\n          vec4 fx_${fx.key}_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor${pm}) {\n            ${onEffectMask}\n          }\n        `;\n            }\n        });\n        let sharedMethods = '';\n        for (const m in methods) {\n            sharedMethods += methods[m];\n        }\n        //fill main functions\n        let currentMask = `mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))`;\n        let drawEffects = `\n\n    `;\n        for (let i = 0; i < effects.length; i++) {\n            const current = effects[i];\n            const pm = current.passParameters.length > 0 ? `, ${current.passParameters}` : '';\n            const currentClass = effectContructors[current.name];\n            if (currentClass.onShaderMask) {\n                drawEffects += `\n        shaderMask = fx_${current.target}_onShaderMask(shaderMask ${pm});\n        `;\n            }\n            if (currentClass.onColorize) {\n                drawEffects += `\n        maskColor = fx_${current.target}_onColorize(shaderMask, maskColor, shaderColor${pm});\n        `;\n            }\n            if (currentClass.onEffectMask) {\n                currentMask = `fx_${current.target}_onEffectMask(shaderMask, maskColor, shaderColor${pm})`;\n            }\n            const next = effects[i + 1];\n            if (next === undefined ||\n                effectContructors[next.name].onEffectMask) {\n                drawEffects += `\n          shaderColor = ${currentMask};\n        `;\n            }\n        }\n        return {\n            effects,\n            uniforms,\n            fragment: DynamicShader.fragment(declareUniforms, sharedMethods, effectMethods, drawEffects),\n            vertex: DynamicShader.vertex(),\n        };\n    }\n    static resolveMethodDuplicate(key, effectMethod, methodCollection, increment = 0) {\n        const m = key + (increment > 0 ? increment : '');\n        if (methodCollection[m] && methodCollection[m] !== effectMethod) {\n            return this.resolveMethodDuplicate(key, effectMethod, methodCollection, ++increment);\n        }\n        return m;\n    }\n    static resolveDefaults(props, effectContructors) {\n        assertTruthy(effectContructors);\n        return {\n            effects: getResolvedEffect(props.effects ?? [], effectContructors),\n            $dimensions: {\n                width: 0,\n                height: 0,\n            },\n            $alpha: 0,\n        };\n    }\n    static makeCacheKey(props, effectContructors) {\n        let fx = '';\n        props.effects?.forEach((effect) => {\n            const baseClass = effectContructors[effect.type];\n            const key = baseClass.getEffectKey(effect.props || {});\n            fx += `,${key}`;\n        });\n        return `DynamicShader${fx}`;\n    }\n    static z$__type__Props;\n    static vertex = () => `\n    # ifdef GL_FRAGMENT_PRESICISON_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    attribute vec2 a_textureCoordinate;\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    attribute float a_textureIndex;\n\n    uniform vec2 u_resolution;\n    uniform float u_pixelRatio;\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n    varying float v_textureIndex;\n\n    void main(){\n      vec2 normalized = a_position * u_pixelRatio / u_resolution;\n      vec2 zero_two = normalized * 2.0;\n      vec2 clip_space = zero_two - 1.0;\n\n      // pass to fragment\n      v_color = a_color;\n      v_textureCoordinate = a_textureCoordinate;\n      v_textureIndex = a_textureIndex;\n\n      // flip y\n      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n    }\n  `;\n    static fragment = (uniforms, methods, effectMethods, drawEffects) => `\n    # ifdef GL_FRAGMENT_PRESICISON_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    #define PI 3.14159265359\n\n    uniform vec2 u_resolution;\n    uniform vec2 u_dimensions;\n    uniform float u_alpha;\n    uniform float u_radius;\n    uniform sampler2D u_texture;\n    uniform float u_pixelRatio;\n\n    ${uniforms}\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n\n    ${methods}\n\n    ${effectMethods}\n\n    void main() {\n      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;\n      vec2 d = abs(p) - (u_dimensions) * 0.5;\n      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n\n      vec4 shaderColor = vec4(0.0);\n      float shaderMask = lng_DefaultMask;\n\n      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;\n\n      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));\n\n      ${drawEffects}\n\n      gl_FragColor = shaderColor * u_alpha;\n    }\n  `;\n}\n//# sourceMappingURL=DynamicShader.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { WebGlCoreShader, } from '../WebGlCoreShader.js';\n/**\n * Similar to the {@link DefaultShader} but cuts out 4 rounded rectangle corners\n * as defined by the specified corner {@link RoundedRectangleProps.radius}\n */\nexport class RoundedRectangle extends WebGlCoreShader {\n    constructor(renderer) {\n        super({\n            renderer,\n            attributes: ['a_position', 'a_textureCoordinate', 'a_color'],\n            uniforms: [\n                { name: 'u_resolution', uniform: 'uniform2fv' },\n                { name: 'u_pixelRatio', uniform: 'uniform1f' },\n                { name: 'u_texture', uniform: 'uniform2f' },\n                { name: 'u_dimensions', uniform: 'uniform2fv' },\n                { name: 'u_radius', uniform: 'uniform1f' },\n            ],\n        });\n    }\n    static z$__type__Props;\n    static resolveDefaults(props) {\n        return {\n            radius: props.radius || 10,\n            $dimensions: {\n                width: 0,\n                height: 0,\n            },\n        };\n    }\n    bindTextures(textures) {\n        const { glw } = this;\n        glw.activeTexture(0);\n        glw.bindTexture(textures[0].ctxTexture);\n    }\n    bindProps(props) {\n        this.setUniform('u_radius', props.radius);\n    }\n    canBatchShaderProps(propsA, propsB) {\n        return (propsA.radius === propsB.radius &&\n            propsA.$dimensions.width === propsB.$dimensions.width &&\n            propsA.$dimensions.height === propsB.$dimensions.height);\n    }\n    static shaderSources = {\n        vertex: `\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    `,\n        fragment: `\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform vec2 u_dimensions;\n      uniform float u_radius;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n\n      float fillMask(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n\n      void main() {\n        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;\n        vec2 halfDimensions = u_dimensions * 0.5;\n\n        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);\n        gl_FragColor = mix(vec4(0.0), color, fillMask(d));\n      }\n    `,\n    };\n}\n//# sourceMappingURL=RoundedRectangle.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../lib/utils.js';\nimport { WebGlCoreShader } from '../WebGlCoreShader.js';\nconst IDENTITY_MATRIX_3x3 = new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);\n/**\n * SdfShader supports multi-channel and single-channel signed distance field textures.\n *\n * @remarks\n * This Shader is used by the {@link SdfTextRenderer}. Do not use thie Shader\n * directly. Instead create a Text Node and assign a SDF font family to it.\n *\n * @internalRemarks\n * The only thing this shader does to support multi-channel SDFs is to\n * add a median function to the fragment shader. If this one function call\n * ends up being a performance bottleneck we can always look at ways to\n * remove it.\n */\nexport class SdfShader extends WebGlCoreShader {\n    constructor(renderer) {\n        super({\n            renderer,\n            attributes: ['a_position', 'a_textureCoordinate'],\n            uniforms: [\n                { name: 'u_resolution', uniform: 'uniform2fv' },\n                { name: 'u_transform', uniform: 'uniformMatrix3fv' },\n                { name: 'u_scrollY', uniform: 'uniform1f' },\n                { name: 'u_pixelRatio', uniform: 'uniform1f' },\n                { name: 'u_texture', uniform: 'uniform2f' },\n                { name: 'u_color', uniform: 'uniform4fv' },\n                { name: 'u_size', uniform: 'uniform1f' },\n                { name: 'u_distanceRange', uniform: 'uniform1f' },\n                { name: 'u_debug', uniform: 'uniform1i' },\n            ],\n        });\n    }\n    bindTextures(textures) {\n        const { glw } = this;\n        glw.activeTexture(0);\n        glw.bindTexture(textures[0].ctxTexture);\n    }\n    bindProps(props) {\n        const resolvedProps = SdfShader.resolveDefaults(props);\n        for (const key in resolvedProps) {\n            if (key === 'transform') {\n                this.setUniform('u_transform', false, resolvedProps[key]);\n            }\n            else if (key === 'scrollY') {\n                this.setUniform('u_scrollY', resolvedProps[key]);\n            }\n            else if (key === 'color') {\n                const components = getNormalizedRgbaComponents(resolvedProps.color);\n                this.setUniform('u_color', components);\n            }\n            else if (key === 'size') {\n                this.setUniform('u_size', resolvedProps[key]);\n            }\n            else if (key === 'distanceRange') {\n                this.setUniform('u_distanceRange', resolvedProps[key]);\n            }\n            else if (key === 'debug') {\n                this.setUniform('u_debug', resolvedProps[key] ? 1.0 : 0.0);\n            }\n        }\n    }\n    static resolveDefaults(props = {}) {\n        return {\n            transform: props.transform ?? IDENTITY_MATRIX_3x3,\n            scrollY: props.scrollY ?? 0,\n            color: props.color ?? 0xffffffff,\n            size: props.size ?? 16,\n            distanceRange: props.distanceRange ?? 1.0,\n            debug: props.debug ?? false,\n        };\n    }\n    static shaderSources = {\n        vertex: `\n      // an attribute is an input (in) to a vertex shader.\n      // It will receive data from a buffer\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n\n      uniform vec2 u_resolution;\n      uniform mat3 u_transform;\n      uniform float u_scrollY;\n      uniform float u_pixelRatio;\n      uniform float u_size;\n\n      varying vec2 v_texcoord;\n\n      void main() {\n        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);\n        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;\n\n        // Calculate screen space with pixel ratio\n        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);\n\n        gl_Position = vec4(screenSpace, 0.0, 1.0);\n        v_texcoord = a_textureCoordinate;\n\n      }\n    `,\n        fragment: `\n      precision highp float;\n\n      uniform vec4 u_color;\n      uniform sampler2D u_texture;\n      uniform float u_distanceRange;\n      uniform float u_pixelRatio;\n      uniform int u_debug;\n\n      varying vec2 v_texcoord;\n\n      float median(float r, float g, float b) {\n          return max(min(r, g), min(max(r, g), b));\n      }\n\n      void main() {\n          vec3 sample = texture2D(u_texture, v_texcoord).rgb;\n          if (u_debug == 1) {\n            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);\n            return;\n          }\n          float scaledDistRange = u_distanceRange * u_pixelRatio;\n          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);\n          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;\n\n          // Build the final color.\n          // IMPORTANT: We must premultiply the color by the alpha value before returning it.\n          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);\n      }\n    `,\n    };\n}\n//# sourceMappingURL=SdfShader.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport const colorToFloat32Array = (argb) => {\n    const col = getRgbaComponentsNormalized(argb);\n    /* eslint-disable @typescript-eslint/no-non-null-assertion -- getRgbaComponentsNormalized has a constant array size */\n    col[0] *= col[3];\n    col[1] *= col[3];\n    col[2] *= col[3];\n    /* eslint-enable */\n    return col;\n};\nconst getRgbaComponentsNormalized = (argb) => {\n    const r = ((argb / 65536) | 0) % 256;\n    const g = ((argb / 256) | 0) % 256;\n    const b = argb % 256;\n    const a = (argb / 16777216) | 0;\n    return [r / 255, g / 255, b / 255, a / 255];\n};\nexport const updateShaderEffectColor = (values) => {\n    if (values.programValue === undefined) {\n        values.programValue = new Float32Array(4);\n    }\n    const rgba = values.value;\n    const floatArray = values.programValue;\n    floatArray[0] = (rgba >>> 24) / 255;\n    floatArray[1] = ((rgba >>> 16) & 0xff) / 255;\n    floatArray[2] = ((rgba >>> 8) & 0xff) / 255;\n    floatArray[3] = (rgba & 0xff) / 255;\n};\nexport const updateFloat32ArrayLength2 = (values) => {\n    const validatedValue = (values.validatedValue || values.value);\n    if (values.programValue instanceof Float32Array) {\n        const floatArray = values.programValue;\n        floatArray[0] = validatedValue[0];\n        floatArray[1] = validatedValue[1];\n    }\n    else {\n        values.programValue = new Float32Array(validatedValue);\n    }\n};\nexport const updateFloat32ArrayLength4 = (values) => {\n    const validatedValue = (values.validatedValue || values.value);\n    if (values.programValue instanceof Float32Array) {\n        const floatArray = values.programValue;\n        floatArray[0] = validatedValue[0];\n        floatArray[1] = validatedValue[1];\n        floatArray[2] = validatedValue[1];\n        floatArray[3] = validatedValue[1];\n    }\n    else {\n        values.programValue = new Float32Array(validatedValue);\n    }\n};\nexport const updateFloat32ArrayLengthN = (values) => {\n    const validatedValue = (values.validatedValue || values.value);\n    if (values.programValue instanceof Float32Array) {\n        const len = validatedValue.length;\n        const programValue = values.programValue;\n        for (let i = 0; i < len; i++) {\n            programValue[i] = validatedValue[i];\n        }\n    }\n    else {\n        values.programValue = new Float32Array(validatedValue);\n    }\n};\nexport const validateArrayLength4 = (value) => {\n    const isArray = Array.isArray(value);\n    if (!isArray) {\n        return [value, value, value, value];\n    }\n    else if (isArray && value.length === 4) {\n        return value;\n    }\n    else if (isArray && value.length === 2) {\n        return [value[0], value[1], value[0], value[1]];\n    }\n    else if (isArray && value.length === 3) {\n        return [value[0], value[1], value[2], value[0]];\n    }\n    return [value[0], value[0], value[0], value[0]];\n};\nexport const updateWebSafeRadius = (values, shaderProps) => {\n    if (values.programValue === undefined) {\n        values.programValue = new Float32Array(4);\n    }\n    const programValue = values.programValue;\n    const validatedValue = (values.validatedValue || values.value);\n    if (shaderProps === undefined && values.$dimensions === undefined) {\n        programValue[0] = validatedValue[0];\n        programValue[1] = validatedValue[1];\n        programValue[2] = validatedValue[2];\n        programValue[3] = validatedValue[3];\n        return;\n    }\n    let storedDimensions = values.$dimensions;\n    if (shaderProps !== undefined) {\n        const { $dimensions } = shaderProps;\n        if (storedDimensions !== undefined &&\n            (storedDimensions.width === $dimensions.width ||\n                storedDimensions.height === $dimensions.height)) {\n            return;\n        }\n        if (storedDimensions === undefined) {\n            storedDimensions = {\n                width: $dimensions?.width,\n                height: $dimensions?.height,\n            };\n            values.$dimensions = storedDimensions;\n        }\n    }\n    const { width, height } = storedDimensions;\n    const [r0, r1, r2, r3] = validatedValue;\n    const factor = Math.min(Math.min(Math.min(width / Math.max(width, r0 + r1), width / Math.max(width, r2 + r3)), Math.min(height / Math.max(height, r0 + r2), height / Math.max(height, r1 + r3))), 1);\n    programValue[0] = r0 * factor;\n    programValue[1] = r1 * factor;\n    programValue[2] = r2 * factor;\n    programValue[3] = r3 * factor;\n};\n//# sourceMappingURL=EffectUtils.js.map","import { updateWebSafeRadius, validateArrayLength4 } from './EffectUtils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * Masks the current maskcolor with rounded corners similar to {@link RoundedRectangle}\n */\nexport class RadiusEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'radius';\n    static getEffectKey() {\n        return `radius`;\n    }\n    static uniforms = {\n        radius: {\n            value: 0,\n            method: 'uniform4fv',\n            type: 'vec4',\n            updateOnBind: true,\n            validator: validateArrayLength4,\n            updateProgramValue: updateWebSafeRadius,\n        },\n    };\n    static methods = {\n        fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n        boxDist: `\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    `,\n    };\n    static resolveDefaults(props) {\n        return {\n            radius: props.radius ?? 10,\n        };\n    }\n    static onShaderMask = `\n  vec2 halfDimensions = u_dimensions * 0.5;\n  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);\n  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);\n  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);\n  `;\n    static onEffectMask = `\n  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));\n  `;\n}\n//# sourceMappingURL=RadiusEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The BorderEffect renders a border along all edges of an element\n */\nexport class BorderEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'border';\n    static getEffectKey() {\n        return `border`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            updateProgramValue: updateShaderEffectColor,\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static onEffectMask = `\n  float intR = shaderMask + 1.0;\n  float mask = clamp(intR + width, 0.0, 1.0) - clamp(intR, 0.0, 1.0);\n  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=BorderEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { updateFloat32ArrayLengthN } from './EffectUtils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * Linear Gradient effect over a effect mask\n */\nexport class LinearGradientEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'linearGradient';\n    static getEffectKey(props) {\n        return `linearGradient${props.colors.length}`;\n    }\n    static resolveDefaults(props) {\n        const colors = props.colors ?? [0xff000000, 0xffffffff];\n        let stops = props.stops || [];\n        if (stops.length === 0 || stops.length !== colors.length) {\n            const colorsL = colors.length;\n            let i = 0;\n            const tmp = stops;\n            for (; i < colorsL; i++) {\n                if (stops[i]) {\n                    tmp[i] = stops[i];\n                    if (stops[i - 1] === undefined && tmp[i - 2] !== undefined) {\n                        tmp[i - 1] = tmp[i - 2] + (stops[i] - tmp[i - 2]) / 2;\n                    }\n                }\n                else {\n                    tmp[i] = i * (1 / (colors.length - 1));\n                }\n            }\n            stops = tmp;\n        }\n        return {\n            colors,\n            stops,\n            angle: props.angle ?? 0,\n        };\n    }\n    static uniforms = {\n        angle: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        colors: {\n            value: 0xffffffff,\n            validator: (rgbas) => {\n                return rgbas.reduce((acc, val) => acc.concat(getNormalizedRgbaComponents(val)), []);\n            },\n            updateProgramValue: updateFloat32ArrayLengthN,\n            size: (props) => props.colors.length,\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n        stops: {\n            value: [],\n            size: (props) => props.colors.length,\n            method: 'uniform1fv',\n            type: 'float',\n        },\n    };\n    static methods = {\n        fromLinear: `\n      vec4 function(vec4 linearRGB) {\n        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);\n        vec4 lower = linearRGB * vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    `,\n        toLinear: `\n      vec4 function(vec4 sRGB) {\n        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));\n        vec4 lower = sRGB/vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    `,\n        calcPoint: `\n      vec2 function(float d, float angle) {\n        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);\n      }\n    `,\n    };\n    static ColorLoop = (amount) => {\n        let loop = '';\n        for (let i = 2; i < amount; i++) {\n            loop += `colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i - 1}]) / (stops[${i}] - stops[${i - 1}]), 0.0, 1.0));`;\n        }\n        return loop;\n    };\n    static onColorize = (props) => {\n        const colors = props.colors.length || 1;\n        return `\n      float a = angle - (PI / 180.0 * 90.0);\n      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));\n      vec2 f = $calcPoint(lineDist * 0.5, a);\n      vec2 t = $calcPoint(lineDist * 0.5, a + PI);\n      vec2 gradVec = t - f;\n      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));\n      ${this.ColorLoop(colors)}\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    `;\n    };\n}\n//# sourceMappingURL=LinearGradientEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * Grayscale effect grayscales the color values of the current mask color\n */\nexport class GrayscaleEffect extends ShaderEffect {\n    name = 'grayscale';\n    static getEffectKey() {\n        return `grayscale`;\n    }\n    static resolveDefaults(props) {\n        return {\n            amount: props.amount ?? 1,\n        };\n    }\n    static uniforms = {\n        amount: {\n            value: 1,\n            method: 'uniform1f',\n            type: 'float',\n        },\n    };\n    static onColorize = `\n    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;\n    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);\n  `;\n}\n//# sourceMappingURL=GrayscaleEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The BorderBottomEffect renders a border on the right side of an element\n */\nexport class BorderRightEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'borderRight';\n    static getEffectKey() {\n        return `borderRight`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            updateProgramValue: updateShaderEffectColor,\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static methods = {\n        fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n        rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n    };\n    static onEffectMask = `\n  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=BorderRightEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The BorderBottomEffect renders a border on the top side of an element\n */\nexport class BorderTopEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'borderTop';\n    static getEffectKey() {\n        return `borderTop`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            updateProgramValue: updateShaderEffectColor,\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static methods = {\n        fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n        rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n    };\n    static onEffectMask = `\n  vec2 pos = vec2(0.0, width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=BorderTopEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The BorderBottomEffect renders a border on the bottom side of an element\n */\nexport class BorderBottomEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'borderBottom';\n    static getEffectKey() {\n        return `borderBottom`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            updateProgramValue: updateShaderEffectColor,\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static methods = {\n        fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n        rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n    };\n    static onEffectMask = `\n  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=BorderBottomEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The BorderBottomEffect renders a border on the left of an element\n */\nexport class BorderLeftEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'borderLeft';\n    static getEffectKey() {\n        return `borderLeft`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            updateProgramValue: updateShaderEffectColor,\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static methods = {\n        fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n        rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n    };\n    static onEffectMask = `\n  vec2 pos = vec2(width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=BorderLeftEffect.js.map","import { ShaderEffect, } from './ShaderEffect.js';\n/**\n * Renders a Glitch effect using the incoming texture\n */\nexport class GlitchEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'glitch';\n    static getEffectKey(props) {\n        return `glitch`;\n    }\n    static resolveDefaults(props) {\n        return {\n            amplitude: props.amplitude ?? 0.2,\n            narrowness: props.narrowness ?? 4.0,\n            blockiness: props.blockiness ?? 2.0,\n            minimizer: props.minimizer ?? 8.0,\n            time: props.time ?? Date.now(),\n        };\n    }\n    static uniforms = {\n        amplitude: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        narrowness: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        blockiness: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        minimizer: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        time: {\n            value: 0,\n            method: 'uniform1f',\n            updateOnBind: true,\n            updateProgramValue: (values) => {\n                const value = (values.value =\n                    (Date.now() - values.value) % 1000);\n                values.programValue = value;\n            },\n            type: 'float',\n        },\n    };\n    static methods = {\n        rand: `\n      float function(vec2 p, float time) {\n        float t = floor(time * 20.) / 10.;\n        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);\n      }\n    `,\n        noise: `\n      float function(vec2 uv, float blockiness, float time) {\n        vec2 lv = fract(uv);\n        vec2 id = floor(uv);\n\n        float n1 = rand(id, time);\n        float n2 = rand(id+vec2(1,0), time);\n        float n3 = rand(id+vec2(0,1), time);\n        float n4 = rand(id+vec2(1,1), time);\n        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n      }\n    `,\n        fbm: `\n      float function(vec2 uv, int count, float blockiness, float complexity, float time) {\n        float val = 0.0;\n        float amp = 0.5;\n        const int MAX_ITERATIONS = 10;\n\n        for(int i = 0; i < MAX_ITERATIONS; i++) {\n          if(i >= count) {break;}\n          val += amp * noise(uv, blockiness, time);\n          amp *= 0.5;\n          uv *= complexity;\n        }\n        return val;\n      }\n    `,\n    };\n    static onColorize = `\n    vec2 uv = v_textureCoordinate.xy;\n    float aspect = u_dimensions.x / u_dimensions.y;\n    vec2 a = vec2(uv.x * aspect , uv.y);\n    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));\n\n    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);\n    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);\n    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);\n    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n\n    vec3 f = vec3(colR, colG, colB);\n    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);\n  `;\n}\n//# sourceMappingURL=GlitchEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateFloat32ArrayLength4, validateArrayLength4, } from './EffectUtils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\nexport class FadeOutEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'fadeOut';\n    static getEffectKey() {\n        return `fadeOut`;\n    }\n    static uniforms = {\n        fade: {\n            value: 0,\n            method: 'uniform4fv',\n            type: 'vec4',\n            validator: validateArrayLength4,\n            updateProgramValue: updateFloat32ArrayLength4,\n        },\n    };\n    static resolveDefaults(props) {\n        return {\n            fade: props.fade ?? 10,\n        };\n    }\n    static onColorize = `\n  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;\n  vec2 pos1;\n  vec2 pos2;\n  vec2 d;\n  float c;\n  vec4 result = maskColor;\n\n\n  if(fade[0] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x, point.y + fade[0]);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[1] > 0.0) {\n    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);\n    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[2] > 0.0) {\n    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);\n    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[3] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x + fade[3], point.y);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  return result;\n  `;\n}\n//# sourceMappingURL=FadeOutEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { updateFloat32ArrayLength2, updateFloat32ArrayLengthN, } from './EffectUtils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\nexport class RadialGradientEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'radialGradient';\n    static getEffectKey(props) {\n        return `radialGradient${props.colors.length}`;\n    }\n    static resolveDefaults(props) {\n        const colors = props.colors ?? [0xff000000, 0xffffffff];\n        let stops = props.stops || [];\n        if (stops.length === 0 || stops.length !== colors.length) {\n            const colorsL = colors.length;\n            let i = 0;\n            const tmp = stops;\n            for (; i < colorsL; i++) {\n                if (stops[i]) {\n                    tmp[i] = stops[i];\n                    if (stops[i - 1] === undefined && tmp[i - 2] !== undefined) {\n                        tmp[i - 1] = tmp[i - 2] + (stops[i] - tmp[i - 2]) / 2;\n                    }\n                }\n                else {\n                    tmp[i] = i * (1 / (colors.length - 1));\n                }\n            }\n            stops = tmp;\n        }\n        return {\n            colors,\n            stops,\n            width: props.width ?? 0,\n            height: props.height ?? props.width ?? 0,\n            pivot: props.pivot ?? [0.5, 0.5],\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        height: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        pivot: {\n            value: [0.5, 0.5],\n            updateProgramValue: updateFloat32ArrayLength2,\n            method: 'uniform2fv',\n            type: 'vec2',\n        },\n        colors: {\n            value: 0xffffffff,\n            validator: (rgbas) => {\n                return rgbas.reduce((acc, val) => acc.concat(getNormalizedRgbaComponents(val)), []);\n            },\n            updateProgramValue: updateFloat32ArrayLengthN,\n            size: (props) => props.colors.length,\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n        stops: {\n            value: [],\n            size: (props) => props.colors.length,\n            method: 'uniform1fv',\n            type: 'float',\n        },\n    };\n    static ColorLoop = (amount) => {\n        let loop = '';\n        for (let i = 2; i < amount; i++) {\n            loop += `colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i - 1}]) / (stops[${i}] - stops[${i - 1}]), 0.0, 1.0));`;\n        }\n        return loop;\n    };\n    static onColorize = (props) => {\n        const colors = props.colors.length || 1;\n        return `\n      vec2 point = v_textureCoordinate.xy * u_dimensions;\n      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);\n\n      float dist = length((point - projection) / vec2(width, height));\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = mix(colors[0], colors[1], stopCalc);\n      ${this.ColorLoop(colors)}\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    `;\n    };\n}\n//# sourceMappingURL=RadialGradientEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * The RadialProgressEffect renders a border along all edges of an element\n */\nexport class RadialProgressEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'radialProgress';\n    static getEffectKey() {\n        return `radialProgress`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 10,\n            progress: props.progress ?? 0.5,\n            offset: props.offset ?? 0,\n            range: props.range ?? Math.PI * 2,\n            rounded: props.rounded ?? false,\n            radius: props.radius ?? 1,\n            color: props.color ?? 0xffffffff,\n        };\n    }\n    static uniforms = {\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        progress: {\n            value: 0.5,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        offset: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        range: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        rounded: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n            validator: (value) => {\n                return value ? 1 : 0;\n            },\n        },\n        radius: {\n            value: 1,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        color: {\n            value: 0xffffffff,\n            updateProgramValue: updateShaderEffectColor,\n            method: 'uniform4fv',\n            type: 'vec4',\n        },\n    };\n    static methods = {\n        rotateUV: `\n    vec2 function(vec2 uv, float d) {\n      float s = sin(d);\n      float c = cos(d);\n      mat2 rotMatrix = mat2(c, -s, s, c);\n      return uv * rotMatrix;\n    }\n    `,\n        drawDot: `\n    float function(vec2 uv, vec2 p, float r) {\n      uv += p;\n      float circle = length(uv) - r;\n      return clamp(-circle, 0.0, 1.0);\n    }\n    `,\n    };\n    static onEffectMask = `\n    float outerRadius = radius * u_dimensions.y * 0.5;\n\n    float endAngle = range * progress - 0.0005;\n\n    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;\n\n    uv = $rotateUV(uv, -(offset));\n    float linewidth = width * u_pixelRatio;\n    float circle = length(uv) - (outerRadius - linewidth) ;\n    circle = abs(circle) - linewidth;\n    circle = clamp(-circle, 0.0, 1.0);\n\n    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);\n    float p = endAngle / (PI * 2.);\n\n    circle *= step(fract(angle), fract(p));\n\n    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));\n    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));\n\n    return mix(shaderColor, maskColor, circle);\n  `;\n    static onColorize = `\n    return color;\n  `;\n}\n//# sourceMappingURL=RadialProgressEffect.js.map","import { updateWebSafeRadius, validateArrayLength4 } from './EffectUtils.js';\nimport { ShaderEffect, } from './ShaderEffect.js';\n/**\n * Masks the current maskcolor a holepunch effect with rounded corners similar to {@link RoundedRectangle}\n */\nexport class HolePunchEffect extends ShaderEffect {\n    static z$__type__Props;\n    name = 'holePunch';\n    static getEffectKey() {\n        return `holePunch`;\n    }\n    static uniforms = {\n        x: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        y: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        width: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        height: {\n            value: 0,\n            method: 'uniform1f',\n            type: 'float',\n        },\n        radius: {\n            value: 0,\n            method: 'uniform4fv',\n            type: 'vec4',\n            updateOnBind: true,\n            validator: validateArrayLength4,\n            updateProgramValue: updateWebSafeRadius,\n        },\n    };\n    static resolveDefaults(props) {\n        return {\n            x: props.x || 0,\n            y: props.y || 0,\n            width: props.width || 50,\n            height: props.height || 50,\n            radius: props.radius ?? 0,\n        };\n    }\n    static methods = {\n        fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n        boxDist: `\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    `,\n    };\n    static onShaderMask = `\n  vec2 halfDimensions = u_dimensions * 0.5;\n  vec2 size = vec2(width, height) * 0.5;\n  vec2 basePos = v_textureCoordinate.xy * u_dimensions.xy - vec2(x, y);\n  vec2 pos = basePos - size;\n  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);\n  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);\n  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);\n  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);\n  return $boxDist(pos, size, r);\n  `;\n    static onEffectMask = `\n  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));\n  `;\n}\n//# sourceMappingURL=HolePunchEffect.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { CoreShader } from '../../CoreShader.js';\nexport const ROUNDED_RECTANGLE_SHADER_TYPE = 'RoundedRectangle';\nexport class UnsupportedShader extends CoreShader {\n    shType;\n    constructor(shType) {\n        super();\n        this.shType = shType;\n        if (shType !== ROUNDED_RECTANGLE_SHADER_TYPE) {\n            console.warn('Unsupported shader:', shType);\n        }\n    }\n    bindRenderOp() {\n        // noop\n    }\n    bindProps() {\n        // noop\n    }\n    attach() {\n        // noop\n    }\n    detach() {\n        // noop\n    }\n}\n//# sourceMappingURL=UnsupportedShader.js.map","/**\n * Shader Controller Class\n *\n * @remarks\n * This class is used to control shader props.\n */\nexport class ShaderController {\n    type;\n    shader;\n    resolvedProps;\n    props;\n    constructor(type, shader, props, stage) {\n        this.type = type;\n        this.shader = shader;\n        this.resolvedProps = props;\n        const keys = Object.keys(props);\n        const l = keys.length;\n        const definedProps = {};\n        for (let i = 0; i < l; i++) {\n            const name = keys[i];\n            Object.defineProperty(definedProps, name, {\n                get: () => {\n                    return this.resolvedProps[name];\n                },\n                set: (value) => {\n                    this.resolvedProps[name] = value;\n                    stage.requestRender();\n                },\n            });\n        }\n        this.props = definedProps;\n    }\n    getResolvedProps() {\n        return this.resolvedProps;\n    }\n}\n//# sourceMappingURL=ShaderController.js.map","export class DynamicShaderController {\n    shader;\n    resolvedProps;\n    props;\n    type;\n    constructor(shader, props, shManager) {\n        this.shader = shader;\n        this.type = 'DynamicShader';\n        this.resolvedProps = props;\n        const effectConstructors = shManager.getRegisteredEffects();\n        const definedProps = {};\n        const effects = props.effects;\n        const effectsLength = effects.length;\n        for (let i = 0; i < effectsLength; i++) {\n            const { name: effectName, props: effectProps, type: effectType, } = effects[i];\n            if (effectName === undefined) {\n                continue;\n            }\n            const definedEffectProps = {};\n            const propEntries = Object.keys(effectProps);\n            const propEntriesLength = propEntries.length;\n            for (let j = 0; j < propEntriesLength; j++) {\n                const propName = propEntries[j];\n                Object.defineProperty(definedEffectProps, propName, {\n                    get: () => {\n                        return this.resolvedProps.effects[i].props[propName].value;\n                    },\n                    set: (value) => {\n                        const target = this.resolvedProps.effects[i].props[propName];\n                        target.value = value;\n                        if (target.hasValidator) {\n                            value = target.validatedValue = effectConstructors[effectType]\n                                .uniforms[propName]?.validator(value, effectProps);\n                        }\n                        if (target.hasProgramValueUpdater) {\n                            effectConstructors[effectType].uniforms[propName]\n                                ?.updateProgramValue(target);\n                        }\n                        else {\n                            target.programValue = value;\n                        }\n                        shManager.renderer.stage.requestRender();\n                    },\n                });\n            }\n            Object.defineProperty(definedProps, effectName, {\n                get: () => {\n                    return definedEffectProps;\n                },\n            });\n        }\n        this.props = definedProps;\n    }\n    getResolvedProps() {\n        return this.resolvedProps;\n    }\n}\n//# sourceMappingURL=DynamicShaderController.js.map","import { DefaultShader } from './renderers/webgl/shaders/DefaultShader.js';\nimport { DefaultShaderBatched } from './renderers/webgl/shaders/DefaultShaderBatched.js';\nimport { DynamicShader, } from './renderers/webgl/shaders/DynamicShader.js';\nimport { RoundedRectangle } from './renderers/webgl/shaders/RoundedRectangle.js';\nimport { SdfShader } from './renderers/webgl/shaders/SdfShader.js';\nimport { RadiusEffect } from './renderers/webgl/shaders/effects/RadiusEffect.js';\nimport { BorderEffect } from './renderers/webgl/shaders/effects/BorderEffect.js';\nimport { LinearGradientEffect, } from './renderers/webgl/shaders/effects/LinearGradientEffect.js';\nimport { GrayscaleEffect, } from './renderers/webgl/shaders/effects/GrayscaleEffect.js';\nimport { BorderRightEffect } from './renderers/webgl/shaders/effects/BorderRightEffect.js';\nimport { BorderTopEffect } from './renderers/webgl/shaders/effects/BorderTopEffect.js';\nimport { BorderBottomEffect } from './renderers/webgl/shaders/effects/BorderBottomEffect.js';\nimport { BorderLeftEffect } from './renderers/webgl/shaders/effects/BorderLeftEffect.js';\nimport { GlitchEffect, } from './renderers/webgl/shaders/effects/GlitchEffect.js';\nimport { FadeOutEffect, } from './renderers/webgl/shaders/effects/FadeOutEffect.js';\nimport { RadialGradientEffect, } from './renderers/webgl/shaders/effects/RadialGradientEffect.js';\nimport { RadialProgressEffect, } from './renderers/webgl/shaders/effects/RadialProgressEffect.js';\nimport { HolePunchEffect, } from './renderers/webgl/shaders/effects/HolePunchEffect.js';\nimport { WebGlCoreShader } from './renderers/webgl/WebGlCoreShader.js';\nimport { UnsupportedShader } from './renderers/canvas/shaders/UnsupportedShader.js';\nimport { ShaderController } from '../main-api/ShaderController.js';\nimport { DynamicShaderController, } from '../main-api/DynamicShaderController.js';\nexport class CoreShaderManager {\n    shCache = new Map();\n    shConstructors = {};\n    attachedShader = null;\n    effectConstructors = {};\n    renderer;\n    constructor() {\n        this.registerShaderType('DefaultShader', DefaultShader);\n        this.registerShaderType('DefaultShaderBatched', DefaultShaderBatched);\n        this.registerShaderType('RoundedRectangle', RoundedRectangle);\n        this.registerShaderType('DynamicShader', DynamicShader);\n        this.registerShaderType('SdfShader', SdfShader);\n        this.registerEffectType('border', BorderEffect);\n        this.registerEffectType('borderBottom', BorderBottomEffect);\n        this.registerEffectType('borderLeft', BorderLeftEffect);\n        this.registerEffectType('borderRight', BorderRightEffect);\n        this.registerEffectType('borderTop', BorderTopEffect);\n        this.registerEffectType('fadeOut', FadeOutEffect);\n        this.registerEffectType('linearGradient', LinearGradientEffect);\n        this.registerEffectType('radialGradient', RadialGradientEffect);\n        this.registerEffectType('grayscale', GrayscaleEffect);\n        this.registerEffectType('glitch', GlitchEffect);\n        this.registerEffectType('radius', RadiusEffect);\n        this.registerEffectType('radialProgress', RadialProgressEffect);\n        this.registerEffectType('holePunch', HolePunchEffect);\n    }\n    registerShaderType(shType, shClass) {\n        this.shConstructors[shType] = shClass;\n    }\n    registerEffectType(effectType, effectClass) {\n        this.effectConstructors[effectType] = effectClass;\n    }\n    getRegisteredEffects() {\n        return this.effectConstructors;\n    }\n    getRegisteredShaders() {\n        return this.shConstructors;\n    }\n    /**\n     * Loads a shader (if not already loaded) and returns a controller for it.\n     *\n     * @param shType\n     * @param props\n     * @returns\n     */\n    loadShader(shType, props) {\n        if (!this.renderer) {\n            throw new Error(`Renderer is not been defined`);\n        }\n        const ShaderClass = this.shConstructors[shType];\n        if (!ShaderClass) {\n            throw new Error(`Shader type \"${shType}\" is not registered`);\n        }\n        if (this.renderer.mode === 'canvas' &&\n            ShaderClass.prototype instanceof WebGlCoreShader) {\n            return this._createShaderCtr(shType, new UnsupportedShader(shType), props);\n        }\n        if (shType === 'DynamicShader') {\n            return this.loadDynamicShader(props);\n        }\n        const resolvedProps = ShaderClass.resolveDefaults(props);\n        const cacheKey = ShaderClass.makeCacheKey(resolvedProps) || ShaderClass.name;\n        if (cacheKey && this.shCache.has(cacheKey)) {\n            return this._createShaderCtr(shType, this.shCache.get(cacheKey), resolvedProps);\n        }\n        // @ts-expect-error ShaderClass WILL accept a Renderer\n        const shader = new ShaderClass(this.renderer, props);\n        if (cacheKey) {\n            this.shCache.set(cacheKey, shader);\n        }\n        return this._createShaderCtr(shType, shader, resolvedProps);\n    }\n    loadDynamicShader(props) {\n        if (!this.renderer) {\n            throw new Error(`Renderer is not been defined`);\n        }\n        const resolvedProps = DynamicShader.resolveDefaults(props, this.effectConstructors);\n        const cacheKey = DynamicShader.makeCacheKey(resolvedProps, this.effectConstructors);\n        if (cacheKey && this.shCache.has(cacheKey)) {\n            return this._createDynShaderCtr(this.shCache.get(cacheKey), resolvedProps);\n        }\n        const shader = new DynamicShader(this.renderer, props, this.effectConstructors);\n        if (cacheKey) {\n            this.shCache.set(cacheKey, shader);\n        }\n        return this._createDynShaderCtr(shader, resolvedProps);\n    }\n    _createShaderCtr(type, shader, props) {\n        return new ShaderController(type, shader, props, this.renderer.stage);\n    }\n    _createDynShaderCtr(shader, props) {\n        return new DynamicShaderController(shader, props, this);\n    }\n    useShader(shader) {\n        if (this.attachedShader === shader) {\n            return;\n        }\n        if (this.attachedShader) {\n            this.attachedShader.detach();\n        }\n        shader.attach();\n        this.attachedShader = shader;\n    }\n}\n//# sourceMappingURL=CoreShaderManager.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Represents a collection of WebGL Buffers along with their associated\n * vertex attribute formats.\n */\nexport class BufferCollection {\n    config;\n    constructor(config) {\n        this.config = config;\n    }\n    /**\n     * Get the WebGLBuffer associated with the given attribute name if it exists.\n     *\n     * @param attributeName\n     * @returns\n     */\n    getBuffer(attributeName) {\n        return this.config.find((item) => item.attributes[attributeName])?.buffer;\n    }\n    /**\n     * Get the AttributeInfo associated with the given attribute name if it exists.\n     *\n     * @param attributeName\n     * @returns\n     */\n    getAttributeInfo(attributeName) {\n        return this.config.find((item) => item.attributes[attributeName])\n            ?.attributes[attributeName];\n    }\n}\n//# sourceMappingURL=BufferCollection.js.map","/* eslint-disable @typescript-eslint/no-unsafe-return */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unsafe-argument */\nimport { assertTruthy } from '../../utils.js';\nimport { isWebGl2 } from '../renderers/webgl/internal/WebGlUtils.js';\n/**\n * Optimized WebGL Context Wrapper\n *\n * @remarks\n * This class contains the subset of the WebGLRenderingContext & WebGL2RenderingContext\n * API that is used by the renderer. Select high volume WebGL methods include\n * caching optimizations to avoid making WebGL calls if the state is already set\n * to the desired value.\n *\n * While most methods contained are direct passthroughs to the WebGL context,\n * some methods combine multiple WebGL calls into one for convenience, modify\n * arguments to be more convenient, or are replaced by more specific methods.\n *\n * Not all methods are optimized. Only methods that are called frequently\n * and/or have a high cost are optimized.\n *\n * A subset of GLenum constants are also exposed as properties on this class\n * for convenience.\n */\nexport class WebGlContextWrapper {\n    gl;\n    //#region Cached WebGL State\n    activeTextureUnit = 0;\n    texture2dUnits;\n    texture2dParams = new WeakMap();\n    scissorEnabled;\n    scissorX;\n    scissorY;\n    scissorWidth;\n    scissorHeight;\n    blendEnabled;\n    blendSrcRgb;\n    blendDstRgb;\n    blendSrcAlpha;\n    blendDstAlpha;\n    boundArrayBuffer;\n    boundElementArrayBuffer;\n    curProgram;\n    programUniforms = new WeakMap();\n    //#endregion Cached WebGL State\n    //#region Canvas\n    canvas;\n    //#endregion Canvas\n    //#region WebGL Enums\n    MAX_RENDERBUFFER_SIZE;\n    MAX_TEXTURE_SIZE;\n    MAX_VIEWPORT_DIMS;\n    MAX_VERTEX_TEXTURE_IMAGE_UNITS;\n    MAX_TEXTURE_IMAGE_UNITS;\n    MAX_COMBINED_TEXTURE_IMAGE_UNITS;\n    MAX_VERTEX_ATTRIBS;\n    MAX_VARYING_VECTORS;\n    MAX_VERTEX_UNIFORM_VECTORS;\n    MAX_FRAGMENT_UNIFORM_VECTORS;\n    TEXTURE_MAG_FILTER;\n    TEXTURE_MIN_FILTER;\n    TEXTURE_WRAP_S;\n    TEXTURE_WRAP_T;\n    LINEAR;\n    CLAMP_TO_EDGE;\n    RGBA;\n    UNSIGNED_BYTE;\n    UNPACK_PREMULTIPLY_ALPHA_WEBGL;\n    UNPACK_FLIP_Y_WEBGL;\n    FLOAT;\n    TRIANGLES;\n    UNSIGNED_SHORT;\n    ONE;\n    ONE_MINUS_SRC_ALPHA;\n    VERTEX_SHADER;\n    FRAGMENT_SHADER;\n    STATIC_DRAW;\n    COMPILE_STATUS;\n    LINK_STATUS;\n    DYNAMIC_DRAW;\n    COLOR_ATTACHMENT0;\n    //#endregion WebGL Enums\n    constructor(gl) {\n        this.gl = gl;\n        // The following code extracts the current state of the WebGL context\n        // to our local JavaScript cached version of it. This is so we can\n        // avoid making WebGL calls if we don't need to.\n        // We could assume that the WebGL context is in a default state, but\n        // in the future we may want to support restoring a broken WebGL context\n        // and this will help with that.\n        this.activeTextureUnit =\n            gl.getParameter(gl.ACTIVE_TEXTURE) - gl.TEXTURE0;\n        const maxTextureUnits = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\n        // save current texture units\n        this.texture2dUnits = new Array(maxTextureUnits)\n            .fill(undefined)\n            .map((_, i) => {\n            this.activeTexture(i);\n            return gl.getParameter(gl.TEXTURE_BINDING_2D);\n        });\n        // restore active texture unit\n        this.activeTexture(this.activeTextureUnit);\n        this.scissorEnabled = gl.isEnabled(gl.SCISSOR_TEST);\n        const scissorBox = gl.getParameter(gl.SCISSOR_BOX);\n        this.scissorX = scissorBox[0];\n        this.scissorY = scissorBox[1];\n        this.scissorWidth = scissorBox[2];\n        this.scissorHeight = scissorBox[3];\n        this.blendEnabled = gl.isEnabled(gl.BLEND);\n        this.blendSrcRgb = gl.getParameter(gl.BLEND_SRC_RGB);\n        this.blendDstRgb = gl.getParameter(gl.BLEND_DST_RGB);\n        this.blendSrcAlpha = gl.getParameter(gl.BLEND_SRC_ALPHA);\n        this.blendDstAlpha = gl.getParameter(gl.BLEND_DST_ALPHA);\n        this.boundArrayBuffer = gl.getParameter(gl.ARRAY_BUFFER_BINDING);\n        this.boundElementArrayBuffer = gl.getParameter(gl.ELEMENT_ARRAY_BUFFER_BINDING);\n        this.curProgram = gl.getParameter(gl.CURRENT_PROGRAM);\n        this.canvas = gl.canvas;\n        // Extract GLenums\n        this.MAX_RENDERBUFFER_SIZE = gl.MAX_RENDERBUFFER_SIZE;\n        this.MAX_TEXTURE_SIZE = gl.MAX_TEXTURE_SIZE;\n        this.MAX_VIEWPORT_DIMS = gl.MAX_VIEWPORT_DIMS;\n        this.MAX_VERTEX_TEXTURE_IMAGE_UNITS = gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS;\n        this.MAX_TEXTURE_IMAGE_UNITS = gl.MAX_TEXTURE_IMAGE_UNITS;\n        this.MAX_COMBINED_TEXTURE_IMAGE_UNITS = gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS;\n        this.MAX_VERTEX_ATTRIBS = gl.MAX_VERTEX_ATTRIBS;\n        this.MAX_VARYING_VECTORS = gl.MAX_VARYING_VECTORS;\n        this.MAX_VERTEX_UNIFORM_VECTORS = gl.MAX_VERTEX_UNIFORM_VECTORS;\n        this.MAX_FRAGMENT_UNIFORM_VECTORS = gl.MAX_FRAGMENT_UNIFORM_VECTORS;\n        this.TEXTURE_MAG_FILTER = gl.TEXTURE_MAG_FILTER;\n        this.TEXTURE_MIN_FILTER = gl.TEXTURE_MIN_FILTER;\n        this.TEXTURE_WRAP_S = gl.TEXTURE_WRAP_S;\n        this.TEXTURE_WRAP_T = gl.TEXTURE_WRAP_T;\n        this.LINEAR = gl.LINEAR;\n        this.CLAMP_TO_EDGE = gl.CLAMP_TO_EDGE;\n        this.RGBA = gl.RGBA;\n        this.UNSIGNED_BYTE = gl.UNSIGNED_BYTE;\n        this.UNPACK_PREMULTIPLY_ALPHA_WEBGL = gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL;\n        this.UNPACK_FLIP_Y_WEBGL = gl.UNPACK_FLIP_Y_WEBGL;\n        this.FLOAT = gl.FLOAT;\n        this.TRIANGLES = gl.TRIANGLES;\n        this.UNSIGNED_SHORT = gl.UNSIGNED_SHORT;\n        this.ONE = gl.ONE;\n        this.ONE_MINUS_SRC_ALPHA = gl.ONE_MINUS_SRC_ALPHA;\n        this.MAX_VERTEX_TEXTURE_IMAGE_UNITS = gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS;\n        this.TRIANGLES = gl.TRIANGLES;\n        this.UNSIGNED_SHORT = gl.UNSIGNED_SHORT;\n        this.VERTEX_SHADER = gl.VERTEX_SHADER;\n        this.FRAGMENT_SHADER = gl.FRAGMENT_SHADER;\n        this.STATIC_DRAW = gl.STATIC_DRAW;\n        this.COMPILE_STATUS = gl.COMPILE_STATUS;\n        this.LINK_STATUS = gl.LINK_STATUS;\n        this.DYNAMIC_DRAW = gl.DYNAMIC_DRAW;\n        this.COLOR_ATTACHMENT0 = gl.COLOR_ATTACHMENT0;\n    }\n    /**\n     * Returns true if the WebGL context is WebGL2\n     *\n     * @returns\n     */\n    isWebGl2() {\n        return isWebGl2(this.gl);\n    }\n    /**\n     * ```\n     * gl.activeTexture(textureUnit + gl.TEXTURE0);\n     * ```\n     *\n     * @remarks\n     * **WebGL Difference**: `textureUnit` is based from 0, not `gl.TEXTURE0`.\n     *\n     * @param textureUnit\n     */\n    activeTexture(textureUnit) {\n        const { gl } = this;\n        if (this.activeTextureUnit !== textureUnit) {\n            gl.activeTexture(textureUnit + gl.TEXTURE0);\n            this.activeTextureUnit = textureUnit;\n        }\n    }\n    /**\n     * ```\n     * gl.bindTexture(gl.TEXTURE_2D, texture);\n     * ```\n     * @remarks\n     * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`\n     *\n     * @param texture\n     */\n    bindTexture(texture) {\n        const { gl, activeTextureUnit, texture2dUnits } = this;\n        if (texture2dUnits[activeTextureUnit] === texture) {\n            return;\n        }\n        texture2dUnits[activeTextureUnit] = texture;\n        gl.bindTexture(this.gl.TEXTURE_2D, texture);\n    }\n    _getActiveTexture() {\n        const { activeTextureUnit, texture2dUnits } = this;\n        return texture2dUnits[activeTextureUnit];\n    }\n    /**\n     * ```\n     * gl.texParameteri(gl.TEXTURE_2D, pname, param);\n     * ```\n     * @remarks\n     * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`\n     *\n     * @param pname\n     * @param param\n     * @returns\n     */\n    texParameteri(pname, param) {\n        const { gl, texture2dParams } = this;\n        const activeTexture = this._getActiveTexture();\n        if (!activeTexture) {\n            throw new Error('No active texture');\n        }\n        let textureParams = texture2dParams.get(activeTexture);\n        if (!textureParams) {\n            textureParams = {};\n            texture2dParams.set(activeTexture, textureParams);\n        }\n        if (textureParams[pname] === param) {\n            return;\n        }\n        textureParams[pname] = param;\n        gl.texParameteri(gl.TEXTURE_2D, pname, param);\n    }\n    texImage2D(level, internalFormat, widthOrFormat, heightOrType, borderOrSource, format, type, pixels) {\n        const { gl } = this;\n        if (format) {\n            gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, widthOrFormat, heightOrType, borderOrSource, format, type, pixels);\n        }\n        else {\n            gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, widthOrFormat, heightOrType, borderOrSource);\n        }\n    }\n    /**\n     * ```\n     * gl.compressedTexImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border, data);\n     * ```\n     *\n     * @remarks\n     * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`\n     */\n    compressedTexImage2D(level, internalformat, width, height, border, data) {\n        const { gl } = this;\n        gl.compressedTexImage2D(gl.TEXTURE_2D, level, internalformat, width, height, border, data);\n    }\n    /**\n     * ```\n     * gl.pixelStorei(pname, param);\n     * ```\n     *\n     * @param pname\n     * @param param\n     */\n    pixelStorei(pname, param) {\n        const { gl } = this;\n        gl.pixelStorei(pname, param);\n    }\n    /**\n     * ```\n     * gl.generateMipmap(gl.TEXTURE_2D);\n     * ```\n     *\n     * @remarks\n     * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`\n     */\n    generateMipmap() {\n        const { gl } = this;\n        gl.generateMipmap(gl.TEXTURE_2D);\n    }\n    /**\n     * ```\n     * gl.createTexture();\n     * ```\n     *\n     * @returns\n     */\n    createTexture() {\n        const { gl } = this;\n        return gl.createTexture();\n    }\n    /**\n     * ```\n     * gl.deleteTexture(texture);\n     * ```\n     *\n     * @param texture\n     */\n    deleteTexture(texture) {\n        const { gl } = this;\n        if (texture) {\n            this.texture2dParams.delete(texture);\n        }\n        gl.deleteTexture(texture);\n    }\n    /**\n     * ```\n     * gl.viewport(x, y, width, height);\n     * ```\n     */\n    viewport(x, y, width, height) {\n        const { gl } = this;\n        gl.viewport(x, y, width, height);\n    }\n    /**\n     * ```\n     * gl.clearColor(red, green, blue, alpha);\n     * ```\n     *\n     * @param red\n     * @param green\n     * @param blue\n     * @param alpha\n     */\n    clearColor(red, green, blue, alpha) {\n        const { gl } = this;\n        gl.clearColor(red, green, blue, alpha);\n    }\n    /**\n     * ```\n     * gl[\"enable\"|\"disable\"](gl.SCISSOR_TEST);\n     * ```\n     * @param enable\n     */\n    setScissorTest(enable) {\n        const { gl, scissorEnabled } = this;\n        if (enable === scissorEnabled) {\n            return;\n        }\n        if (enable) {\n            gl.enable(gl.SCISSOR_TEST);\n        }\n        else {\n            gl.disable(gl.SCISSOR_TEST);\n        }\n        this.scissorEnabled = enable;\n    }\n    /**\n     * ```\n     * gl.scissor(x, y, width, height);\n     * ```\n     *\n     * @param x\n     * @param y\n     * @param width\n     * @param height\n     */\n    scissor(x, y, width, height) {\n        const { gl, scissorX, scissorY, scissorWidth, scissorHeight } = this;\n        if (x !== scissorX ||\n            y !== scissorY ||\n            width !== scissorWidth ||\n            height !== scissorHeight) {\n            gl.scissor(x, y, width, height);\n            this.scissorX = x;\n            this.scissorY = y;\n            this.scissorWidth = width;\n            this.scissorHeight = height;\n        }\n    }\n    /**\n     * ```\n     * gl[\"enable\"|\"disable\"](gl.BLEND);\n     * ```\n     *\n     * @param blend\n     * @returns\n     */\n    setBlend(blend) {\n        const { gl, blendEnabled } = this;\n        if (blend === blendEnabled) {\n            return;\n        }\n        if (blend) {\n            gl.enable(gl.BLEND);\n        }\n        else {\n            gl.disable(gl.BLEND);\n        }\n        this.blendEnabled = blend;\n    }\n    /**\n     * ```\n     * gl.blendFunc(src, dst);\n     * ```\n     *\n     * @param src\n     * @param dst\n     */\n    blendFunc(src, dst) {\n        const { gl, blendSrcRgb, blendDstRgb, blendSrcAlpha, blendDstAlpha } = this;\n        if (src !== blendSrcRgb ||\n            dst !== blendDstRgb ||\n            src !== blendSrcAlpha ||\n            dst !== blendDstAlpha) {\n            gl.blendFunc(src, dst);\n            this.blendSrcRgb = src;\n            this.blendDstRgb = dst;\n            this.blendSrcAlpha = src;\n            this.blendDstAlpha = dst;\n        }\n    }\n    /**\n     * ```\n     * gl.createBuffer();\n     * ```\n     *\n     * @returns\n     */\n    createBuffer() {\n        const { gl } = this;\n        return gl.createBuffer();\n    }\n    /**\n     * ```\n     * gl.createFramebuffer();\n     * ```\n     * @returns\n     */\n    createFramebuffer() {\n        const { gl } = this;\n        return gl.createFramebuffer();\n    }\n    /**\n     * ```\n     * gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n     * ```\n     *\n     * @param framebuffer\n     */\n    bindFramebuffer(framebuffer) {\n        const { gl } = this;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n    }\n    /**\n     * ```\n     * gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n     * ```\n     * @remarks\n     * **WebGL Difference**: Bind target is always `gl.FRAMEBUFFER` and textarget is always `gl.TEXTURE_2D`\n     */\n    framebufferTexture2D(attachment, texture, level) {\n        const { gl } = this;\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_2D, texture, level);\n    }\n    /**\n     * ```\n     * gl.clear(gl.COLOR_BUFFER_BIT);\n     * ```\n     *\n     * @remarks\n     * **WebGL Difference**: Clear mask is always `gl.COLOR_BUFFER_BIT`\n     */\n    clear() {\n        const { gl } = this;\n        gl.clear(gl.COLOR_BUFFER_BIT);\n    }\n    /**\n     * ```\n     * gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n     * gl.bufferData(gl.ARRAY_BUFFER, data, usage);\n     * ```\n     *\n     * @remarks\n     * **WebGL Combo**: `gl.bindBuffer` and `gl.bufferData` are combined into one function.\n     *\n     * @param buffer\n     * @param data\n     * @param usage\n     */\n    arrayBufferData(buffer, data, usage) {\n        const { gl, boundArrayBuffer } = this;\n        if (boundArrayBuffer !== buffer) {\n            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n            this.boundArrayBuffer = buffer;\n        }\n        gl.bufferData(gl.ARRAY_BUFFER, data, usage);\n    }\n    /**\n     * ```\n     * gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n     * gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, usage);\n     * ```\n     * @remarks\n     * **WebGL Combo**: `gl.bindBuffer` and `gl.bufferData` are combined into one function.\n     *\n     * @param buffer\n     * @param data\n     * @param usage\n     */\n    elementArrayBufferData(buffer, data, usage) {\n        const { gl, boundElementArrayBuffer } = this;\n        if (boundElementArrayBuffer !== buffer) {\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n            this.boundElementArrayBuffer = buffer;\n        }\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, usage);\n    }\n    /**\n     * ```\n     * gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n     * gl.vertexAttribPointer(index, size, type, normalized, stride, offset);\n     * ```\n     *\n     * @remarks\n     * **WebGL Combo**: `gl.bindBuffer` and `gl.vertexAttribPointer` are combined into one function.\n     *\n     * @param buffer\n     * @param index\n     * @param size\n     * @param type\n     * @param normalized\n     * @param stride\n     * @param offset\n     */\n    vertexAttribPointer(buffer, index, size, type, normalized, stride, offset) {\n        const { gl, boundArrayBuffer } = this;\n        if (boundArrayBuffer !== buffer) {\n            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n            this.boundArrayBuffer = buffer;\n        }\n        gl.vertexAttribPointer(index, size, type, normalized, stride, offset);\n    }\n    /**\n     * ```\n     * gl.useProgram(program);\n     * ```\n     *\n     * @param program\n     * @returns\n     */\n    useProgram(program) {\n        const { gl, curProgram } = this;\n        if (curProgram === program) {\n            return;\n        }\n        gl.useProgram(program);\n        this.curProgram = program;\n    }\n    setUniform(type, location, ...args) {\n        const { gl, programUniforms } = this;\n        let uniforms = programUniforms.get(this.curProgram);\n        if (!uniforms) {\n            uniforms = new Map();\n            programUniforms.set(this.curProgram, uniforms);\n        }\n        const uniformArgs = uniforms.get(location);\n        if (!uniformArgs || !compareArrays(uniformArgs, args)) {\n            uniforms.set(location, args);\n            gl[type](location, ...args);\n        }\n    }\n    /**\n     * ```\n     * gl.getParameter(pname);\n     * ```\n     *\n     * @param pname\n     * @returns\n     */\n    getParameter(pname) {\n        const { gl } = this;\n        return gl.getParameter(pname);\n    }\n    /**\n     * ```\n     * gl.drawElements(mode, count, type, offset);\n     * ```\n     *\n     * @param mode\n     * @param count\n     * @param type\n     * @param offset\n     */\n    drawElements(mode, count, type, offset) {\n        const { gl } = this;\n        gl.drawElements(mode, count, type, offset);\n    }\n    /**\n     * ```\n     * gl.drawArrays(mode, first, count);\n     * ```\n     *\n     * @param name\n     * @returns\n     */\n    getExtension(name) {\n        const { gl } = this;\n        return gl.getExtension(name);\n    }\n    /**\n     * ```\n     * gl.createVertexArray();\n     * ```\n     *\n     * @returns\n     */\n    createVertexArray() {\n        const { gl } = this;\n        assertTruthy(gl instanceof WebGL2RenderingContext);\n        return gl.createVertexArray();\n    }\n    /**\n     * ```\n     * gl.bindVertexArray(vertexArray);\n     * ```\n     *\n     * @param vertexArray\n     */\n    bindVertexArray(vertexArray) {\n        const { gl } = this;\n        assertTruthy(gl instanceof WebGL2RenderingContext);\n        gl.bindVertexArray(vertexArray);\n    }\n    /**\n     * ```\n     * gl.getAttribLocation(program, name);\n     * ```\n     *\n     * @param program\n     * @param name\n     * @returns\n     */\n    getAttribLocation(program, name) {\n        const { gl } = this;\n        return gl.getAttribLocation(program, name);\n    }\n    /**\n     * ```\n     * gl.getUniformLocation(program, name);\n     * ```\n     *\n     * @param program\n     * @param name\n     * @returns\n     */\n    getUniformLocation(program, name) {\n        const { gl } = this;\n        return gl.getUniformLocation(program, name);\n    }\n    /**\n     * ```\n     * gl.enableVertexAttribArray(index);\n     * ```\n     *\n     * @param index\n     */\n    enableVertexAttribArray(index) {\n        const { gl } = this;\n        gl.enableVertexAttribArray(index);\n    }\n    /**\n     * ```\n     * gl.disableVertexAttribArray(index);\n     * ```\n     *\n     * @param index\n     */\n    disableVertexAttribArray(index) {\n        const { gl } = this;\n        gl.disableVertexAttribArray(index);\n    }\n    /**\n     * ```\n     * gl.createShader(type);\n     * ```\n     *\n     * @param type\n     * @returns\n     */\n    createShader(type) {\n        const { gl } = this;\n        return gl.createShader(type);\n    }\n    /**\n     * ```\n     * gl.compileShader(shader);\n     * ```\n     *\n     * @param shader\n     * @returns\n     */\n    compileShader(shader) {\n        const { gl } = this;\n        gl.compileShader(shader);\n    }\n    /**\n     * ```\n     * gl.attachShader(program, shader);\n     * ```\n     *\n     * @param program\n     * @param shader\n     */\n    attachShader(program, shader) {\n        const { gl } = this;\n        gl.attachShader(program, shader);\n    }\n    /**\n     * ```\n     * gl.linkProgram(program);\n     * ```\n     *\n     * @param program\n     */\n    linkProgram(program) {\n        const { gl } = this;\n        gl.linkProgram(program);\n    }\n    /**\n     * ```\n     * gl.deleteProgram(shader);\n     * ```\n     *\n     * @param shader\n     */\n    deleteProgram(shader) {\n        const { gl } = this;\n        gl.deleteProgram(shader);\n    }\n    /**\n     * ```\n     * gl.getShaderParameter(shader, pname);\n     * ```\n     *\n     * @param shader\n     * @param pname\n     */\n    getShaderParameter(shader, pname) {\n        const { gl } = this;\n        return gl.getShaderParameter(shader, pname);\n    }\n    /**\n     * ```\n     * gl.getShaderInfoLog(shader);\n     * ```\n     *\n     * @param shader\n     */\n    getShaderInfoLog(shader) {\n        const { gl } = this;\n        return gl.getShaderInfoLog(shader);\n    }\n    /**\n     * ```\n     * gl.createProgram();\n     * ```\n     *\n     * @returns\n     */\n    createProgram() {\n        const { gl } = this;\n        return gl.createProgram();\n    }\n    /**\n     * ```\n     * gl.getProgramParameter(program, pname);\n     * ```\n     *\n     * @param program\n     * @param pname\n     * @returns\n     */\n    getProgramParameter(program, pname) {\n        const { gl } = this;\n        return gl.getProgramParameter(program, pname);\n    }\n    /**\n     * ```\n     * gl.getProgramInfoLog(program);\n     * ```\n     *\n     * @param program\n     * @returns\n     */\n    getProgramInfoLog(program) {\n        const { gl } = this;\n        return gl.getProgramInfoLog(program);\n    }\n    /**\n     * ```\n     * gl.shaderSource(shader, source);\n     * ```\n     *\n     * @param shader\n     * @param source\n     */\n    shaderSource(shader, source) {\n        const { gl } = this;\n        gl.shaderSource(shader, source);\n    }\n    /**\n     * ```\n     * gl.deleteShader(shader);\n     * ```\n     *\n     * @param shader\n     */\n    deleteShader(shader) {\n        const { gl } = this;\n        gl.deleteShader(shader);\n    }\n}\n/**\n * Compare two arrays for equality.\n *\n * @remarks\n * This function will not try to compare nested arrays or Float32Arrays and\n * instead will always return false when they are encountered.\n *\n * @param a\n * @param b\n * @returns\n */\nexport function compareArrays(a, b) {\n    if (a.length !== b.length) {\n        return false;\n    }\n    return a.every((v, i) => {\n        // Don't bother to compare nested arrays or Float32Arrays\n        if (Array.isArray(v) || v instanceof Float32Array) {\n            return false;\n        }\n        else {\n            return v === b[i];\n        }\n    });\n}\n//# sourceMappingURL=WebGlContextWrapper.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Generic WebGL Utility Functions\n *\n * @remarks\n * Nothing here should be coupled to Renderer logic / types.\n *\n * @param gl\n * @returns\n */\nexport function isWebGl2(gl) {\n    return (self.WebGL2RenderingContext && gl instanceof self.WebGL2RenderingContext);\n}\n//# sourceMappingURL=WebGlUtils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Texture } from './Texture.js';\nexport class RenderTexture extends Texture {\n    props;\n    constructor(txManager, props) {\n        super(txManager);\n        this.props = RenderTexture.resolveDefaults(props || {});\n    }\n    get width() {\n        return this.props.width;\n    }\n    set width(value) {\n        this.props.width = value;\n    }\n    get height() {\n        return this.props.height;\n    }\n    set height(value) {\n        this.props.height = value;\n    }\n    async getTextureData() {\n        return {\n            data: null,\n            premultiplyAlpha: null,\n        };\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width || 256,\n            height: props.height || 256,\n        };\n    }\n    static z$__type__Props;\n}\n//# sourceMappingURL=RenderTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2024 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../../utils.js';\nimport { WebGlCoreCtxTexture } from './WebGlCoreCtxTexture.js';\nexport class WebGlCoreCtxRenderTexture extends WebGlCoreCtxTexture {\n    framebuffer;\n    constructor(glw, memManager, textureSource) {\n        super(glw, memManager, textureSource);\n        // Create Framebuffer object\n        const framebuffer = glw.createFramebuffer();\n        assertTruthy(framebuffer, 'Unable to create framebuffer');\n        this.framebuffer = framebuffer;\n    }\n    async onLoadRequest() {\n        const { glw } = this;\n        const nativeTexture = (this._nativeCtxTexture =\n            this.createNativeCtxTexture());\n        const { width, height } = this.textureSource;\n        // Set the dimensions of the render texture\n        glw.texImage2D(0, glw.RGBA, width, height, 0, glw.RGBA, glw.UNSIGNED_BYTE, null);\n        // Update the texture memory manager\n        this.setTextureMemUse(width * height * 4);\n        // Bind the framebuffer\n        glw.bindFramebuffer(this.framebuffer);\n        // Attach the texture to the framebuffer\n        glw.framebufferTexture2D(glw.COLOR_ATTACHMENT0, nativeTexture, 0);\n        // Unbind the framebuffer\n        glw.bindFramebuffer(null);\n        return {\n            width,\n            height,\n        };\n    }\n}\n//# sourceMappingURL=WebGlCoreCtxRenderTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {} from '../textures/Texture.js';\n/**\n * Tests if the given location is a compressed texture container\n * @param url\n * @remarks\n * This function is used to determine if the given image url is a compressed\n * and only supports the following extensions: .ktx and .pvr\n * @returns\n */\nexport function isCompressedTextureContainer(url) {\n    return /\\.(ktx|pvr)$/.test(url);\n}\n/**\n * Loads a compressed texture container\n * @param url\n * @returns\n */\nexport const loadCompressedTexture = async (url) => {\n    const response = await fetch(url);\n    const arrayBuffer = await response.arrayBuffer();\n    if (url.indexOf('.ktx') !== -1) {\n        return loadKTXData(arrayBuffer);\n    }\n    return loadPVRData(arrayBuffer);\n};\n/**\n * Loads a KTX texture container and returns the texture data\n * @param buffer\n * @returns\n */\nconst loadKTXData = async (buffer) => {\n    const view = new DataView(buffer);\n    const littleEndian = view.getUint32(12) === 16909060 ? true : false;\n    const mipmaps = [];\n    const data = {\n        glInternalFormat: view.getUint32(28, littleEndian),\n        pixelWidth: view.getUint32(36, littleEndian),\n        pixelHeight: view.getUint32(40, littleEndian),\n        numberOfMipmapLevels: view.getUint32(56, littleEndian),\n        bytesOfKeyValueData: view.getUint32(60, littleEndian),\n    };\n    let offset = 64;\n    // Key Value Pairs of data start at byte offset 64\n    // But the only known kvp is the API version, so skipping parsing.\n    offset += data.bytesOfKeyValueData;\n    for (let i = 0; i < data.numberOfMipmapLevels; i++) {\n        const imageSize = view.getUint32(offset);\n        offset += 4;\n        mipmaps.push(view.buffer.slice(offset, imageSize));\n        offset += imageSize;\n    }\n    return {\n        data: {\n            glInternalFormat: data.glInternalFormat,\n            mipmaps,\n            width: data.pixelWidth || 0,\n            height: data.pixelHeight || 0,\n            type: 'ktx',\n        },\n        premultiplyAlpha: false,\n    };\n};\n/**\n * Loads a PVR texture container and returns the texture data\n * @param buffer\n * @returns\n */\nconst loadPVRData = async (buffer) => {\n    // pvr header length in 32 bits\n    const pvrHeaderLength = 13;\n    // for now only we only support: COMPRESSED_RGB_ETC1_WEBGL\n    const pvrFormatEtc1 = 0x8d64;\n    const pvrWidth = 7;\n    const pvrHeight = 6;\n    const pvrMipmapCount = 11;\n    const pvrMetadata = 12;\n    const arrayBuffer = buffer;\n    const header = new Int32Array(arrayBuffer, 0, pvrHeaderLength);\n    // @ts-expect-error Object possibly undefined\n    // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n    const dataOffset = header[pvrMetadata] + 52;\n    const pvrtcData = new Uint8Array(arrayBuffer, dataOffset);\n    const mipmaps = [];\n    const data = {\n        pixelWidth: header[pvrWidth],\n        pixelHeight: header[pvrHeight],\n        numberOfMipmapLevels: header[pvrMipmapCount] || 0,\n    };\n    let offset = 0;\n    let width = data.pixelWidth || 0;\n    let height = data.pixelHeight || 0;\n    for (let i = 0; i < data.numberOfMipmapLevels; i++) {\n        const level = ((width + 3) >> 2) * ((height + 3) >> 2) * 8;\n        const view = new Uint8Array(arrayBuffer, pvrtcData.byteOffset + offset, level);\n        mipmaps.push(view);\n        offset += level;\n        width = width >> 1;\n        height = height >> 1;\n    }\n    return {\n        data: {\n            glInternalFormat: pvrFormatEtc1,\n            mipmaps: mipmaps,\n            width: data.pixelWidth || 0,\n            height: data.pixelHeight || 0,\n            type: 'pvr',\n        },\n        premultiplyAlpha: false,\n    };\n};\n//# sourceMappingURL=textureCompression.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Texture } from './Texture.js';\nimport { isCompressedTextureContainer, loadCompressedTexture, } from '../lib/textureCompression.js';\nimport { convertUrlToAbsolute } from '../lib/utils.js';\n/**\n * Texture consisting of an image loaded from a URL\n *\n * @remarks\n * The ImageTexture's {@link ImageTextureProps.src} prop defines the image URL\n * to be downloaded.\n *\n * By default, the texture's alpha values will be premultiplied into its color\n * values which is generally the desired setting before they are sent to the\n * texture's associated {@link Shader}. However, in special cases you may want\n * the Shader to receive straight (non-premultiplied) values. In that case you\n * can disable the default behavior by setting the\n * {@link ImageTextureProps.premultiplyAlpha} prop to `false`.\n */\nexport class ImageTexture extends Texture {\n    props;\n    constructor(txManager, props) {\n        super(txManager);\n        this.props = ImageTexture.resolveDefaults(props);\n    }\n    hasAlphaChannel(mimeType) {\n        return mimeType.indexOf('image/png') !== -1;\n    }\n    async getTextureData() {\n        const { src, premultiplyAlpha } = this.props;\n        if (!src) {\n            return {\n                data: null,\n            };\n        }\n        if (typeof src !== 'string') {\n            if (src instanceof ImageData) {\n                return {\n                    data: src,\n                    premultiplyAlpha,\n                };\n            }\n            return {\n                data: src(),\n                premultiplyAlpha,\n            };\n        }\n        // Handle compressed textures\n        if (isCompressedTextureContainer(src)) {\n            return loadCompressedTexture(src);\n        }\n        // Convert relative URL to absolute URL\n        const absoluteSrc = convertUrlToAbsolute(src);\n        if (this.txManager.imageWorkerManager) {\n            return await this.txManager.imageWorkerManager.getImage(absoluteSrc, premultiplyAlpha);\n        }\n        else if (this.txManager.hasCreateImageBitmap) {\n            const response = await fetch(absoluteSrc);\n            const blob = await response.blob();\n            const hasAlphaChannel = premultiplyAlpha ?? this.hasAlphaChannel(blob.type);\n            return {\n                data: await createImageBitmap(blob, {\n                    premultiplyAlpha: hasAlphaChannel ? 'premultiply' : 'none',\n                    colorSpaceConversion: 'none',\n                    imageOrientation: 'none',\n                }),\n                premultiplyAlpha: hasAlphaChannel,\n            };\n        }\n        else {\n            const img = new Image();\n            if (!(src.substr(0, 5) === 'data:')) {\n                img.crossOrigin = 'Anonymous';\n            }\n            img.src = absoluteSrc;\n            await new Promise((resolve, reject) => {\n                img.onload = () => resolve();\n                img.onerror = () => reject(new Error(`Failed to load image`));\n            }).catch((e) => {\n                console.error(e);\n            });\n            return {\n                data: img,\n                premultiplyAlpha: premultiplyAlpha ?? true,\n            };\n        }\n    }\n    static makeCacheKey(props) {\n        const resolvedProps = ImageTexture.resolveDefaults(props);\n        // Only cache key-able textures; prioritise key\n        const key = resolvedProps.key || resolvedProps.src;\n        if (typeof key !== 'string') {\n            return false;\n        }\n        return `ImageTexture,${key},${resolvedProps.premultiplyAlpha ?? 'true'}`;\n    }\n    static resolveDefaults(props) {\n        return {\n            src: props.src ?? '',\n            premultiplyAlpha: props.premultiplyAlpha ?? true,\n            key: props.key ?? null,\n        };\n    }\n    static z$__type__Props;\n}\n//# sourceMappingURL=ImageTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy, createWebGLContext, hasOwn } from '../../../utils.js';\nimport { CoreRenderer, } from '../CoreRenderer.js';\nimport { WebGlCoreRenderOp } from './WebGlCoreRenderOp.js';\nimport { createIndexBuffer, getWebGlParameters, getWebGlExtensions, } from './internal/RendererUtils.js';\nimport { WebGlCoreCtxTexture } from './WebGlCoreCtxTexture.js';\nimport { Texture } from '../../textures/Texture.js';\nimport { ColorTexture } from '../../textures/ColorTexture.js';\nimport { SubTexture } from '../../textures/SubTexture.js';\nimport { WebGlCoreCtxSubTexture } from './WebGlCoreCtxSubTexture.js';\nimport { CoreShaderManager } from '../../CoreShaderManager.js';\nimport { BufferCollection } from './internal/BufferCollection.js';\nimport { compareRect, getNormalizedRgbaComponents, } from '../../lib/utils.js';\nimport { WebGlCoreShader } from './WebGlCoreShader.js';\nimport { WebGlContextWrapper } from '../../lib/WebGlContextWrapper.js';\nimport { RenderTexture } from '../../textures/RenderTexture.js';\nimport { WebGlCoreCtxRenderTexture } from './WebGlCoreCtxRenderTexture.js';\nimport { ImageTexture } from '../../textures/ImageTexture.js';\nconst WORDS_PER_QUAD = 24;\nexport class WebGlCoreRenderer extends CoreRenderer {\n    //// WebGL Native Context and Data\n    glw;\n    system;\n    //// Persistent data\n    quadBuffer = new ArrayBuffer(1024 * 1024 * 4);\n    fQuadBuffer = new Float32Array(this.quadBuffer);\n    uiQuadBuffer = new Uint32Array(this.quadBuffer);\n    renderOps = [];\n    //// Render Op / Buffer Filling State\n    curBufferIdx = 0;\n    curRenderOp = null;\n    rttNodes = [];\n    activeRttNode = null;\n    //// Default Shader\n    defShaderCtrl;\n    defaultShader;\n    quadBufferCollection;\n    /**\n     * White pixel texture used by default when no texture is specified.\n     */\n    defaultTexture;\n    /**\n     * Whether the renderer is currently rendering to a texture.\n     */\n    renderToTextureActive = false;\n    constructor(options) {\n        super(options);\n        this.mode = 'webgl';\n        const { canvas, clearColor, bufferMemory } = options;\n        this.defaultTexture = new ColorTexture(this.txManager);\n        // Mark the default texture as ALWAYS renderable\n        // This prevents it from ever being cleaned up.\n        // Fixes https://github.com/lightning-js/renderer/issues/262\n        this.defaultTexture.setRenderableOwner(this, true);\n        // When the default texture is loaded, request a render in case the\n        // RAF is paused. Fixes: https://github.com/lightning-js/renderer/issues/123\n        this.defaultTexture.once('loaded', () => {\n            this.stage.requestRender();\n        });\n        const gl = createWebGLContext(canvas, options.contextSpy);\n        const glw = (this.glw = new WebGlContextWrapper(gl));\n        const color = getNormalizedRgbaComponents(clearColor);\n        glw.viewport(0, 0, canvas.width, canvas.height);\n        glw.clearColor(color[0], color[1], color[2], color[3]);\n        glw.setBlend(true);\n        glw.blendFunc(glw.ONE, glw.ONE_MINUS_SRC_ALPHA);\n        createIndexBuffer(glw, bufferMemory);\n        this.system = {\n            parameters: getWebGlParameters(this.glw),\n            extensions: getWebGlExtensions(this.glw),\n        };\n        this.shManager.renderer = this;\n        this.defShaderCtrl = this.shManager.loadShader('DefaultShader');\n        this.defaultShader = this.defShaderCtrl.shader;\n        const quadBuffer = glw.createBuffer();\n        assertTruthy(quadBuffer);\n        const stride = 6 * Float32Array.BYTES_PER_ELEMENT;\n        this.quadBufferCollection = new BufferCollection([\n            {\n                buffer: quadBuffer,\n                attributes: {\n                    a_position: {\n                        name: 'a_position',\n                        size: 2,\n                        type: glw.FLOAT,\n                        normalized: false,\n                        stride,\n                        offset: 0, // start at the beginning of the buffer\n                    },\n                    a_textureCoordinate: {\n                        name: 'a_textureCoordinate',\n                        size: 2,\n                        type: glw.FLOAT,\n                        normalized: false,\n                        stride,\n                        offset: 2 * Float32Array.BYTES_PER_ELEMENT,\n                    },\n                    a_color: {\n                        name: 'a_color',\n                        size: 4,\n                        type: glw.UNSIGNED_BYTE,\n                        normalized: true,\n                        stride,\n                        offset: 4 * Float32Array.BYTES_PER_ELEMENT,\n                    },\n                    a_textureIndex: {\n                        name: 'a_textureIndex',\n                        size: 1,\n                        type: glw.FLOAT,\n                        normalized: false,\n                        stride,\n                        offset: 5 * Float32Array.BYTES_PER_ELEMENT,\n                    },\n                },\n            },\n        ]);\n    }\n    reset() {\n        const { glw } = this;\n        this.curBufferIdx = 0;\n        this.curRenderOp = null;\n        this.renderOps.length = 0;\n        glw.setScissorTest(false);\n        glw.clear();\n    }\n    getShaderManager() {\n        return this.shManager;\n    }\n    createCtxTexture(textureSource) {\n        if (textureSource instanceof SubTexture) {\n            return new WebGlCoreCtxSubTexture(this.glw, this.txMemManager, textureSource);\n        }\n        else if (textureSource instanceof RenderTexture) {\n            return new WebGlCoreCtxRenderTexture(this.glw, this.txMemManager, textureSource);\n        }\n        return new WebGlCoreCtxTexture(this.glw, this.txMemManager, textureSource);\n    }\n    /**\n     * This function adds a quad (a rectangle composed of two triangles) to the WebGL rendering pipeline.\n     *\n     * It takes a set of options that define the quad's properties, such as its dimensions, colors, texture, shader, and transformation matrix.\n     * The function first updates the shader properties with the current dimensions if necessary, then sets the default texture if none is provided.\n     * It then checks if a new render operation is needed, based on the current shader and clipping rectangle.\n     * If a new render operation is needed, it creates one and updates the current render operation.\n     * The function then adjusts the texture coordinates based on the texture options and adds the texture to the texture manager.\n     *\n     * Finally, it calculates the vertices for the quad, taking into account any transformations, and adds them to the quad buffer.\n     * The function updates the length and number of quads in the current render operation, and updates the current buffer index.\n     */\n    addQuad(params) {\n        const { fQuadBuffer, uiQuadBuffer } = this;\n        const { width, height, colorTl, colorTr, colorBl, colorBr, textureOptions, shader, shaderProps, alpha, clippingRect, tx, ty, ta, tb, tc, td, renderCoords, rtt: renderToTexture, parentHasRenderTexture, framebufferDimensions, } = params;\n        let { texture } = params;\n        /**\n         * If the shader props contain any automatic properties, update it with the\n         * current dimensions that will be used to render the quad.\n         */\n        if (shaderProps && hasOwn(shaderProps, '$dimensions')) {\n            const dimensions = shaderProps.$dimensions;\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            dimensions.width = width;\n            dimensions.height = height;\n        }\n        texture = texture ?? this.defaultTexture;\n        assertTruthy(texture instanceof Texture, 'Invalid texture type');\n        let { curBufferIdx: bufferIdx, curRenderOp } = this;\n        const targetDims = {\n            width,\n            height,\n        };\n        const targetShader = shader || this.defaultShader;\n        assertTruthy(targetShader instanceof WebGlCoreShader);\n        if (!this.reuseRenderOp(params)) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n            this.newRenderOp(targetShader, shaderProps, alpha, targetDims, clippingRect, bufferIdx, renderToTexture, parentHasRenderTexture, framebufferDimensions);\n            curRenderOp = this.curRenderOp;\n            assertTruthy(curRenderOp);\n        }\n        const flipX = textureOptions?.flipX ?? false;\n        let flipY = textureOptions?.flipY ?? false;\n        // always flip flipY for render textures\n        if (texture instanceof RenderTexture) {\n            flipY = !flipY;\n        }\n        let texCoordX1 = 0;\n        let texCoordY1 = 0;\n        let texCoordX2 = 1;\n        let texCoordY2 = 1;\n        if (texture instanceof SubTexture) {\n            const { x: tx, y: ty, width: tw, height: th } = texture.props;\n            const { width: parentW = 0, height: parentH = 0 } = texture.parentTexture\n                .dimensions || { width: 0, height: 0 };\n            texCoordX1 = tx / parentW;\n            texCoordX2 = texCoordX1 + tw / parentW;\n            texCoordY1 = ty / parentH;\n            texCoordY2 = texCoordY1 + th / parentH;\n            texture = texture.parentTexture;\n        }\n        const resizeMode = textureOptions?.resizeMode ?? false;\n        if (texture instanceof ImageTexture) {\n            if (resizeMode && texture.dimensions) {\n                const { width: tw, height: th } = texture.dimensions;\n                if (resizeMode.type === 'cover') {\n                    const scaleX = width / tw;\n                    const scaleY = height / th;\n                    const scale = Math.max(scaleX, scaleY);\n                    const precision = 1 / scale;\n                    // Determine based on width\n                    if (scale && scaleX && scaleX < scale) {\n                        const desiredSize = precision * width;\n                        texCoordX1 = (1 - desiredSize / tw) * (resizeMode.clipX ?? 0.5);\n                        texCoordX2 = texCoordX1 + desiredSize / tw;\n                    }\n                    // Determine based on height\n                    if (scale && scaleY && scaleY < scale) {\n                        const desiredSize = precision * height;\n                        texCoordY1 = (1 - desiredSize / th) * (resizeMode.clipY ?? 0.5);\n                        texCoordY2 = texCoordY1 + desiredSize / th;\n                    }\n                }\n            }\n        }\n        // Flip texture coordinates if dictated by texture options\n        if (flipX) {\n            [texCoordX1, texCoordX2] = [texCoordX2, texCoordX1];\n        }\n        if (flipY) {\n            [texCoordY1, texCoordY2] = [texCoordY2, texCoordY1];\n        }\n        const ctxTexture = texture.ctxTexture;\n        assertTruthy(ctxTexture instanceof WebGlCoreCtxTexture);\n        const textureIdx = this.addTexture(ctxTexture, bufferIdx);\n        curRenderOp = this.curRenderOp;\n        assertTruthy(curRenderOp);\n        if (renderCoords) {\n            const { x1, y1, x2, y2, x3, y3, x4, y4 } = renderCoords;\n            // Upper-Left\n            fQuadBuffer[bufferIdx++] = x1; // vertexX\n            fQuadBuffer[bufferIdx++] = y1; // vertexY\n            fQuadBuffer[bufferIdx++] = texCoordX1; // texCoordX\n            fQuadBuffer[bufferIdx++] = texCoordY1; // texCoordY\n            uiQuadBuffer[bufferIdx++] = colorTl; // color\n            fQuadBuffer[bufferIdx++] = textureIdx; // texIndex\n            // Upper-Right\n            fQuadBuffer[bufferIdx++] = x2;\n            fQuadBuffer[bufferIdx++] = y2;\n            fQuadBuffer[bufferIdx++] = texCoordX2;\n            fQuadBuffer[bufferIdx++] = texCoordY1;\n            uiQuadBuffer[bufferIdx++] = colorTr;\n            fQuadBuffer[bufferIdx++] = textureIdx;\n            // Lower-Left\n            fQuadBuffer[bufferIdx++] = x4;\n            fQuadBuffer[bufferIdx++] = y4;\n            fQuadBuffer[bufferIdx++] = texCoordX1;\n            fQuadBuffer[bufferIdx++] = texCoordY2;\n            uiQuadBuffer[bufferIdx++] = colorBl;\n            fQuadBuffer[bufferIdx++] = textureIdx;\n            // Lower-Right\n            fQuadBuffer[bufferIdx++] = x3;\n            fQuadBuffer[bufferIdx++] = y3;\n            fQuadBuffer[bufferIdx++] = texCoordX2;\n            fQuadBuffer[bufferIdx++] = texCoordY2;\n            uiQuadBuffer[bufferIdx++] = colorBr;\n            fQuadBuffer[bufferIdx++] = textureIdx;\n        }\n        else if (tb !== 0 || tc !== 0) {\n            // Upper-Left\n            fQuadBuffer[bufferIdx++] = tx; // vertexX\n            fQuadBuffer[bufferIdx++] = ty; // vertexY\n            fQuadBuffer[bufferIdx++] = texCoordX1; // texCoordX\n            fQuadBuffer[bufferIdx++] = texCoordY1; // texCoordY\n            uiQuadBuffer[bufferIdx++] = colorTl; // color\n            fQuadBuffer[bufferIdx++] = textureIdx; // texIndex\n            // Upper-Right\n            fQuadBuffer[bufferIdx++] = tx + width * ta;\n            fQuadBuffer[bufferIdx++] = ty + width * tc;\n            fQuadBuffer[bufferIdx++] = texCoordX2;\n            fQuadBuffer[bufferIdx++] = texCoordY1;\n            uiQuadBuffer[bufferIdx++] = colorTr;\n            fQuadBuffer[bufferIdx++] = textureIdx;\n            // Lower-Left\n            fQuadBuffer[bufferIdx++] = tx + height * tb;\n            fQuadBuffer[bufferIdx++] = ty + height * td;\n            fQuadBuffer[bufferIdx++] = texCoordX1;\n            fQuadBuffer[bufferIdx++] = texCoordY2;\n            uiQuadBuffer[bufferIdx++] = colorBl;\n            fQuadBuffer[bufferIdx++] = textureIdx;\n            // Lower-Right\n            fQuadBuffer[bufferIdx++] = tx + width * ta + height * tb;\n            fQuadBuffer[bufferIdx++] = ty + width * tc + height * td;\n            fQuadBuffer[bufferIdx++] = texCoordX2;\n            fQuadBuffer[bufferIdx++] = texCoordY2;\n            uiQuadBuffer[bufferIdx++] = colorBr;\n            fQuadBuffer[bufferIdx++] = textureIdx;\n        }\n        else {\n            // Calculate the right corner of the quad\n            // multiplied by the scale\n            const rightCornerX = tx + width * ta;\n            const rightCornerY = ty + height * td;\n            // Upper-Left\n            fQuadBuffer[bufferIdx++] = tx; // vertexX\n            fQuadBuffer[bufferIdx++] = ty; // vertexY\n            fQuadBuffer[bufferIdx++] = texCoordX1; // texCoordX\n            fQuadBuffer[bufferIdx++] = texCoordY1; // texCoordY\n            uiQuadBuffer[bufferIdx++] = colorTl; // color\n            fQuadBuffer[bufferIdx++] = textureIdx; // texIndex\n            // Upper-Right\n            fQuadBuffer[bufferIdx++] = rightCornerX;\n            fQuadBuffer[bufferIdx++] = ty;\n            fQuadBuffer[bufferIdx++] = texCoordX2;\n            fQuadBuffer[bufferIdx++] = texCoordY1;\n            uiQuadBuffer[bufferIdx++] = colorTr;\n            fQuadBuffer[bufferIdx++] = textureIdx;\n            // Lower-Left\n            fQuadBuffer[bufferIdx++] = tx;\n            fQuadBuffer[bufferIdx++] = rightCornerY;\n            fQuadBuffer[bufferIdx++] = texCoordX1;\n            fQuadBuffer[bufferIdx++] = texCoordY2;\n            uiQuadBuffer[bufferIdx++] = colorBl;\n            fQuadBuffer[bufferIdx++] = textureIdx;\n            // Lower-Right\n            fQuadBuffer[bufferIdx++] = rightCornerX;\n            fQuadBuffer[bufferIdx++] = rightCornerY;\n            fQuadBuffer[bufferIdx++] = texCoordX2;\n            fQuadBuffer[bufferIdx++] = texCoordY2;\n            uiQuadBuffer[bufferIdx++] = colorBr;\n            fQuadBuffer[bufferIdx++] = textureIdx;\n        }\n        // Update the length of the current render op\n        curRenderOp.length += WORDS_PER_QUAD;\n        curRenderOp.numQuads++;\n        this.curBufferIdx = bufferIdx;\n    }\n    /**\n     * Replace the existing RenderOp with a new one that uses the specified Shader\n     * and starts at the specified buffer index.\n     *\n     * @param shader\n     * @param bufferIdx\n     */\n    newRenderOp(shader, shaderProps, alpha, dimensions, clippingRect, bufferIdx, renderToTexture, parentHasRenderTexture, framebufferDimensions) {\n        const curRenderOp = new WebGlCoreRenderOp(this.glw, this.options, this.quadBufferCollection, shader, shaderProps, alpha, clippingRect, dimensions, bufferIdx, 0, // Z-Index is only used for explictly added Render Ops\n        renderToTexture, parentHasRenderTexture, framebufferDimensions);\n        this.curRenderOp = curRenderOp;\n        this.renderOps.push(curRenderOp);\n    }\n    /**\n     * Add a texture to the current RenderOp. If the texture cannot be added to the\n     * current RenderOp, a new RenderOp will be created and the texture will be added\n     * to that one.\n     *\n     * If the texture cannot be added to the new RenderOp, an error will be thrown.\n     *\n     * @param texture\n     * @param bufferIdx\n     * @param recursive\n     * @returns Assigned Texture Index of the texture in the render op\n     */\n    addTexture(texture, bufferIdx, recursive) {\n        const { curRenderOp } = this;\n        assertTruthy(curRenderOp);\n        const textureIdx = curRenderOp.addTexture(texture);\n        // TODO: Refactor to be more DRY\n        if (textureIdx === 0xffffffff) {\n            if (recursive) {\n                throw new Error('Unable to add texture to render op');\n            }\n            const { shader, shaderProps, dimensions, clippingRect, alpha } = curRenderOp;\n            this.newRenderOp(shader, shaderProps, alpha, dimensions, clippingRect, bufferIdx);\n            return this.addTexture(texture, bufferIdx, true);\n        }\n        return textureIdx;\n    }\n    /**\n     * Test if the current Render operation can be reused for the specified parameters.\n     * @param params\n     * @returns\n     */\n    reuseRenderOp(params) {\n        const { shader, shaderProps, parentHasRenderTexture, rtt, clippingRect } = params;\n        const targetShader = shader || this.defaultShader;\n        // Switching shader program will require a new render operation\n        if (this.curRenderOp?.shader !== targetShader) {\n            return false;\n        }\n        // Switching clipping rect will require a new render operation\n        if (!compareRect(this.curRenderOp.clippingRect, clippingRect)) {\n            return false;\n        }\n        // Force new render operation if rendering to texture\n        // @todo: This needs to be improved, render operations could also be reused\n        // for rendering to texture\n        if (parentHasRenderTexture || rtt) {\n            return false;\n        }\n        // Check if the shader can batch the shader properties\n        if (this.curRenderOp.shader !== this.defaultShader &&\n            (!shaderProps ||\n                !this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps, shaderProps))) {\n            return false;\n        }\n        // Render operation can be reused\n        return true;\n    }\n    /**\n     * add RenderOp to the render pipeline\n     */\n    addRenderOp(renderable) {\n        this.renderOps.push(renderable);\n        this.curRenderOp = null;\n    }\n    /**\n     * Render the current set of RenderOps to render to the specified surface.\n     *\n     * TODO: 'screen' is the only supported surface at the moment.\n     *\n     * @param surface\n     */\n    render(surface = 'screen') {\n        const { glw, quadBuffer } = this;\n        const arr = new Float32Array(quadBuffer, 0, this.curBufferIdx);\n        const buffer = this.quadBufferCollection.getBuffer('a_position') ?? null;\n        glw.arrayBufferData(buffer, arr, glw.STATIC_DRAW);\n        const doLog = false; // idx++ % 100 === 0;\n        if (doLog) {\n            console.log('renderOps', this.renderOps.length);\n        }\n        this.renderOps.forEach((renderOp, i) => {\n            if (doLog) {\n                console.log('Quads per operation', renderOp.numQuads);\n            }\n            renderOp.draw();\n        });\n    }\n    renderToTexture(node) {\n        for (let i = 0; i < this.rttNodes.length; i++) {\n            if (this.rttNodes[i] === node) {\n                return;\n            }\n        }\n        // @todo: Better bottom up rendering order\n        this.rttNodes.unshift(node);\n    }\n    renderRTTNodes() {\n        const { glw } = this;\n        const { txManager } = this.stage;\n        // Render all associated RTT nodes to their textures\n        for (let i = 0; i < this.rttNodes.length; i++) {\n            const node = this.rttNodes[i];\n            // Skip nodes that don't have RTT updates\n            if (!node || !node.hasRTTupdates) {\n                continue;\n            }\n            // Set the active RTT node to the current node\n            // So we can prevent rendering children of nested RTT nodes\n            this.activeRttNode = node;\n            assertTruthy(node.texture, 'RTT node missing texture');\n            const ctxTexture = node.texture.ctxTexture;\n            assertTruthy(ctxTexture instanceof WebGlCoreCtxRenderTexture);\n            this.renderToTextureActive = true;\n            // Bind the the texture's framebuffer\n            glw.bindFramebuffer(ctxTexture.framebuffer);\n            glw.viewport(0, 0, ctxTexture.w, ctxTexture.h);\n            glw.clear();\n            // Render all associated quads to the texture\n            for (let i = 0; i < node.children.length; i++) {\n                const child = node.children[i];\n                if (!child) {\n                    continue;\n                }\n                child.update(this.stage.deltaTime, {\n                    x: 0,\n                    y: 0,\n                    width: 0,\n                    height: 0,\n                    valid: false,\n                });\n                this.stage.addQuads(child);\n                child.hasRTTupdates = false;\n            }\n            // Render all associated quads to the texture\n            this.render();\n            // Reset render operations\n            this.renderOps.length = 0;\n            node.hasRTTupdates = false;\n        }\n        // Bind the default framebuffer\n        glw.bindFramebuffer(null);\n        glw.viewport(0, 0, this.glw.canvas.width, this.glw.canvas.height);\n        this.renderToTextureActive = false;\n    }\n    removeRTTNode(node) {\n        const index = this.rttNodes.indexOf(node);\n        if (index === -1) {\n            return;\n        }\n        this.rttNodes.splice(index, 1);\n    }\n    getDefShaderCtr() {\n        return this.defShaderCtrl;\n    }\n}\n//# sourceMappingURL=WebGlCoreRenderer.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { CoreAnimation } from './CoreAnimation.js';\nexport class AnimationManager {\n    activeAnimations = new Set();\n    registerAnimation(animation) {\n        this.activeAnimations.add(animation);\n    }\n    unregisterAnimation(animation) {\n        this.activeAnimations.delete(animation);\n    }\n    update(dt) {\n        this.activeAnimations.forEach((animation) => {\n            animation.update(dt);\n        });\n    }\n}\n//# sourceMappingURL=AnimationManager.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {} from '../textures/Texture.js';\n/**\n * Note that, within the createImageWorker function, we must only use ES5 code to keep it ES5-valid after babelifying, as\n *  the converted code of this section is converted to a blob and used as the js of the web worker thread.\n *\n * The createImageWorker function is a web worker that fetches an image from a URL and returns an ImageBitmap object.\n * The eslint @typescript rule is disabled for the entire function because the function is converted to a blob and used as the\n * js of the web worker thread, so the typescript syntax is not valid in this context.\n */\n/* eslint-disable */\nconst createImageWorker = function worker() {\n    function hasAlphaChannel(mimeType) {\n        return mimeType.indexOf('image/png') !== -1;\n    }\n    function getImage(src, premultiplyAlpha) {\n        return new Promise(function (resolve, reject) {\n            var xhr = new XMLHttpRequest();\n            xhr.open('GET', src, true);\n            xhr.responseType = 'blob';\n            xhr.onload = function () {\n                if (xhr.status !== 200) {\n                    return reject(new Error('Failed to load image: ' + xhr.statusText));\n                }\n                var blob = xhr.response;\n                var withAlphaChannel = premultiplyAlpha !== undefined\n                    ? premultiplyAlpha\n                    : hasAlphaChannel(blob.type);\n                createImageBitmap(blob, {\n                    premultiplyAlpha: withAlphaChannel ? 'premultiply' : 'none',\n                    colorSpaceConversion: 'none',\n                    imageOrientation: 'none',\n                })\n                    .then(function (data) {\n                    resolve({ data, premultiplyAlpha: premultiplyAlpha });\n                })\n                    .catch(function (error) {\n                    reject(error);\n                });\n            };\n            xhr.onerror = function () {\n                reject(new Error('Network error occurred while trying to fetch the image.'));\n            };\n            xhr.send();\n        });\n    }\n    self.onmessage = (event) => {\n        var src = event.data.src;\n        var id = event.data.id;\n        var premultiplyAlpha = event.data.premultiplyAlpha;\n        getImage(src, premultiplyAlpha)\n            .then(function (data) {\n            self.postMessage({ id: id, src: src, data: data });\n        })\n            .catch(function (error) {\n            self.postMessage({ id: id, src: src, error: error.message });\n        });\n    };\n};\n/* eslint-enable */\nexport class ImageWorkerManager {\n    imageWorkersEnabled = true;\n    messageManager = {};\n    workers = [];\n    workerIndex = 0;\n    nextId = 0;\n    constructor(numImageWorkers) {\n        this.workers = this.createWorkers(numImageWorkers);\n        this.workers.forEach((worker) => {\n            worker.onmessage = this.handleMessage.bind(this);\n        });\n    }\n    handleMessage(event) {\n        const { id, data, error } = event.data;\n        const msg = this.messageManager[id];\n        if (msg) {\n            const [resolve, reject] = msg;\n            delete this.messageManager[id];\n            if (error) {\n                reject(new Error(error));\n            }\n            else {\n                resolve(data);\n            }\n        }\n    }\n    createWorkers(numWorkers = 1) {\n        const workerCode = `${createImageWorker.toString()} worker()`;\n        const blob = new Blob([workerCode.replace('\"use strict\";', '')], {\n            type: 'application/javascript',\n        });\n        const blobURL = (self.URL ? URL : webkitURL).createObjectURL(blob);\n        const workers = [];\n        for (let i = 0; i < numWorkers; i++) {\n            workers.push(new Worker(blobURL));\n        }\n        return workers;\n    }\n    getNextWorker() {\n        const worker = this.workers[this.workerIndex];\n        this.workerIndex = (this.workerIndex + 1) % this.workers.length;\n        return worker;\n    }\n    getImage(src, premultiplyAlpha) {\n        return new Promise((resolve, reject) => {\n            try {\n                if (this.workers) {\n                    const id = this.nextId++;\n                    this.messageManager[id] = [resolve, reject];\n                    const nextWorker = this.getNextWorker();\n                    if (nextWorker) {\n                        nextWorker.postMessage({\n                            id,\n                            src: src,\n                            premultiplyAlpha,\n                        });\n                    }\n                }\n            }\n            catch (error) {\n                reject(error);\n            }\n        });\n    }\n}\n//# sourceMappingURL=ImageWorker.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Texture } from './Texture.js';\n/**\n * Texture consisting of a random grid of greyscale pixels\n *\n * @remarks\n * The width and height of the NoiseTexture are defined by it's\n * {@link NoiseTextureProps.width} and {@link NoiseTextureProps.height}\n * properties. The {@link NoiseTextureProps.cacheId} prop can be varied in order\n * to bypass cache and get newly randomized texture data.\n */\nexport class NoiseTexture extends Texture {\n    props;\n    constructor(txManager, props) {\n        super(txManager);\n        this.props = NoiseTexture.resolveDefaults(props);\n    }\n    async getTextureData() {\n        const { width, height } = this.props;\n        const size = width * height * 4;\n        const pixelData8 = new Uint8ClampedArray(size);\n        for (let i = 0; i < size; i += 4) {\n            const v = Math.floor(Math.random() * 256);\n            pixelData8[i] = v;\n            pixelData8[i + 1] = v;\n            pixelData8[i + 2] = v;\n            pixelData8[i + 3] = 255;\n        }\n        return {\n            data: new ImageData(pixelData8, width, height),\n        };\n    }\n    static makeCacheKey(props) {\n        if (props.cacheId === undefined) {\n            return false;\n        }\n        const resolvedProps = NoiseTexture.resolveDefaults(props);\n        return `NoiseTexture,${resolvedProps.width},${resolvedProps.height},${resolvedProps.cacheId}`;\n    }\n    static resolveDefaults(props) {\n        return {\n            width: props.width ?? 128,\n            height: props.height ?? 128,\n            cacheId: props.cacheId ?? 0,\n        };\n    }\n    static z$__type__Props;\n}\n//# sourceMappingURL=NoiseTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ImageWorkerManager } from './lib/ImageWorker.js';\nimport { ColorTexture } from './textures/ColorTexture.js';\nimport { ImageTexture } from './textures/ImageTexture.js';\nimport { NoiseTexture } from './textures/NoiseTexture.js';\nimport { SubTexture } from './textures/SubTexture.js';\nimport { RenderTexture } from './textures/RenderTexture.js';\nexport class CoreTextureManager {\n    /**\n     * Map of textures by cache key\n     */\n    keyCache = new Map();\n    /**\n     * Map of cache keys by texture\n     */\n    inverseKeyCache = new WeakMap();\n    /**\n     * Map of texture constructors by their type name\n     */\n    txConstructors = {};\n    imageWorkerManager = null;\n    hasCreateImageBitmap = !!self.createImageBitmap;\n    hasWorker = !!self.Worker;\n    /**\n     * Renderer that this texture manager is associated with\n     *\n     * @remarks\n     * This MUST be set before the texture manager is used. Otherwise errors\n     * will occur when using the texture manager.\n     */\n    renderer;\n    /**\n     * The current frame time in milliseconds\n     *\n     * @remarks\n     * This is used to populate the `lastRenderableChangeTime` property of\n     * {@link Texture} instances when their renderable state changes.\n     *\n     * Set by stage via `updateFrameTime` method.\n     */\n    frameTime = 0;\n    constructor(numImageWorkers) {\n        // Register default known texture types\n        if (this.hasCreateImageBitmap && this.hasWorker && numImageWorkers > 0) {\n            this.imageWorkerManager = new ImageWorkerManager(numImageWorkers);\n        }\n        if (!this.hasCreateImageBitmap) {\n            console.warn('[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower.');\n        }\n        this.registerTextureType('ImageTexture', ImageTexture);\n        this.registerTextureType('ColorTexture', ColorTexture);\n        this.registerTextureType('NoiseTexture', NoiseTexture);\n        this.registerTextureType('SubTexture', SubTexture);\n        this.registerTextureType('RenderTexture', RenderTexture);\n    }\n    registerTextureType(textureType, textureClass) {\n        this.txConstructors[textureType] = textureClass;\n    }\n    loadTexture(textureType, props) {\n        let texture;\n        const TextureClass = this.txConstructors[textureType];\n        if (!TextureClass) {\n            throw new Error(`Texture type \"${textureType}\" is not registered`);\n        }\n        if (!texture) {\n            const cacheKey = TextureClass.makeCacheKey(props);\n            if (cacheKey && this.keyCache.has(cacheKey)) {\n                // console.log('Getting texture by cache key', cacheKey);\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                texture = this.keyCache.get(cacheKey);\n            }\n            else {\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-explicit-any\n                texture = new TextureClass(this, props);\n                if (cacheKey) {\n                    this.initTextureToCache(texture, cacheKey);\n                }\n            }\n        }\n        return texture;\n    }\n    initTextureToCache(texture, cacheKey) {\n        const { keyCache, inverseKeyCache } = this;\n        keyCache.set(cacheKey, texture);\n        inverseKeyCache.set(texture, cacheKey);\n    }\n    /**\n     * Remove a texture from the cache\n     *\n     * @remarks\n     * Called by Texture Cleanup when a texture is freed.\n     *\n     * @param texture\n     */\n    removeTextureFromCache(texture) {\n        const { inverseKeyCache, keyCache } = this;\n        const cacheKey = inverseKeyCache.get(texture);\n        if (cacheKey) {\n            keyCache.delete(cacheKey);\n        }\n    }\n}\n//# sourceMappingURL=CoreTextureManager.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport memize from 'memize';\nconst weightConversions = {\n    normal: 400,\n    bold: 700,\n    bolder: 900,\n    lighter: 100,\n};\nconst fontWeightToNumber = (weight) => {\n    if (typeof weight === 'number') {\n        return weight;\n    }\n    return weightConversions[weight] || 400;\n};\nfunction rawResolveFontToUse(familyMapsByPriority, family, weightIn, style, stretch) {\n    let weight = fontWeightToNumber(weightIn);\n    for (const fontFamiles of familyMapsByPriority) {\n        const fontFaces = fontFamiles[family];\n        if (!fontFaces) {\n            continue;\n        }\n        if (fontFaces.size === 1) {\n            // No Exact match found, find nearest weight match\n            console.warn(`TrFontManager: Only one font face found for family: '${family}' - will be used for all weights and styles`);\n            return fontFaces.values().next().value;\n        }\n        const weightMap = new Map();\n        for (const fontFace of fontFaces) {\n            const fontFamilyWeight = fontWeightToNumber(fontFace.descriptors.weight);\n            if (fontFamilyWeight === weight &&\n                fontFace.descriptors.style === style &&\n                fontFace.descriptors.stretch === stretch) {\n                return fontFace;\n            }\n            weightMap.set(fontFamilyWeight, fontFace);\n        }\n        // No Exact match found, find nearest weight match\n        const msg = `TrFontManager: No exact match: '${family} Weight: ${weight} Style: ${style} Stretch: ${stretch}'`;\n        console.error(msg);\n        // Follow the CSS font-weight algorithm to find the nearest weight match\n        // https://www.w3.org/TR/2018/REC-css-fonts-3-20180920/#font-matching-algorithm\n        if (weight === 400 && weightMap.has(500)) {\n            return weightMap.get(500);\n        }\n        if (weight === 500 && weightMap.has(400)) {\n            return weightMap.get(400);\n        }\n        if (weight < 400) {\n            while (weight > 0) {\n                if (weightMap.has(weight)) {\n                    return weightMap.get(weight);\n                }\n                weight -= 100;\n            }\n            // reset back for the next loop\n            weight = 600;\n        }\n        while (weight < 1000) {\n            if (weightMap.has(weight)) {\n                return weightMap.get(weight);\n            }\n            weight += 100;\n        }\n        // finally check lower again\n        weight = 500;\n        while (weight > 0) {\n            if (weightMap.has(weight)) {\n                return weightMap.get(weight);\n            }\n            weight -= 100;\n        }\n    }\n    return;\n}\nconst resolveFontToUse = memize(rawResolveFontToUse);\nexport class TrFontManager {\n    textRenderers;\n    constructor(textRenderers) {\n        this.textRenderers = textRenderers;\n        // Intentionally left blank\n    }\n    addFontFace(font) {\n        // All the font face to all of the text renderers that support it\n        for (const trId in this.textRenderers) {\n            const tr = this.textRenderers[trId];\n            if (tr && tr.isFontFaceSupported(font)) {\n                tr.addFontFace(font);\n            }\n        }\n    }\n    /**\n     * Utility method to resolve a single font face from a list of prioritized family maps based on\n     * a set of font properties.\n     *\n     * @remarks\n     * These are to be used by a text renderer to resolve a font face if needed.\n     *\n     * @param familyMapsByPriority\n     * @param props\n     * @returns\n     */\n    static resolveFontFace(familyMapsByPriority, props) {\n        const { fontFamily, fontWeight, fontStyle, fontStretch } = props;\n        return resolveFontToUse(familyMapsByPriority, fontFamily, fontWeight, fontStyle, fontStretch);\n    }\n}\n//# sourceMappingURL=TrFontManager.js.map","/**\n * Memize options object.\n *\n * @typedef MemizeOptions\n *\n * @property {number} [maxSize] Maximum size of the cache.\n */\n\n/**\n * Internal cache entry.\n *\n * @typedef MemizeCacheNode\n *\n * @property {?MemizeCacheNode|undefined} [prev] Previous node.\n * @property {?MemizeCacheNode|undefined} [next] Next node.\n * @property {Array<*>}                   args   Function arguments for cache\n *                                               entry.\n * @property {*}                          val    Function result.\n */\n\n/**\n * Properties of the enhanced function for controlling cache.\n *\n * @typedef MemizeMemoizedFunction\n *\n * @property {()=>void} clear Clear the cache.\n */\n\n/**\n * Accepts a function to be memoized, and returns a new memoized function, with\n * optional options.\n *\n * @template {(...args: any[]) => any} F\n *\n * @param {F}             fn        Function to memoize.\n * @param {MemizeOptions} [options] Options object.\n *\n * @return {((...args: Parameters<F>) => ReturnType<F>) & MemizeMemoizedFunction} Memoized function.\n */\nfunction memize(fn, options) {\n\tvar size = 0;\n\n\t/** @type {?MemizeCacheNode|undefined} */\n\tvar head;\n\n\t/** @type {?MemizeCacheNode|undefined} */\n\tvar tail;\n\n\toptions = options || {};\n\n\tfunction memoized(/* ...args */) {\n\t\tvar node = head,\n\t\t\tlen = arguments.length,\n\t\t\targs,\n\t\t\ti;\n\n\t\tsearchCache: while (node) {\n\t\t\t// Perform a shallow equality test to confirm that whether the node\n\t\t\t// under test is a candidate for the arguments passed. Two arrays\n\t\t\t// are shallowly equal if their length matches and each entry is\n\t\t\t// strictly equal between the two sets. Avoid abstracting to a\n\t\t\t// function which could incur an arguments leaking deoptimization.\n\n\t\t\t// Check whether node arguments match arguments length\n\t\t\tif (node.args.length !== arguments.length) {\n\t\t\t\tnode = node.next;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Check whether node arguments match arguments values\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tif (node.args[i] !== arguments[i]) {\n\t\t\t\t\tnode = node.next;\n\t\t\t\t\tcontinue searchCache;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// At this point we can assume we've found a match\n\n\t\t\t// Surface matched node to head if not already\n\t\t\tif (node !== head) {\n\t\t\t\t// As tail, shift to previous. Must only shift if not also\n\t\t\t\t// head, since if both head and tail, there is no previous.\n\t\t\t\tif (node === tail) {\n\t\t\t\t\ttail = node.prev;\n\t\t\t\t}\n\n\t\t\t\t// Adjust siblings to point to each other. If node was tail,\n\t\t\t\t// this also handles new tail's empty `next` assignment.\n\t\t\t\t/** @type {MemizeCacheNode} */ (node.prev).next = node.next;\n\t\t\t\tif (node.next) {\n\t\t\t\t\tnode.next.prev = node.prev;\n\t\t\t\t}\n\n\t\t\t\tnode.next = head;\n\t\t\t\tnode.prev = null;\n\t\t\t\t/** @type {MemizeCacheNode} */ (head).prev = node;\n\t\t\t\thead = node;\n\t\t\t}\n\n\t\t\t// Return immediately\n\t\t\treturn node.val;\n\t\t}\n\n\t\t// No cached value found. Continue to insertion phase:\n\n\t\t// Create a copy of arguments (avoid leaking deoptimization)\n\t\targs = new Array(len);\n\t\tfor (i = 0; i < len; i++) {\n\t\t\targs[i] = arguments[i];\n\t\t}\n\n\t\tnode = {\n\t\t\targs: args,\n\n\t\t\t// Generate the result from original function\n\t\t\tval: fn.apply(null, args),\n\t\t};\n\n\t\t// Don't need to check whether node is already head, since it would\n\t\t// have been returned above already if it was\n\n\t\t// Shift existing head down list\n\t\tif (head) {\n\t\t\thead.prev = node;\n\t\t\tnode.next = head;\n\t\t} else {\n\t\t\t// If no head, follows that there's no tail (at initial or reset)\n\t\t\ttail = node;\n\t\t}\n\n\t\t// Trim tail if we're reached max size and are pending cache insertion\n\t\tif (size === /** @type {MemizeOptions} */ (options).maxSize) {\n\t\t\ttail = /** @type {MemizeCacheNode} */ (tail).prev;\n\t\t\t/** @type {MemizeCacheNode} */ (tail).next = null;\n\t\t} else {\n\t\t\tsize++;\n\t\t}\n\n\t\thead = node;\n\n\t\treturn node.val;\n\t}\n\n\tmemoized.clear = function () {\n\t\thead = null;\n\t\ttail = null;\n\t\tsize = 0;\n\t};\n\n\t// Ignore reason: There's not a clear solution to create an intersection of\n\t// the function with additional properties, where the goal is to retain the\n\t// function signature of the incoming argument and add control properties\n\t// on the return value.\n\n\t// @ts-ignore\n\treturn memoized;\n}\n\nexport { memize as default };\n","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst trPropSetterDefaults = {\n    x: (state, value) => {\n        state.props.x = value;\n    },\n    y: (state, value) => {\n        state.props.y = value;\n    },\n    width: (state, value) => {\n        state.props.width = value;\n    },\n    height: (state, value) => {\n        state.props.height = value;\n    },\n    color: (state, value) => {\n        state.props.color = value;\n    },\n    zIndex: (state, value) => {\n        state.props.zIndex = value;\n    },\n    fontFamily: (state, value) => {\n        state.props.fontFamily = value;\n    },\n    fontWeight: (state, value) => {\n        state.props.fontWeight = value;\n    },\n    fontStyle: (state, value) => {\n        state.props.fontStyle = value;\n    },\n    fontStretch: (state, value) => {\n        state.props.fontStretch = value;\n    },\n    fontSize: (state, value) => {\n        state.props.fontSize = value;\n    },\n    text: (state, value) => {\n        state.props.text = value;\n    },\n    textAlign: (state, value) => {\n        state.props.textAlign = value;\n    },\n    contain: (state, value) => {\n        state.props.contain = value;\n    },\n    offsetY: (state, value) => {\n        state.props.offsetY = value;\n    },\n    scrollable: (state, value) => {\n        state.props.scrollable = value;\n    },\n    scrollY: (state, value) => {\n        state.props.scrollY = value;\n    },\n    letterSpacing: (state, value) => {\n        state.props.letterSpacing = value;\n    },\n    lineHeight: (state, value) => {\n        state.props.lineHeight = value;\n    },\n    maxLines: (state, value) => {\n        state.props.maxLines = value;\n    },\n    textBaseline: (state, value) => {\n        state.props.textBaseline = value;\n    },\n    verticalAlign: (state, value) => {\n        state.props.verticalAlign = value;\n    },\n    overflowSuffix: (state, value) => {\n        state.props.overflowSuffix = value;\n    },\n    debug: (state, value) => {\n        state.props.debug = value;\n    },\n};\nexport class TextRenderer {\n    stage;\n    set;\n    constructor(stage) {\n        this.stage = stage;\n        const propSetters = {\n            ...trPropSetterDefaults,\n            ...this.getPropertySetters(),\n        };\n        // For each prop setter add a wrapper method that checks if the prop is\n        // different before calling the setter\n        this.set = Object.freeze(Object.fromEntries(Object.entries(propSetters).map(([key, setter]) => {\n            return [\n                key,\n                (state, value) => {\n                    if (state.props[key] !== value) {\n                        setter(state, value);\n                        // Assume any prop change will require a render\n                        // This is required because otherwise a paused RAF will result\n                        // in renders when text props are changed.\n                        this.stage.requestRender();\n                    }\n                },\n            ];\n        })));\n    }\n    setStatus(state, status, error) {\n        // Don't emit the same status twice\n        if (state.status === status) {\n            return;\n        }\n        state.status = status;\n        state.emitter.emit(status, error);\n    }\n    /**\n     * Allows the CoreTextNode to communicate changes to the isRenderable state of\n     * the itself.\n     *\n     * @param state\n     * @param renderable\n     */\n    setIsRenderable(state, renderable) {\n        state.isRenderable = renderable;\n    }\n    /**\n     * Destroy/Clean up the state object\n     *\n     * @remarks\n     * Opposite of createState(). Frees any event listeners / resources held by\n     * the state that may not reliably get garbage collected.\n     *\n     * @param state\n     */\n    destroyState(state) {\n        this.setStatus(state, 'destroyed');\n        state.emitter.removeAllListeners();\n    }\n    /**\n     * Schedule a state update via queueMicrotask\n     *\n     * @remarks\n     * This method is used to schedule a state update via queueMicrotask. This\n     * method should be called whenever a state update is needed, and it will\n     * ensure that the state is only updated once per microtask.\n     * @param state\n     * @returns\n     */\n    scheduleUpdateState(state) {\n        if (state.updateScheduled) {\n            return;\n        }\n        state.updateScheduled = true;\n        queueMicrotask(() => {\n            // If the state has been destroyed, don't update it\n            if (state.status === 'destroyed') {\n                return;\n            }\n            state.updateScheduled = false;\n            this.updateState(state);\n        });\n    }\n}\n//# sourceMappingURL=TextRenderer.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { EventEmitter } from '../../../common/EventEmitter.js';\nexport class TrFontFace extends EventEmitter {\n    fontFamily;\n    descriptors;\n    loaded = false;\n    metrics = null;\n    constructor(options) {\n        super();\n        const { fontFamily, descriptors, metrics } = options;\n        if (metrics) {\n            // Normalize metrics to be in the range of 0 to 1\n            this.metrics = {\n                ascender: metrics.ascender / metrics.unitsPerEm,\n                descender: metrics.descender / metrics.unitsPerEm,\n                lineGap: metrics.lineGap / metrics.unitsPerEm,\n            };\n        }\n        this.fontFamily = fontFamily;\n        this.descriptors = {\n            style: 'normal',\n            weight: 'normal',\n            stretch: 'normal',\n            ...descriptors,\n        };\n    }\n    /**\n     * Convert a TrFontFaceDescriptors to a FontFaceDescriptors which differ slightly\n     *\n     * @param descriptors\n     * @returns\n     */\n    static convertToCssFontFaceDescriptors(descriptors) {\n        return {\n            style: descriptors.style,\n            weight: typeof descriptors.weight === 'number'\n                ? `${descriptors.weight}`\n                : descriptors.weight,\n            stretch: descriptors.stretch,\n            unicodeRange: descriptors.unicodeRange,\n            featureSettings: descriptors.featureSettings,\n            display: descriptors.display,\n        };\n    }\n}\n//# sourceMappingURL=TrFontFace.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport const SpecialCodepoints = {\n    LINE_FEED: 0x0a,\n    CARRIAGE_RETURN: 0x0d,\n    SPACE: 0x20,\n    TAB: 0x09,\n    ZERO_WIDTH_SPACE: 0x200b,\n    ZERO_WIDTH_NON_JOINER: 0x200c,\n    ZERO_WIDTH_JOINER: 0x200d,\n    LEFT_TO_RIGHT_MARK: 0x200e,\n    RIGHT_TO_LEFT_MARK: 0x200f,\n    LEFT_TO_RIGHT_EMBEDDING: 0x202a,\n    RIGHT_TO_LEFT_EMBEDDING: 0x202b,\n    POP_DIRECTIONAL_FORMATTING: 0x202c,\n    LEFT_TO_RIGHT_OVERRIDE: 0x202d,\n    RIGHT_TO_LEFT_OVERRIDE: 0x202e,\n    LINE_SEPARATOR: 0x2028,\n    PARAGRAPH_SEPARATOR: 0x2029,\n    OBJECT_REPLACEMENT_CHARACTER: 0xfffc,\n    REPLACEMENT_CHARACTER: 0xfffd,\n    ZERO_WIDTH_NO_BREAK_SPACE: 0xfeff,\n    LEFT_TO_RIGHT_ISOLATE: 0x2066,\n    RIGHT_TO_LEFT_ISOLATE: 0x2067,\n    FIRST_STRONG_ISOLATE: 0x2068,\n    POP_DIRECTIONAL_ISOLATE: 0x2069,\n    INHIBIT_SYMMETRIC_SWAPPING: 0x206a,\n    ACTIVATE_SYMMETRIC_SWAPPING: 0x206b,\n    INHIBIT_ARABIC_FORM_SHAPING: 0x206c,\n    ACTIVATE_ARABIC_FORM_SHAPING: 0x206d,\n    NATIONAL_DIGIT_SHAPES: 0x206e,\n    NOMINAL_DIGIT_SHAPES: 0x206f,\n    LEFT_TO_RIGHT_BOUNDARY: 0x200e,\n    RIGHT_TO_LEFT_BOUNDARY: 0x200f,\n};\n//# sourceMappingURL=SpecialCodepoints.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport class FontShaper {\n}\n//# sourceMappingURL=FontShaper.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { SpecialCodepoints } from '../../../renderers/SdfTextRenderer/internal/SpecialCodepoints.js';\nimport { FontShaper, } from './FontShaper.js';\nexport class SdfFontShaper extends FontShaper {\n    data;\n    glyphMap;\n    kernings;\n    constructor(data, glyphMap) {\n        super();\n        this.data = data;\n        this.glyphMap = glyphMap;\n        const kernings = (this.kernings = {});\n        data.kernings.forEach((kerning) => {\n            const second = kerning.second;\n            const firsts = (kernings[second] = kernings[second] || {});\n            firsts[kerning.first] = kerning.amount;\n        });\n        this.kernings = kernings;\n    }\n    *shapeText(props, codepoints) {\n        let codepointResult;\n        let lastGlyphId = undefined;\n        while ((codepointResult = codepoints.peek()) && !codepointResult.done) {\n            const codepoint = codepointResult.value;\n            const glyph = this.glyphMap.get(codepoint);\n            codepoints.next();\n            if (glyph !== undefined) {\n                // We found a glyph for this codepoint\n                // Yield the mapped glyph info\n                /**\n                 * Kerning includes any possible additional letter spacing\n                 */\n                const kerning = lastGlyphId !== undefined\n                    ? (this.kernings[glyph.id]?.[lastGlyphId] || 0) +\n                        props.letterSpacing\n                    : 0;\n                lastGlyphId = glyph.id;\n                yield {\n                    mapped: true,\n                    glyphId: glyph.id,\n                    codepoint,\n                    cluster: codepoints.lastIndex,\n                    xAdvance: glyph.xadvance + kerning,\n                    yAdvance: 0,\n                    xOffset: glyph.xoffset + kerning,\n                    yOffset: glyph.yoffset,\n                    xBearing: 0,\n                    yBearing: 0,\n                    width: glyph.width,\n                    height: glyph.height,\n                };\n            }\n            else {\n                // We didn't find a glyph for this codepoint\n                // Yield the unmapped codepoint info\n                // If this codepoint is a linebreak, we should reset the last glyph id\n                // so that the next glyph will not be kerned with the last glyph of the\n                // previous line.\n                if (codepoint === SpecialCodepoints.LINE_FEED) {\n                    lastGlyphId = undefined;\n                }\n                yield {\n                    mapped: false,\n                    codepoint,\n                    cluster: codepoints.lastIndex,\n                };\n            }\n        }\n    }\n}\n//# sourceMappingURL=SdfFontShaper.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// import type { Renderer } from '../../../Renderer';\nimport { assertTruthy } from '../../../../utils.js';\nimport { WebGlCoreRenderer } from '../../../renderers/webgl/WebGlCoreRenderer.js';\nimport { ImageTexture } from '../../../textures/ImageTexture.js';\nimport { TrFontFace, } from '../TrFontFace.js';\nimport { SdfFontShaper } from './internal/SdfFontShaper.js';\nexport class SdfTrFontFace extends TrFontFace {\n    type;\n    texture;\n    /**\n     * Height of the tallest character in the font including the whitespace above it\n     * in SDF/vertex units.\n     */\n    maxCharHeight = 0;\n    data;\n    shaper;\n    glyphMap = new Map();\n    constructor(type, options) {\n        super(options);\n        const { atlasUrl, atlasDataUrl, stage } = options;\n        this.type = type;\n        const renderer = stage.renderer;\n        assertTruthy(renderer instanceof WebGlCoreRenderer, 'SDF Font Faces can only be used with the WebGL Renderer');\n        // Load image\n        this.texture = stage.txManager.loadTexture('ImageTexture', {\n            src: atlasUrl,\n            // IMPORTANT: The SDF shader requires the alpha channel to NOT be\n            // premultiplied on the atlas texture. If it is premultiplied, the\n            // rendering of SDF glyphs (especially single-channel SDF fonts) will\n            // be very jagged.\n            premultiplyAlpha: false,\n        });\n        this.texture.on('loaded', () => {\n            this.checkLoaded();\n            // Make sure we mark the stage for a re-render (in case the font's texture was freed and reloaded)\n            stage.requestRender();\n        });\n        // Pre-load it\n        this.texture.ctxTexture.load();\n        // Set this.data to the fetched data from dataUrl\n        fetch(atlasDataUrl)\n            .then(async (response) => {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            this.data = await response.json();\n            assertTruthy(this.data);\n            // Add all the glyphs to the glyph map\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            let maxCharHeight = 0;\n            this.data.chars.forEach((glyph) => {\n                this.glyphMap.set(glyph.id, glyph);\n                const charHeight = glyph.yoffset + glyph.height;\n                if (charHeight > maxCharHeight) {\n                    maxCharHeight = charHeight;\n                }\n            });\n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n            this.maxCharHeight = maxCharHeight;\n            // We know `data` is defined here, because we just set it\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.shaper = new SdfFontShaper(this.data, this.glyphMap);\n            // If the metrics aren't provided explicitly in the font face options,\n            // Gather them from the metrics added by the msdf-generator tool ()\n            // If they are missing then we throw an error.\n            if (!this.metrics) {\n                if (this.data?.lightningMetrics) {\n                    const { ascender, descender, lineGap, unitsPerEm } = this.data.lightningMetrics;\n                    this.metrics = {\n                        ascender: ascender / unitsPerEm,\n                        descender: descender / unitsPerEm,\n                        lineGap: lineGap / unitsPerEm,\n                    };\n                }\n                else {\n                    throw new Error(`Font metrics not found in ${this.type} font ${this.fontFamily}. ` +\n                        'Make sure you are using the latest version of the Lightning ' +\n                        '3 `msdf-generator` tool to generate your SDF fonts.');\n                }\n            }\n            this.checkLoaded();\n        })\n            .catch(console.error);\n    }\n    getAtlasEntry(glyphId) {\n        const glyph = this.glyphMap.get(glyphId);\n        if (glyph === undefined) {\n            throw new Error(`Glyph ${glyphId} not found in font ${this.fontFamily}`);\n        }\n        return {\n            x: glyph.x,\n            y: glyph.y,\n            width: glyph.width,\n            height: glyph.height,\n        };\n    }\n    checkLoaded() {\n        if (this.loaded)\n            return;\n        if (this.texture.state === 'loaded' && this.data) {\n            this.loaded = true;\n            this.emit('loaded');\n        }\n    }\n}\n//# sourceMappingURL=SdfTrFontFace.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * A wrapper Generator class that makes a generator peekable.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport class PeekableIterator {\n    iterator;\n    peekBuffer = [];\n    _lastIndex;\n    constructor(iterator, indexBase = 0) {\n        this.iterator = iterator;\n        this.iterator = iterator;\n        this._lastIndex = indexBase - 1;\n        this.peekBuffer = [];\n    }\n    next() {\n        const nextResult = this.peekBuffer.length > 0\n            ? // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                this.peekBuffer.pop()\n            : this.iterator.next();\n        if (nextResult.done) {\n            this._lastIndex = -1;\n        }\n        else {\n            this._lastIndex++;\n        }\n        return nextResult;\n    }\n    peek() {\n        if (this.peekBuffer.length > 0) {\n            // We know that the buffer is not empty, so we can safely use the\n            // non-null assertion operator\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            return this.peekBuffer[0];\n        }\n        const result = this.iterator.next();\n        this.peekBuffer.push(result);\n        return result;\n    }\n    get lastIndex() {\n        return this._lastIndex;\n    }\n}\n//# sourceMappingURL=PeekableGenerator.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// Reversible Generator Wrapper Class\n/**\n * Generator function that yields each Unicode code point in the given string.\n */\nexport function* getUnicodeCodepoints(text, start = 0) {\n    let i = start;\n    while (i < text.length) {\n        const codePoint = text.codePointAt(i);\n        if (codePoint === undefined) {\n            throw new Error('Invalid Unicode code point');\n        }\n        yield codePoint;\n        i += codePoint <= 0xffff ? 1 : 2;\n    }\n}\n//# sourceMappingURL=getUnicodeCodepoints.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../../../../utils.js';\nimport { PeekableIterator } from './PeekableGenerator.js';\nimport { getUnicodeCodepoints } from './getUnicodeCodepoints.js';\nimport { measureText } from './measureText.js';\nexport function layoutText(curLineIndex, startX, startY, text, textAlign, width, height, fontSize, lineHeight, letterSpacing, \n/**\n * Mutated\n */\nvertexBuffer, contain, \n/**\n * Mutated\n */\nlineCache, rwSdf, trFontFace, forceFullLayoutCalc, scrollable, overflowSuffix, maxLines) {\n    assertTruthy(trFontFace, 'Font face must be loaded');\n    assertTruthy(trFontFace.loaded, 'Font face must be loaded');\n    assertTruthy(trFontFace.data, 'Font face must be loaded');\n    assertTruthy(trFontFace.shaper, 'Font face must be loaded');\n    // Regardless of fontSize (or other scaling properties), we layout the vertices of each glyph\n    // using the fixed coordinate space determined by font size used to produce the atlas.\n    // Scaling for display is handled by shader uniforms inexpensively.\n    // So we have:\n    //  - vertex space: the space in which the vertices of each glyph are laid out\n    //  - screen space: the screen pixel space\n    // Input properties such as x, y, w, fontSize, letterSpacing, etc. are all expressed in screen space.\n    // We convert these to the vertex space by dividing them the `fontSizeRatio` factor.\n    /**\n     * See above\n     */\n    const fontSizeRatio = fontSize / trFontFace.data.info.size;\n    /**\n     * `lineHeight` in vertex coordinates\n     */\n    const vertexLineHeight = lineHeight / fontSizeRatio;\n    /**\n     * `w` in vertex coordinates\n     */\n    const vertexW = width / fontSizeRatio;\n    /**\n     * `letterSpacing` in vertex coordinates\n     */\n    const vertexLSpacing = letterSpacing / fontSizeRatio;\n    const startingLineCacheEntry = lineCache[curLineIndex];\n    const startingCodepointIndex = startingLineCacheEntry?.codepointIndex || 0;\n    const startingMaxX = startingLineCacheEntry?.maxX || 0;\n    const startingMaxY = startingLineCacheEntry?.maxY || 0;\n    let maxX = startingMaxX;\n    let maxY = startingMaxY;\n    let curX = startX;\n    let curY = startY;\n    let bufferOffset = 0;\n    /**\n     * Buffer offset to last word boundry. This is -1 when we aren't in a word boundry.\n     */\n    const lastWord = {\n        codepointIndex: -1,\n        bufferOffset: -1,\n        xStart: -1,\n    };\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const shaper = trFontFace.shaper;\n    const shaperProps = {\n        letterSpacing: vertexLSpacing,\n    };\n    // Get glyphs\n    let glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, startingCodepointIndex), startingCodepointIndex));\n    let glyphResult;\n    let curLineBufferStart = -1;\n    const bufferLineInfos = [];\n    const vertexTruncateHeight = height / fontSizeRatio;\n    const overflowSuffVertexWidth = measureText(overflowSuffix, shaperProps, shaper);\n    // Line-by-line layout\n    let moreLines = true;\n    while (moreLines) {\n        const nextLineWillFit = (maxLines === 0 || curLineIndex + 1 < maxLines) &&\n            (contain !== 'both' ||\n                scrollable ||\n                curY + vertexLineHeight + trFontFace.maxCharHeight <=\n                    vertexTruncateHeight);\n        const lineVertexW = nextLineWillFit\n            ? vertexW\n            : vertexW - overflowSuffVertexWidth;\n        /**\n         * Vertex X position to the beginning of the last word boundary. This becomes -1 when we start traversing a word.\n         */\n        let xStartLastWordBoundary = 0;\n        const lineIsBelowWindowTop = curY + trFontFace.maxCharHeight >= rwSdf.y1;\n        const lineIsAboveWindowBottom = curY <= rwSdf.y2;\n        const lineIsWithinWindow = lineIsBelowWindowTop && lineIsAboveWindowBottom;\n        // Layout glyphs in this line\n        // Any break statements in this while loop will trigger a line break\n        while ((glyphResult = glyphs.next()) && !glyphResult.done) {\n            const glyph = glyphResult.value;\n            if (curLineIndex === lineCache.length) {\n                lineCache.push({\n                    codepointIndex: glyph.cluster,\n                    maxY,\n                    maxX,\n                });\n            }\n            else if (curLineIndex > lineCache.length) {\n                throw new Error('Unexpected lineCache length');\n            }\n            // If we encounter a word boundary (white space or newline) we invalidate\n            // the lastWord and set the xStartLastWordBoundary if we haven't already.\n            if (glyph.codepoint === 32 || glyph.codepoint === 10) {\n                if (lastWord.codepointIndex !== -1) {\n                    lastWord.codepointIndex = -1;\n                    xStartLastWordBoundary = curX;\n                }\n            }\n            else if (lastWord.codepointIndex === -1) {\n                lastWord.codepointIndex = glyph.cluster;\n                lastWord.bufferOffset = bufferOffset;\n                lastWord.xStart = xStartLastWordBoundary;\n            }\n            if (glyph.mapped) {\n                // Mapped glyph\n                const charEndX = curX + glyph.xOffset + glyph.width;\n                // Word wrap check\n                if (\n                // We are containing the text\n                contain !== 'none' &&\n                    // The current glyph reaches outside the contained width\n                    charEndX >= lineVertexW &&\n                    // There is a last word that we can break to the next line\n                    lastWord.codepointIndex !== -1 &&\n                    // Prevents infinite loop when a single word is longer than the width\n                    lastWord.xStart > 0) {\n                    // The current word is about to go off the edge of the container width\n                    // Reinitialize the iterator starting at the last word\n                    // and proceeding to the next line\n                    if (nextLineWillFit) {\n                        glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, lastWord.codepointIndex), lastWord.codepointIndex));\n                        bufferOffset = lastWord.bufferOffset;\n                        break;\n                    }\n                    else {\n                        glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(overflowSuffix, 0), 0));\n                        curX = lastWord.xStart;\n                        bufferOffset = lastWord.bufferOffset;\n                        // HACK: For the rest of the line when inserting the overflow suffix,\n                        // set contain = 'none' to prevent an infinite loop.\n                        contain = 'none';\n                    }\n                }\n                else {\n                    // This glyph fits, so we can add it to the buffer\n                    const quadX = curX + glyph.xOffset;\n                    const quadY = curY + glyph.yOffset;\n                    // Only add to buffer for rendering if the line is within the render window\n                    if (lineIsWithinWindow) {\n                        if (curLineBufferStart === -1) {\n                            curLineBufferStart = bufferOffset;\n                        }\n                        const atlasEntry = trFontFace.getAtlasEntry(glyph.glyphId);\n                        // Add texture coordinates\n                        const u = atlasEntry.x / trFontFace.data.common.scaleW;\n                        const v = atlasEntry.y / trFontFace.data.common.scaleH;\n                        const uvWidth = atlasEntry.width / trFontFace.data.common.scaleW;\n                        const uvHeight = atlasEntry.height / trFontFace.data.common.scaleH;\n                        // TODO: (Performance) We can optimize this by using ELEMENT_ARRAY_BUFFER\n                        // eliminating the need to duplicate vertices\n                        // Top-left\n                        vertexBuffer[bufferOffset++] = quadX;\n                        vertexBuffer[bufferOffset++] = quadY;\n                        vertexBuffer[bufferOffset++] = u;\n                        vertexBuffer[bufferOffset++] = v;\n                        // Top-right\n                        vertexBuffer[bufferOffset++] = quadX + glyph.width;\n                        vertexBuffer[bufferOffset++] = quadY;\n                        vertexBuffer[bufferOffset++] = u + uvWidth;\n                        vertexBuffer[bufferOffset++] = v;\n                        // Bottom-left\n                        vertexBuffer[bufferOffset++] = quadX;\n                        vertexBuffer[bufferOffset++] = quadY + glyph.height;\n                        vertexBuffer[bufferOffset++] = u;\n                        vertexBuffer[bufferOffset++] = v + uvHeight;\n                        // Bottom-right\n                        vertexBuffer[bufferOffset++] = quadX + glyph.width;\n                        vertexBuffer[bufferOffset++] = quadY + glyph.height;\n                        vertexBuffer[bufferOffset++] = u + uvWidth;\n                        vertexBuffer[bufferOffset++] = v + uvHeight;\n                    }\n                    maxY = Math.max(maxY, quadY + glyph.height);\n                    maxX = Math.max(maxX, quadX + glyph.width);\n                    curX += glyph.xAdvance;\n                }\n            }\n            else {\n                // Unmapped character\n                // Handle newlines\n                if (glyph.codepoint === 10) {\n                    if (nextLineWillFit) {\n                        // The whole line fit, so we can break to the next line\n                        break;\n                    }\n                    else {\n                        // The whole line won't fit, so we need to add the overflow suffix\n                        glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(overflowSuffix, 0), 0));\n                        // HACK: For the rest of the line when inserting the overflow suffix,\n                        // set contain = 'none' to prevent an infinite loop.\n                        contain = 'none';\n                    }\n                }\n            }\n        }\n        // Prepare for the next line...\n        if (curLineBufferStart !== -1) {\n            bufferLineInfos.push({\n                bufferStart: curLineBufferStart,\n                bufferEnd: bufferOffset,\n            });\n            curLineBufferStart = -1;\n        }\n        curX = 0;\n        curY += vertexLineHeight;\n        curLineIndex++;\n        lastWord.codepointIndex = -1;\n        xStartLastWordBoundary = 0;\n        // Figure out if there are any more lines to render...\n        if (!forceFullLayoutCalc && contain === 'both' && curY > rwSdf.y2) {\n            // Stop layout calculation early (for performance purposes) if:\n            // - We're not forcing a full layout calculation (for width/height calculation)\n            // - ...and we're containing the text vertically+horizontally (contain === 'both')\n            // - ...and we have a render window\n            // - ...and the next line is below the bottom of the render window\n            moreLines = false;\n        }\n        else if (glyphResult && glyphResult.done) {\n            // If we've reached the end of the text, we know we're done\n            moreLines = false;\n        }\n        else if (!nextLineWillFit) {\n            // If we're contained vertically+horizontally (contain === 'both')\n            // but not scrollable and the next line won't fit, we're done.\n            moreLines = false;\n        }\n    }\n    // Use textAlign to determine if we need to adjust the x position of the text\n    // in the buffer line by line\n    if (textAlign === 'center') {\n        const vertexTextW = contain === 'none' ? maxX : vertexW;\n        for (let i = 0; i < bufferLineInfos.length; i++) {\n            const line = bufferLineInfos[i];\n            // - 4 = the x position of a rightmost vertex\n            const lineWidth = \n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            vertexBuffer[line.bufferEnd - 4] - vertexBuffer[line.bufferStart];\n            const xOffset = (vertexTextW - lineWidth) / 2;\n            for (let j = line.bufferStart; j < line.bufferEnd; j += 4) {\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                vertexBuffer[j] += xOffset;\n            }\n        }\n    }\n    else if (textAlign === 'right') {\n        const vertexTextW = contain === 'none' ? maxX : vertexW;\n        for (let i = 0; i < bufferLineInfos.length; i++) {\n            const line = bufferLineInfos[i];\n            const lineWidth = line.bufferEnd === line.bufferStart\n                ? 0\n                : // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                    vertexBuffer[line.bufferEnd - 4] - vertexBuffer[line.bufferStart];\n            const xOffset = vertexTextW - lineWidth;\n            for (let j = line.bufferStart; j < line.bufferEnd; j += 4) {\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                vertexBuffer[j] += xOffset;\n            }\n        }\n    }\n    assertTruthy(glyphResult);\n    return {\n        bufferNumFloats: bufferOffset,\n        bufferNumQuads: bufferOffset / 16,\n        layoutNumCharacters: glyphResult.done\n            ? text.length - startingCodepointIndex\n            : glyphResult.value.cluster - startingCodepointIndex + 1,\n        fullyProcessed: !!glyphResult.done,\n        maxX,\n        maxY,\n        numLines: lineCache.length,\n    };\n}\n//# sourceMappingURL=layoutText.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { PeekableIterator } from './PeekableGenerator.js';\nimport { getUnicodeCodepoints } from './getUnicodeCodepoints.js';\n/**\n * Measures a single-line of text width ignoring any unmapped glyphs including line breaks\n *\n * @param text\n * @param shaperProps\n * @param shaper\n * @returns\n */\nexport function measureText(text, shaperProps, shaper) {\n    const glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, 0), 0));\n    let width = 0;\n    for (const glyph of glyphs) {\n        if (glyph.mapped) {\n            width += glyph.xAdvance;\n        }\n    }\n    return width;\n}\n//# sourceMappingURL=measureText.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { isBoundPositive } from '../../../../lib/utils.js';\nimport { roundDownToMultiple, roundUpToMultiple } from './util.js';\n/**\n * Create a render window from the given parameters.\n *\n * @remarks\n * The render window is a rectangle that defines the area of the text that\n * should be rendered. It is used to skip rendering parts of the text that\n * are outside of the render window. The render window is relative to the\n * text's top left corner of the overrall text.\n *\n * @param x The x coordinate of the text element's top left corner relative to the screen.\n * @param y The y coordinate of the text element's top left corner relative to the screen.\n * @param scrollY The amount of pixels to scroll the text vertically.\n * @param lineHeight The number of extra lines to render above and below the visible window.\n * @param visibleWindow The visible window of the text element relative to the screen\n * @returns\n */\nexport function setRenderWindow(outRenderWindow, x, y, scrollY, lineHeight, bufferMargin, visibleWindow, fontSizeRatio) {\n    const { screen, sdf } = outRenderWindow;\n    if (!isBoundPositive(visibleWindow)) {\n        screen.x1 = 0;\n        screen.y1 = 0;\n        screen.x2 = 0;\n        screen.y2 = 0;\n        sdf.x1 = 0;\n        sdf.y1 = 0;\n        sdf.x2 = 0;\n        sdf.y2 = 0;\n        outRenderWindow.numLines = 0;\n        outRenderWindow.firstLineIdx = 0;\n    }\n    else {\n        const x1 = visibleWindow.x1 - x;\n        const x2 = x1 + (visibleWindow.x2 - visibleWindow.x1);\n        const y1Base = visibleWindow.y1 - y + scrollY;\n        const y1 = roundDownToMultiple(y1Base - bufferMargin, lineHeight || 1);\n        const y2 = roundUpToMultiple(y1Base + (visibleWindow.y2 - visibleWindow.y1) + bufferMargin, lineHeight || 1);\n        screen.x1 = x1;\n        screen.y1 = y1;\n        screen.x2 = x2;\n        screen.y2 = y2;\n        sdf.x1 = x1 / fontSizeRatio;\n        sdf.y1 = y1 / fontSizeRatio;\n        sdf.x2 = x2 / fontSizeRatio;\n        sdf.y2 = y2 / fontSizeRatio;\n        outRenderWindow.numLines = Math.ceil((y2 - y1) / lineHeight);\n        outRenderWindow.firstLineIdx = lineHeight ? Math.floor(y1 / lineHeight) : 0;\n    }\n    outRenderWindow.valid = true;\n}\n//# sourceMappingURL=setRenderWindow.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Round up to the nearest multiple of the given number.\n *\n * @param value\n * @param multiple\n * @returns\n */\nexport function roundUpToMultiple(value, multiple) {\n    return Math.ceil(value / multiple) * multiple;\n}\n/**\n * Round down to the nearest multiple of the given number.\n *\n * @param value\n * @param multiple\n * @returns\n */\nexport function roundDownToMultiple(value, multiple) {\n    return Math.floor(value / multiple) * multiple;\n}\n//# sourceMappingURL=util.js.map","/**\n * Calculate the default line height given normalized font metrics\n *\n * @remarks\n * This method may be used for both the WebTrFontFace and SdfTrFontFace font types.\n *\n * @param metrics\n * @param fontSize\n * @returns\n */\nexport function calcDefaultLineHeight(metrics, fontSize) {\n    return fontSize * (metrics.ascender - metrics.descender + metrics.lineGap);\n}\n//# sourceMappingURL=TextRenderingUtils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { createBound, intersectRect, copyRect, boundsOverlap, convertBoundToRect, } from '../../../lib/utils.js';\nimport { TextRenderer, } from '../TextRenderer.js';\nimport { SdfTrFontFace } from '../../font-face-types/SdfTrFontFace/SdfTrFontFace.js';\nimport { FLOATS_PER_GLYPH } from './internal/constants.js';\nimport { getStartConditions } from './internal/getStartConditions.js';\nimport { layoutText } from './internal/layoutText.js';\nimport { setRenderWindow, } from './internal/setRenderWindow.js';\nimport { TrFontManager } from '../../TrFontManager.js';\nimport { assertTruthy, mergeColorAlpha } from '../../../../utils.js';\nimport { WebGlCoreRenderOp } from '../../../renderers/webgl/WebGlCoreRenderOp.js';\nimport { BufferCollection } from '../../../renderers/webgl/internal/BufferCollection.js';\nimport { EventEmitter } from '../../../../common/EventEmitter.js';\nimport { WebGlCoreRenderer } from '../../../renderers/webgl/WebGlCoreRenderer.js';\nimport { calcDefaultLineHeight } from '../../TextRenderingUtils.js';\n/**\n * Ephemeral rect object used for calculations\n */\nconst tmpRect = {\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n};\n/**\n * Singleton class for rendering text using signed distance fields.\n *\n * @remarks\n * SdfTextRenderer supports both single-channel and multi-channel signed distance fields.\n */\nexport class SdfTextRenderer extends TextRenderer {\n    /**\n     * Map of font family names to a set of font faces.\n     */\n    ssdfFontFamilies = {};\n    msdfFontFamilies = {};\n    fontFamilyArray = [\n        this.ssdfFontFamilies,\n        this.msdfFontFamilies,\n    ];\n    sdfShader;\n    rendererBounds;\n    constructor(stage) {\n        super(stage);\n        this.sdfShader = this.stage.shManager.loadShader('SdfShader').shader;\n        this.rendererBounds = {\n            x1: 0,\n            y1: 0,\n            x2: this.stage.options.appWidth,\n            y2: this.stage.options.appHeight,\n        };\n    }\n    //#region Overrides\n    getPropertySetters() {\n        return {\n            fontFamily: (state, value) => {\n                state.props.fontFamily = value;\n                this.releaseFontFace(state);\n                this.invalidateLayoutCache(state);\n            },\n            fontWeight: (state, value) => {\n                state.props.fontWeight = value;\n                this.releaseFontFace(state);\n                this.invalidateLayoutCache(state);\n            },\n            fontStyle: (state, value) => {\n                state.props.fontStyle = value;\n                this.releaseFontFace(state);\n                this.invalidateLayoutCache(state);\n            },\n            fontStretch: (state, value) => {\n                state.props.fontStretch = value;\n                this.releaseFontFace(state);\n                this.invalidateLayoutCache(state);\n            },\n            fontSize: (state, value) => {\n                state.props.fontSize = value;\n                this.invalidateLayoutCache(state);\n            },\n            text: (state, value) => {\n                state.props.text = value;\n                this.invalidateLayoutCache(state);\n            },\n            textAlign: (state, value) => {\n                state.props.textAlign = value;\n                this.invalidateLayoutCache(state);\n            },\n            color: (state, value) => {\n                state.props.color = value;\n            },\n            x: (state, value) => {\n                state.props.x = value;\n                if (state.elementBounds.valid) {\n                    this.setElementBoundsX(state);\n                    // Only schedule an update if the text is not already rendered\n                    // (renderWindow is invalid) and the element possibly overlaps the screen\n                    // This is to avoid unnecessary updates when we know text is off-screen\n                    if (!state.renderWindow.valid &&\n                        boundsOverlap(state.elementBounds, this.rendererBounds)) {\n                        this.scheduleUpdateState(state);\n                    }\n                }\n            },\n            y: (state, value) => {\n                state.props.y = value;\n                if (state.elementBounds.valid) {\n                    this.setElementBoundsY(state);\n                    // See x() for explanation\n                    if (!state.renderWindow.valid &&\n                        boundsOverlap(state.elementBounds, this.rendererBounds)) {\n                        this.scheduleUpdateState(state);\n                    }\n                }\n            },\n            contain: (state, value) => {\n                state.props.contain = value;\n                this.invalidateLayoutCache(state);\n            },\n            width: (state, value) => {\n                state.props.width = value;\n                // Only invalidate layout cache if we're containing in the horizontal direction\n                if (state.props.contain !== 'none') {\n                    this.invalidateLayoutCache(state);\n                }\n            },\n            height: (state, value) => {\n                state.props.height = value;\n                // Only invalidate layout cache if we're containing in the vertical direction\n                if (state.props.contain === 'both') {\n                    this.invalidateLayoutCache(state);\n                }\n            },\n            offsetY: (state, value) => {\n                state.props.offsetY = value;\n                this.invalidateLayoutCache(state);\n            },\n            scrollable: (state, value) => {\n                state.props.scrollable = value;\n                this.invalidateLayoutCache(state);\n            },\n            scrollY: (state, value) => {\n                state.props.scrollY = value;\n                // Scrolling doesn't need to invalidate any caches, but it does need to\n                // schedule an update\n                this.scheduleUpdateState(state);\n            },\n            letterSpacing: (state, value) => {\n                state.props.letterSpacing = value;\n                this.invalidateLayoutCache(state);\n            },\n            lineHeight: (state, value) => {\n                state.props.lineHeight = value;\n                state.resLineHeight = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            maxLines: (state, value) => {\n                state.props.maxLines = value;\n                this.invalidateLayoutCache(state);\n            },\n            textBaseline: (state, value) => {\n                state.props.textBaseline = value;\n                this.invalidateLayoutCache(state);\n            },\n            verticalAlign: (state, value) => {\n                state.props.verticalAlign = value;\n                this.invalidateLayoutCache(state);\n            },\n            overflowSuffix: (state, value) => {\n                state.props.overflowSuffix = value;\n                this.invalidateLayoutCache(state);\n            },\n            debug: (state, value) => {\n                state.props.debug = value;\n            },\n        };\n    }\n    canRenderFont(props) {\n        // TODO: Support matching on font stretch, weight and style (if/when needed)\n        // For now we just match on the font family name\n        // '$$SDF_FAILURE_TEST$$' is used to test the 'failure' event coming from text\n        const { fontFamily } = props;\n        return (fontFamily in this.ssdfFontFamilies ||\n            fontFamily in this.msdfFontFamilies ||\n            fontFamily === '$$SDF_FAILURE_TEST$$');\n    }\n    isFontFaceSupported(fontFace) {\n        return fontFace instanceof SdfTrFontFace;\n    }\n    addFontFace(fontFace) {\n        // Make sure the font face is an SDF font face (it should have already passed\n        // the `isFontFaceSupported` check)\n        assertTruthy(fontFace instanceof SdfTrFontFace);\n        const familyName = fontFace.fontFamily;\n        const fontFamiles = fontFace.type === 'ssdf'\n            ? this.ssdfFontFamilies\n            : fontFace.type === 'msdf'\n                ? this.msdfFontFamilies\n                : undefined;\n        if (!fontFamiles) {\n            console.warn(`Invalid font face type: ${fontFace.type}`);\n            return;\n        }\n        let faceSet = fontFamiles[familyName];\n        if (!faceSet) {\n            faceSet = new Set();\n            fontFamiles[familyName] = faceSet;\n        }\n        faceSet.add(fontFace);\n    }\n    createState(props) {\n        return {\n            props,\n            status: 'initialState',\n            updateScheduled: false,\n            emitter: new EventEmitter(),\n            lineCache: [],\n            forceFullLayoutCalc: false,\n            renderWindow: {\n                screen: {\n                    x1: 0,\n                    y1: 0,\n                    x2: 0,\n                    y2: 0,\n                },\n                sdf: {\n                    x1: 0,\n                    y1: 0,\n                    x2: 0,\n                    y2: 0,\n                },\n                firstLineIdx: 0,\n                numLines: 0,\n                valid: false,\n            },\n            elementBounds: {\n                x1: 0,\n                y1: 0,\n                x2: 0,\n                y2: 0,\n                valid: false,\n            },\n            clippingRect: {\n                x: 0,\n                y: 0,\n                width: 0,\n                height: 0,\n                valid: false,\n            },\n            bufferNumFloats: 0,\n            bufferNumQuads: 0,\n            vertexBuffer: undefined,\n            webGlBuffers: null,\n            bufferUploaded: false,\n            textH: undefined,\n            textW: undefined,\n            distanceRange: 0,\n            trFontFace: undefined,\n            isRenderable: false,\n            resLineHeight: undefined,\n            debugData: {\n                updateCount: 0,\n                layoutCount: 0,\n                lastLayoutNumCharacters: 0,\n                layoutSum: 0,\n                drawSum: 0,\n                drawCount: 0,\n                bufferSize: 0,\n            },\n        };\n    }\n    updateState(state) {\n        let { trFontFace } = state;\n        const { textH, lineCache, debugData, forceFullLayoutCalc } = state;\n        debugData.updateCount++;\n        // On the first update call we need to set the status to loading\n        if (state.status === 'initialState') {\n            this.setStatus(state, 'loading');\n        }\n        // Resolve font face if we haven't yet\n        if (!trFontFace) {\n            trFontFace = this.resolveFontFace(state.props);\n            state.trFontFace = trFontFace;\n            if (!trFontFace) {\n                const msg = `SdfTextRenderer: Could not resolve font face for family: '${state.props.fontFamily}'`;\n                console.error(msg);\n                this.setStatus(state, 'failed', new Error(msg));\n                return;\n            }\n            trFontFace.texture.setRenderableOwner(state, true);\n        }\n        // If the font hasn't been loaded yet, stop here.\n        // Listen for the 'loaded' event and forward fontLoaded event\n        if (!trFontFace.loaded) {\n            trFontFace.once('loaded', () => {\n                this.scheduleUpdateState(state);\n            });\n            return;\n        }\n        // If the font is loaded then so should the data\n        assertTruthy(trFontFace.data, 'Font face data should be loaded');\n        assertTruthy(trFontFace.metrics, 'Font face metrics should be loaded');\n        const { text, fontSize, x, y, contain, width, height, verticalAlign, scrollable, overflowSuffix, maxLines, } = state.props;\n        // scrollY only has an effect when contain === 'both' and scrollable === true\n        const scrollY = contain === 'both' && scrollable ? state.props.scrollY : 0;\n        const { renderWindow } = state;\n        /**\n         * The font size of the SDF font face (the basis for SDF space units)\n         */\n        const sdfFontSize = trFontFace.data.info.size;\n        /**\n         * Divide screen space units by this to get the SDF space units\n         * Mulitple SDF space units by this to get screen space units\n         */\n        const fontSizeRatio = fontSize / sdfFontSize;\n        // If not already resolved, resolve the line height and store it in the state\n        let resLineHeight = state.resLineHeight;\n        if (resLineHeight === undefined) {\n            const lineHeight = state.props.lineHeight;\n            // If lineHeight is undefined, use the maxCharHeight from the font face\n            if (lineHeight === undefined) {\n                resLineHeight = calcDefaultLineHeight(trFontFace.metrics, fontSize);\n            }\n            else {\n                resLineHeight = lineHeight;\n            }\n            state.resLineHeight = resLineHeight;\n        }\n        // Needed in renderWindow calculation\n        const sdfLineHeight = resLineHeight / fontSizeRatio;\n        state.distanceRange =\n            fontSizeRatio * trFontFace.data.distanceField.distanceRange;\n        // Allocate buffers if needed\n        const neededLength = text.length * FLOATS_PER_GLYPH;\n        let vertexBuffer = state.vertexBuffer;\n        if (!vertexBuffer || vertexBuffer.length < neededLength) {\n            vertexBuffer = new Float32Array(neededLength * 2);\n        }\n        const elementBounds = state.elementBounds;\n        if (!elementBounds.valid) {\n            this.setElementBoundsX(state);\n            this.setElementBoundsY(state);\n            elementBounds.valid = true;\n        }\n        // Return early if we're still viewing inside the established render window\n        // No need to re-render what we've already rendered\n        // (Only if there's an established renderWindow and we're not suppressing early exit)\n        if (!forceFullLayoutCalc && renderWindow.valid) {\n            const rwScreen = renderWindow.screen;\n            if (x + rwScreen.x1 <= elementBounds.x1 &&\n                x + rwScreen.x2 >= elementBounds.x2 &&\n                y - scrollY + rwScreen.y1 <= elementBounds.y1 &&\n                y - scrollY + rwScreen.y2 >= elementBounds.y2) {\n                this.setStatus(state, 'loaded');\n                return;\n            }\n            // Otherwise invalidate the renderWindow so it can be redone\n            renderWindow.valid = false;\n            this.setStatus(state, 'loading');\n        }\n        const { offsetY, textAlign } = state.props;\n        // Create a new renderWindow if needed\n        if (!renderWindow.valid) {\n            const isPossiblyOnScreen = boundsOverlap(elementBounds, this.rendererBounds);\n            if (!isPossiblyOnScreen) {\n                // If the element is not possibly on screen, we can skip the layout and rendering completely\n                return;\n            }\n            setRenderWindow(renderWindow, x, y, scrollY, resLineHeight, contain === 'both' ? elementBounds.y2 - elementBounds.y1 : 0, elementBounds, fontSizeRatio);\n            // console.log('newRenderWindow', renderWindow);\n        }\n        const start = getStartConditions(sdfFontSize, sdfLineHeight, trFontFace, verticalAlign, offsetY, fontSizeRatio, renderWindow, lineCache, textH);\n        if (!start) {\n            // Nothing to render, return early, but still mark as loaded (since the text is just scrolled\n            // out of view)\n            this.setStatus(state, 'loaded');\n            return;\n        }\n        const { letterSpacing } = state.props;\n        const out2 = layoutText(start.lineIndex, start.sdfX, start.sdfY, text, textAlign, width, height, fontSize, resLineHeight, letterSpacing, vertexBuffer, contain, lineCache, renderWindow.sdf, trFontFace, forceFullLayoutCalc, scrollable, overflowSuffix, maxLines);\n        state.bufferUploaded = false;\n        state.bufferNumFloats = out2.bufferNumFloats;\n        state.bufferNumQuads = out2.bufferNumQuads;\n        state.vertexBuffer = vertexBuffer;\n        state.renderWindow = renderWindow;\n        debugData.lastLayoutNumCharacters = out2.layoutNumCharacters;\n        debugData.bufferSize = vertexBuffer.byteLength;\n        // If we didn't exit early, we know we have completely computed w/h\n        if (out2.fullyProcessed) {\n            state.textW = out2.maxX * fontSizeRatio;\n            state.textH = out2.numLines * sdfLineHeight * fontSizeRatio;\n        }\n        // if (state.props.debug.printLayoutTime) {\n        //   debugData.layoutSum += performance.now() - updateStartTime;\n        //   debugData.layoutCount++;\n        // }\n        this.setStatus(state, 'loaded');\n    }\n    renderQuads(state, transform, clippingRect, alpha, parentHasRenderTexture, framebufferDimensions) {\n        if (!state.vertexBuffer) {\n            // Nothing to draw\n            return;\n        }\n        const renderer = this.stage.renderer;\n        assertTruthy(renderer instanceof WebGlCoreRenderer);\n        const { fontSize, color, contain, scrollable, zIndex, debug } = state.props;\n        // scrollY only has an effect when contain === 'both' and scrollable === true\n        const scrollY = contain === 'both' && scrollable ? state.props.scrollY : 0;\n        const { textW = 0, textH = 0, distanceRange, vertexBuffer, bufferUploaded, trFontFace, elementBounds, } = state;\n        let { webGlBuffers } = state;\n        if (!webGlBuffers) {\n            const glw = renderer.glw;\n            const stride = 4 * Float32Array.BYTES_PER_ELEMENT;\n            const webGlBuffer = glw.createBuffer();\n            assertTruthy(webGlBuffer);\n            state.webGlBuffers = new BufferCollection([\n                {\n                    buffer: webGlBuffer,\n                    attributes: {\n                        a_position: {\n                            name: 'a_position',\n                            size: 2,\n                            type: glw.FLOAT,\n                            normalized: false,\n                            stride,\n                            offset: 0, // start at the beginning of the buffer\n                        },\n                        a_textureCoordinate: {\n                            name: 'a_textureCoordinate',\n                            size: 2,\n                            type: glw.FLOAT,\n                            normalized: false,\n                            stride,\n                            offset: 2 * Float32Array.BYTES_PER_ELEMENT,\n                        },\n                    },\n                },\n            ]);\n            state.bufferUploaded = false;\n            assertTruthy(state.webGlBuffers);\n            webGlBuffers = state.webGlBuffers;\n        }\n        if (!bufferUploaded) {\n            const glw = renderer.glw;\n            const buffer = webGlBuffers?.getBuffer('a_textureCoordinate') ?? null;\n            glw.arrayBufferData(buffer, vertexBuffer, glw.STATIC_DRAW);\n            state.bufferUploaded = true;\n        }\n        assertTruthy(trFontFace);\n        if (scrollable && contain === 'both') {\n            assertTruthy(elementBounds.valid);\n            const elementRect = convertBoundToRect(elementBounds, tmpRect);\n            if (clippingRect.valid) {\n                state.clippingRect.valid = true;\n                clippingRect = intersectRect(clippingRect, elementRect, state.clippingRect);\n            }\n            else {\n                state.clippingRect.valid = true;\n                clippingRect = copyRect(elementRect, state.clippingRect);\n            }\n        }\n        const renderOp = new WebGlCoreRenderOp(renderer.glw, renderer.options, webGlBuffers, this.sdfShader, {\n            transform: transform.getFloatArr(),\n            // IMPORTANT: The SDF Shader expects the color NOT to be premultiplied\n            // for the best blending results. Which is why we use `mergeColorAlpha`\n            // instead of `mergeColorAlphaPremultiplied` here.\n            color: mergeColorAlpha(color, alpha),\n            size: fontSize / (trFontFace.data?.info.size || 0),\n            scrollY,\n            distanceRange,\n            debug: debug.sdfShaderDebug,\n        }, alpha, clippingRect, { height: textH, width: textW }, 0, zIndex, false, parentHasRenderTexture, framebufferDimensions);\n        const texture = state.trFontFace?.texture;\n        assertTruthy(texture);\n        const ctxTexture = texture.ctxTexture;\n        renderOp.addTexture(ctxTexture);\n        renderOp.length = state.bufferNumFloats;\n        renderOp.numQuads = state.bufferNumQuads;\n        renderer.addRenderOp(renderOp);\n        // if (!debug.disableScissor) {\n        //   renderer.enableScissor(\n        //     visibleRect.x,\n        //     visibleRect.y,\n        //     visibleRect.w,\n        //     visibleRect.h,\n        //   );\n        // }\n        // Draw the arrays\n        // gl.drawArrays(\n        //   gl.TRIANGLES, // Primitive type\n        //   0,\n        //   bufferNumVertices, // Number of verticies\n        // );\n        // renderer.disableScissor();\n        // if (debug.showElementRect) {\n        //   this.renderer.drawBorder(\n        //     Colors.Blue,\n        //     elementRect.x,\n        //     elementRect.y,\n        //     elementRect.w,\n        //     elementRect.h,\n        //   );\n        // }\n        // if (debug.showVisibleRect) {\n        //   this.renderer.drawBorder(\n        //     Colors.Green,\n        //     visibleRect.x,\n        //     visibleRect.y,\n        //     visibleRect.w,\n        //     visibleRect.h,\n        //   );\n        // }\n        // if (debug.showRenderWindow && renderWindow) {\n        //   this.renderer.drawBorder(\n        //     Colors.Red,\n        //     x + renderWindow.x1,\n        //     y + renderWindow.y1 - scrollY,\n        //     x + renderWindow.x2 - (x + renderWindow.x1),\n        //     y + renderWindow.y2 - scrollY - (y + renderWindow.y1 - scrollY),\n        //   );\n        // }\n        // if (debug.printLayoutTime) {\n        //   debugData.drawSum += performance.now() - drawStartTime;\n        //   debugData.drawCount++;\n        // }\n    }\n    setIsRenderable(state, renderable) {\n        super.setIsRenderable(state, renderable);\n        state.trFontFace?.texture.setRenderableOwner(state, renderable);\n    }\n    destroyState(state) {\n        super.destroyState(state);\n        // If there's a Font Face assigned we must free the owner relation to its texture\n        state.trFontFace?.texture.setRenderableOwner(state, false);\n    }\n    //#endregion Overrides\n    resolveFontFace(props) {\n        return TrFontManager.resolveFontFace(this.fontFamilyArray, props);\n    }\n    /**\n     * Release the loaded SDF font face\n     *\n     * @param state\n     */\n    releaseFontFace(state) {\n        state.resLineHeight = undefined;\n        if (state.trFontFace) {\n            state.trFontFace.texture.setRenderableOwner(state, false);\n            state.trFontFace = undefined;\n        }\n    }\n    /**\n     * Invalidate the layout cache stored in the state. This will cause the text\n     * to be re-layed out on the next update.\n     *\n     * @remarks\n     * This also invalidates the visible window cache.\n     *\n     * @param state\n     */\n    invalidateLayoutCache(state) {\n        state.renderWindow.valid = false;\n        state.elementBounds.valid = false;\n        state.textH = undefined;\n        state.textW = undefined;\n        state.lineCache = [];\n        this.setStatus(state, 'loading');\n        this.scheduleUpdateState(state);\n    }\n    setElementBoundsX(state) {\n        const { x, contain, width } = state.props;\n        const { elementBounds } = state;\n        elementBounds.x1 = x;\n        elementBounds.x2 = contain !== 'none' ? x + width : Infinity;\n    }\n    setElementBoundsY(state) {\n        const { y, contain, height } = state.props;\n        const { elementBounds } = state;\n        elementBounds.y1 = y;\n        elementBounds.y2 = contain === 'both' ? y + height : Infinity;\n    }\n}\n//# sourceMappingURL=SdfTextRenderer.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Number of floating point numbers that represent a single glyph in the SDF vertex buffer.\n *\n * @remarks\n * The vertex buffer contains:\n *  - 6 vertex positions\n *  - 6 texture coordinates\n *  - = 12 positions/coordinates per glyph\n *\n * Each vertex position and texture coordinate consist of 2 floating point numbers (x/y).\n * So there are 12 * 2 = 24 floating point numbers that make up a single glyph.\n */\nexport const FLOATS_PER_GLYPH = 24;\n//# sourceMappingURL=constants.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../../../../utils.js';\n/**\n * Gets the start conditions for the layout loop.\n *\n * @remarks\n * Returns `undefined` if the layout loop should not be run.\n *\n * @param fontSize\n * @param fontSizeRatio\n * @param sdfLineHeight\n * @param renderWindow\n * @param lineCache\n * @param textH\n * @returns\n */\nexport function getStartConditions(sdfFontSize, sdfLineHeight, fontFace, verticalAlign, offsetY, fontSizeRatio, renderWindow, lineCache, textH) {\n    // State variables\n    const startLineIndex = Math.min(Math.max(renderWindow.firstLineIdx, 0), lineCache.length);\n    const sdfStartX = 0;\n    const { metrics } = fontFace;\n    assertTruthy(metrics, 'Font metrics not loaded');\n    assertTruthy(fontFace.data, 'Font data not loaded');\n    /**\n     * Bare line height is the distance between the ascender and descender of the font.\n     * without the line gap metric.\n     */\n    const sdfBareLineHeight = (metrics.ascender - metrics.descender) * sdfFontSize;\n    let sdfVerticalAlignYOffset = 0;\n    if (verticalAlign === 'middle') {\n        sdfVerticalAlignYOffset = (sdfLineHeight - sdfBareLineHeight) / 2;\n    }\n    else if (verticalAlign === 'bottom') {\n        sdfVerticalAlignYOffset = sdfLineHeight - sdfBareLineHeight;\n    }\n    const sdfOffsetY = offsetY / fontSizeRatio;\n    /**\n     * This is the position from the top of the text drawing line to where the\n     * baseline of the text will be according to the encoded positioning data for\n     * each glyph in the SDF data. This also happens to be the ascender value\n     * that is encoded into the font data.\n     */\n    const sdfEncodedAscender = fontFace.data.common.base;\n    /**\n     * This is the ascender that is configured and overridable in the font face.\n     */\n    const sdfConfiguredAscender = metrics.ascender * sdfFontSize;\n    /**\n     * If the configured ascender is different from the SDF data's encoded\n     * ascender, the offset of the text will be adjusted by the difference.\n     */\n    const sdfAscenderAdjOffset = sdfConfiguredAscender - sdfEncodedAscender;\n    const sdfStartY = sdfOffsetY +\n        sdfAscenderAdjOffset +\n        startLineIndex * sdfLineHeight +\n        sdfVerticalAlignYOffset; // TODO: Figure out what determines the initial y offset of text.\n    // Don't attempt to render anything if we know we're starting past the established end of the text\n    if (textH && sdfStartY >= textH / fontSizeRatio) {\n        return;\n    }\n    return {\n        sdfX: sdfStartX,\n        sdfY: sdfStartY,\n        lineIndex: startLineIndex,\n    };\n}\n//# sourceMappingURL=getStartConditions.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { TrFontFace, } from './TrFontFace.js';\nexport class WebTrFontFace extends TrFontFace {\n    fontFace;\n    fontUrl;\n    constructor(options) {\n        super(options);\n        const { fontFamily, fontUrl } = options;\n        // Filter out parentheses from fontUrl\n        const fontUrlWithoutParentheses = fontUrl.replace(/\\(|\\)/g, '');\n        // Defaults for descriptors resolved in the super constructor\n        const determinedDescriptors = this.descriptors;\n        // Convert TrFontFaceDescriptors to CSS FontFaceDescriptors\n        const cssDescriptors = {\n            style: determinedDescriptors.style,\n            weight: typeof determinedDescriptors.weight === 'number'\n                ? `${determinedDescriptors.weight}`\n                : determinedDescriptors.weight,\n            stretch: determinedDescriptors.stretch,\n            unicodeRange: determinedDescriptors.unicodeRange,\n            featureSettings: determinedDescriptors.featureSettings,\n            display: determinedDescriptors.display,\n        };\n        const fontFace = new FontFace(fontFamily, `url(${fontUrlWithoutParentheses})`, cssDescriptors);\n        fontFace\n            .load()\n            .then(() => {\n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n            this.loaded = true;\n            this.emit('loaded');\n        })\n            .catch(console.error);\n        this.fontFace = fontFace;\n        this.fontUrl = fontUrl;\n    }\n}\n//# sourceMappingURL=WebTrFontFace.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { assertTruthy } from '../../../utils.js';\nimport { getRgbaString } from '../../lib/utils.js';\nimport { calcDefaultLineHeight } from '../TextRenderingUtils.js';\nimport { getWebFontMetrics } from '../TextTextureRendererUtils.js';\nconst MAX_TEXTURE_DIMENSION = 2048;\n/**\n * Calculate height for the canvas\n *\n * @param textBaseline\n * @param fontSize\n * @param lineHeight\n * @param numLines\n * @param offsetY\n * @returns\n */\nfunction calcHeight(textBaseline, fontSize, lineHeight, numLines, offsetY) {\n    const baselineOffset = textBaseline !== 'bottom' ? 0.5 * fontSize : 0;\n    return (lineHeight * (numLines - 1) +\n        baselineOffset +\n        Math.max(lineHeight, fontSize) +\n        (offsetY || 0));\n}\nexport class LightningTextTextureRenderer {\n    _canvas;\n    _context;\n    _settings;\n    constructor(canvas, context) {\n        this._canvas = canvas;\n        this._context = context;\n        this._settings = this.mergeDefaults({});\n    }\n    set settings(v) {\n        this._settings = this.mergeDefaults(v);\n    }\n    get settings() {\n        return this._settings;\n    }\n    getPrecision() {\n        return this._settings.precision;\n    }\n    setFontProperties() {\n        this._context.font = this._getFontSetting();\n        this._context.textBaseline = this._settings.textBaseline;\n    }\n    _getFontSetting() {\n        const ff = [this._settings.fontFamily];\n        const ffs = [];\n        for (let i = 0, n = ff.length; i < n; i++) {\n            if (ff[i] === 'serif' || ff[i] === 'sans-serif') {\n                ffs.push(ff[i]);\n            }\n            else {\n                ffs.push(`\"${ff[i]}\"`);\n            }\n        }\n        return `${this._settings.fontStyle} ${this._settings.fontSize * this.getPrecision()}px ${ffs.join(',')}`;\n    }\n    _load() {\n        if (true && document.fonts) {\n            const fontSetting = this._getFontSetting();\n            try {\n                if (!document.fonts.check(fontSetting, this._settings.text)) {\n                    // Use a promise that waits for loading.\n                    return document.fonts\n                        .load(fontSetting, this._settings.text)\n                        .catch((err) => {\n                        // Just load the fallback font.\n                        console.warn('[Lightning] Font load error', err, fontSetting);\n                    })\n                        .then(() => {\n                        if (!document.fonts.check(fontSetting, this._settings.text)) {\n                            console.warn('[Lightning] Font not found', fontSetting);\n                        }\n                    });\n                }\n            }\n            catch (e) {\n                console.warn(\"[Lightning] Can't check font loading for \" + fontSetting);\n            }\n        }\n    }\n    calculateRenderInfo() {\n        const renderInfo = {};\n        const precision = this.getPrecision();\n        const paddingLeft = this._settings.paddingLeft * precision;\n        const paddingRight = this._settings.paddingRight * precision;\n        const fontSize = this._settings.fontSize * precision;\n        let offsetY = this._settings.offsetY === null\n            ? null\n            : this._settings.offsetY * precision;\n        const w = this._settings.w * precision;\n        const h = this._settings.h * precision;\n        let wordWrapWidth = this._settings.wordWrapWidth * precision;\n        const cutSx = this._settings.cutSx * precision;\n        const cutEx = this._settings.cutEx * precision;\n        const cutSy = this._settings.cutSy * precision;\n        const cutEy = this._settings.cutEy * precision;\n        const letterSpacing = (this._settings.letterSpacing || 0) * precision;\n        const textIndent = this._settings.textIndent * precision;\n        const trFontFace = this._settings.trFontFace;\n        // Set font properties.\n        this.setFontProperties();\n        assertTruthy(trFontFace);\n        const metrics = getWebFontMetrics(this._context, trFontFace, fontSize);\n        const defLineHeight = calcDefaultLineHeight(metrics, fontSize) * precision;\n        const lineHeight = this._settings.lineHeight !== null\n            ? this._settings.lineHeight * precision\n            : defLineHeight;\n        const maxHeight = this._settings.maxHeight;\n        const containedMaxLines = maxHeight !== null && lineHeight > 0\n            ? Math.floor(maxHeight / lineHeight)\n            : 0;\n        const setMaxLines = this._settings.maxLines;\n        const calcMaxLines = containedMaxLines > 0 && setMaxLines > 0\n            ? Math.min(containedMaxLines, setMaxLines)\n            : Math.max(containedMaxLines, setMaxLines);\n        // Total width.\n        let width = w || 2048 / this.getPrecision();\n        // Inner width.\n        let innerWidth = width - paddingLeft;\n        if (innerWidth < 10) {\n            width += 10 - innerWidth;\n            innerWidth = 10;\n        }\n        if (!wordWrapWidth) {\n            wordWrapWidth = innerWidth;\n        }\n        // Text overflow\n        if (this._settings.textOverflow && !this._settings.wordWrap) {\n            let suffix;\n            switch (this._settings.textOverflow) {\n                case 'clip':\n                    suffix = '';\n                    break;\n                case 'ellipsis':\n                    suffix = this._settings.overflowSuffix;\n                    break;\n                default:\n                    suffix = this._settings.textOverflow;\n            }\n            this._settings.text = this.wrapWord(this._settings.text, wordWrapWidth - textIndent, suffix);\n        }\n        // word wrap\n        // preserve original text\n        let linesInfo;\n        if (this._settings.wordWrap) {\n            linesInfo = this.wrapText(this._settings.text, wordWrapWidth, letterSpacing, textIndent);\n        }\n        else {\n            linesInfo = { l: this._settings.text.split(/(?:\\r\\n|\\r|\\n)/), n: [] };\n            const n = linesInfo.l.length;\n            for (let i = 0; i < n - 1; i++) {\n                linesInfo.n.push(i);\n            }\n        }\n        let lines = linesInfo.l;\n        if (calcMaxLines && lines.length > calcMaxLines) {\n            const usedLines = lines.slice(0, calcMaxLines);\n            let otherLines = null;\n            if (this._settings.overflowSuffix) {\n                // Wrap again with max lines suffix enabled.\n                const w = this._settings.overflowSuffix\n                    ? this.measureText(this._settings.overflowSuffix)\n                    : 0;\n                const al = this.wrapText(usedLines[usedLines.length - 1], wordWrapWidth - w, letterSpacing, textIndent);\n                usedLines[usedLines.length - 1] = `${al.l[0]}${this._settings.overflowSuffix}`;\n                otherLines = [al.l.length > 1 ? al.l[1] : ''];\n            }\n            else {\n                otherLines = [''];\n            }\n            // Re-assemble the remaining text.\n            let i;\n            const n = lines.length;\n            let j = 0;\n            const m = linesInfo.n.length;\n            for (i = calcMaxLines; i < n; i++) {\n                otherLines[j] += `${otherLines[j] ? ' ' : ''}${lines[i]}`;\n                if (i + 1 < m && linesInfo.n[i + 1]) {\n                    j++;\n                }\n            }\n            renderInfo.remainingText = otherLines.join('\\n');\n            renderInfo.moreTextLines = true;\n            lines = usedLines;\n        }\n        else {\n            renderInfo.moreTextLines = false;\n            renderInfo.remainingText = '';\n        }\n        // calculate text width\n        let maxLineWidth = 0;\n        const lineWidths = [];\n        for (let i = 0; i < lines.length; i++) {\n            const lineWidth = this.measureText(lines[i], letterSpacing) + (i === 0 ? textIndent : 0);\n            lineWidths.push(lineWidth);\n            maxLineWidth = Math.max(maxLineWidth, lineWidth);\n        }\n        renderInfo.lineWidths = lineWidths;\n        if (!w) {\n            // Auto-set width to max text length.\n            width = maxLineWidth + paddingLeft + paddingRight;\n            innerWidth = maxLineWidth;\n        }\n        let height;\n        if (h) {\n            height = h;\n        }\n        else {\n            height = calcHeight(this._settings.textBaseline, fontSize, lineHeight, lines.length, offsetY);\n        }\n        if (offsetY === null) {\n            offsetY = fontSize;\n        }\n        renderInfo.w = width;\n        renderInfo.h = height;\n        renderInfo.lines = lines;\n        renderInfo.precision = precision;\n        if (!width) {\n            // To prevent canvas errors.\n            width = 1;\n        }\n        if (!height) {\n            // To prevent canvas errors.\n            height = 1;\n        }\n        if (cutSx || cutEx) {\n            width = Math.min(width, cutEx - cutSx);\n        }\n        if (cutSy || cutEy) {\n            height = Math.min(height, cutEy - cutSy);\n        }\n        renderInfo.width = width;\n        renderInfo.innerWidth = innerWidth;\n        renderInfo.height = height;\n        renderInfo.fontSize = fontSize;\n        renderInfo.cutSx = cutSx;\n        renderInfo.cutSy = cutSy;\n        renderInfo.cutEx = cutEx;\n        renderInfo.cutEy = cutEy;\n        renderInfo.lineHeight = lineHeight;\n        renderInfo.defLineHeight = defLineHeight;\n        renderInfo.lineWidths = lineWidths;\n        renderInfo.offsetY = offsetY;\n        renderInfo.paddingLeft = paddingLeft;\n        renderInfo.paddingRight = paddingRight;\n        renderInfo.letterSpacing = letterSpacing;\n        renderInfo.textIndent = textIndent;\n        renderInfo.metrics = metrics;\n        return renderInfo;\n    }\n    draw(renderInfo, linesOverride) {\n        const precision = this.getPrecision();\n        // Allow lines to be overriden for partial rendering.\n        const lines = linesOverride?.lines || renderInfo.lines;\n        const lineWidths = linesOverride?.lineWidths || renderInfo.lineWidths;\n        const height = linesOverride\n            ? calcHeight(this._settings.textBaseline, renderInfo.fontSize, renderInfo.lineHeight, linesOverride.lines.length, this._settings.offsetY === null\n                ? null\n                : this._settings.offsetY * precision)\n            : renderInfo.height;\n        // Add extra margin to prevent issue with clipped text when scaling.\n        this._canvas.width = Math.min(Math.ceil(renderInfo.width + this._settings.textRenderIssueMargin), MAX_TEXTURE_DIMENSION);\n        this._canvas.height = Math.min(Math.ceil(height), MAX_TEXTURE_DIMENSION);\n        // Canvas context has been reset.\n        this.setFontProperties();\n        if (renderInfo.fontSize >= 128) {\n            // WpeWebKit bug: must force compositing because cairo-traps-compositor will not work with text first.\n            this._context.globalAlpha = 0.01;\n            this._context.fillRect(0, 0, 0.01, 0.01);\n            this._context.globalAlpha = 1.0;\n        }\n        if (renderInfo.cutSx || renderInfo.cutSy) {\n            this._context.translate(-renderInfo.cutSx, -renderInfo.cutSy);\n        }\n        let linePositionX;\n        let linePositionY;\n        const drawLines = [];\n        const { metrics } = renderInfo;\n        /**\n         * Ascender (in pixels)\n         */\n        const ascenderPx = metrics\n            ? metrics.ascender * renderInfo.fontSize\n            : renderInfo.fontSize;\n        /**\n         * Bare line height is the distance between the ascender and descender of the font.\n         * without the line gap metric.\n         */\n        const bareLineHeightPx = (metrics.ascender - metrics.descender) * renderInfo.fontSize;\n        // Draw lines line by line.\n        for (let i = 0, n = lines.length; i < n; i++) {\n            linePositionX = i === 0 ? renderInfo.textIndent : 0;\n            // By default, text is aligned to top\n            linePositionY = i * renderInfo.lineHeight + ascenderPx;\n            if (this._settings.verticalAlign == 'middle') {\n                linePositionY += (renderInfo.lineHeight - bareLineHeightPx) / 2;\n            }\n            else if (this._settings.verticalAlign == 'bottom') {\n                linePositionY += renderInfo.lineHeight - bareLineHeightPx;\n            }\n            if (this._settings.textAlign === 'right') {\n                linePositionX += renderInfo.innerWidth - lineWidths[i];\n            }\n            else if (this._settings.textAlign === 'center') {\n                linePositionX += (renderInfo.innerWidth - lineWidths[i]) / 2;\n            }\n            linePositionX += renderInfo.paddingLeft;\n            drawLines.push({\n                text: lines[i],\n                x: linePositionX,\n                y: linePositionY,\n                w: lineWidths[i],\n            });\n        }\n        // Highlight.\n        if (this._settings.highlight) {\n            const color = this._settings.highlightColor;\n            const hlHeight = this._settings.highlightHeight * precision || renderInfo.fontSize * 1.5;\n            const offset = this._settings.highlightOffset * precision;\n            const hlPaddingLeft = this._settings.highlightPaddingLeft !== null\n                ? this._settings.highlightPaddingLeft * precision\n                : renderInfo.paddingLeft;\n            const hlPaddingRight = this._settings.highlightPaddingRight !== null\n                ? this._settings.highlightPaddingRight * precision\n                : renderInfo.paddingRight;\n            this._context.fillStyle = getRgbaString(color);\n            for (let i = 0; i < drawLines.length; i++) {\n                const drawLine = drawLines[i];\n                this._context.fillRect(drawLine.x - hlPaddingLeft, drawLine.y - renderInfo.offsetY + offset, drawLine.w + hlPaddingRight + hlPaddingLeft, hlHeight);\n            }\n        }\n        // Text shadow.\n        let prevShadowSettings = null;\n        if (this._settings.shadow) {\n            prevShadowSettings = [\n                this._context.shadowColor,\n                this._context.shadowOffsetX,\n                this._context.shadowOffsetY,\n                this._context.shadowBlur,\n            ];\n            this._context.shadowColor = getRgbaString(this._settings.shadowColor);\n            this._context.shadowOffsetX = this._settings.shadowOffsetX * precision;\n            this._context.shadowOffsetY = this._settings.shadowOffsetY * precision;\n            this._context.shadowBlur = this._settings.shadowBlur * precision;\n        }\n        this._context.fillStyle = getRgbaString(this._settings.textColor);\n        for (let i = 0, n = drawLines.length; i < n; i++) {\n            const drawLine = drawLines[i];\n            if (renderInfo.letterSpacing === 0) {\n                this._context.fillText(drawLine.text, drawLine.x, drawLine.y);\n            }\n            else {\n                const textSplit = drawLine.text.split('');\n                let x = drawLine.x;\n                for (let i = 0, j = textSplit.length; i < j; i++) {\n                    this._context.fillText(textSplit[i], x, drawLine.y);\n                    x += this.measureText(textSplit[i], renderInfo.letterSpacing);\n                }\n            }\n        }\n        if (prevShadowSettings) {\n            this._context.shadowColor = prevShadowSettings[0];\n            this._context.shadowOffsetX = prevShadowSettings[1];\n            this._context.shadowOffsetY = prevShadowSettings[2];\n            this._context.shadowBlur = prevShadowSettings[3];\n        }\n        if (renderInfo.cutSx || renderInfo.cutSy) {\n            this._context.translate(renderInfo.cutSx, renderInfo.cutSy);\n        }\n    }\n    wrapWord(word, wordWrapWidth, suffix) {\n        const suffixWidth = this._context.measureText(suffix).width;\n        const wordLen = word.length;\n        const wordWidth = this._context.measureText(word).width;\n        /* If word fits wrapWidth, do nothing */\n        if (wordWidth <= wordWrapWidth) {\n            return word;\n        }\n        /* Make initial guess for text cuttoff */\n        let cutoffIndex = Math.floor((wordWrapWidth * wordLen) / wordWidth);\n        let truncWordWidth = this._context.measureText(word.substring(0, cutoffIndex)).width +\n            suffixWidth;\n        /* In case guess was overestimated, shrink it letter by letter. */\n        if (truncWordWidth > wordWrapWidth) {\n            while (cutoffIndex > 0) {\n                truncWordWidth =\n                    this._context.measureText(word.substring(0, cutoffIndex)).width +\n                        suffixWidth;\n                if (truncWordWidth > wordWrapWidth) {\n                    cutoffIndex -= 1;\n                }\n                else {\n                    break;\n                }\n            }\n            /* In case guess was underestimated, extend it letter by letter. */\n        }\n        else {\n            while (cutoffIndex < wordLen) {\n                truncWordWidth =\n                    this._context.measureText(word.substring(0, cutoffIndex)).width +\n                        suffixWidth;\n                if (truncWordWidth < wordWrapWidth) {\n                    cutoffIndex += 1;\n                }\n                else {\n                    // Finally, when bound is crossed, retract last letter.\n                    cutoffIndex -= 1;\n                    break;\n                }\n            }\n        }\n        /* If wrapWidth is too short to even contain suffix alone, return empty string */\n        return (word.substring(0, cutoffIndex) +\n            (wordWrapWidth >= suffixWidth ? suffix : ''));\n    }\n    /**\n     * Applies newlines to a string to have it optimally fit into the horizontal\n     * bounds set by the Text object's wordWrapWidth property.\n     */\n    wrapText(text, wordWrapWidth, letterSpacing, indent = 0) {\n        // Greedy wrapping algorithm that will wrap words as the line grows longer.\n        // than its horizontal bounds.\n        const lines = text.split(/\\r?\\n/g);\n        let allLines = [];\n        const realNewlines = [];\n        for (let i = 0; i < lines.length; i++) {\n            const resultLines = [];\n            let result = '';\n            let spaceLeft = wordWrapWidth - indent;\n            const words = lines[i].split(' ');\n            for (let j = 0; j < words.length; j++) {\n                const wordWidth = this.measureText(words[j], letterSpacing);\n                const wordWidthWithSpace = wordWidth + this.measureText(' ', letterSpacing);\n                if (j === 0 || wordWidthWithSpace > spaceLeft) {\n                    // Skip printing the newline if it's the first word of the line that is.\n                    // greater than the word wrap width.\n                    if (j > 0) {\n                        resultLines.push(result);\n                        result = '';\n                    }\n                    result += words[j];\n                    spaceLeft = wordWrapWidth - wordWidth - (j === 0 ? indent : 0);\n                }\n                else {\n                    spaceLeft -= wordWidthWithSpace;\n                    result += ` ${words[j]}`;\n                }\n            }\n            resultLines.push(result);\n            result = '';\n            allLines = allLines.concat(resultLines);\n            if (i < lines.length - 1) {\n                realNewlines.push(allLines.length);\n            }\n        }\n        return { l: allLines, n: realNewlines };\n    }\n    measureText(word, space = 0) {\n        if (!space) {\n            return this._context.measureText(word).width;\n        }\n        return word.split('').reduce((acc, char) => {\n            return acc + this._context.measureText(char).width + space;\n        }, 0);\n    }\n    mergeDefaults(settings) {\n        return {\n            text: '',\n            w: 0,\n            h: 0,\n            fontStyle: 'normal',\n            fontSize: 40,\n            fontFamily: null,\n            trFontFace: null,\n            wordWrap: true,\n            wordWrapWidth: 0,\n            wordBreak: false,\n            textOverflow: '',\n            lineHeight: null,\n            textBaseline: 'alphabetic',\n            textAlign: 'left',\n            verticalAlign: 'top',\n            offsetY: null,\n            maxLines: 0,\n            maxHeight: null,\n            overflowSuffix: '...',\n            textColor: [1.0, 1.0, 1.0, 1.0],\n            paddingLeft: 0,\n            paddingRight: 0,\n            shadow: false,\n            shadowColor: [0.0, 0.0, 0.0, 1.0],\n            shadowOffsetX: 0,\n            shadowOffsetY: 0,\n            shadowBlur: 5,\n            highlight: false,\n            highlightHeight: 0,\n            highlightColor: [0.0, 0.0, 0.0, 1.0],\n            highlightOffset: 0,\n            highlightPaddingLeft: 0,\n            highlightPaddingRight: 0,\n            letterSpacing: 0,\n            textIndent: 0,\n            cutSx: 0,\n            cutEx: 0,\n            cutSy: 0,\n            cutEy: 0,\n            advancedRenderer: false,\n            fontBaselineRatio: 0,\n            precision: 1,\n            textRenderIssueMargin: 0,\n            ...settings,\n        };\n    }\n}\n//# sourceMappingURL=LightningTextTextureRenderer.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Returns CSS font setting string for use in canvas context.\n *\n * @param fontFace\n * @param fontStyle\n * @param fontSize\n * @param precision\n * @param defaultFontFace\n * @returns\n */\nexport function getFontSetting(fontFace, fontStyle, fontSize, precision, defaultFontFace) {\n    let ff = fontFace;\n    if (!Array.isArray(ff)) {\n        ff = [ff];\n    }\n    const ffs = [];\n    for (let i = 0, n = ff.length; i < n; i++) {\n        let curFf = ff[i];\n        // Replace the default font face `null` with the actual default font face set\n        // on the stage.\n        if (curFf === null || curFf === undefined) {\n            curFf = defaultFontFace;\n        }\n        if (curFf === 'serif' || curFf === 'sans-serif') {\n            ffs.push(curFf);\n        }\n        else {\n            ffs.push(`\"${curFf}\"`);\n        }\n    }\n    return `${fontStyle} ${fontSize * precision}px ${ffs.join(',')}`;\n}\n/**\n * Returns true if the given character is a zero-width space.\n *\n * @param space\n */\nexport function isZeroWidthSpace(space) {\n    return space === '' || space === '\\u200B';\n}\n/**\n * Returns true if the given character is a zero-width space or a regular space.\n *\n * @param space\n */\nexport function isSpace(space) {\n    return isZeroWidthSpace(space) || space === ' ';\n}\n/**\n * Converts a string into an array of tokens and the words between them.\n *\n * @param tokenRegex\n * @param text\n */\nexport function tokenizeString(tokenRegex, text) {\n    const delimeters = text.match(tokenRegex) || [];\n    const words = text.split(tokenRegex) || [];\n    const final = [];\n    for (let i = 0; i < words.length; i++) {\n        final.push(words[i], delimeters[i]);\n    }\n    final.pop();\n    return final.filter((word) => word != '');\n}\n/**\n * Measure the width of a string accounting for letter spacing.\n *\n * @param context\n * @param word\n * @param space\n */\nexport function measureText(context, word, space = 0) {\n    if (!space) {\n        return context.measureText(word).width;\n    }\n    return word.split('').reduce((acc, char) => {\n        // Zero-width spaces should not include letter spacing.\n        // And since we know the width of a zero-width space is 0, we can skip\n        // measuring it.\n        if (isZeroWidthSpace(char)) {\n            return acc;\n        }\n        return acc + context.measureText(char).width + space;\n    }, 0);\n}\n/**\n * Get the font metrics for a font face.\n *\n * @remarks\n * This function will attempt to grab the explicitly defined metrics from the\n * font face first. If the font face does not have metrics defined, it will\n * attempt to calculate the metrics using the browser's measureText method.\n *\n * If the browser does not support the font metrics API, it will use some\n * default values.\n *\n * @param context\n * @param fontFace\n * @param fontSize\n * @returns\n */\nexport function getWebFontMetrics(context, fontFace, fontSize) {\n    if (fontFace.metrics) {\n        return fontFace.metrics;\n    }\n    // If the font face doesn't have metrics defined, we fallback to using the\n    // browser's measureText method to calculate take a best guess at the font\n    // actual font's metrics.\n    // - fontBoundingBox[Ascent|Descent] is the best estimate but only supported\n    //   in Chrome 87+ (2020), Firefox 116+ (2023), and Safari 11.1+ (2018).\n    //   - It is an estimate as it can vary between browsers.\n    // - actualBoundingBox[Ascent|Descent] is less accurate and supported in\n    //   Chrome 77+ (2019), Firefox 74+ (2020), and Safari 11.1+ (2018).\n    // - If neither are supported, we'll use some default values which will\n    //   get text on the screen but likely not be great.\n    // NOTE: It's been decided not to rely on fontBoundingBox[Ascent|Descent]\n    // as it's browser support is limited and it also tends to produce higher than\n    // expected values. It is instead HIGHLY RECOMMENDED that developers provide\n    // explicit metrics in the font face definition.\n    const browserMetrics = context.measureText('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz');\n    console.warn(`Font metrics not provided for Canvas Web font ${fontFace.fontFamily}. ` +\n        'Using fallback values. It is HIGHLY recommended you use the latest ' +\n        'version of the Lightning 3 `msdf-generator` tool to extract the default ' +\n        'metrics for the font and provide them in the Canvas Web font definition.');\n    let metrics;\n    if (browserMetrics.actualBoundingBoxDescent &&\n        browserMetrics.actualBoundingBoxAscent) {\n        metrics = {\n            ascender: browserMetrics.actualBoundingBoxAscent / fontSize,\n            descender: -browserMetrics.actualBoundingBoxDescent / fontSize,\n            lineGap: 0.2,\n        };\n    }\n    else {\n        // If the browser doesn't support the font metrics API, we'll use some\n        // default values.\n        metrics = {\n            ascender: 0.8,\n            descender: -0.2,\n            lineGap: 0.2,\n        };\n    }\n    // Save the calculated metrics to the font face for future use.\n    fontFace.metrics = metrics;\n    return metrics;\n}\n/**\n * Applies newlines to a string to have it optimally fit into the horizontal\n * bounds set by the Text object's wordWrapWidth property.\n *\n * @param context\n * @param text\n * @param wordWrapWidth\n * @param letterSpacing\n * @param indent\n */\nexport function wrapText(context, text, wordWrapWidth, letterSpacing, indent) {\n    // Greedy wrapping algorithm that will wrap words as the line grows longer.\n    // than its horizontal bounds.\n    const spaceRegex = / |\\u200B/g;\n    const lines = text.split(/\\r?\\n/g);\n    let allLines = [];\n    const realNewlines = [];\n    for (let i = 0; i < lines.length; i++) {\n        const resultLines = [];\n        let result = '';\n        let spaceLeft = wordWrapWidth - indent;\n        const words = lines[i].split(spaceRegex);\n        const spaces = lines[i].match(spaceRegex) || [];\n        for (let j = 0; j < words.length; j++) {\n            const space = spaces[j - 1] || '';\n            const word = words[j];\n            const wordWidth = measureText(context, word, letterSpacing);\n            const wordWidthWithSpace = wordWidth + measureText(context, space, letterSpacing);\n            if (j === 0 || wordWidthWithSpace > spaceLeft) {\n                // Skip printing the newline if it's the first word of the line that is.\n                // greater than the word wrap width.\n                if (j > 0) {\n                    resultLines.push(result);\n                    result = '';\n                }\n                result += word;\n                spaceLeft = wordWrapWidth - wordWidth - (j === 0 ? indent : 0);\n            }\n            else {\n                spaceLeft -= wordWidthWithSpace;\n                result += space + word;\n            }\n        }\n        resultLines.push(result);\n        result = '';\n        allLines = allLines.concat(resultLines);\n        if (i < lines.length - 1) {\n            realNewlines.push(allLines.length);\n        }\n    }\n    return { l: allLines, n: realNewlines };\n}\n//# sourceMappingURL=TextTextureRendererUtils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { EventEmitter } from '../../../common/EventEmitter.js';\nimport { assertTruthy } from '../../../utils.js';\nimport { getNormalizedRgbaComponents, getNormalizedAlphaComponent, } from '../../lib/utils.js';\nimport { TrFontManager } from '../TrFontManager.js';\nimport { WebTrFontFace } from '../font-face-types/WebTrFontFace.js';\nimport { LightningTextTextureRenderer, } from './LightningTextTextureRenderer.js';\nimport { TextRenderer, } from './TextRenderer.js';\nconst resolvedGlobal = typeof self === 'undefined' ? globalThis : self;\n/**\n * Global font set regardless of if run in the main thread or a web worker\n */\nconst globalFontSet = (resolvedGlobal.document?.fonts ||\n    resolvedGlobal.fonts);\nfunction getFontCssString(props) {\n    const { fontFamily, fontStyle, fontWeight, fontStretch, fontSize } = props;\n    return [fontStyle, fontWeight, fontStretch, `${fontSize}px`, fontFamily].join(' ');\n}\nexport class CanvasTextRenderer extends TextRenderer {\n    canvas;\n    context;\n    /**\n     * Font family map used to store web font faces that were added to the\n     * canvas text renderer.\n     */\n    fontFamilies = {};\n    fontFamilyArray = [this.fontFamilies];\n    constructor(stage) {\n        super(stage);\n        if (typeof OffscreenCanvas !== 'undefined') {\n            this.canvas = new OffscreenCanvas(0, 0);\n        }\n        else {\n            this.canvas = document.createElement('canvas');\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n        let context = this.canvas.getContext('2d', {\n            willReadFrequently: true,\n        });\n        if (!context) {\n            // A browser may appear to support OffscreenCanvas but not actually support the Canvas '2d' context\n            // Here we try getting the context again after falling back to an HTMLCanvasElement.\n            // See: https://github.com/lightning-js/renderer/issues/26#issuecomment-1750438486\n            this.canvas = document.createElement('canvas');\n            context = this.canvas.getContext('2d', {\n                willReadFrequently: true,\n            });\n        }\n        assertTruthy(context);\n        this.context = context;\n        // Install the default 'san-serif' font face\n        this.addFontFace(new WebTrFontFace({\n            fontFamily: 'sans-serif',\n            descriptors: {},\n            fontUrl: '',\n        }));\n    }\n    //#region Overrides\n    getPropertySetters() {\n        return {\n            fontFamily: (state, value) => {\n                state.props.fontFamily = value;\n                state.fontInfo = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontWeight: (state, value) => {\n                state.props.fontWeight = value;\n                state.fontInfo = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontStyle: (state, value) => {\n                state.props.fontStyle = value;\n                state.fontInfo = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontStretch: (state, value) => {\n                state.props.fontStretch = value;\n                state.fontInfo = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            fontSize: (state, value) => {\n                state.props.fontSize = value;\n                state.fontInfo = undefined;\n                this.invalidateLayoutCache(state);\n            },\n            text: (state, value) => {\n                state.props.text = value;\n                this.invalidateLayoutCache(state);\n            },\n            textAlign: (state, value) => {\n                state.props.textAlign = value;\n                this.invalidateLayoutCache(state);\n            },\n            color: (state, value) => {\n                state.props.color = value;\n                this.invalidateLayoutCache(state);\n            },\n            x: (state, value) => {\n                state.props.x = value;\n            },\n            y: (state, value) => {\n                state.props.y = value;\n            },\n            contain: (state, value) => {\n                state.props.contain = value;\n                this.invalidateLayoutCache(state);\n            },\n            width: (state, value) => {\n                state.props.width = value;\n                // Only invalidate layout cache if we're containing in the horizontal direction\n                if (state.props.contain !== 'none') {\n                    this.invalidateLayoutCache(state);\n                }\n            },\n            height: (state, value) => {\n                state.props.height = value;\n                // Only invalidate layout cache if we're containing in the vertical direction\n                if (state.props.contain === 'both') {\n                    this.invalidateLayoutCache(state);\n                }\n            },\n            offsetY: (state, value) => {\n                state.props.offsetY = value;\n                this.invalidateLayoutCache(state);\n            },\n            scrollY: (state, value) => {\n                state.props.scrollY = value;\n            },\n            letterSpacing: (state, value) => {\n                state.props.letterSpacing = value;\n                this.invalidateLayoutCache(state);\n            },\n            lineHeight: (state, value) => {\n                state.props.lineHeight = value;\n                this.invalidateLayoutCache(state);\n            },\n            maxLines: (state, value) => {\n                state.props.maxLines = value;\n                this.invalidateLayoutCache(state);\n            },\n            textBaseline: (state, value) => {\n                state.props.textBaseline = value;\n                this.invalidateLayoutCache(state);\n            },\n            verticalAlign: (state, value) => {\n                state.props.verticalAlign = value;\n                this.invalidateLayoutCache(state);\n            },\n            overflowSuffix: (state, value) => {\n                state.props.overflowSuffix = value;\n                this.invalidateLayoutCache(state);\n            },\n        };\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    canRenderFont(props) {\n        // The canvas renderer can render any font because it automatically\n        // falls back to system fonts. The CanvasTextRenderer should be\n        // checked last if other renderers are preferred.\n        return true;\n    }\n    isFontFaceSupported(fontFace) {\n        return fontFace instanceof WebTrFontFace;\n    }\n    addFontFace(fontFace) {\n        // Make sure the font face is an Canvas font face (it should have already passed\n        // the `isFontFaceSupported` check)\n        assertTruthy(fontFace instanceof WebTrFontFace);\n        // Add the font face to the document\n        // Except for the 'sans-serif' font family, which the Renderer provides\n        // as a special default fallback.\n        if (fontFace.fontFamily !== 'sans-serif') {\n            // @ts-expect-error `add()` method should be available from a FontFaceSet\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n            globalFontSet.add(fontFace.fontFace);\n        }\n        const { fontFamilies } = this;\n        const familyName = fontFace.fontFace.family;\n        let faceSet = fontFamilies[familyName];\n        if (!faceSet) {\n            faceSet = new Set();\n            fontFamilies[familyName] = faceSet;\n        }\n        faceSet.add(fontFace);\n    }\n    createState(props, node) {\n        return {\n            node,\n            props,\n            status: 'initialState',\n            updateScheduled: false,\n            emitter: new EventEmitter(),\n            textureNode: undefined,\n            lightning2TextRenderer: new LightningTextTextureRenderer(this.canvas, this.context),\n            renderInfo: undefined,\n            forceFullLayoutCalc: false,\n            textW: 0,\n            textH: 0,\n            fontInfo: undefined,\n            isRenderable: false,\n            debugData: {\n                updateCount: 0,\n                layoutCount: 0,\n                drawCount: 0,\n                lastLayoutNumCharacters: 0,\n                layoutSum: 0,\n                drawSum: 0,\n                bufferSize: 0,\n            },\n        };\n    }\n    updateState(state) {\n        // On the first update call we need to set the status to loading\n        if (state.status === 'initialState') {\n            this.setStatus(state, 'loading');\n            // check if we're on screen\n            // if (this.isValidOnScreen(state) === true) {\n            //   this.setStatus(state, 'loading');\n            // }\n        }\n        if (state.status === 'loaded') {\n            // If we're loaded, we don't need to do anything\n            return;\n        }\n        // If fontInfo is invalid, we need to establish it\n        if (!state.fontInfo) {\n            return this.loadFont(state);\n        }\n        // If we're waiting for a font face to load, don't render anything\n        if (!state.fontInfo.loaded) {\n            return;\n        }\n        if (!state.renderInfo) {\n            state.renderInfo = this.calculateRenderInfo(state);\n            state.textH = state.renderInfo.lineHeight * state.renderInfo.lines.length;\n            state.textW = state.renderInfo.width;\n            this.renderSingleCanvasPage(state);\n        }\n        // handle scrollable text !!!\n        // if (state.isScrollable === true) {\n        //   return this.renderScrollableCanvasPages(state);\n        // }\n        // handle single page text\n    }\n    renderSingleCanvasPage(state) {\n        assertTruthy(state.renderInfo);\n        const node = state.node;\n        const texture = this.stage.txManager.loadTexture('ImageTexture', {\n            src: function (lightning2TextRenderer, renderInfo) {\n                // load the canvas texture\n                assertTruthy(renderInfo);\n                lightning2TextRenderer.draw(renderInfo, {\n                    lines: renderInfo.lines,\n                    lineWidths: renderInfo.lineWidths,\n                });\n                if (this.canvas.width === 0 || this.canvas.height === 0) {\n                    return null;\n                }\n                return this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n            }.bind(this, state.lightning2TextRenderer, state.renderInfo),\n        });\n        if (state.textureNode) {\n            // Use the existing texture node\n            state.textureNode.texture = texture;\n        }\n        else {\n            // Create a new texture node\n            const textureNode = this.stage.createNode({\n                parent: node,\n                texture,\n                autosize: true,\n                // The alpha channel of the color is ignored when rasterizing the text\n                // texture so we need to pass it directly to the texture node.\n                alpha: getNormalizedAlphaComponent(state.props.color),\n            });\n            state.textureNode = textureNode;\n        }\n        this.setStatus(state, 'loaded');\n    }\n    loadFont = (state) => {\n        const cssString = getFontCssString(state.props);\n        const trFontFace = TrFontManager.resolveFontFace(this.fontFamilyArray, state.props);\n        assertTruthy(trFontFace, `Could not resolve font face for ${cssString}`);\n        state.fontInfo = {\n            fontFace: trFontFace,\n            cssString: cssString,\n            // TODO: For efficiency we would use this here but it's not reliable on WPE -> document.fonts.check(cssString),\n            loaded: false,\n        };\n        // If font is not loaded, set up a handler to update the font info when the font loads\n        if (!state.fontInfo.loaded) {\n            globalFontSet\n                .load(cssString)\n                .then(this.onFontLoaded.bind(this, state, cssString))\n                .catch(this.onFontLoadError.bind(this, state, cssString));\n            return;\n        }\n    };\n    calculateRenderInfo(state) {\n        state.lightning2TextRenderer.settings = {\n            text: state.props.text,\n            textAlign: state.props.textAlign,\n            fontFamily: state.props.fontFamily,\n            trFontFace: state.fontInfo?.fontFace,\n            fontSize: state.props.fontSize,\n            fontStyle: [\n                state.props.fontStretch,\n                state.props.fontStyle,\n                state.props.fontWeight,\n            ].join(' '),\n            textColor: getNormalizedRgbaComponents(state.props.color),\n            offsetY: state.props.offsetY,\n            wordWrap: state.props.contain !== 'none',\n            wordWrapWidth: state.props.contain === 'none' ? undefined : state.props.width,\n            letterSpacing: state.props.letterSpacing,\n            lineHeight: state.props.lineHeight ?? null,\n            maxLines: state.props.maxLines,\n            maxHeight: state.props.contain === 'both'\n                ? state.props.height - state.props.offsetY\n                : null,\n            textBaseline: state.props.textBaseline,\n            verticalAlign: state.props.verticalAlign,\n            overflowSuffix: state.props.overflowSuffix,\n            w: state.props.contain !== 'none' ? state.props.width : undefined,\n        };\n        state.renderInfo = state.lightning2TextRenderer.calculateRenderInfo();\n        return state.renderInfo;\n    }\n    renderQuads() {\n        // Do nothing. The renderer will render the child node(s) that were created\n        // in the state update.\n        return;\n    }\n    destroyState(state) {\n        if (state.status === 'destroyed') {\n            return;\n        }\n        super.destroyState(state);\n        if (state.textureNode) {\n            state.textureNode.destroy();\n            delete state.textureNode;\n        }\n        delete state.renderInfo;\n    }\n    //#endregion Overrides\n    /**\n     * Invalidate the layout cache stored in the state. This will cause the text\n     * to be re-rendered on the next update.\n     *\n     * @remarks\n     * This also invalidates the visible window cache.\n     *\n     * @param state\n     */\n    invalidateLayoutCache(state) {\n        state.renderInfo = undefined;\n        this.setStatus(state, 'loading');\n        this.scheduleUpdateState(state);\n    }\n    onFontLoaded(state, cssString) {\n        if (cssString !== state.fontInfo?.cssString || !state.fontInfo) {\n            return;\n        }\n        state.fontInfo.loaded = true;\n        this.scheduleUpdateState(state);\n    }\n    onFontLoadError(state, cssString, error) {\n        if (cssString !== state.fontInfo?.cssString || !state.fontInfo) {\n            return;\n        }\n        // Font didn't actually load, but we'll log the error and mark it as loaded\n        // because the browser can still render with a fallback font.\n        state.fontInfo.loaded = true;\n        console.error(`CanvasTextRenderer: Error loading font '${state.fontInfo.cssString}'`, error);\n        this.scheduleUpdateState(state);\n    }\n}\n//# sourceMappingURL=CanvasTextRenderer.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Class that keeps track of the invocations of Context methods when\n * the `enableContextSpy` renderer option is enabled.\n */\nexport class ContextSpy {\n    data = {};\n    reset() {\n        this.data = {};\n    }\n    increment(name) {\n        if (!this.data[name]) {\n            this.data[name] = 0;\n        }\n        this.data[name]++;\n    }\n    getData() {\n        return { ...this.data };\n    }\n}\n//# sourceMappingURL=ContextSpy.js.map","import { bytesToMb } from './utils.js';\n/**\n * LRU (Least Recently Used) style memory manager for textures\n *\n * @remarks\n * This class is responsible for managing the memory usage of textures\n * in the Renderer. It keeps track of the memory used by each texture\n * and triggers a cleanup when the memory usage exceeds a critical\n * threshold (`criticalThreshold`).\n *\n * The cleanup process will free up non-renderable textures until the\n * memory usage is below a target threshold (`targetThresholdLevel`).\n *\n * The memory manager's clean up process will also be triggered when the\n * scene is idle for a certain amount of time (`cleanupInterval`).\n */\nexport class TextureMemoryManager {\n    stage;\n    memUsed = 0;\n    loadedTextures = new Map();\n    criticalThreshold;\n    targetThreshold;\n    cleanupInterval;\n    debugLogging;\n    lastCleanupTime = 0;\n    criticalCleanupRequested = false;\n    /**\n     * The current frame time in milliseconds\n     *\n     * @remarks\n     * This is used to determine when to perform Idle Texture Cleanups.\n     *\n     * Set by stage via `updateFrameTime` method.\n     */\n    frameTime = 0;\n    constructor(stage, settings) {\n        this.stage = stage;\n        const { criticalThreshold } = settings;\n        this.criticalThreshold = Math.round(criticalThreshold);\n        const targetFraction = Math.max(0, Math.min(1, settings.targetThresholdLevel));\n        this.targetThreshold = Math.round(criticalThreshold * targetFraction);\n        this.cleanupInterval = settings.cleanupInterval;\n        this.debugLogging = settings.debugLogging;\n        if (settings.debugLogging) {\n            let lastMemUse = 0;\n            setInterval(() => {\n                if (lastMemUse !== this.memUsed) {\n                    lastMemUse = this.memUsed;\n                    console.log(`[TextureMemoryManager] Memory used: ${bytesToMb(this.memUsed)} mb / ${bytesToMb(this.criticalThreshold)} mb (${((this.memUsed / this.criticalThreshold) *\n                        100).toFixed(1)}%)`);\n                }\n            }, 1000);\n        }\n        // If the threshold is 0, we disable the memory manager by replacing the\n        // setTextureMemUse method with a no-op function.\n        if (criticalThreshold === 0) {\n            // eslint-disable-next-line @typescript-eslint/no-empty-function\n            this.setTextureMemUse = () => { };\n        }\n    }\n    setTextureMemUse(texture, byteSize) {\n        if (this.loadedTextures.has(texture)) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.memUsed -= this.loadedTextures.get(texture);\n        }\n        if (byteSize === 0) {\n            this.loadedTextures.delete(texture);\n            return;\n        }\n        else {\n            this.memUsed += byteSize;\n            this.loadedTextures.set(texture, byteSize);\n        }\n        if (this.memUsed > this.criticalThreshold) {\n            this.criticalCleanupRequested = true;\n        }\n    }\n    checkCleanup() {\n        return (this.criticalCleanupRequested ||\n            (this.memUsed > this.targetThreshold &&\n                this.frameTime - this.lastCleanupTime >= this.cleanupInterval));\n    }\n    cleanup() {\n        const critical = this.criticalCleanupRequested;\n        this.lastCleanupTime = this.frameTime;\n        this.criticalCleanupRequested = false;\n        if (critical) {\n            this.stage.queueFrameEvent('criticalCleanup', {\n                memUsed: this.memUsed,\n                criticalThreshold: this.criticalThreshold,\n            });\n        }\n        if (this.debugLogging) {\n            console.log(`[TextureMemoryManager] Cleaning up textures. Critical: ${critical}`);\n        }\n        /**\n         * Sort the loaded textures by renderability, then by last touch time.\n         *\n         * This will ensure that the array is ordered by the following:\n         * - Non-renderable textures, starting at the least recently rendered\n         * - Renderable textures, starting at the least recently rendered\n         */\n        const textures = [...this.loadedTextures.keys()].sort((textureA, textureB) => {\n            const txARenderable = textureA.renderable;\n            const txBRenderable = textureB.renderable;\n            if (txARenderable === txBRenderable) {\n                return (textureA.lastRenderableChangeTime -\n                    textureB.lastRenderableChangeTime);\n            }\n            else if (txARenderable) {\n                return 1;\n            }\n            else if (txBRenderable) {\n                return -1;\n            }\n            return 0;\n        });\n        // Free non-renderable textures until we reach the target threshold\n        const memTarget = this.targetThreshold;\n        const txManager = this.stage.txManager;\n        for (const texture of textures) {\n            if (texture.renderable) {\n                // Stop at the first renderable texture (The rest are renderable because of the sort above)\n                // We don't want to free renderable textures because they will just likely be reloaded in the next frame\n                break;\n            }\n            texture.ctxTexture.free();\n            txManager.removeTextureFromCache(texture);\n            if (this.memUsed <= memTarget) {\n                // Stop once we've freed enough textures to reach under the target threshold\n                break;\n            }\n        }\n        if (this.memUsed >= this.criticalThreshold) {\n            this.stage.queueFrameEvent('criticalCleanupFailed', {\n                memUsed: this.memUsed,\n                criticalThreshold: this.criticalThreshold,\n            });\n            console.warn(`[TextureMemoryManager] Memory usage above critical threshold after cleanup: ${this.memUsed}`);\n        }\n    }\n    /**\n     * Get the current texture memory usage information\n     *\n     * @remarks\n     * This method is for debugging purposes and returns information about the\n     * current memory usage of the textures in the Renderer.\n     */\n    getMemoryInfo() {\n        let renderableTexturesLoaded = 0;\n        const renderableMemUsed = [...this.loadedTextures.keys()].reduce(\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        (acc, texture) => {\n            renderableTexturesLoaded += texture.renderable ? 1 : 0;\n            return (acc + (texture.renderable ? this.loadedTextures.get(texture) : 0));\n        }, 0);\n        return {\n            criticalThreshold: this.criticalThreshold,\n            targetThreshold: this.targetThreshold,\n            renderableMemUsed,\n            memUsed: this.memUsed,\n            renderableTexturesLoaded,\n            loadedTextures: this.loadedTextures.size,\n        };\n    }\n}\n//# sourceMappingURL=TextureMemoryManager.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst WHITE = {\n    isWhite: true,\n    a: 1,\n    r: 0xff,\n    g: 0xff,\n    b: 0xff,\n};\n/**\n * Extract color components\n */\nexport function parseColor(abgr) {\n    if (abgr === 0xffffffff) {\n        return WHITE;\n    }\n    const a = ((abgr >>> 24) & 0xff) / 255;\n    const b = (abgr >>> 16) & 0xff & 0xff;\n    const g = (abgr >>> 8) & 0xff & 0xff;\n    const r = abgr & 0xff & 0xff;\n    return { isWhite: false, a, r, g, b };\n}\n/**\n * Format a parsed color into a rgba CSS color\n */\nexport function formatRgba({ a, r, g, b }) {\n    return `rgba(${r},${g},${b},${a})`;\n}\n//# sourceMappingURL=ColorUtils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assertTruthy } from '../../../utils.js';\nimport { CoreContextTexture } from '../CoreContextTexture.js';\nimport { formatRgba } from './internal/ColorUtils.js';\nexport class CanvasCoreTexture extends CoreContextTexture {\n    image;\n    tintCache;\n    load() {\n        if (this.textureSource.state !== 'freed') {\n            return;\n        }\n        this.textureSource.setState('loading');\n        this.onLoadRequest()\n            .then((size) => {\n            this.textureSource.setState('loaded', size);\n            this.updateMemSize();\n        })\n            .catch((err) => {\n            this.textureSource.setState('failed', err);\n        });\n    }\n    free() {\n        this.image = undefined;\n        this.tintCache = undefined;\n        this.textureSource.setState('freed');\n        this.setTextureMemUse(0);\n    }\n    updateMemSize() {\n        // Counting memory usage for:\n        // - main image\n        // - tinted image\n        const mult = this.tintCache ? 8 : 4;\n        if (this.textureSource.dimensions) {\n            const { width, height } = this.textureSource.dimensions;\n            this.setTextureMemUse(width * height * mult);\n        }\n    }\n    hasImage() {\n        return this.image !== undefined;\n    }\n    getImage(color) {\n        const image = this.image;\n        assertTruthy(image, 'Attempt to get unloaded image texture');\n        if (color.isWhite) {\n            if (this.tintCache) {\n                this.tintCache = undefined;\n                this.updateMemSize();\n            }\n            return image;\n        }\n        const key = formatRgba(color);\n        if (this.tintCache?.key === key) {\n            return this.tintCache.image;\n        }\n        const tintedImage = this.tintTexture(image, key);\n        this.tintCache = {\n            key,\n            image: tintedImage,\n        };\n        this.updateMemSize();\n        return tintedImage;\n    }\n    tintTexture(source, color) {\n        const { width, height } = source;\n        const canvas = document.createElement('canvas');\n        canvas.width = width;\n        canvas.height = height;\n        const ctx = canvas.getContext('2d');\n        if (ctx) {\n            // fill with target color\n            ctx.fillStyle = color;\n            ctx.globalCompositeOperation = 'copy';\n            ctx.fillRect(0, 0, width, height);\n            // multiply with image, resulting in non-transparent tinted image\n            ctx.globalCompositeOperation = 'multiply';\n            ctx.drawImage(source, 0, 0, width, height, 0, 0, width, height);\n            // apply original image alpha\n            ctx.globalCompositeOperation = 'destination-in';\n            ctx.drawImage(source, 0, 0, width, height, 0, 0, width, height);\n        }\n        return canvas;\n    }\n    async onLoadRequest() {\n        const { data } = await this.textureSource.getTextureData();\n        // TODO: canvas from text renderer should be able to provide the canvas directly\n        // instead of having to re-draw it into a new canvas...\n        if (data instanceof ImageData) {\n            const canvas = document.createElement('canvas');\n            canvas.width = data.width;\n            canvas.height = data.height;\n            const ctx = canvas.getContext('2d');\n            if (ctx)\n                ctx.putImageData(data, 0, 0);\n            this.image = canvas;\n            return { width: data.width, height: data.height };\n        }\n        else if (data instanceof ImageBitmap) {\n            this.image = data;\n            return { width: data.width, height: data.height };\n        }\n        return { width: 0, height: 0 };\n    }\n}\n//# sourceMappingURL=CanvasCoreTexture.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getRgbaComponents } from '../../lib/utils.js';\nimport { SubTexture } from '../../textures/SubTexture.js';\nimport { CoreRenderer, } from '../CoreRenderer.js';\nimport { CanvasCoreTexture } from './CanvasCoreTexture.js';\nimport { getRadius } from './internal/C2DShaderUtils.js';\nimport { formatRgba, parseColor, } from './internal/ColorUtils.js';\nimport { UnsupportedShader } from './shaders/UnsupportedShader.js';\nexport class CanvasCoreRenderer extends CoreRenderer {\n    context;\n    canvas;\n    pixelRatio;\n    clearColor;\n    renderToTextureActive = false;\n    activeRttNode = null;\n    defShaderCtr;\n    constructor(options) {\n        super(options);\n        this.mode = 'canvas';\n        this.shManager.renderer = this;\n        const { canvas, pixelRatio, clearColor } = options;\n        this.canvas = canvas;\n        this.context = canvas.getContext('2d');\n        this.pixelRatio = pixelRatio;\n        this.clearColor = clearColor ? getRgbaComponents(clearColor) : undefined;\n        // Stub for default shader controller since the canvas renderer does not\n        // (really) support the concept of a shader (yet)\n        this.defShaderCtr = {\n            type: 'DefaultShader',\n            props: {},\n            shader: new UnsupportedShader('DefaultShader'),\n            getResolvedProps: () => () => {\n                return {};\n            },\n        };\n    }\n    reset() {\n        // eslint-disable-next-line no-self-assign\n        this.canvas.width = this.canvas.width; // quick reset canvas\n        const ctx = this.context;\n        if (this.clearColor) {\n            const [r, g, b, a] = this.clearColor;\n            ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${a / 255})`;\n            ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n        }\n        ctx.scale(this.pixelRatio, this.pixelRatio);\n    }\n    render() {\n        // noop\n    }\n    addQuad(quad) {\n        const ctx = this.context;\n        const { tx, ty, width, height, alpha, colorTl, colorTr, colorBr, ta, tb, tc, td, clippingRect, } = quad;\n        let texture = quad.texture;\n        let ctxTexture = undefined;\n        let frame;\n        if (texture) {\n            if (texture instanceof SubTexture) {\n                frame = texture.props;\n                texture = texture.parentTexture;\n            }\n            ctxTexture = texture.ctxTexture;\n            if (texture.state === 'freed') {\n                ctxTexture.load();\n                return;\n            }\n            if (texture.state !== 'loaded' || !ctxTexture.hasImage()) {\n                return;\n            }\n        }\n        const color = parseColor(colorTl);\n        const hasTransform = ta !== 1;\n        const hasClipping = clippingRect.width !== 0 && clippingRect.height !== 0;\n        const hasGradient = colorTl !== colorTr || colorTl !== colorBr;\n        const radius = quad.shader ? getRadius(quad) : 0;\n        if (hasTransform || hasClipping || radius) {\n            ctx.save();\n        }\n        if (hasClipping) {\n            const path = new Path2D();\n            const { x, y, width, height } = clippingRect;\n            path.rect(x, y, width, height);\n            ctx.clip(path);\n        }\n        if (hasTransform) {\n            // Quad transform:\n            // | ta tb tx |\n            // | tc td ty |\n            // | 0  0  1  |\n            // C2D transform:\n            // | a  c  e  |\n            // | b  d  f  |\n            // | 0  0  1  |\n            const scale = this.pixelRatio;\n            ctx.setTransform(ta, tc, tb, td, tx * scale, ty * scale);\n            ctx.scale(scale, scale);\n            ctx.translate(-tx, -ty);\n        }\n        if (radius) {\n            const path = new Path2D();\n            path.roundRect(tx, ty, width, height, radius);\n            ctx.clip(path);\n        }\n        if (ctxTexture) {\n            const image = ctxTexture.getImage(color);\n            ctx.globalAlpha = alpha;\n            if (frame) {\n                ctx.drawImage(image, frame.x, frame.y, frame.width, frame.height, tx, ty, width, height);\n            }\n            else {\n                ctx.drawImage(image, tx, ty, width, height);\n            }\n            ctx.globalAlpha = 1;\n        }\n        else if (hasGradient) {\n            let endX = tx;\n            let endY = ty;\n            let endColor;\n            if (colorTl === colorTr) {\n                // vertical\n                endX = tx;\n                endY = ty + height;\n                endColor = parseColor(colorBr);\n            }\n            else {\n                // horizontal\n                endX = tx + width;\n                endY = ty;\n                endColor = parseColor(colorTr);\n            }\n            const gradient = ctx.createLinearGradient(tx, ty, endX, endY);\n            gradient.addColorStop(0, formatRgba(color));\n            gradient.addColorStop(1, formatRgba(endColor));\n            ctx.fillStyle = gradient;\n            ctx.fillRect(tx, ty, width, height);\n        }\n        else {\n            ctx.fillStyle = formatRgba(color);\n            ctx.fillRect(tx, ty, width, height);\n        }\n        if (hasTransform || hasClipping || radius) {\n            ctx.restore();\n        }\n    }\n    createCtxTexture(textureSource) {\n        return new CanvasCoreTexture(this.txMemManager, textureSource);\n    }\n    getShaderManager() {\n        return this.shManager;\n    }\n    getDefShaderCtr() {\n        return this.defShaderCtr;\n    }\n    renderRTTNodes() {\n        // noop\n    }\n    removeRTTNode(node) {\n        // noop\n    }\n    renderToTexture(node) {\n        // noop\n    }\n}\n//# sourceMappingURL=CanvasCoreRenderer.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ROUNDED_RECTANGLE_SHADER_TYPE, UnsupportedShader, } from '../shaders/UnsupportedShader.js';\n/**\n * Extract `RoundedRectangle` shader radius to apply as a clipping\n */\nexport function getRadius(quad) {\n    if (quad.shader instanceof UnsupportedShader) {\n        const shType = quad.shader.shType;\n        if (shType === ROUNDED_RECTANGLE_SHADER_TYPE) {\n            return quad.shaderProps?.radius ?? 0;\n        }\n    }\n    return 0;\n}\n//# sourceMappingURL=C2DShaderUtils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { CoreNode, UpdateType } from './CoreNode.js';\nimport { assertTruthy } from '../utils.js';\nimport { Matrix3d } from './lib/Matrix3d.js';\n/**\n * An CoreNode in the Renderer scene graph that renders text.\n *\n * @remarks\n * A Text Node is the second graphical building block of the Renderer scene\n * graph. It renders text using a specific text renderer that is automatically\n * chosen based on the font requested and what type of fonts are installed\n * into an app.\n *\n * The text renderer can be overridden by setting the `textRendererOverride`\n *\n * The `texture` and `shader` properties are managed by loaded text renderer and\n * should not be set directly.\n *\n * For non-text rendering, see {@link CoreNode}.\n */\nexport class CoreTextNode extends CoreNode {\n    textRenderer;\n    trState;\n    _textRendererOverride = null;\n    constructor(stage, props) {\n        super(stage, props);\n        this._textRendererOverride = props.textRendererOverride;\n        const { resolvedTextRenderer, textRendererState } = this.resolveTextRendererAndState({\n            x: this.absX,\n            y: this.absY,\n            width: props.width,\n            height: props.height,\n            textAlign: props.textAlign,\n            color: props.color,\n            zIndex: props.zIndex,\n            contain: props.contain,\n            scrollable: props.scrollable,\n            scrollY: props.scrollY,\n            offsetY: props.offsetY,\n            letterSpacing: props.letterSpacing,\n            debug: props.debug,\n            fontFamily: props.fontFamily,\n            fontSize: props.fontSize,\n            fontStretch: props.fontStretch,\n            fontStyle: props.fontStyle,\n            fontWeight: props.fontWeight,\n            text: props.text,\n            lineHeight: props.lineHeight,\n            maxLines: props.maxLines,\n            textBaseline: props.textBaseline,\n            verticalAlign: props.verticalAlign,\n            overflowSuffix: props.overflowSuffix,\n        });\n        this.textRenderer = resolvedTextRenderer;\n        this.trState = textRendererState;\n    }\n    onTextLoaded = () => {\n        const { contain } = this;\n        const setWidth = this.trState.props.width;\n        const setHeight = this.trState.props.height;\n        const calcWidth = this.trState.textW || 0;\n        const calcHeight = this.trState.textH || 0;\n        if (contain === 'both') {\n            this.props.width = setWidth;\n            this.props.height = setHeight;\n        }\n        else if (contain === 'width') {\n            this.props.width = setWidth;\n            this.props.height = calcHeight;\n        }\n        else if (contain === 'none') {\n            this.props.width = calcWidth;\n            this.props.height = calcHeight;\n        }\n        this.updateLocalTransform();\n        // Incase the RAF loop has been stopped already before text was loaded,\n        // we request a render so it can be drawn.\n        this.stage.requestRender();\n        this.emit('loaded', {\n            type: 'text',\n            dimensions: {\n                width: this.trState.textW || 0,\n                height: this.trState.textH || 0,\n            },\n        });\n    };\n    onTextFailed = (target, error) => {\n        this.emit('failed', {\n            type: 'text',\n            error,\n        });\n    };\n    get width() {\n        return this.props.width;\n    }\n    set width(value) {\n        this.props.width = value;\n        this.textRenderer.set.width(this.trState, value);\n        // If not containing, we must update the local transform to account for the\n        // new width\n        if (this.contain === 'none') {\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get height() {\n        return this.props.height;\n    }\n    set height(value) {\n        this.props.height = value;\n        this.textRenderer.set.height(this.trState, value);\n        // If not containing in the horizontal direction, we must update the local\n        // transform to account for the new height\n        if (this.contain !== 'both') {\n            this.setUpdateType(UpdateType.Local);\n        }\n    }\n    get color() {\n        return this.trState.props.color;\n    }\n    set color(value) {\n        this.textRenderer.set.color(this.trState, value);\n    }\n    get text() {\n        return this.trState.props.text;\n    }\n    set text(value) {\n        this.textRenderer.set.text(this.trState, value);\n    }\n    get textRendererOverride() {\n        return this._textRendererOverride;\n    }\n    set textRendererOverride(value) {\n        this._textRendererOverride = value;\n        this.textRenderer.destroyState(this.trState);\n        const { resolvedTextRenderer, textRendererState } = this.resolveTextRendererAndState(this.trState.props);\n        this.textRenderer = resolvedTextRenderer;\n        this.trState = textRendererState;\n    }\n    get fontSize() {\n        return this.trState.props.fontSize;\n    }\n    set fontSize(value) {\n        this.textRenderer.set.fontSize(this.trState, value);\n    }\n    get fontFamily() {\n        return this.trState.props.fontFamily;\n    }\n    set fontFamily(value) {\n        this.textRenderer.set.fontFamily(this.trState, value);\n    }\n    get fontStretch() {\n        return this.trState.props.fontStretch;\n    }\n    set fontStretch(value) {\n        this.textRenderer.set.fontStretch(this.trState, value);\n    }\n    get fontStyle() {\n        return this.trState.props.fontStyle;\n    }\n    set fontStyle(value) {\n        this.textRenderer.set.fontStyle(this.trState, value);\n    }\n    get fontWeight() {\n        return this.trState.props.fontWeight;\n    }\n    set fontWeight(value) {\n        this.textRenderer.set.fontWeight(this.trState, value);\n    }\n    get textAlign() {\n        return this.trState.props.textAlign;\n    }\n    set textAlign(value) {\n        this.textRenderer.set.textAlign(this.trState, value);\n    }\n    get contain() {\n        return this.trState.props.contain;\n    }\n    set contain(value) {\n        this.textRenderer.set.contain(this.trState, value);\n    }\n    get scrollable() {\n        return this.trState.props.scrollable;\n    }\n    set scrollable(value) {\n        this.textRenderer.set.scrollable(this.trState, value);\n    }\n    get scrollY() {\n        return this.trState.props.scrollY;\n    }\n    set scrollY(value) {\n        this.textRenderer.set.scrollY(this.trState, value);\n    }\n    get offsetY() {\n        return this.trState.props.offsetY;\n    }\n    set offsetY(value) {\n        this.textRenderer.set.offsetY(this.trState, value);\n    }\n    get letterSpacing() {\n        return this.trState.props.letterSpacing;\n    }\n    set letterSpacing(value) {\n        this.textRenderer.set.letterSpacing(this.trState, value);\n    }\n    get lineHeight() {\n        return this.trState.props.lineHeight;\n    }\n    set lineHeight(value) {\n        if (this.textRenderer.set.lineHeight) {\n            this.textRenderer.set.lineHeight(this.trState, value);\n        }\n    }\n    get maxLines() {\n        return this.trState.props.maxLines;\n    }\n    set maxLines(value) {\n        if (this.textRenderer.set.maxLines) {\n            this.textRenderer.set.maxLines(this.trState, value);\n        }\n    }\n    get textBaseline() {\n        return this.trState.props.textBaseline;\n    }\n    set textBaseline(value) {\n        if (this.textRenderer.set.textBaseline) {\n            this.textRenderer.set.textBaseline(this.trState, value);\n        }\n    }\n    get verticalAlign() {\n        return this.trState.props.verticalAlign;\n    }\n    set verticalAlign(value) {\n        if (this.textRenderer.set.verticalAlign) {\n            this.textRenderer.set.verticalAlign(this.trState, value);\n        }\n    }\n    get overflowSuffix() {\n        return this.trState.props.overflowSuffix;\n    }\n    set overflowSuffix(value) {\n        if (this.textRenderer.set.overflowSuffix) {\n            this.textRenderer.set.overflowSuffix(this.trState, value);\n        }\n    }\n    get debug() {\n        return this.trState.props.debug;\n    }\n    set debug(value) {\n        this.textRenderer.set.debug(this.trState, value);\n    }\n    update(delta, parentClippingRect) {\n        super.update(delta, parentClippingRect);\n        assertTruthy(this.globalTransform);\n        // globalTransform is updated in super.update(delta)\n        this.textRenderer.set.x(this.trState, this.globalTransform.tx);\n        this.textRenderer.set.y(this.trState, this.globalTransform.ty);\n    }\n    checkRenderProps() {\n        if (this.trState.props.text !== '') {\n            return true;\n        }\n        return super.checkRenderProps();\n    }\n    onChangeIsRenderable(isRenderable) {\n        super.onChangeIsRenderable(isRenderable);\n        this.textRenderer.setIsRenderable(this.trState, isRenderable);\n    }\n    renderQuads(renderer) {\n        assertTruthy(this.globalTransform);\n        // If the text renderer does not support rendering quads, fallback to the\n        // default renderQuads method\n        if (!this.textRenderer.renderQuads) {\n            super.renderQuads(renderer);\n            return;\n        }\n        // If the text renderer does support rendering quads, use it...\n        // Prevent quad rendering if parent has a render texture\n        // and this node is not the render texture\n        if (this.parentHasRenderTexture) {\n            if (!renderer.renderToTextureActive) {\n                return;\n            }\n            // Prevent quad rendering if parent render texture is not the active render texture\n            if (this.parentRenderTexture !== renderer.activeRttNode) {\n                return;\n            }\n        }\n        if (this.parentHasRenderTexture && this.props.parent?.rtt) {\n            this.globalTransform = Matrix3d.identity();\n            if (this.localTransform) {\n                this.globalTransform.multiply(this.localTransform);\n            }\n        }\n        assertTruthy(this.globalTransform);\n        this.textRenderer.renderQuads(this.trState, this.globalTransform, this.clippingRect, this.worldAlpha, this.parentHasRenderTexture, this.framebufferDimensions);\n    }\n    /**\n     * Destroy the node and cleanup all resources\n     */\n    destroy() {\n        super.destroy();\n        this.textRenderer.destroyState(this.trState);\n    }\n    /**\n     * Resolve a text renderer and a new state based on the current text renderer props provided\n     * @param props\n     * @returns\n     */\n    resolveTextRendererAndState(props) {\n        const resolvedTextRenderer = this.stage.resolveTextRenderer(props, this._textRendererOverride);\n        const textRendererState = resolvedTextRenderer.createState(props, this);\n        textRendererState.emitter.on('loaded', this.onTextLoaded);\n        textRendererState.emitter.on('failed', this.onTextFailed);\n        resolvedTextRenderer.scheduleUpdateState(textRendererState);\n        return {\n            resolvedTextRenderer,\n            textRendererState,\n        };\n    }\n}\n//# sourceMappingURL=CoreTextNode.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { startLoop, getTimeStamp } from './platform.js';\nimport { WebGlCoreRenderer } from './renderers/webgl/WebGlCoreRenderer.js';\nimport { assertTruthy, setPremultiplyMode } from '../utils.js';\nimport { AnimationManager } from './animations/AnimationManager.js';\nimport { CoreNode } from './CoreNode.js';\nimport { CoreTextureManager } from './CoreTextureManager.js';\nimport { TrFontManager } from './text-rendering/TrFontManager.js';\nimport { CoreShaderManager } from './CoreShaderManager.js';\nimport { SdfTextRenderer } from './text-rendering/renderers/SdfTextRenderer/SdfTextRenderer.js';\nimport { CanvasTextRenderer } from './text-rendering/renderers/CanvasTextRenderer.js';\nimport { EventEmitter } from '../common/EventEmitter.js';\nimport { ContextSpy } from './lib/ContextSpy.js';\nimport { TextureMemoryManager, } from './TextureMemoryManager.js';\nimport { CanvasCoreRenderer } from './renderers/canvas/CanvasCoreRenderer.js';\nimport { CoreTextNode } from './CoreTextNode.js';\nimport { santizeCustomDataMap } from '../main-api/utils.js';\nconst bufferMemory = 2e6;\nconst autoStart = true;\nexport class Stage {\n    options;\n    /// Module Instances\n    animationManager;\n    txManager;\n    txMemManager;\n    fontManager;\n    textRenderers;\n    shManager;\n    renderer;\n    root;\n    boundsMargin;\n    defShaderCtr;\n    /**\n     * Renderer Event Bus for the Stage to emit events onto\n     *\n     * @remarks\n     * In reality this is just the RendererMain instance, which is an EventEmitter.\n     * this allows us to directly emit events from the Stage to RendererMain\n     * without having to set up forwarding handlers.\n     */\n    eventBus;\n    /// State\n    deltaTime = 0;\n    lastFrameTime = 0;\n    currentFrameTime = 0;\n    fpsNumFrames = 0;\n    fpsElapsedTime = 0;\n    renderRequested = false;\n    frameEventQueue = [];\n    /// Debug data\n    contextSpy = null;\n    /**\n     * Stage constructor\n     */\n    constructor(options) {\n        this.options = options;\n        const { canvas, clearColor, appWidth, appHeight, boundsMargin, enableContextSpy, numImageWorkers, textureMemory, renderMode, } = options;\n        this.eventBus = options.eventBus;\n        this.txManager = new CoreTextureManager(numImageWorkers);\n        this.txMemManager = new TextureMemoryManager(this, textureMemory);\n        this.shManager = new CoreShaderManager();\n        this.animationManager = new AnimationManager();\n        this.contextSpy = enableContextSpy ? new ContextSpy() : null;\n        let bm = [0, 0, 0, 0];\n        if (boundsMargin) {\n            bm = Array.isArray(boundsMargin)\n                ? boundsMargin\n                : [boundsMargin, boundsMargin, boundsMargin, boundsMargin];\n        }\n        this.boundsMargin = bm;\n        const rendererOptions = {\n            stage: this,\n            canvas,\n            pixelRatio: options.devicePhysicalPixelRatio * options.deviceLogicalPixelRatio,\n            clearColor: clearColor ?? 0xff000000,\n            bufferMemory,\n            txManager: this.txManager,\n            txMemManager: this.txMemManager,\n            shManager: this.shManager,\n            contextSpy: this.contextSpy,\n        };\n        if (renderMode === 'canvas') {\n            this.renderer = new CanvasCoreRenderer(rendererOptions);\n        }\n        else {\n            this.renderer = new WebGlCoreRenderer(rendererOptions);\n        }\n        this.defShaderCtr = this.renderer.getDefShaderCtr();\n        setPremultiplyMode(renderMode);\n        // Must do this after renderer is created\n        this.txManager.renderer = this.renderer;\n        this.textRenderers =\n            renderMode === 'webgl'\n                ? {\n                    canvas: new CanvasTextRenderer(this),\n                    sdf: new SdfTextRenderer(this),\n                }\n                : {\n                    canvas: new CanvasTextRenderer(this),\n                };\n        this.fontManager = new TrFontManager(this.textRenderers);\n        // create root node\n        const rootNode = new CoreNode(this, {\n            x: 0,\n            y: 0,\n            width: appWidth,\n            height: appHeight,\n            alpha: 1,\n            autosize: false,\n            clipping: false,\n            color: 0x00000000,\n            colorTop: 0x00000000,\n            colorBottom: 0x00000000,\n            colorLeft: 0x00000000,\n            colorRight: 0x00000000,\n            colorTl: 0x00000000,\n            colorTr: 0x00000000,\n            colorBl: 0x00000000,\n            colorBr: 0x00000000,\n            zIndex: 0,\n            zIndexLocked: 0,\n            scaleX: 1,\n            scaleY: 1,\n            mountX: 0,\n            mountY: 0,\n            mount: 0,\n            pivot: 0.5,\n            pivotX: 0.5,\n            pivotY: 0.5,\n            rotation: 0,\n            parent: null,\n            texture: null,\n            textureOptions: {},\n            shader: this.defShaderCtr,\n            rtt: false,\n            src: null,\n            scale: 1,\n        });\n        this.root = rootNode;\n        // execute platform start loop\n        if (autoStart) {\n            startLoop(this);\n        }\n    }\n    updateFrameTime() {\n        const newFrameTime = getTimeStamp();\n        this.lastFrameTime = this.currentFrameTime;\n        this.currentFrameTime = newFrameTime;\n        this.deltaTime = !this.lastFrameTime\n            ? 100 / 6\n            : newFrameTime - this.lastFrameTime;\n        this.txManager.frameTime = newFrameTime;\n        this.txMemManager.frameTime = newFrameTime;\n        // This event is emitted at the beginning of the frame (before any updates\n        // or rendering), so no need to to use `stage.queueFrameEvent` here.\n        this.eventBus.emit('frameTick', {\n            time: this.currentFrameTime,\n            delta: this.deltaTime,\n        });\n    }\n    /**\n     * Update animations\n     */\n    updateAnimations() {\n        const { animationManager } = this;\n        if (!this.root) {\n            return;\n        }\n        // step animation\n        animationManager.update(this.deltaTime);\n    }\n    /**\n     * Check if the scene has updates\n     */\n    hasSceneUpdates() {\n        return !!this.root.updateType || this.renderRequested;\n    }\n    /**\n     * Start a new frame draw\n     */\n    drawFrame() {\n        const { renderer, renderRequested } = this;\n        assertTruthy(renderer);\n        // Update tree if needed\n        if (this.root.updateType !== 0) {\n            this.root.update(this.deltaTime, this.root.clippingRect);\n        }\n        // Reset render operations and clear the canvas\n        renderer.reset();\n        // Check if we need to cleanup textures\n        if (this.txMemManager.criticalCleanupRequested) {\n            this.txMemManager.cleanup();\n        }\n        // If we have RTT nodes draw them first\n        // So we can use them as textures in the main scene\n        if (renderer.rttNodes.length > 0) {\n            renderer.renderRTTNodes();\n        }\n        // Fill quads buffer\n        this.addQuads(this.root);\n        // Perform render pass\n        renderer?.render();\n        this.calculateFps();\n        // Reset renderRequested flag if it was set\n        if (renderRequested) {\n            this.renderRequested = false;\n        }\n    }\n    /**\n     * Queue an event to be emitted after the current/next frame is rendered\n     *\n     * @remarks\n     * When we are operating in the context of the render loop, we may want to\n     * emit events that are related to the current frame. However, we generally do\n     * NOT want to emit events directly in the middle of the render loop, since\n     * this could enable event handlers to modify the scene graph and cause\n     * unexpected behavior. Instead, we queue up events to be emitted and then\n     * flush the queue after the frame has been rendered.\n     *\n     * @param name\n     * @param data\n     */\n    queueFrameEvent(name, data) {\n        this.frameEventQueue.push([name, data]);\n    }\n    /**\n     * Emit all queued frame events\n     *\n     * @remarks\n     * This method should be called after the frame has been rendered to emit\n     * all events that were queued during the frame.\n     *\n     * See {@link queueFrameEvent} for more information.\n     */\n    flushFrameEvents() {\n        for (const [name, data] of this.frameEventQueue) {\n            this.eventBus.emit(name, data);\n        }\n        this.frameEventQueue = [];\n    }\n    calculateFps() {\n        // If there's an FPS update interval, emit the FPS update event\n        // when the specified interval has elapsed.\n        const { fpsUpdateInterval } = this.options;\n        if (fpsUpdateInterval) {\n            this.fpsNumFrames++;\n            this.fpsElapsedTime += this.deltaTime;\n            if (this.fpsElapsedTime >= fpsUpdateInterval) {\n                const fps = Math.round((this.fpsNumFrames * 1000) / this.fpsElapsedTime);\n                this.fpsNumFrames = 0;\n                this.fpsElapsedTime = 0;\n                this.queueFrameEvent('fpsUpdate', {\n                    fps,\n                    contextSpyData: this.contextSpy?.getData() ?? null,\n                });\n                this.contextSpy?.reset();\n            }\n        }\n    }\n    addQuads(node) {\n        assertTruthy(this.renderer && node.globalTransform);\n        if (node.isRenderable) {\n            node.renderQuads(this.renderer);\n        }\n        for (let i = 0; i < node.children.length; i++) {\n            const child = node.children[i];\n            if (!child) {\n                continue;\n            }\n            if (child?.worldAlpha === 0) {\n                continue;\n            }\n            this.addQuads(child);\n        }\n    }\n    /**\n     * Request a render pass without forcing an update\n     */\n    requestRender() {\n        this.renderRequested = true;\n    }\n    /**\n     * Given a font name, and possible renderer override, return the best compatible text renderer.\n     *\n     * @remarks\n     * Will always return at least a canvas renderer if no other suitable renderer can be resolved.\n     *\n     * @param fontFamily\n     * @param textRendererOverride\n     * @returns\n     */\n    resolveTextRenderer(trProps, textRendererOverride = null) {\n        let rendererId = textRendererOverride;\n        let overrideFallback = false;\n        // Check if the override is valid (if one is provided)\n        if (rendererId) {\n            const possibleRenderer = this.textRenderers[rendererId];\n            if (!possibleRenderer) {\n                console.warn(`Text renderer override '${rendererId}' not found.`);\n                rendererId = null;\n                overrideFallback = true;\n            }\n            else if (!possibleRenderer.canRenderFont(trProps)) {\n                console.warn(`Cannot use override text renderer '${rendererId}' for font`, trProps);\n                rendererId = null;\n                overrideFallback = true;\n            }\n        }\n        if (!rendererId) {\n            // Iterate through the text renderers and find the first one that can render the font\n            for (const [trId, tr] of Object.entries(this.textRenderers)) {\n                if (trId === 'canvas') {\n                    // Canvas is always a fallback\n                    continue;\n                }\n                if (tr.canRenderFont(trProps)) {\n                    rendererId = trId;\n                    break;\n                }\n            }\n            if (!rendererId) {\n                // If no renderer can be found, use the canvas renderer\n                rendererId = 'canvas';\n            }\n        }\n        if (overrideFallback) {\n            console.warn(`Falling back to text renderer ${String(rendererId)}`);\n        }\n        // By now we are guaranteed to have a valid rendererId (at least Canvas);\n        const resolvedTextRenderer = this.textRenderers[rendererId];\n        assertTruthy(resolvedTextRenderer, 'resolvedTextRenderer undefined');\n        // Need to explicitly cast to TextRenderer because TS doesn't like\n        // the covariant state argument in the setter method map\n        return resolvedTextRenderer;\n    }\n    /**\n     * Create a shader controller instance\n     *\n     * @param type\n     * @param props\n     * @returns\n     */\n    createShaderCtr(type, props) {\n        return this.shManager.loadShader(type, props);\n    }\n    createNode(props) {\n        const resolvedProps = this.resolveNodeDefaults(props);\n        return new CoreNode(this, resolvedProps);\n    }\n    createTextNode(props) {\n        const fontSize = props.fontSize ?? 16;\n        const resolvedProps = {\n            ...this.resolveNodeDefaults(props),\n            text: props.text ?? '',\n            textRendererOverride: props.textRendererOverride ?? null,\n            fontSize,\n            fontFamily: props.fontFamily ?? 'sans-serif',\n            fontStyle: props.fontStyle ?? 'normal',\n            fontWeight: props.fontWeight ?? 'normal',\n            fontStretch: props.fontStretch ?? 'normal',\n            textAlign: props.textAlign ?? 'left',\n            contain: props.contain ?? 'none',\n            scrollable: props.scrollable ?? false,\n            scrollY: props.scrollY ?? 0,\n            offsetY: props.offsetY ?? 0,\n            letterSpacing: props.letterSpacing ?? 0,\n            lineHeight: props.lineHeight,\n            maxLines: props.maxLines ?? 0,\n            textBaseline: props.textBaseline ?? 'alphabetic',\n            verticalAlign: props.verticalAlign ?? 'middle',\n            overflowSuffix: props.overflowSuffix ?? '...',\n            debug: props.debug ?? {},\n            shaderProps: null,\n        };\n        return new CoreTextNode(this, resolvedProps);\n    }\n    /**\n     * Resolves the default property values for a Node\n     *\n     * @remarks\n     * This method is used internally by the RendererMain to resolve the default\n     * property values for a Node. It is exposed publicly so that it can be used\n     * by Core Driver implementations.\n     *\n     * @param props\n     * @returns\n     */\n    resolveNodeDefaults(props) {\n        const color = props.color ?? 0xffffffff;\n        const colorTl = props.colorTl ?? props.colorTop ?? props.colorLeft ?? color;\n        const colorTr = props.colorTr ?? props.colorTop ?? props.colorRight ?? color;\n        const colorBl = props.colorBl ?? props.colorBottom ?? props.colorLeft ?? color;\n        const colorBr = props.colorBr ?? props.colorBottom ?? props.colorRight ?? color;\n        const data = santizeCustomDataMap(props.data ?? {});\n        return {\n            x: props.x ?? 0,\n            y: props.y ?? 0,\n            width: props.width ?? 0,\n            height: props.height ?? 0,\n            alpha: props.alpha ?? 1,\n            autosize: props.autosize ?? false,\n            clipping: props.clipping ?? false,\n            color,\n            colorTop: props.colorTop ?? color,\n            colorBottom: props.colorBottom ?? color,\n            colorLeft: props.colorLeft ?? color,\n            colorRight: props.colorRight ?? color,\n            colorBl,\n            colorBr,\n            colorTl,\n            colorTr,\n            zIndex: props.zIndex ?? 0,\n            zIndexLocked: props.zIndexLocked ?? 0,\n            parent: props.parent ?? null,\n            texture: props.texture ?? null,\n            textureOptions: props.textureOptions ?? {},\n            shader: props.shader ?? this.defShaderCtr,\n            // Since setting the `src` will trigger a texture load, we need to set it after\n            // we set the texture. Otherwise, problems happen.\n            src: props.src ?? null,\n            scale: props.scale ?? null,\n            scaleX: props.scaleX ?? props.scale ?? 1,\n            scaleY: props.scaleY ?? props.scale ?? 1,\n            mount: props.mount ?? 0,\n            mountX: props.mountX ?? props.mount ?? 0,\n            mountY: props.mountY ?? props.mount ?? 0,\n            pivot: props.pivot ?? 0.5,\n            pivotX: props.pivotX ?? props.pivot ?? 0.5,\n            pivotY: props.pivotY ?? props.pivot ?? 0.5,\n            rotation: props.rotation ?? 0,\n            rtt: props.rtt ?? false,\n            data: data,\n        };\n    }\n}\n//# sourceMappingURL=Stage.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Platform render loop initiator\n */\nexport const startLoop = (stage) => {\n    let isIdle = false;\n    const runLoop = () => {\n        stage.updateFrameTime();\n        stage.updateAnimations();\n        if (!stage.hasSceneUpdates()) {\n            // We still need to calculate the fps else it looks like the app is frozen\n            stage.calculateFps();\n            setTimeout(runLoop, 16.666666666666668);\n            if (!isIdle) {\n                if (stage.txMemManager.checkCleanup()) {\n                    stage.txMemManager.cleanup();\n                }\n                stage.eventBus.emit('idle');\n                isIdle = true;\n            }\n            stage.flushFrameEvents();\n            return;\n        }\n        isIdle = false;\n        stage.drawFrame();\n        stage.flushFrameEvents();\n        requestAnimationFrame(runLoop);\n    };\n    requestAnimationFrame(runLoop);\n};\n/**\n * Return unix timestamp\n * @return {number}\n */\nexport const getTimeStamp = () => {\n    return performance ? performance.now() : Date.now();\n};\n//# sourceMappingURL=platform.js.map","export function santizeCustomDataMap(d) {\n    const validTypes = {\n        boolean: true,\n        string: true,\n        number: true,\n        undefined: true,\n    };\n    const keys = Object.keys(d);\n    for (let i = 0; i < keys.length; i++) {\n        const key = keys[i];\n        if (!key) {\n            continue;\n        }\n        const value = d[key];\n        const valueType = typeof value;\n        // Typescript doesn't understand the above const valueType ¯\\_(ツ)_/¯\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore-next-line\n        if (valueType === 'string' && value.length > 2048) {\n            console.warn(`Custom Data value for ${key} is too long, it will be truncated to 2048 characters`);\n            // same here, see above comment, this can only be a string at this point\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore-next-line\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call\n            d[key] = value.substring(0, 2048);\n        }\n        if (!validTypes[valueType]) {\n            console.warn(`Custom Data value for ${key} is not a boolean, string, or number, it will be ignored`);\n            delete d[key];\n        }\n    }\n    return d;\n}\n//# sourceMappingURL=utils.js.map","/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { EventEmitter } from '../common/EventEmitter.js';\nimport { Inspector } from './Inspector.js';\nimport { assertTruthy, isProductionEnvironment } from '../utils.js';\nimport { Stage } from '../core/Stage.js';\nimport { CoreNode } from '../core/CoreNode.js';\nimport {} from '../core/CoreTextNode.js';\n/**\n * The Renderer Main API\n *\n * @remarks\n * This is the primary class used to configure and operate the Renderer.\n *\n * It is used to create and destroy Nodes, as well as Texture and Shader\n * references.\n *\n * Example:\n * ```ts\n * import { RendererMain, MainCoreDriver } from '@lightningjs/renderer';\n *\n * // Initialize the Renderer\n * const renderer = new RendererMain(\n *   {\n *     appWidth: 1920,\n *     appHeight: 1080\n *   },\n *   'app',\n *   new MainCoreDriver(),\n * );\n * ```\n *\n * ## Events\n * - `fpsUpdate`\n *   - Emitted every `fpsUpdateInterval` milliseconds with the current FPS\n * - `frameTick`\n *   - Emitted every frame tick\n * - `idle`\n *   - Emitted when the renderer is idle (no changes to the scene\n *     graph/animations running)\n * - `criticalCleanup`\n *  - Emitted when the Texture Memory Manager Cleanup process is triggered\n *  - Payload: { memUsed: number, criticalThreshold: number }\n *    - `memUsed` - The amount of memory (in bytes) used by textures before the\n *       cleanup process\n *    - `criticalThreshold` - The critical threshold (in bytes)\n * - `criticalCleanupFailed`\n *   - Emitted when the Texture Memory Manager Cleanup process is unable to free\n *     up enough texture memory to reach below the critical threshold.\n *     This can happen when there is not enough non-renderable textures to\n *     free up.\n *   - Payload (object with keys):\n *     - `memUsed` - The amount of memory (in bytes) used by textures after\n *       the cleanup process\n *     - `criticalThreshold` - The critical threshold (in bytes)\n */\nexport class RendererMain extends EventEmitter {\n    root;\n    canvas;\n    settings;\n    stage;\n    inspector = null;\n    /**\n     * Constructs a new Renderer instance\n     *\n     * @param settings Renderer settings\n     * @param target Element ID or HTMLElement to insert the canvas into\n     * @param driver Core Driver to use\n     */\n    constructor(settings, target) {\n        super();\n        const resolvedTxSettings = {\n            criticalThreshold: settings.textureMemory?.criticalThreshold || 124e6,\n            targetThresholdLevel: settings.textureMemory?.targetThresholdLevel || 0.5,\n            cleanupInterval: settings.textureMemory?.cleanupInterval || 30000,\n            debugLogging: settings.textureMemory?.debugLogging || false,\n        };\n        const resolvedSettings = {\n            appWidth: settings.appWidth || 1920,\n            appHeight: settings.appHeight || 1080,\n            textureMemory: resolvedTxSettings,\n            boundsMargin: settings.boundsMargin || 0,\n            deviceLogicalPixelRatio: settings.deviceLogicalPixelRatio || 1,\n            devicePhysicalPixelRatio: settings.devicePhysicalPixelRatio || window.devicePixelRatio,\n            clearColor: settings.clearColor ?? 0x00000000,\n            fpsUpdateInterval: settings.fpsUpdateInterval || 0,\n            numImageWorkers: settings.numImageWorkers !== undefined ? settings.numImageWorkers : 2,\n            enableContextSpy: settings.enableContextSpy ?? false,\n            enableInspector: settings.enableInspector ?? false,\n            renderMode: settings.renderMode ?? 'webgl',\n        };\n        this.settings = resolvedSettings;\n        const { appWidth, appHeight, deviceLogicalPixelRatio, devicePhysicalPixelRatio, enableInspector, } = resolvedSettings;\n        const deviceLogicalWidth = appWidth * deviceLogicalPixelRatio;\n        const deviceLogicalHeight = appHeight * deviceLogicalPixelRatio;\n        const canvas = document.createElement('canvas');\n        this.canvas = canvas;\n        canvas.width = deviceLogicalWidth * devicePhysicalPixelRatio;\n        canvas.height = deviceLogicalHeight * devicePhysicalPixelRatio;\n        canvas.style.width = `${deviceLogicalWidth}px`;\n        canvas.style.height = `${deviceLogicalHeight}px`;\n        // Initialize the stage\n        this.stage = new Stage({\n            appWidth: this.settings.appWidth,\n            appHeight: this.settings.appHeight,\n            boundsMargin: this.settings.boundsMargin,\n            clearColor: this.settings.clearColor,\n            canvas: this.canvas,\n            deviceLogicalPixelRatio: this.settings.deviceLogicalPixelRatio,\n            devicePhysicalPixelRatio: this.settings.devicePhysicalPixelRatio,\n            enableContextSpy: this.settings.enableContextSpy,\n            fpsUpdateInterval: this.settings.fpsUpdateInterval,\n            numImageWorkers: this.settings.numImageWorkers,\n            renderMode: this.settings.renderMode,\n            textureMemory: resolvedTxSettings,\n            eventBus: this,\n        });\n        // Extract the root node\n        this.root = this.stage.root;\n        // Get the target element and attach the canvas to it\n        let targetEl;\n        if (typeof target === 'string') {\n            targetEl = document.getElementById(target);\n        }\n        else {\n            targetEl = target;\n        }\n        if (!targetEl) {\n            throw new Error('Could not find target element');\n        }\n        targetEl.appendChild(canvas);\n        // Initialize inspector (if enabled)\n        if (enableInspector && !isProductionEnvironment()) {\n            this.inspector = new Inspector(canvas, resolvedSettings);\n        }\n    }\n    /**\n     * Create a new scene graph node\n     *\n     * @remarks\n     * A node is the main graphical building block of the Renderer scene graph. It\n     * can be a container for other nodes, or it can be a leaf node that renders a\n     * solid color, gradient, image, or specific texture, using a specific shader.\n     *\n     * To create a text node, see {@link createTextNode}.\n     *\n     * See {@link CoreNode} for more details.\n     *\n     * @param props\n     * @returns\n     */\n    createNode(props) {\n        assertTruthy(this.stage, 'Stage is not initialized');\n        const node = this.stage.createNode(props);\n        if (this.inspector) {\n            return this.inspector.createNode(node);\n        }\n        // FIXME onDestroy event? node.once('beforeDestroy'\n        // FIXME onCreate event?\n        return node;\n    }\n    /**\n     * Create a new scene graph text node\n     *\n     * @remarks\n     * A text node is the second graphical building block of the Renderer scene\n     * graph. It renders text using a specific text renderer that is automatically\n     * chosen based on the font requested and what type of fonts are installed\n     * into an app.\n     *\n     * See {@link ITextNode} for more details.\n     *\n     * @param props\n     * @returns\n     */\n    createTextNode(props) {\n        const textNode = this.stage.createTextNode(props);\n        if (this.inspector) {\n            return this.inspector.createTextNode(textNode);\n        }\n        return textNode;\n    }\n    /**\n     * Destroy a node\n     *\n     * @remarks\n     * This method destroys a node\n     *\n     * @param node\n     * @returns\n     */\n    destroyNode(node) {\n        if (this.inspector) {\n            this.inspector.destroyNode(node.id);\n        }\n        return node.destroy();\n    }\n    /**\n     * Create a new texture reference\n     *\n     * @remarks\n     * This method creates a new reference to a texture. The texture is not\n     * loaded until it is used on a node.\n     *\n     * It can be assigned to a node's `texture` property, or it can be used\n     * when creating a SubTexture.\n     *\n     * @param textureType\n     * @param props\n     * @param options\n     * @returns\n     */\n    createTexture(textureType, props) {\n        return this.stage.txManager.loadTexture(textureType, props);\n    }\n    /**\n     * Create a new shader controller for a shader type\n     *\n     * @remarks\n     * This method creates a new Shader Controller for a specific shader type.\n     *\n     * If the shader has not been loaded yet, it will be loaded. Otherwise, the\n     * existing shader will be reused.\n     *\n     * It can be assigned to a Node's `shader` property.\n     *\n     * @param shaderType\n     * @param props\n     * @returns\n     */\n    createShader(shaderType, props) {\n        return this.stage.shManager.loadShader(shaderType, props);\n    }\n    /**\n     * Create a new Dynamic Shader controller\n     *\n     * @remarks\n     * A Dynamic Shader is a shader that can be composed of an array of mulitple\n     * effects. Each effect can be animated or changed after creation (provided\n     * the effect is given a name).\n     *\n     * Example:\n     * ```ts\n     * renderer.createNode({\n     *   shader: renderer.createDynamicShader([\n     *     renderer.createEffect('radius', {\n     *       radius: 0\n     *     }, 'effect1'),\n     *     renderer.createEffect('border', {\n     *       color: 0xff00ffff,\n     *       width: 10,\n     *     }, 'effect2'),\n     *   ]),\n     * });\n     * ```\n     *\n     * @param effects\n     * @returns\n     */\n    createDynamicShader(effects) {\n        return this.stage.shManager.loadDynamicShader({\n            effects: effects,\n        });\n    }\n    /**\n     * Create an effect to be used in a Dynamic Shader\n     *\n     * @remark\n     * The {name} parameter is optional but required if you want to animate the effect\n     * or change the effect's properties after creation.\n     *\n     * See {@link createDynamicShader} for an example.\n     *\n     * @param type\n     * @param props\n     * @param name\n     * @returns\n     */\n    createEffect(type, props, name) {\n        return {\n            name,\n            type,\n            props,\n        };\n    }\n    /**\n     * Get a Node by its ID\n     *\n     * @param id\n     * @returns\n     */\n    getNodeById(id) {\n        const root = this.stage?.root;\n        if (!root) {\n            return null;\n        }\n        const findNode = (node) => {\n            if (node.id === id) {\n                return node;\n            }\n            for (const child of node.children) {\n                const found = findNode(child);\n                if (found) {\n                    return found;\n                }\n            }\n            return null;\n        };\n        return findNode(root);\n    }\n    toggleFreeze() {\n        throw new Error('Not implemented');\n    }\n    advanceFrame() {\n        throw new Error('Not implemented');\n    }\n    /**\n     * Re-render the current frame without advancing any running animations.\n     *\n     * @remarks\n     * Any state changes will be reflected in the re-rendered frame. Useful for\n     * debugging.\n     *\n     * May not do anything if the render loop is running on a separate worker.\n     */\n    rerender() {\n        throw new Error('Not implemented');\n    }\n}\n//# sourceMappingURL=Renderer.js.map","export const screenResolutions = {\n  hd: 0.66666667,\n  '720p': 0.66666667,\n  720: 0.66666667,\n  fhd: 1,\n  fullhd: 1,\n  '1080p': 1,\n  1080: 1,\n  '4k': 2,\n  '2160p': 2,\n  2160: 2,\n}\n","import { SdfTrFontFace, WebTrFontFace } from '@lightningjs/renderer'\nimport Settings from '../../settings.js'\nimport { renderer } from './launch.js'\n\nexport default () => {\n  const stage = renderer.stage\n  Settings.get('fonts', []).forEach((font) => {\n    if (font.type === 'sdf' || font.type === 'msdf') {\n      // automatically map png key to file name\n      if (!font.png && font.file) {\n        font.png = font.file.replace(/\\.[^.]+$/, `.${font.type}.png`)\n      }\n      // automatically map json to file name\n      if (!font.json && font.file) {\n        font.json = font.file.replace(/\\.[^.]+$/, `.${font.type}.json`)\n      }\n      stage.fontManager.addFontFace(\n        new SdfTrFontFace(font.type, {\n          fontFamily: font.family,\n          descriptors: {},\n          atlasUrl: font.png,\n          atlasDataUrl: font.json,\n          stage,\n          metrics: font.metrics,\n        })\n      )\n    } else if (font.type === 'web') {\n      stage.fontManager.addFontFace(\n        new WebTrFontFace({\n          fontFamily: font.family,\n          fontUrl: font.file,\n          descriptors: {},\n          metrics: font.metrics,\n        })\n      )\n    }\n  })\n}\n","import Settings from '../../settings.js'\nimport { renderer } from './launch.js'\n\nexport default () => {\n  const stage = renderer.stage\n  Settings.get('shaders', []).forEach((shader) => {\n    stage.shManager.registerShaderType(shader.name, shader.type)\n  })\n  Settings.get('effects', []).forEach((effect) => {\n    stage.shManager.registerShaderType(effect.name, effect.type)\n  })\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { RendererMain } from '@lightningjs/renderer'\nimport { Log } from '../../lib/log.js'\nimport { screenResolutions } from '../../lib/utils.js'\nimport colors from '../../lib/colors/colors.js'\nimport fontLoader from './fontLoader.js'\nimport shaderLoader from './shaderLoader.js'\n\nexport let renderer\n\nexport default (App, target, settings = {}) => {\n  if ('fontLoader' in settings) {\n    Log.warn(\n      `\n\nStarting version 0.9.0 of Blits, the Launch setting \\`fontLoader\\` is not supported / required anymore.\nYou can remove the option from your \\`src/index.js\\`-file. And you can safely remove the file \\`src/fontLoader.js\\` from your project.\n      `\n    )\n  }\n\n  renderer = new RendererMain(\n    {\n      appWidth: settings.w || 1920,\n      appHeight: settings.h || 1080,\n      fpsUpdateInterval: settings.fpsInterval || 1000,\n      deviceLogicalPixelRatio:\n        settings.pixelRatio ||\n        screenResolutions[settings.screenResolution] ||\n        screenResolutions[window.innerHeight] ||\n        1,\n      numImageWorkers:\n        'webWorkersLimit' in settings\n          ? settings.webWorkersLimit\n          : window.navigator.hardwareConcurrency || 2,\n      clearColor: (settings.canvasColor && colors.normalize(settings.canvasColor)) || 0x00000000,\n      enableInspector: settings.inspector || false,\n      boundsMargin: settings.viewportMargin || 0,\n      // gpu memory limit, converted from mb to bytes - defaults to 200mb\n      txMemByteThreshold:\n        'gpuMemoryLimit' in settings ? settings.gpuMemoryLimit * 1024 * 1024 : 200 * 1024 * 1024,\n      renderMode: 'renderMode' in settings ? settings.renderMode : 'webgl',\n    },\n    target\n  )\n\n  const initApp = () => {\n    let app = App()\n    app.quit = () => {\n      Log.info('Closing App')\n      app.destroy()\n      app = null\n      renderer = null\n    }\n  }\n\n  shaderLoader()\n  fontLoader()\n  initApp()\n\n  return renderer\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { renderer } from './launch.js'\nimport colors from '../../lib/colors/colors.js'\n\nimport { Log } from '../../lib/log.js'\nimport symbols from '../../lib/symbols.js'\nimport Settings from '../../settings.js'\n\nconst isTransition = (value) => {\n  return value !== null && typeof value === 'object' && 'transition' in value\n}\n\nconst isObjectString = (str) => {\n  return typeof str === 'string' && str.startsWith('{') && str.endsWith('}')\n}\n\nconst parseToObject = (str) => {\n  return JSON.parse(str.replace(/'/g, '\"').replace(/([\\w-_]+)\\s*:/g, '\"$1\":'))\n}\n\nconst parsePercentage = function (v, base) {\n  if (typeof v !== 'string') {\n    return v\n  } else if (v.indexOf('%') === v.length - 1) {\n    return (\n      this.element.parent &&\n      this.element.parent[base] &&\n      this.element.parent[base] * (parseFloat(v) / 100)\n    )\n  }\n  return v\n}\n\nconst unpackTransition = (v) => {\n  if (v === null) return v\n  if (typeof v === 'string') return v\n  else if (typeof v === 'number') return v\n  else if (typeof v === 'object' && v.constructor === Object) {\n    if ('value' in v) {\n      return v.value\n    } else if ('transition' in v) {\n      return unpackTransition(v.transition)\n    }\n  }\n  return v\n}\n\nconst colorMap = {\n  top: 'colorTop',\n  bottom: 'colorBottom',\n  left: 'colorLeft',\n  right: 'colorRight',\n}\n\nlet textDefaults\n\nconst propsTransformer = {\n  set parent(v) {\n    this.props['parent'] = v === 'root' ? renderer.root : v.node\n  },\n  set rotation(v) {\n    this.props['rotation'] = v * (Math.PI / 180)\n  },\n  set w(v) {\n    this.props['width'] = parsePercentage.call(this, v, 'width')\n  },\n  set width(v) {\n    this.props['width'] = parsePercentage.call(this, v, 'width')\n  },\n  set h(v) {\n    this.props['height'] = parsePercentage.call(this, v, 'height')\n  },\n  set height(v) {\n    this.props['height'] = parsePercentage.call(this, v, 'height')\n  },\n  set x(v) {\n    this.props['x'] = parsePercentage.call(this, v, 'width')\n  },\n  set y(v) {\n    this.props['y'] = parsePercentage.call(this, v, 'height')\n  },\n  set z(v) {\n    this.props['zIndex'] = v\n  },\n  set zIndex(v) {\n    this.props['zIndex'] = v\n  },\n  set color(v) {\n    if (typeof v === 'string' && v.indexOf('{') === -1) {\n      this.props['color'] = colors.normalize(v)\n    } else if (typeof v === 'object' || (isObjectString(v) && (v = parseToObject(v)))) {\n      this.props['color'] = 0\n      Object.entries(v).forEach((color) => {\n        this.props[colorMap[color[0]]] = colors.normalize(color[1])\n      })\n    }\n  },\n  set src(v) {\n    this.props['src'] = v\n    if (this.raw.get('color') === undefined) {\n      this.props['color'] = 0xffffffff\n    }\n  },\n  set texture(v) {\n    this.props['texture'] = v\n\n    if (this.raw.get('color') === undefined && (v === null || v === undefined)) {\n      this.props['color'] = 0x00000000\n    } else if (this.raw.get('color') === undefined) {\n      this.props['color'] = 0xffffffff\n    }\n  },\n  set rtt(v) {\n    this.props['rtt'] = v\n    if (v === true && this.raw.get('color') === undefined) {\n      this.props['color'] = 0xffffffff\n    }\n  },\n  set mount(v) {\n    if (typeof v === 'object' || (isObjectString(v) && (v = parseToObject(v)))) {\n      if ('x' in v) {\n        this.props['mountX'] = v.x\n      }\n      if ('y' in v) {\n        this.props['mountY'] = v.y\n      }\n    } else {\n      this.props['mountX'] = v\n      this.props['mountY'] = v\n    }\n  },\n  set pivot(v) {\n    if (typeof v === 'object' || (isObjectString(v) && (v = parseToObject(v)))) {\n      if ('x' in v) {\n        this.props['pivotX'] = v.x\n      }\n      if ('y' in v) {\n        this.props['pivotY'] = v.y\n      }\n    } else {\n      this.props['pivotX'] = v\n      this.props['pivotY'] = v\n    }\n  },\n  set scale(v) {\n    if (typeof v === 'object' || (isObjectString(v) && (v = parseToObject(v)))) {\n      if ('x' in v) {\n        this.props['scaleX'] = v.x\n      }\n      if ('y' in v) {\n        this.props['scaleY'] = v.y\n      }\n    } else {\n      this.props['scale'] = v\n    }\n  },\n  set show(v) {\n    this.props['alpha'] = v ? 1 : 0\n  },\n  set alpha(v) {\n    this.props['alpha'] = v\n  },\n  set shader(v) {\n    if (v !== null) {\n      this.props['shader'] = renderer.createShader(v.type, v.props)\n    } else {\n      this.props['shader'] = renderer.createShader('DefaultShader')\n    }\n  },\n  set effects(v) {\n    this.props['shader'] = renderer.createShader('DynamicShader', {\n      effects: v.map((eff) => {\n        if (eff.props && eff.props.color) {\n          eff.props.color = colors.normalize(eff.props.color)\n        }\n        return eff\n      }),\n    })\n  },\n  set clipping(v) {\n    this.props['clipping'] = v\n  },\n  set overflow(v) {\n    this.props['clipping'] = !!!v\n  },\n  set font(v) {\n    this.props['fontFamily'] = v\n  },\n  set size(v) {\n    this.props['fontSize'] = v\n  },\n  set wordwrap(v) {\n    this.props['width'] = v\n    this.props['contain'] = 'width'\n  },\n  set maxheight(v) {\n    this.props['height'] = v\n    this.props['contain'] = 'both'\n  },\n  set contain(v) {\n    this.props['contain'] = v\n  },\n  set maxlines(v) {\n    this.props['maxLines'] = v\n  },\n  set textoverflow(v) {\n    this.props['overflowSuffix'] = v === false ? ' ' : v === true ? undefined : v\n  },\n  set letterspacing(v) {\n    this.props['letterSpacing'] = v || 1\n  },\n  set lineheight(v) {\n    this.props['lineHeight'] = v\n  },\n  set align(v) {\n    this.props['textAlign'] = v\n  },\n  set content(v) {\n    this.props['text'] = '' + v\n  },\n}\n\nconst Element = {\n  populate(data) {\n    const props = {\n      ...this.config,\n      ...data,\n    }\n\n    if (props[symbols.isSlot]) {\n      this[symbols.isSlot] = true\n    }\n\n    this.props.element = this\n\n    const propKeys = Object.keys(props)\n    const length = propKeys.length\n\n    this.props['parent'] = props.parent\n    delete props.parent\n\n    this.props.raw = new Map(Object.entries(props))\n\n    for (let i = 0; i < length; i++) {\n      const key = propKeys[i]\n      const value = props[key]\n      if (value !== undefined) {\n        this.props[key] = unpackTransition(value)\n      }\n    }\n\n    // correct for default white nodes (but not for text nodes)\n    if (this.props.props['color'] === undefined && !('__textnode' in props)) {\n      this.props.props['color'] = 0\n    }\n\n    this.node = props.__textnode\n      ? renderer.createTextNode({ ...textDefaults, ...this.props.props })\n      : (this.node = renderer.createNode(this.props.props))\n\n    if (props['@loaded']) {\n      this.node.on('loaded', (el, { type, dimensions }) => {\n        props['@loaded']({ w: dimensions.width, h: dimensions.height, type }, this)\n      })\n    }\n\n    if (props['@error']) {\n      this.node.on('failed', (el, error) => {\n        props['@error'](error, this)\n      })\n    }\n\n    if (this.component && this.component.___layout) {\n      this.node.on('loaded', () => {\n        this.component.___layout()\n      })\n    }\n  },\n  set(prop, value) {\n    if (value === undefined) return\n    if (this.props.raw.get(prop) === value) return\n\n    this.props.raw.set(prop, value)\n\n    this.props.props = {}\n    this.props[prop] = unpackTransition(value)\n    const props = Object.entries(this.props.props)\n\n    if (props.length === 1) {\n      const [p, v] = props[0]\n      if (isTransition(value)) {\n        return this.animate(p, v, value.transition)\n      }\n      // set the prop to the value on the node\n      this.node[p] = v\n    } else {\n      for (let i = 0; i < props.length; i++) {\n        // todo: fix code duplication\n        const [p, v] = props[i]\n        if (isTransition(value)) {\n          return this.animate(p, v, value.transition)\n        }\n        // set the prop to the value on the node\n        this.node[p] = v\n      }\n    }\n\n    // todo: review naming\n    if (this.component && this.component.___layout) {\n      this.component.___layout()\n    }\n  },\n  animate(prop, value, transition) {\n    // if current value is the same as the value to animate to, instantly resolve\n    if (this.node[prop] === value) return\n    // check if a transition is already scheduled or running on the same prop\n    if (this.scheduledTransitions[prop]) {\n      if (this.scheduledTransitions[prop].f.state === 'running') {\n        // fastforward to final value\n        this.node[prop] = this.scheduledTransitions[prop].v\n        // this.scheduledTransitions[prop].f.stop()\n      }\n    }\n\n    const props = {}\n    props[prop] = value\n\n    // construct animate function\n    const f = this.node.animate(props, {\n      duration:\n        typeof transition === 'object'\n          ? 'duration' in transition\n            ? transition.duration\n            : 300\n          : 300,\n      easing:\n        typeof transition === 'object'\n          ? 'easing' in transition\n            ? transition.easing\n            : 'ease'\n          : 'ease',\n      delay: typeof transition === 'object' ? ('delay' in transition ? transition.delay : 0) : 0,\n    })\n\n    // capture the current value to be used in the transition start\n    const startValue = this.node[prop]\n\n    // schedule the transition for this prop, so it can be canceled /\n    // removed if another transition for the same prop starts in the mean time\n    this.scheduledTransitions[prop] = {\n      v: props[prop],\n      cancel: false,\n      f,\n    }\n\n    if (transition.start && typeof transition.start === 'function') {\n      // fire transition start callback when animation really starts (depending on specified delay)\n      f.once('animating', () => {\n        transition.start.call(this.component, this, prop, startValue)\n      })\n    }\n\n    f.once('stopped', () => {\n      // remove the prop from scheduled transitions\n      this.scheduledTransitions[prop] = null\n      // fire transition end callback when animation ends (if specified)\n      if (transition.end && typeof transition.end === 'function') {\n        transition.end.call(this.component, this, prop, this.node[prop])\n      }\n    })\n\n    // start animation\n    f.start()\n  },\n  destroy() {\n    Log.debug('Deleting  Node', this.nodeId)\n    this.node.destroy()\n  },\n  get nodeId() {\n    return this.node && this.node.id\n  },\n  get ref() {\n    return this.props.ref || null\n  },\n  get parent() {\n    return this.node && this.node.parent\n  },\n  get children() {\n    return this.component[symbols.getChildren]().filter((child) => {\n      return child.parent === (this[symbols.isSlot] ? this.node.children[0] : this.node)\n    })\n  },\n}\n\nexport default (config, component) => {\n  if (!textDefaults) {\n    textDefaults = {\n      fontSize: 32,\n      fontFamily: Settings.get('defaultFont', 'sans-serif'),\n    }\n  }\n  return Object.assign(Object.create(Element), {\n    props: Object.assign(Object.create(propsTransformer), { props: {} }),\n    scheduledTransitions: {},\n    config,\n    component,\n  })\n}\n","import Element from './element.js'\nimport Launch from './launch.js'\n\nexport default {\n  Element,\n  Launch,\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Settings from './settings.js'\nimport { initLog } from './lib/log.js'\nimport engine from './engine.js'\n\nexport let renderer\nexport const stage = {}\n\nexport default (App, target, settings) => {\n  Settings.set(settings)\n\n  initLog()\n\n  stage.element = engine.Element\n\n  renderer = engine.Launch(App, target, settings)\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport default {\n  before: {\n    prop: 'alpha',\n    value: 0,\n  },\n  in: {\n    prop: 'alpha',\n    value: 1,\n    duration: 200,\n  },\n  out: {\n    prop: 'alpha',\n    value: 0,\n    duration: 100,\n  },\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst syn = window.speechSynthesis\n\nconst getUA = () => (window.navigator || {}).userAgent || ''\nconst isAndroid = () => /android/i.test(getUA())\n\nlet initialized = false\nlet infinityTimer = null\nconst clear = () => infinityTimer && clearTimeout(infinityTimer)\n\nconst resumeInfinity = (target) => {\n  if (!target || infinityTimer) {\n    return clear()\n  }\n\n  syn.pause()\n  syn.resume()\n\n  infinityTimer = setTimeout(() => {\n    resumeInfinity(target)\n  }, 5000)\n}\n\nconst utterProps = {\n  lang: 'en-US',\n  pitch: 1,\n  rate: 1,\n  voice: null,\n  volume: 1,\n}\n\nconst initialize = () => {\n  utterProps.voice = syn.getVoices()[0]\n  initialized = true\n}\n\nconst utterance = (scope, e) => {\n  const utter = new SpeechSynthesisUtterance(e.value)\n\n  // utter props\n  utter.lang = e.lang || utterProps.lang\n  utter.pitch = e.pitch || utterProps.pitch\n  utter.rate = e.rate || utterProps.rate\n  utter.voice = e.voice || utterProps.voice\n  utter.volume = e.volume || utterProps.volume\n\n  // utter events\n  utter.onstart = () => {\n    if (!isAndroid()) {\n      resumeInfinity(utter)\n    }\n    scope.onstart()\n  }\n\n  utter.onresume = () => {\n    if (!isAndroid()) {\n      resumeInfinity(utter)\n    }\n    scope.onresume()\n  }\n\n  utter.onpause = () => {\n    scope.onpause()\n  }\n  utter.onend = () => {\n    scope.onend()\n  }\n  utter.onerror = () => {\n    clear()\n    scope.onerror()\n  }\n  syn.speak(utter)\n}\n\nexport default {\n  speak(e) {\n    if (!initialized) {\n      initialize()\n    }\n    this.cancel()\n    utterance(this, e)\n  },\n  resume() {\n    syn.resume()\n  },\n  pause() {\n    syn.pause()\n  },\n  cancel() {\n    syn.cancel()\n    clear()\n  },\n  getVoices() {\n    return syn.getVoices()\n  },\n  onend() {\n    //event placeholder\n  },\n  onerror() {\n    //event placeholder\n  },\n  onstart() {\n    //event placeholder\n  },\n  onresume() {\n    //event placeholder\n  },\n  onpause() {\n    //eventplaceholder\n  },\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport speechSynthesis from './speechSynthesis.js'\n\nlet debounce\n\nconst speak = (message, politeness = 'off') => {\n  clearTimeout(debounce)\n  speechSynthesis.cancel()\n  // assertive messages get spoken immediately\n  if (politeness === 'assertive') {\n    speechSynthesis.speak({ value: message })\n  } else {\n    debounce = setTimeout(() => {\n      speechSynthesis.speak({ value: message })\n    }, 400)\n  }\n}\n\nconst polite = (message) => speak(message, 'polite')\n\nconst assertive = (message) => speak(message, 'assertive')\n\nconst stop = () => {\n  speechSynthesis.cancel()\n}\n\nexport default {\n  speak,\n  polite,\n  assertive,\n  stop,\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { default as fadeInFadeOutTransition } from './transitions/fadeInOut.js'\n\nimport symbols from '../lib/symbols.js'\nimport { Log } from '../lib/log.js'\nimport { stage } from '../launch.js'\nimport Focus from '../focus.js'\nimport Announcer from '../announcer/announcer.js'\n\nexport let currentRoute\nexport let navigating = false\n\nconst cacheMap = new WeakMap()\nconst history = []\n\nlet overrideOptions = {}\nlet navigationData = {}\nlet navigatingBack = false\nlet previousFocus\n\nexport const getHash = () => {\n  return (document.location.hash || '/').replace(/^#/, '')\n}\n\nconst normalizePath = (path) => {\n  return (\n    path\n      // remove leading and trailing slashes\n      .replace(/^\\/+|\\/+$/g, '')\n      .toLowerCase()\n  )\n}\nconst isObject = (v) => typeof v === 'object' && v !== null\n\nconst isString = (v) => typeof v === 'string'\n\nexport const matchHash = (path, routes = []) => {\n  // remove trailing slashes\n  const originalPath = path\n  path = normalizePath(path)\n  let matchingRoute = false\n  let i = 0\n  while (!matchingRoute && i < routes.length) {\n    const route = routes[i]\n    route.path = normalizePath(route.path)\n    if (route.path === path) {\n      route.params = {}\n      matchingRoute = route\n    } else if (route.path.indexOf(':') > -1) {\n      // match dynamic route parts\n      const dynamicRouteParts = [...route.path.matchAll(/:([^\\s/]+)/gi)]\n\n      // construct a regex for the route with dynamic parts\n      let dynamicRoutePartsRegex = route.path\n      dynamicRouteParts.reverse().forEach((part) => {\n        dynamicRoutePartsRegex =\n          dynamicRoutePartsRegex.substring(0, part.index) +\n          '([^\\\\s/]+)' +\n          dynamicRoutePartsRegex.substring(part.index + part[0].length)\n      })\n\n      // test if the constructed regex matches the path\n      const match = originalPath.match(new RegExp(`${dynamicRoutePartsRegex}`, 'i'))\n\n      if (match) {\n        // map the route params to a params object\n        route.params = dynamicRouteParts.reverse().reduce((acc, part, index) => {\n          acc[part[1]] = match[index + 1]\n          return acc\n        }, {})\n        matchingRoute = route\n      }\n    } else if (route.path.endsWith('*')) {\n      const regex = new RegExp(route.path.replace(/\\/?\\*/, '/?([^\\\\s]*)'), 'i')\n      const match = path.match(regex)\n\n      if (match) {\n        if (match[1]) route.params = { path: match[1] }\n        matchingRoute = route\n      }\n    }\n    i++\n  }\n\n  if (matchingRoute) {\n    matchingRoute.options = { ...matchingRoute.options, ...overrideOptions }\n    if (!matchingRoute.data) {\n      matchingRoute.data = {}\n    }\n    currentRoute = matchingRoute\n  }\n\n  return matchingRoute\n}\n\nexport const navigate = async function () {\n  navigating = true\n  if (this.parent[symbols.routes]) {\n    const previousRoute = currentRoute\n    const hash = getHash()\n    let route = matchHash(hash, this.parent[symbols.routes])\n    let beforeHookOutput\n    if (route) {\n      if (route.hooks) {\n        if (route.hooks.before) {\n          beforeHookOutput = await route.hooks.before(route, previousRoute)\n          if (isString(beforeHookOutput)) {\n            currentRoute = previousRoute\n            to(beforeHookOutput)\n            return\n          }\n        }\n      }\n      route = isObject(beforeHookOutput) ? beforeHookOutput : route\n      // add the previous route (technically still the current route at this point)\n      // into the history stack, unless navigating back or inHistory flag of route is false\n      if (navigatingBack === false && previousRoute && previousRoute.options.inHistory === true) {\n        history.push(previousRoute)\n      }\n      // apply default transition if none specified\n      if (!('transition' in route)) {\n        route.transition = fadeInFadeOutTransition\n      }\n      // a transition can be a function returning a dynamic transition object\n      // based on current and previous route\n      if (typeof route.transition === 'function') {\n        route.transition = route.transition(previousRoute, route)\n      }\n\n      let holder\n      let { view, focus } = cacheMap.get(route) || {}\n\n      if (!view) {\n        // create a holder element for the new view\n        holder = stage.element({ parent: this[symbols.children][0] })\n        holder.populate({})\n        holder.set('w', '100%')\n        holder.set('h', '100%')\n        // merge props with potential route params, navigation data and route data to be injected into the component instance\n        const props = { ...this[symbols.props], ...route.params, ...navigationData, ...route.data }\n\n        view = await route.component({ props }, holder, this)\n        if (view[Symbol.toStringTag] === 'Module') {\n          if (view.default && typeof view.default === 'function') {\n            view = view.default({ props }, holder, this)\n          } else {\n            Log.error(\"Dynamic import doesn't have a default export or default is not a function\")\n          }\n        }\n        if (typeof view === 'function') {\n          view = view({ props }, holder, this)\n        }\n      } else {\n        holder = view[symbols.holder]\n      }\n\n      this[symbols.children].push(view)\n\n      // keep reference to the previous focus for storing in cache\n      previousFocus = Focus.get()\n\n      // set focus to the view that we're routing to\n      focus ? Focus.set(focus) : Focus.set(view)\n\n      // apply before settings to holder element\n      if (route.transition.before) {\n        if (Array.isArray(route.transition.before)) {\n          for (let i = 0; i < route.transition.before.length; i++) {\n            holder.set(route.transition.before[i].prop, route.transition.before[i].value)\n          }\n        } else {\n          holder.set(route.transition.before.prop, route.transition.before.value)\n        }\n      }\n\n      let shouldAnimate = false\n\n      // apply out out transition on previous view\n      if (previousRoute) {\n        // only animate when there is a previous route\n        shouldAnimate = true\n        const oldView = this[symbols.children].splice(1, 1).pop()\n        if (oldView) {\n          removeView(previousRoute, oldView, route.transition.out)\n        }\n      }\n\n      // apply in transition\n      if (route.transition.in) {\n        if (Array.isArray(route.transition.in)) {\n          for (let i = 0; i < route.transition.in.length; i++) {\n            i === route.transition.length - 1\n              ? await setOrAnimate(holder, route.transition.in[i], shouldAnimate)\n              : setOrAnimate(holder, route.transition.in[i], shouldAnimate)\n          }\n        } else {\n          await setOrAnimate(holder, route.transition.in, shouldAnimate)\n        }\n      }\n\n      // Announce route change if a message has been specified for this route\n      if (route.announce) {\n        if (typeof route.announce === 'string') {\n          route.announce = {\n            message: route.announce,\n          }\n        }\n        Announcer.speak(route.announce.message, route.announce.politeness)\n      }\n\n      this.activeView = this[symbols.children][this[symbols.children].length - 1]\n    } else {\n      Log.error(`Route ${hash} not found`)\n    }\n  }\n\n  // reset navigating indicators\n  navigatingBack = false\n  navigating = false\n}\n\nconst removeView = async (route, view, transition) => {\n  // apply out transition\n  if (transition) {\n    if (Array.isArray(transition)) {\n      for (let i = 0; i < transition.length; i++) {\n        i === transition.length - 1\n          ? await setOrAnimate(view[symbols.holder], transition[i])\n          : setOrAnimate(view[symbols.holder], transition[i])\n      }\n    } else {\n      await setOrAnimate(view[symbols.holder], transition)\n    }\n  }\n\n  // cache the page when it's as 'keepAlive' instead of destroying\n  if (route.options && route.options.keepAlive === true) {\n    cacheMap.set(route, { view: view, focus: previousFocus })\n  } else {\n    view.destroy()\n    view = null\n  }\n}\n\nconst setOrAnimate = (node, transition, shouldAnimate = true) => {\n  return new Promise((resolve) => {\n    if (shouldAnimate) {\n      // resolve the promise in the transition end-callback\n      // (\"extending\" end callback when one is already specified)\n      const existingEndCallback = transition.end\n      transition.end = existingEndCallback\n        ? (...args) => {\n            existingEndCallback(...args)\n            resolve()\n          }\n        : resolve\n      node.set(transition.prop, { transition })\n    } else {\n      node.set(transition.prop, transition.value)\n      resolve()\n    }\n  })\n}\n\nexport const to = (location, data = {}, options = {}) => {\n  navigationData = data\n  overrideOptions = options\n  window.location.hash = `#${location}`\n}\n\nexport const back = () => {\n  const route = history.pop()\n  if (route) {\n    // set indicator that we are navigating back (to prevent adding page to history stack)\n    navigatingBack = true\n    let targetRoutePath = route.path\n    if (targetRoutePath.indexOf(':') > -1) {\n      Object.keys(route.params).forEach((item) => {\n        targetRoutePath = targetRoutePath.replace(`:${item}`, route.params[item])\n      })\n    }\n    to(targetRoutePath)\n    return true\n  } else {\n    return false\n  }\n}\n\nexport default {\n  navigate,\n  to,\n  back,\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from './lib/symbols.js'\nimport { navigating } from './router/router.js'\n\nlet focusedComponent = null\nlet focusChain = []\nlet setFocusTimeout\n\nexport default {\n  _hold: false,\n  set hold(v) {\n    this._hold = v\n  },\n  get hold() {\n    return this._hold\n  },\n  get() {\n    return focusedComponent\n  },\n  set(component, event) {\n    clearTimeout(setFocusTimeout)\n    focusedComponent && focusedComponent !== component.parent && focusedComponent.unfocus()\n    focusChain.reverse().forEach((cmp) => cmp.unfocus())\n    if (component !== focusedComponent) {\n      setFocusTimeout = setTimeout(\n        () => {\n          focusedComponent = component\n          focusedComponent.lifecycle.state = 'focus'\n          if (event instanceof KeyboardEvent) {\n            document.dispatchEvent(new KeyboardEvent('keydown', event))\n          } else {\n            focusChain = []\n          }\n        },\n        // todo: make the hold timeout configurable?\n        this.hold ? 50 : 0\n      )\n    }\n  },\n  input(key, event) {\n    if (navigating === true) return\n    focusChain = walkChain([focusedComponent], key)\n    const componentWithInputEvent = focusChain.shift()\n\n    if (componentWithInputEvent) {\n      if (componentWithInputEvent[symbols.inputEvents][key]) {\n        componentWithInputEvent[symbols.inputEvents][key].call(componentWithInputEvent, event)\n      } else if (componentWithInputEvent[symbols.inputEvents].any) {\n        componentWithInputEvent[symbols.inputEvents].any.call(componentWithInputEvent, event)\n      }\n    }\n  },\n}\n\nconst walkChain = (components, key) => {\n  if (\n    components[0][symbols.inputEvents] &&\n    (typeof components[0][symbols.inputEvents][key] === 'function' ||\n      typeof components[0][symbols.inputEvents].any === 'function')\n  ) {\n    return components\n  } else if (components[0].parent) {\n    components.unshift(components[0].parent)\n    return walkChain(components, key)\n  } else return []\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst eventsMap = new Map()\n\nexport default {\n  registerListener(component, event, cb) {\n    let componentsMap = eventsMap.get(event)\n    if (!componentsMap) {\n      componentsMap = new Map()\n      eventsMap.set(event, componentsMap)\n    }\n\n    let components = componentsMap.get(component)\n    if (!components) {\n      components = new Set()\n      componentsMap.set(component, components)\n    }\n\n    components.add(cb)\n  },\n  executeListeners(event, params) {\n    const componentsMap = eventsMap.get(event)\n    if (componentsMap) {\n      componentsMap.forEach((component) => {\n        component.forEach((cb) => {\n          cb(params)\n        })\n      })\n    }\n  },\n  removeListeners(component) {\n    eventsMap.forEach((componentMap) => {\n      const cmp = componentMap.get(component)\n      if (cmp) {\n        cmp.clear()\n        componentMap.delete(cmp)\n      }\n    })\n  },\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\nimport Focus from '../../focus.js'\nimport eventListeners from '../../lib/eventListeners.js'\nimport { trigger } from '../../lib/reactivity/effect.js'\nimport { Log } from '../../lib/log.js'\n\nexport default {\n  focus: {\n    value: function (e) {\n      this[symbols.state].hasFocus = true\n      Focus.set(this, e)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  unfocus: {\n    value: function () {\n      this[symbols.state].hasFocus = false\n      this.lifecycle.state = 'unfocus'\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  destroy: {\n    value: function () {\n      this.lifecycle.state = 'destroy'\n      this.$clearTimeouts()\n      this.$clearIntervals()\n      eventListeners.removeListeners(this)\n      deleteChildren(this[symbols.children])\n      Log.debug(`Destroyed component ${this.componentId}`)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  select: {\n    value: function (ref) {\n      let selected = null\n      this[symbols.children].forEach((child) => {\n        if (Array.isArray(child)) {\n          child.forEach((c) => {\n            if (c['ref'] === ref) selected = c\n          })\n        } else if (Object.getPrototypeOf(child) === Object.prototype) {\n          Object.keys(child).forEach((k) => {\n            if (child[k]['ref'] === ref) selected = child[k]\n          })\n        } else {\n          if (child['ref'] === ref) selected = child\n        }\n      })\n      return selected\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  trigger: {\n    value: function (key) {\n      // trigger with force set to true\n      trigger(this[symbols.originalState], key, true)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $trigger: {\n    value: function (key) {\n      Log.warn('this.$trigger is deprecated, use this.trigger instead')\n      return this.trigger(key)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  shader: {\n    value: function (type, args) {\n      const target = type\n      return {\n        type: target,\n        props: args,\n      }\n      // const shaders = renderer.driver.stage.shManager.getRegisteredEffects()\n\n      // if (target in shaders) {\n      //   return {\n      //     type: target,\n      //     props: args,\n      //   }\n      // } else {\n      //   Log.error(`Shader ${type} not found`)\n      // }\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n\nconst deleteChildren = function (children) {\n  for (let i = 0; i < children.length; i++) {\n    if (!children[i]) return\n    // call destroy when method is available on child\n    if (children[i].destroy && typeof children[i].destroy === 'function') {\n      children[i].destroy()\n    }\n    // recursively call deleteChildren when it's an object of items (happens when using a forloop construct)\n    else if (Object.getPrototypeOf(children[i]) === Object.prototype) {\n      deleteChildren(Object.values(children[i]))\n    }\n\n    children[i] = null\n  }\n\n  children.length = 0\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\n\nexport default {\n  $setTimeout: {\n    value: function (fn, ms, ...params) {\n      const timeoutId = setTimeout(\n        () => {\n          this[symbols.timeouts] = this[symbols.timeouts].filter((id) => id !== timeoutId)\n          fn.apply(null, params)\n        },\n        ms,\n        params\n      )\n      this[symbols.timeouts].push(timeoutId)\n      return timeoutId\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $clearTimeout: {\n    value: function (timeoutId) {\n      if (this[symbols.timeouts].indexOf(timeoutId) > -1) {\n        this[symbols.timeouts] = this[symbols.timeouts].filter((id) => id !== timeoutId)\n        clearTimeout(timeoutId)\n      }\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $clearTimeouts: {\n    value: function () {\n      for (let i = 0; i < this[symbols.timeouts].length; i++) {\n        clearTimeout(this[symbols.timeouts][i])\n      }\n      this[symbols.timeouts] = []\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $setInterval: {\n    value: function (fn, ms, ...params) {\n      const intervalId = setInterval(() => fn.apply(null, params), ms, params)\n      this[symbols.intervals].push(intervalId)\n      return intervalId\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $clearInterval: {\n    value: function (intervalId) {\n      if (this[symbols.intervals].indexOf(intervalId) > -1) {\n        this[symbols.intervals] = this[symbols.intervals].filter((id) => id !== intervalId)\n        clearInterval(intervalId)\n      }\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $clearIntervals: {\n    value: function () {\n      for (let i = 0; i < this[symbols.intervals].length; i++) {\n        clearInterval(this[symbols.intervals][i])\n      }\n      this[symbols.intervals] = []\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport eventListeners from '../../lib/eventListeners.js'\n\nexport default {\n  $emit: {\n    value: function (event, params) {\n      eventListeners.executeListeners(event, params)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $listen: {\n    value: function (event, callback) {\n      eventListeners.registerListener(this, event, callback)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport log from '../../lib/log.js'\n\nexport default {\n  $log: {\n    value: log('App'),\n    writable: false,\n    enumerable: false,\n    configurable: false,\n  },\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\nimport { to, currentRoute, navigating, back } from '../../router/router.js'\n\nexport default {\n  $router: {\n    value: {\n      to,\n      back,\n      get currentRoute() {\n        return currentRoute\n      },\n      get routes() {\n        return this[symbols.routes]\n      },\n      get navigating() {\n        return navigating\n      },\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Announcer from '../../announcer/announcer.js'\n\nexport default {\n  $announcer: {\n    value: Announcer,\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\n\nimport { renderer } from '../../launch.js'\n\nexport default {\n  [symbols.renderer]: {\n    value: () => renderer,\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  [symbols.getChildren]: {\n    value() {\n      const parent = this.rootParent || this.parent\n      return (this[symbols.children] || []).concat(\n        (parent &&\n          parent[symbols.getChildren]()\n            .map((child) => {\n              if (Object.getPrototypeOf(child) === Object.prototype) {\n                return Object.values(child).map((c) => {\n                  // ugly hack .. but the point is to reference the right component\n                  c.forComponent = c.config && c.config.parent.component\n                  return c\n                })\n              }\n              return child\n            })\n            .flat()\n            .filter((child) => {\n              // problem is that component of a forloop in a slot has component of root component\n              if (child && child.component) {\n                return (\n                  (child.component && child.component.componentId === this.componentId) ||\n                  (child.forComponent && child.forComponent.componentId === this.componentId)\n                )\n              }\n            })) ||\n          []\n      )\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport methods from './methods.js'\nimport scheduling from './timeouts_intervals.js'\nimport events from './events.js'\nimport log from './log.js'\nimport router from './router.js'\nimport announcer from './announcer.js'\nimport utils from './utils.js'\n\nexport default Object.defineProperties(\n  {},\n  { ...methods, ...scheduling, ...events, ...log, ...router, ...announcer, ...utils }\n)\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../../lib/log.js'\n\nimport symbols from '../../lib/symbols.js'\n\nconst baseProp = {\n  cast: (v) => v,\n  required: false,\n}\n\nexport default (component, props = []) => {\n  if (props.indexOf('ref') === -1) {\n    props.push('ref')\n  }\n  component[symbols.propKeys] = []\n  props.forEach((prop) => {\n    prop = { ...baseProp, ...(typeof prop === 'object' ? prop : { key: prop }) }\n    component[symbols.propKeys].push(prop.key)\n    Object.defineProperty(component, prop.key, {\n      get() {\n        const value = prop.cast(\n          this[symbols.props] && prop.key in this[symbols.props]\n            ? this[symbols.props][prop.key]\n            : 'default' in prop\n            ? prop.default\n            : undefined\n        )\n\n        if (prop.required && value === undefined) {\n          Log.warn(`${prop.key} is required`)\n        }\n\n        return value\n      },\n      set(v) {\n        Log.warn(`Warning! Avoid mutating props directly (${prop.key})`)\n        this[symbols.props][prop.key] = v\n      },\n    })\n  })\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../../lib/log.js'\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, state = () => {}) => {\n  Object.defineProperty(component, symbols.stateKeys, {\n    value: [],\n    enumerable: false,\n    configurable: false,\n    writable: false,\n  })\n\n  const stateKeys = Object.keys(state.apply(component) || {}).concat(['hasFocus'])\n\n  stateKeys.forEach((key) => {\n    if (component[symbols.propKeys] && component[symbols.propKeys].indexOf(key) > -1) {\n      Log.error(`State ${key} already exists as a prop`)\n    }\n    if (component[symbols.methodKeys] && component[symbols.methodKeys].indexOf(key) > -1) {\n      Log.error(`State ${key} already exists as a method`)\n    }\n    component[symbols.stateKeys].push(key)\n    try {\n      Object.defineProperty(component, key, {\n        get() {\n          return this[symbols.state] && key in this[symbols.state] && this[symbols.state][key]\n        },\n        set(v) {\n          if (this[symbols.state]) this[symbols.state][key] = v\n        },\n        // enumerable: true,\n      })\n    } catch (e) {\n      Log.error(e)\n    }\n  })\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../../lib/log.js'\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, computeds) => {\n  component[symbols.computedKeys] = []\n\n  for (let computed in computeds) {\n    // test for reserved keys?\n    if (component[symbols.stateKeys] && component[symbols.stateKeys].indexOf(computed) > -1) {\n      Log.error(`${computed} already exists as a state variable`)\n    } else if (component[symbols.propKeys] && component[symbols.propKeys].indexOf(computed) > -1) {\n      Log.error(`${computed} already exists as a prop`)\n    } else if (\n      component[symbols.methodKeys] &&\n      component[symbols.methodKeys].indexOf(computed) > -1\n    ) {\n      Log.error(`${computed} already exists as a method`)\n    } else {\n      if (typeof computeds[computed] !== 'function') {\n        Log.warn(`${computed} is not a function`)\n      }\n      component[symbols.computedKeys].push(computed)\n      Object.defineProperty(component, computed, {\n        get() {\n          return computeds[computed].apply(this)\n        },\n      })\n    }\n  }\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, watchers) => {\n  component[symbols.watchKeys] = []\n  component[symbols.watchers] = {}\n\n  for (let watch in watchers) {\n    if (typeof watchers[watch] !== 'function') {\n      console.warn(`${watch} is not a function`)\n    }\n\n    component[symbols.watchKeys].push(watch)\n\n    component[symbols.watchers][watch] = function (v, old) {\n      watchers[watch].call(this, v, old)\n    }\n  }\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport setupProps from './props.js'\nimport setupMethods from './methods.js'\nimport setupState from './state.js'\nimport setupComputed from './computed.js'\nimport setupInput from './input.js'\nimport setupRoutes from './routes.js'\nimport setupWatch from './watch.js'\n\nimport { registerHooks } from '../../lib/hooks.js'\n\nimport symbols from '../../lib/symbols.js'\n\nlet counter = 0\n\nexport default function (component, config) {\n  component[symbols.identifier] = ++counter\n\n  // setup hooks\n  registerHooks(config.hooks, component[symbols.identifier])\n\n  // setup props\n  // if (config.props) // because of the default props like id - might change this\n  setupProps(component, config.props)\n\n  // // setup methods\n  if (config.methods) setupMethods(component, config.methods)\n\n  // // setup state\n  setupState(component, config.state)\n\n  // // setup computed\n  if (config.computed) setupComputed(component, config.computed)\n\n  // // setup watchers\n  if (config.watch) setupWatch(component, config.watch)\n\n  // // setup routes\n  if (config.routes) setupRoutes(component, config.routes)\n\n  // // setup input\n  if (config.input) setupInput(component, config.input)\n\n  return component\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../../lib/log.js'\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, methods) => {\n  component[symbols.methodKeys] = []\n\n  for (let method in methods) {\n    // test for reserved keys?\n    if (component[symbols.propKeys] && component[symbols.propKeys].indexOf(method) > -1) {\n      Log.error(`${method} already exists as a prop`)\n    } else {\n      if (typeof methods[method] !== 'function') {\n        Log.warn(`${method} is not a function`)\n      }\n      component[symbols.methodKeys].push(method)\n      component[method] = methods[method]\n    }\n  }\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, routes) => {\n  component[symbols.routes] = []\n  Object.keys(routes).forEach((key) => {\n    // todo: validate routes[key] for expected format etc.\n    component[symbols.routes][key] = {\n      ...routes[key],\n      ...{\n        // merge default route options with route specific options\n        options: {\n          ...{\n            inHistory: true,\n          },\n          ...routes[key].options,\n        },\n      },\n    }\n  })\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../../lib/log.js'\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, input) => {\n  component[symbols.inputEvents] = []\n  Object.keys(input).forEach((key) => {\n    if (typeof input[key] !== 'function') {\n      Log.warn(`${input[key]} is not a function`)\n    }\n    component[symbols.inputEvents][key] = input[key]\n  })\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from '../component.js'\n\nexport default () =>\n  Component('Image', {\n    template: `\n      <Element :imageSource=\"$imageSource\" />`,\n    props: ['src'],\n    computed: {\n      imageSource() {\n        if (/^(?:https?:)?\\/\\//i.test(this.src)) {\n          return this.src\n        }\n        return `${window.location.protocol}//${window.location.host}/${this.src}`\n      },\n    },\n  })\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from '../component.js'\n\nexport default () =>\n  Component('Circle', {\n    template: `\n      <Element :color=\"$color\" :w=\"$size\" :h=\"$size\" :effects=\"[$shader('radius', {radius: $radius})]\"></Element>\n    `,\n    props: [{ key: 'size', default: 40 }, 'color'],\n    computed: {\n      radius() {\n        return this.size / 2\n      },\n    },\n  })\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from '../component.js'\nimport Router from '../router/router.js'\n\nlet handler\n\nexport default () =>\n  Component('RouterView', {\n    template: `\n      <Element w=\"100%\" height=\"100%\"></Element>\n    `,\n    state() {\n      return {\n        activeView: null,\n      }\n    },\n    hooks: {\n      ready() {\n        handler = () => Router.navigate.apply(this)\n        Router.navigate.apply(this)\n        window.addEventListener('hashchange', handler)\n      },\n      destroy() {\n        window.removeEventListener('hashchange', handler, false)\n      },\n      focus() {\n        this.activeView && this.activeView.focus()\n      },\n    },\n    input: {\n      back() {\n        Router.back()\n      },\n    },\n  })\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from '../component.js'\n\nimport symbols from '../lib/symbols.js'\n\nexport default () =>\n  Component('Sprite', {\n    template: `\n      <Element w=\"100%\" h=\"100%\" :texture=\"$texture\" :color=\"$color\" />\n    `,\n    props: ['image', 'map', 'frame', 'color'],\n    state() {\n      return {\n        spriteTexture: false,\n      }\n    },\n    computed: {\n      texture() {\n        const options =\n          'frames' in this.map\n            ? Object.assign({}, this.map.defaults || {}, this.map.frames[this.frame])\n            : this.map[this.frame]\n\n        if (this.spriteTexture && options) {\n          return this[symbols.renderer]().createTexture('SubTexture', {\n            texture: this.spriteTexture,\n            x: options.x,\n            y: options.y,\n            width: options.w,\n            height: options.h,\n          })\n        }\n      },\n    },\n    hooks: {\n      ready() {\n        this.spriteTexture = this[symbols.renderer]().createTexture('ImageTexture', {\n          src: this.image,\n        })\n      },\n    },\n  })\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from '../component.js'\nimport { renderer } from '../launch.js'\nimport fps_sprite from '../../public/assets/fps_sprite.base64.js'\n\nexport default () =>\n  Component('FPScounter', {\n    template: `\n      <Element>\n        <Element y=\"15\" x=\"20\">\n          <Element>\n            <Sprite image=\"$image\" w=\"43\" h=\"25\" map=\"$sprite\" frame=\"fps\" />\n            <Element x=\"58\" y=\"2\">\n              <Sprite image=\"$image\" x=\"0\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$fps[0]\" />\n              <Sprite image=\"$image\" x=\"18\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$fps[1]\" />\n              <Sprite image=\"$image\" x=\"36\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$fps[2]\" />\n            </Element>\n          </Element>\n\n          <Element x=\"150\">\n            <Sprite image=\"$image\" y=\"2\" w=\"48\" h=\"25\" map=\"$sprite\" frame=\"avg\" />\n            <Element x=\"63\" y=\"2\">\n              <Sprite image=\"$image\" x=\"0\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$avgFps[0]\" />\n              <Sprite image=\"$image\" x=\"18\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$avgFps[1]\" />\n              <Sprite image=\"$image\" x=\"36\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$avgFps[2]\" />\n            </Element>\n          </Element>\n\n          <Element x=\"0\" y=\"40\" >\n            <Sprite image=\"$image\" x=\"-2\" w=\"47\" h=\"25\" map=\"$sprite\" frame=\"min\" />\n            <Element x=\"58\" y=\"2\">\n              <Sprite image=\"$image\" x=\"0\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$minFps[0]\" />\n              <Sprite image=\"$image\" x=\"18\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$minFps[1]\" />\n              <Sprite image=\"$image\" x=\"36\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$minFps[2]\" />\n            </Element>\n          </Element>\n\n          <Element x=\"150\" y=\"40\">\n            <Sprite image=\"$image\" w=\"53\" h=\"25\" map=\"$sprite\" frame=\"max\" />\n            <Element x=\"63\" y=\"2\">\n              <Sprite image=\"$image\" x=\"0\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$maxFps[0]\" />\n              <Sprite image=\"$image\" x=\"18\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$maxFps[1]\" />\n              <Sprite image=\"$image\" x=\"36\" h=\"20\" w=\"20\" map=\"$sprite\" :frame=\"$maxFps[2]\" />\n            </Element>\n          </Element>\n        </Element>\n      </Element>\n    `,\n    state() {\n      return {\n        image: fps_sprite,\n        sprite: {\n          defaults: {\n            y: 1,\n            w: 20,\n            h: 20,\n          },\n          frames: {\n            '-': { x: -1000 },\n            0: { x: 1 },\n            1: { x: 23 },\n            2: { x: 45 },\n            3: { x: 67 },\n            4: { x: 89 },\n            5: { x: 111 },\n            6: { x: 133 },\n            7: { x: 155 },\n            8: { x: 177 },\n            9: { x: 199 },\n            avg: { x: 221, w: 48, h: 25 },\n            fps: { x: 271, w: 43, h: 25 },\n            max: { x: 316, w: 53, h: 25 },\n            min: { x: 371, w: 47, h: 25 },\n          },\n        },\n        fps: '---',\n        avgFps: '---',\n        minFps: '---',\n        maxFps: '---',\n      }\n    },\n    hooks: {\n      ready() {\n        let minFps = 10000\n        let maxFps = 0\n        let avgFps = 0\n        let totalFps = 0\n        let fpsUpdateCounter = 0\n\n        renderer.on('fpsUpdate', (rM, { fps }) => {\n          minFps = Math.min(fps, minFps)\n          maxFps = Math.max(fps, maxFps)\n          totalFps += fps\n          fpsUpdateCounter++\n          avgFps = Math.round(totalFps / fpsUpdateCounter)\n\n          this.fps = fps.toString().padStart(3, '0')\n          this.avgFps = avgFps.toString().padStart(3, '0')\n          this.minFps = minFps.toString().padStart(3, '0')\n          this.maxFps = maxFps.toString().padStart(3, '0')\n        })\n      },\n    },\n  })\n","export default 'data:image/png;base64,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'\n","import Component from '../component.js'\n\nexport default () => {\n  return Component('Layout', {\n    template: `\n      <Slot ref=\"slot\" />\n    `,\n    props: [\n      'direction',\n      {\n        key: 'gap',\n        default: 0,\n      },\n    ],\n    hooks: {\n      ready() {\n        this.___layout()\n      },\n    },\n    methods: {\n      // todo: review naming\n      ___layout() {\n        let offset = 0\n\n        this.select('slot').children.forEach((el) => {\n          el.set(this.direction === 'vertical' ? 'y' : 'x', offset)\n          // todo: grab width from interface, not directly from node\n          offset +=\n            (el.node[this.direction === 'vertical' ? 'height' : 'width'] || 0) + (this.gap || 0)\n        })\n      },\n    },\n  })\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from './lib/log.js'\nimport parser from './lib/templateparser/parser.js'\nimport codegenerator from './lib/codegenerator/generator.js'\nimport { createHumanReadableId, createInternalId } from './lib/componentId.js'\nimport { emit } from './lib/hooks.js'\nimport { reactive } from './lib/reactivity/reactive.js'\nimport { effect } from './lib/reactivity/effect.js'\nimport Lifecycle from './lib/lifecycle.js'\nimport symbols from './lib/symbols.js'\n\nimport { stage, renderer } from './launch.js'\n\nimport Base from './component/base/index.js'\n\nimport Settings from './settings.js'\n\nimport setupComponent from './component/setup/index.js'\nimport components from './components/index.js'\n\n// object to store global components\nlet globalComponents\n\nconst required = (name) => {\n  throw new Error(`Parameter ${name} is required`)\n}\n\n/**\n * Component factory function\n * @param {string} name - The name of the component\n * @param {object} config - The configuration object for the component\n * @returns {function} - A factory function that creates a new component instance\n *\n */\nconst Component = (name = required('name'), config = required('config')) => {\n  let base\n\n  const component = function (opts, parentEl, parentComponent, rootComponent) {\n    // generate a human readable ID for the component instance (i.e. Blits::ComponentName1)\n    this.componentId = createHumanReadableId(name)\n\n    // instantiate a lifecycle object for this instance\n    this.lifecycle = Object.assign(Object.create(Lifecycle), {\n      component: this,\n      previous: null,\n      current: null,\n    })\n\n    // set a reference to the parent component\n    this.parent = parentComponent\n\n    //\n    this.rootParent = rootComponent\n\n    // set a reference to the holder / parentElement\n    // Components are wrapped in a holder node (used to apply positioning and transforms\n    // such as rotation and scale to components)\n    this[symbols.holder] = parentEl\n\n    // generate an internal id (simple counter)\n    this[symbols.id] = createInternalId()\n\n    // set the internal props and make them reactive (based on the reactivity mode)\n    this[symbols.props] = reactive(opts.props || {}, Settings.get('reactivityMode'))\n\n    // create an empty array for storing timeouts created by this component (via this.$setTimeout)\n    this[symbols.timeouts] = []\n\n    // create an empty array for storing intervals created by this component (via this.$setInterval)\n    this[symbols.intervals] = []\n\n    // apply the state function (passing in the this reference to utilize configured props)\n    // and store a reference to this original state\n    // hasFocus key is sprinkled in\n    this[symbols.originalState] = {\n      ...((config.state && typeof config.state === 'function' && config.state.apply(this)) || {}),\n      ...{ hasFocus: false },\n    }\n\n    // generate a reactive state (using the result of previously execute state function)\n    // and store it\n    this[symbols.state] = reactive(this[symbols.originalState], Settings.get('reactivityMode'))\n\n    // all basic setup has been done now, set the lifecycle to state 'init'\n    this.lifecycle.state = 'init'\n\n    // execute the render code that constructs the initial state of the component\n    // and store the children result (a flat map of elements and components)\n    this[symbols.children] =\n      config.code.render.apply(stage, [parentEl, this, config, globalComponents]) || []\n\n    // create a reference to the wrapper element of the component (i.e. the root Element of the component)\n    this[symbols.wrapper] = this[symbols.children][0]\n\n    // create a reference to an array of children that are slots\n    this[symbols.slots] = this[symbols.children].filter((child) => child[symbols.isSlot])\n\n    // register hooks if component has hooks specified\n    if (config.hooks) {\n      // frame tick event\n      if (config.hooks.frameTick) {\n        renderer.on('frameTick', (r, data) =>\n          emit('frameTick', this[symbols.identifier], this, [data])\n        )\n      }\n\n      if (config.hooks.idle) {\n        renderer.on('idle', () => {\n          emit('idle', this[symbols.identifier], this)\n        })\n      }\n\n      // inBounds event emiting a lifecycle attach event\n      if (config.hooks.attach) {\n        this[symbols.wrapper].node.on('inBounds', () => {\n          this.lifecycle.state = 'attach'\n        })\n      }\n\n      // outOfBounds event emiting a lifeycle detach event\n      if (config.hooks.detach) {\n        this[symbols.wrapper].node.on('outOfBounds', (node, { previous }) => {\n          if (previous > 0) this.lifecycle.state = 'detach'\n        })\n      }\n\n      // inViewport event emiting a lifecycle enter event\n      if (config.hooks.enter) {\n        this[symbols.wrapper].node.on('inViewport', () => {\n          this.lifecycle.state = 'enter'\n        })\n      }\n\n      // outOfViewport event emitting a lifecycle exit event\n      if (config.hooks.exit) {\n        this[symbols.wrapper].node.on('outOfViewport', () => {\n          this.lifecycle.state = 'exit'\n        })\n      }\n    }\n\n    // setup (and execute) all the generated side effects based on the\n    // reactive bindings define in the template\n    for (let i = 0; i < config.code.effects.length; i++) {\n      effect(() => {\n        config.code.effects[i].apply(stage, [\n          this,\n          this[symbols.children],\n          config,\n          globalComponents,\n          rootComponent,\n          effect,\n        ])\n      })\n    }\n\n    // setup watchers if the components has watchers specified\n    if (this[symbols.watchers]) {\n      Object.keys(this[symbols.watchers]).forEach((watchKey) => {\n        let old = this[watchKey]\n        effect((force = false) => {\n          if (old !== this[watchKey] || force === true) {\n            this[symbols.watchers][watchKey].apply(this, [this[watchKey], old])\n            old = this[watchKey]\n          }\n        })\n      })\n    }\n\n    // set all symbol based properties to non-enumerable and non-configurable\n    Object.getOwnPropertySymbols(this).forEach((property) => {\n      Object.defineProperties(this, {\n        [property]: {\n          enumerable: false,\n          configurable: false,\n        },\n      })\n    })\n\n    // finaly set the lifecycle state to ready (in the next tick)\n    setTimeout(() => (this.lifecycle.state = 'ready'))\n\n    // and return this\n    return this\n  }\n\n  const factory = (options = {}, parentEl, parentComponent, rootComponent) => {\n    // setup the component once, using Base as the prototype\n    if (!base) {\n      Log.debug(`Setting up ${name} component`)\n      base = setupComponent(Object.create(Base), config)\n    }\n\n    // one time code generation (only if precompilation is turned off)\n    if (!config.code) {\n      Log.debug(`Generating code for ${name} component`)\n      config.code = codegenerator.call(config, parser(config.template, name))\n    }\n\n    // register global components once\n    if (!globalComponents) {\n      globalComponents = components()\n    }\n\n    // create an instance of the component, using base as the prototype (which contains Base)\n    return component.call(Object.create(base), options, parentEl, parentComponent, rootComponent)\n  }\n\n  // store the config on the factory, in order to access the config\n  // during the code generation step\n  factory.config = config\n\n  return factory\n}\n\nexport default Component\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../symbols.js'\nimport colors from '../colors/colors.js'\n\nexport default (template = '', componentName, parentComponent, filePath = null) => {\n  let cursor = 0\n  let prevCursor = 0\n  let tags = []\n  let currentTag = null\n  let currentLevel = 0\n\n  // regular expressions\n  const tagStartRegex = /^<\\/?([a-zA-Z0-9_\\-.]+)\\s*/\n  const tagEndRegex = /^\\s*(\\/?>)\\s*/\n  const attrNameRegex = /^([A-Za-z0-9:.\\-_@]+)=\\s*([\"'])/\n  const emptyTagStartRegex = /^<>\\s*/\n  const emptyTagEndRegex = /^\\s*(<\\/>)\\s*/\n\n  // main functions\n  const parse = () => {\n    template = clean(template)\n    try {\n      parseLoop(parseEmptyTagStart)\n      return format(tags)\n    } catch (error) {\n      if (error.name == 'TemplateParseError' || error.name == 'TemplateStructureError') {\n        error.message = `${error.message}\\n${error.context}`\n      }\n      throw error\n    }\n  }\n\n  const parseLoop = (next) => {\n    if (cursor >= template.length) {\n      return\n    }\n    next()\n  }\n\n  // utils\n  const clean = (templateText) => {\n    // remove all unnecessary new lines and comments\n    return templateText\n      .replace(/<!--.*?-->/gms, '') // remove comments\n      .replace(/\\r?\\n\\s*\\r\\n/gm, ' ') // remove empty lines\n      .replace(/\\r?\\n\\s*(\\S)/gm, ' $1') // remove line endings & spacing\n      .replace(/\\r?\\n/g, '') // remove all line endings\n      .trim()\n  }\n\n  const moveCursorOnMatch = (regex) => {\n    const match = template.slice(cursor).match(regex)\n    if (match) {\n      prevCursor = cursor\n      cursor += match[0].length\n    }\n    return match\n  }\n\n  // parsers\n  const parseEmptyTagStart = () => {\n    const match = moveCursorOnMatch(emptyTagStartRegex)\n    if (match) {\n      tags.push({\n        [Symbol.for('componentType')]: null,\n        [symbols.type]: 'opening',\n        [symbols.level]: currentLevel,\n        [symbols.cursorTagStart]: prevCursor,\n      })\n      currentLevel++\n      parseLoop(parseEmptyTagStart)\n    } else {\n      parseLoop(parseEmptyTagEnd)\n    }\n  }\n\n  const parseEmptyTagEnd = () => {\n    const match = moveCursorOnMatch(emptyTagEndRegex)\n    if (match) {\n      currentLevel--\n      tags.push({\n        [Symbol.for('componentType')]: null,\n        [symbols.type]: 'closing',\n        [symbols.level]: currentLevel,\n      })\n      parseLoop(parseEmptyTagStart)\n    } else {\n      parseLoop(parseTag)\n    }\n  }\n\n  const parseTag = () => {\n    const match = moveCursorOnMatch(tagStartRegex)\n    if (match) {\n      currentTag = {\n        [Symbol.for('componentType')]: match[1],\n        [symbols.level]: currentLevel,\n        [symbols.cursorTagStart]: prevCursor,\n      }\n      if (match[0].startsWith('</')) {\n        currentLevel--\n        currentTag[symbols.type] = 'closing'\n        currentTag[symbols.level] = currentLevel\n      } else {\n        currentTag[symbols.type] = 'opening'\n        currentLevel++\n      }\n      parseLoop(parseTagEnd)\n    } else {\n      throw TemplateParseError('InvalidTag')\n    }\n  }\n\n  const parseTagEnd = () => {\n    const match = moveCursorOnMatch(tagEndRegex)\n    if (match) {\n      if (match[1] === '/>') {\n        if (currentTag[symbols.type] === 'closing') {\n          throw TemplateParseError('InvalidClosingTag')\n        }\n        currentTag[symbols.type] = 'self-closing'\n        currentLevel-- // because it was parsed as opening tag before\n      }\n\n      // parsing content in between tags\n      // rule: < char cannot be used in between tags even in escaped form\n      if (currentTag[symbols.type] === 'opening') {\n        const tagContent = template.slice(cursor, template.indexOf('<', cursor))\n        if (tagContent) {\n          currentTag.content = tagContent\n          cursor += tagContent.length\n        }\n      }\n\n      tags.push(currentTag)\n      parseLoop(parseEmptyTagStart)\n    } else {\n      parseLoop(parseAttributes)\n    }\n  }\n\n  //fixme: closing tags cannot have attributes\n  const parseAttributes = () => {\n    const attrNameMatch = moveCursorOnMatch(attrNameRegex)\n    if (attrNameMatch) {\n      if (currentTag[symbols.type] === 'closing') {\n        throw TemplateParseError('AttributesInClosingTag')\n      }\n\n      const delimiter = attrNameMatch[2]\n      const attrValueRegex = new RegExp(`^(.*?)${delimiter}\\\\s*`)\n      const attrValueMatch = moveCursorOnMatch(attrValueRegex)\n\n      if (attrValueMatch) {\n        // maybe this should be done while code generation step\n        const attr = formatAttribute(attrNameMatch[1], attrValueMatch[1])\n        currentTag[attr.name] = attr.value\n        parseLoop(parseTagEnd)\n      } else {\n        throw TemplateParseError('MissingOrInvalidAttributeValue')\n      }\n    } else {\n      throw TemplateParseError('InvalidAttribute')\n    }\n  }\n\n  const formatAttribute = (name, value) => {\n    // if name contains a dot then we need to add enclosing js object to the value\n    // example :x.transition=\"{v: $offset}\" must be formatted as { name: ':x', value: '{ transition: {v: $offset}' }\n    if (name.includes('.')) {\n      const [objectName, attributeName] = name.split('.')\n      return { name: objectName, value: `{${attributeName}: ${value}}` }\n    }\n\n    // process color values\n    if (['color', ':color', ':effects', 'effects'].includes(name)) {\n      return processColors(name, value)\n    }\n    return { name, value }\n  }\n\n  const processColors = (name, value) => {\n    let newValue = value //copy for processing\n    let normalized = colors.normalize(newValue, null)\n\n    if (normalized === null) {\n      const stringTokenRegex = /'([^']+)'/g\n      let match\n      let lastIndex = 0\n      let result = ''\n\n      while ((match = stringTokenRegex.exec(value)) !== null) {\n        const potentialColor = match[1]\n        const matchIndex = match.index\n        const matchLength = match[0].length\n\n        result += value.slice(lastIndex, matchIndex)\n        normalized = colors.normalize(potentialColor, null)\n\n        if (normalized === null) {\n          result += value.slice(matchIndex, matchIndex + matchLength)\n        } else {\n          result += `'${normalized}'`\n        }\n\n        lastIndex = matchIndex + matchLength\n      }\n\n      result += value.slice(lastIndex)\n      newValue = result\n    } else {\n      newValue = normalized\n    }\n\n    return { name, value: newValue }\n  }\n\n  /*\n  Formatting & validation rules:\n    #1: Every opening tag must have a corresponding closing tag at the same level. If a closing tag is encountered without\n        a preceding opening tag at the same level, or if an opening tag is not followed by a corresponding closing tag at\n        the same level, an error should be thrown.\n    #2: There must be exactly one top-level element (an element at level 0). This element may either be a self-closing\n        element or an opening tag followed by a closing tag. If more than one top-level element is encountered, an error\n        should be thrown.\n  */\n  const format = (parsedData) => {\n    let stack = []\n    let rootElementDefined = false\n    let output = { children: [] }\n    let currentParent = output\n\n    for (let i = 0; i < parsedData.length; i++) {\n      let element = parsedData[i]\n\n      // Rule #1\n      if (element[symbols.level] === 0 && element[symbols.type] !== 'closing') {\n        if (rootElementDefined) {\n          throw TemplateStructureError('MultipleTopLevelTags', element)\n        }\n        rootElementDefined = true\n      }\n\n      // Rule #2\n      if (element[symbols.type] === 'opening') {\n        stack.push({\n          [symbols.level]: element[symbols.level],\n          [symbols.type]: element[symbols.type],\n          [symbols.cursorTagStart]: element[symbols.cursorTagStart],\n          [Symbol.for('componentType')]: element[Symbol.for('componentType')],\n          parent: currentParent, // helps getting the previous parent when closing tag is encountered\n        })\n      } else if (element[symbols.type] === 'closing') {\n        const isStackEmpty = stack.length === 0\n        let isLevelMismatch = false\n        let isTagMismatch = false\n        if (!isStackEmpty) {\n          isLevelMismatch = stack[stack.length - 1][symbols.level] !== element[symbols.level]\n          isTagMismatch =\n            stack[stack.length - 1][Symbol.for('componentType')] !==\n            element[Symbol.for('componentType')]\n        }\n\n        if (isStackEmpty || isLevelMismatch || isTagMismatch) {\n          throw TemplateStructureError('MismatchedClosingTag', element)\n        }\n\n        // when we remove the closing element from the stack, we should set\n        // the current parent to the parent of the closing element\n        const lastTag = stack.pop()\n        currentParent = lastTag.parent\n      }\n\n      const newItem = { ...element }\n      delete newItem[symbols.type]\n      delete newItem[symbols.level]\n      delete newItem[symbols.cursorTagStart]\n\n      // if it is an opening tag, add children[] to it and update current parent\n      if (element[symbols.type] === 'opening') {\n        // make sure the current opening tag has really a child element\n        if (i + 1 < parsedData.length && parsedData[i + 1][symbols.type] !== 'closing') {\n          newItem.children = []\n        }\n        currentParent.children.push(newItem)\n        currentParent = newItem\n      } else if (element[symbols.type] === 'self-closing') {\n        currentParent.children.push(newItem)\n      }\n    }\n\n    // Check if all tags are closed (so stack should be empty)[Rule #1]\n    if (stack.length > 0) {\n      throw TemplateStructureError('UnclosedTags', stack)\n    }\n\n    return output\n  }\n\n  // error reporting\n  const contextPaddingBefore = 10 // number of characters to show before the error location\n  const contextPaddingAfter = 50 // number of characters to show after the error location\n\n  const TemplateParseError = (message) => {\n    const location = getErrorLocation()\n    message = `${message} in ${location}`\n\n    const error = new Error(message)\n    error.name = 'TemplateParseError'\n\n    const start = Math.max(0, prevCursor - contextPaddingBefore)\n    const end = Math.min(template.length, cursor + contextPaddingAfter)\n    const contextText = template.slice(start, end)\n\n    // add ^ caret to show where the error is\n    const caretPosition = cursor - start\n    error.context = insertContextCaret(caretPosition, contextText)\n\n    return error\n  }\n\n  const TemplateStructureError = (message, context) => {\n    const location = getErrorLocation()\n    message = `${message} in ${location}`\n\n    const error = new Error(message)\n    error.name = 'TemplateStructureError'\n\n    // check if context is an array\n    if (Array.isArray(context)) {\n      error.context = context.map((tag) => generateContext(tag)).join('\\n')\n    } else {\n      error.context = generateContext(context)\n    }\n\n    function generateContext(element) {\n      const start = Math.max(0, element[symbols.cursorTagStart] - contextPaddingBefore)\n      const contextText = template.slice(start, start + contextPaddingAfter)\n      // add ^ caret to show where the error is\n      return insertContextCaret(contextPaddingBefore, contextText)\n    }\n    return error\n  }\n\n  const insertContextCaret = (position, contextText) => {\n    const caret = ' '.repeat(position) + '^'\n    return `\\n${contextText}\\n${caret}\\n`\n  }\n\n  const getErrorLocation = () => {\n    if (parentComponent) {\n      let hierarchy = componentName || ''\n      let currentParent = parentComponent\n\n      while (currentParent) {\n        hierarchy = `${currentParent[Symbol.for('componentType')]}/${hierarchy}`\n        currentParent = currentParent.parent\n      }\n      return hierarchy\n    }\n    return filePath ? filePath : 'Blits.Application'\n  }\n\n  return parse()\n}\n","/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Image from './Image.js'\nimport Circle from './Circle.js'\nimport RouterView from './RouterView.js'\nimport Sprite from './Sprite.js'\nimport FPScounter from './FPScounter.js'\nimport Layout from './Layout.js'\n\nexport default () => ({\n  Image: Image(),\n  Circle: Circle(),\n  RouterView: RouterView(),\n  Sprite: Sprite(),\n  FPScounter: FPScounter(),\n  Layout: Layout(),\n})\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from './src/component.js'\nimport Application from './src/application.js'\nimport Launch from './src/launch.js'\n\nexport default {\n  Component,\n  Application,\n  Launch,\n}\n","/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from './component.js'\nimport Focus from './focus.js'\nimport Settings from './settings.js'\n\nimport symbols from './lib/symbols.js'\n\nconst Application = (config) => {\n  const defaultKeyMap = {\n    ArrowLeft: 'left',\n    ArrowRight: 'right',\n    ArrowUp: 'up',\n    ArrowDown: 'down',\n    Enter: 'enter',\n    ' ': 'space',\n    Backspace: 'back',\n    Escape: 'escape',\n    37: 'left',\n    39: 'right',\n    38: 'up',\n    40: 'down',\n    13: 'enter',\n    32: 'space',\n    8: 'back',\n    27: 'escape',\n  }\n\n  config.hooks = config.hooks || {}\n\n  let keyDownHandler\n  let keyUpHandler\n  let holdTimeout\n\n  config.hooks[symbols.destroy] = function () {\n    document.removeEventListener('keydown', keyDownHandler)\n    document.removeEventListener('keyup', keyUpHandler)\n  }\n\n  config.hooks[symbols.init] = function () {\n    const keyMap = { ...defaultKeyMap, ...Settings.get('keymap', {}) }\n\n    keyDownHandler = (e) => {\n      const key = keyMap[e.key] || keyMap[e.keyCode] || e.key || e.keyCode\n      Focus.input(key, e)\n      clearTimeout(holdTimeout)\n      holdTimeout = setTimeout(() => {\n        Focus.hold = true\n      }, 50)\n    }\n\n    keyUpHandler = () => {\n      clearTimeout(holdTimeout)\n      Focus.hold = false\n    }\n\n    document.addEventListener('keydown', keyDownHandler)\n    document.addEventListener('keyup', keyUpHandler)\n\n    // next tick\n    setTimeout(() => Focus.set(this))\n  }\n\n  return Component('App', config)\n}\n\nexport default Application\n"],"names":["symbols","currentView","Symbol","cursorTagStart","computedKeys","destroy","getChildren","holder","id","identifier","index","init","inputEvents","intervals","level","methodKeys","originalState","propKeys","raw","ready","renderer","routes","settings","state","stateKeys","textnode","timeouts","type","watchers","watchKeys","wrapper","children","for","components","isSlot","props","slots","componentType","get","key","defaultValue","this","set","value","Object","keys","forEach","k","n","time","Date","toLocaleTimeString","hour","minute","second","logger","context","Settings","log","defineProperty","Array","isArray","indexOf","console","info","bind","window","warn","error","debug","Log","colorsMap","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","hex","rgba","hsla","hexLookup","decimalToHex","decimal","undefined","resp","parseInt","toString","padStart","colors","color","defaultColor","startsWith","length","test","replace","toLowerCase","split","map","c","join","colorRGBA","padEnd","rgbaMatch","exec","r","g","b","a","alpha","Math","min","max","round","parseFloat","counter","codegenerator","templateObject","ctx","renderCode","effectsCode","generateCode","call","push","render","Function","effects","code","generateElementCode","parent","options","component","forceEffect","forloop","interpolate","elm","slot","isReactiveKey","substring","cast","generateComponentCode","generateForLoopCode","forLoop","result","item","forStartCounter","ref","effect","forEndCounter","i","childTemplateObject","__textnode","val","matches","matchAll","restore","match","el","idx","castedValue","escapedVal","parseInlineContent","isNaN","slice","endsWith","base","w","width","x","h","height","y","str","arg","counters","cbs","emit","hook","scope","data","apply","currentEffect","paused","objectMap","WeakMap","trackQueue","track","target","effectsMap","Map","Set","add","trigger","force","arrayPatchMethods","proxyMap","getRaw","reactiveProxy","original","_parent","_key","constructor","name","existingProxy","obj","proxy","Proxy","receiver","args","resumeTracking","Reflect","oldRawValue","rawValue","reactiveDefineProperty","internalValue","getPrototypeOf","prototype","v","enumerable","configurable","newValue","reactive","mode","states","Lifecycle","previous","current","componentId","symHook","privateEmit","assertTruthy","condition","message","isProductionEnvironment","Error","mergeColorProgress","rgba1","rgba2","p","r1","trunc","g1","b1","a1","r2","g2","b2","a2","mergeColorAlpha","premultiplyRGB","mergeColorAlphaPremultiplied","flipEndianess","newAlpha","rgbAlpha","hasOwn","prop","hasOwnProperty","env","PROD","nextId","EventEmitter","eventListeners","on","event","listener","listeners","off","splice","once","onceListener","removeAllListeners","PROTOCOL_REGEX","getNormalizedRgbaComponents","getNormalizedAlphaComponent","getRgbaString","floor","toFixed","createBound","x1","y1","x2","y2","out","boundsOverlap","intersectRect","copyRect","boundInsideBound","bound1","bound2","Matrix3d","ta","tb","tx","tc","td","ty","_floatArr","mutation","temp","tempMatrix","multiply","e0","e1","e2","e3","e4","e5","identity","translate","scale","sx","sy","rotate","angle","cos","sin","copy","src","dst","PI","other","getFloatArr","Float32Array","RenderCoords","entries","x3","y3","x4","y4","isPowerOfTwo","getTimingBezier","d","xc","xb","xa","yc","yb","ya","cbx","cbxd","dx","t","it","minT","maxT","timingMapping","timingLookup","ease","defaultTiming","getTimingFunction","lookup","timing","num1","num2","num3","num4","parseCubicBezier","bytesToMb","bytes","CoreAnimation","node","progress","delayFor","timingFunction","propValuesMap","dynPropValuesMap","super","start","shader","shaderProps","shaderPropKeys","spLength","j","effectName","effectProps","eLength","easing","delay","duration","loop","repeat","repeatDelay","stopMethod","reset","update","restoreValues","valueMap","dynEntries","dynEntriesL","reverseValues","reverse","applyEasing","s","e","updateValue","propName","propValue","startValue","endValue","updateValues","dt","CoreAnimationController","manager","animation","stoppedPromise","stoppedResolve","Promise","resolve","onAnimating","onFinished","makeStoppedPromise","registerAnimation","stop","unregisterAnimation","pause","waitUntilStopped","CoreNodeRenderState","CoreNodeRenderStateMap","UpdateType","Init","OutOfBounds","InBounds","InViewport","CoreNode","stage","_id","getNewId","updateType","All","globalTransform","scaleRotateTransform","localTransform","renderCoords","renderBound","strictBound","preloadBound","clippingRect","valid","isRenderable","renderState","worldAlpha","premultipliedColorTl","premultipliedColorTr","premultipliedColorBl","premultipliedColorBr","calcZIndex","hasRTTupdates","parentHasRenderTexture","texture","rtt","updateScaleRotateTransform","loadTexture","queueMicrotask","textureOptions","preload","ctxTexture","load","dimensions","onTextureLoaded","onTextureFailed","onTextureFreed","unloadTexture","setRenderableOwner","autosizeNode","autosize","_","requestRender","setRTTUpdates","resizeMode","setUpdateType","Local","Children","sortChildren","sort","rotation","scaleX","scaleY","updateLocalTransform","mountTranslateX","mountX","mountTranslateY","mountY","pivotTranslateX","pivotX","pivotTranslateY","pivotY","resizeModeScaleX","resizeModeScaleY","extraX","extraY","tw","th","scaledTxHeight","scaledTxWidth","Global","delta","parentClippingRect","ScaleRotate","childUpdateType","None","ParentRenderTexture","RenderTexture","child","calculateRenderCoords","updateBoundingRect","Clipping","RenderState","calculateClippingRect","WorldAlpha","PremultipliedColors","IsRenderable","colorTl","colorTr","colorBl","colorBr","updateRenderState","updateIsRenderable","CalculatedZIndex","calculateZIndex","ZIndexSortedChildren","checkRenderProps","defShaderCtr","clipping","colorTop","colorBottom","colorLeft","colorRight","checkRenderBounds","rectW","root","rectH","renderM","boundsMargin","newIsRenderable","onChangeIsRenderable","transform","minX","maxX","minY","maxY","gt","isRotated","z","zIndex","zIndexLocked","removeRTTNode","renderQuads","renderToTextureActive","parentRenderTexture","activeRttNode","addQuad","getResolvedProps","framebufferDimensions","absX","absY","txManager","mount","pivot","newParent","oldParent","renderToTexture","imageUrl","oldTexture","animate","animationManager","flush","stylePropertyMap","fontFamily","fontSize","fontStyle","fontWeight","fontStretch","lineHeight","letterSpacing","textAlign","overflowSuffix","maxLines","contain","verticalAlign","convertColorToRgba","domPropertyMap","Inspector","canvas","ceil","appHeight","deviceLogicalPixelRatio","appWidth","document","createElement","setRootPosition","body","appendChild","MutationObserver","observe","attributes","childList","subtree","ResizeObserver","addEventListener","rect","getBoundingClientRect","top","documentElement","scrollTop","left","scrollLeft","style","position","transformOrigin","overflow","createDiv","properties","div","updateNodeProperty","createNode","createProxy","createTextNode","property","destroyNode","anim","animateNode","getElementById","remove","innerHTML","String","visibility","setAttribute","mappedStyleResponse","setProperty","domProperty","keyValue","removeAttribute","parentId","setTimeout","opacity","CoreContextTexture","textureSource","memManager","setTextureMemUse","byteSize","renderable","CoreRenderer","txMemManager","shManager","rttNodes","CoreRenderOp","CoreShader","makeCacheKey","resolveDefaults","createShader","glw","source","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","WebGlCoreShader","boundBufferCollection","buffersBound","program","vao","attributeBuffers","attributeLocations","attributeNames","uniformLocations","uniformTypes","supportsIndexedTextures","webGl2","isWebGl2","requiredExtensions","webgl2Extensions","webgl1Extensions","glVersion","extensionName","getExtension","shaderSources","fragment","vertex","textureUnits","system","parameters","MAX_VERTEX_TEXTURE_IMAGE_UNITS","vertexSource","fragmentSource","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","createVertexArray","bindVertexArray","attributeName","location","getAttribLocation","buffer","createBuffer","uniforms","uniform","getUniformLocation","bindBufferAttribute","attribute","enableVertexAttribArray","vertexAttribPointer","size","normalized","stride","offset","disableAttribute","disableVertexAttribArray","disableAttributes","loc","canBatchShaderProps","propsA","propsB","bindRenderOp","renderOp","bindBufferCollection","buffers","textures","bindTextures","setUniform","pixelRatio","$dimensions","$alpha","bindProps","resolvedBuffer","getBuffer","resolvedInfo","getAttributeInfo","attach","useProgram","detach","static","WebGlCoreRenderOp","bufferIdx","numQuads","maxTextures","getParameter","addTexture","existingIdx","findIndex","newIdx","draw","useShader","quadIdx","canvasHeight","clipX","clipWidth","clipHeight","clipY","setScissorTest","scissor","drawElements","TRIANGLES","UNSIGNED_SHORT","getWebGlParameters","params","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_SIZE","MAX_VIEWPORT_DIMS","MAX_TEXTURE_IMAGE_UNITS","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_VERTEX_ATTRIBS","MAX_VARYING_VECTORS","MAX_VERTEX_UNIFORM_VECTORS","MAX_FRAGMENT_UNIFORM_VECTORS","getWebGlExtensions","extensions","ANGLE_instanced_arrays","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc_srgb","OES_vertex_array_object","TRANSPARENT_TEXTURE_DATA","Uint8Array","WebGlCoreCtxTexture","_nativeCtxTexture","_state","_w","_h","setState","createNativeCtxTexture","onLoadRequest","then","catch","err","texImage2D","RGBA","UNSIGNED_BYTE","byteLength","textureData","getTextureData","activeTexture","ImageBitmap","ImageData","bindTexture","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","premultiplyAlpha","generateMipmap","mipmaps","glInternalFormat","view","DataView","ArrayBuffer","compressedTexImage2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","free","deleteTexture","nativeTexture","createTexture","Texture","renderableOwners","lastRenderableChangeTime","owner","oldSize","newSize","frameTime","delete","createCtxTexture","loadedArgs","failedArgs","ColorTexture","pixelData32","Uint32Array","pixelData8","Uint8ClampedArray","SubTexture","parentTexture","parentTx","onParentTxLoaded","onParentTxFailed","WebGlCoreCtxSubTexture","DefaultShader","DefaultShaderBatched","samplers","from","ShaderEffect","priority","passParameters","declaredUniforms","uniformInfo","getEffectKey","getMethodParameters","res","u","uni","define","unif","uniType","uniformName","method","makeEffectKey","effectCache","getResolvedEffect","effectContructors","JSON","stringify","has","resolvedEffects","effectsLength","resolvedEffect","effectConstructor","defaultPropValues","uniformKeys","uniformsLength","programValue","updateOnBind","hasValidator","validator","hasProgramValueUpdater","updateProgramValue","validatedValue","DynamicShader","effectsL","propsLength","getRegisteredEffects","propsEffectsLen","effectA","effectB","effectNameCount","methods","declareUniforms","uFx","baseClass","nr","fxClass","values","effectMethods","fx","fxProps","remap","m","cm","fxMethod","resolveMethodDuplicate","onShaderMask","onColorize","onEffectMask","reg","RegExp","methodParameters","pm","sharedMethods","currentMask","drawEffects","currentClass","next","effectMethod","methodCollection","increment","RoundedRectangle","radius","IDENTITY_MATRIX_3x3","SdfShader","resolvedProps","scrollY","distanceRange","updateShaderEffectColor","floatArray","updateFloat32ArrayLength2","updateFloat32ArrayLength4","updateFloat32ArrayLengthN","len","validateArrayLength4","updateWebSafeRadius","storedDimensions","r0","r3","factor","RadiusEffect","fillMask","boxDist","BorderEffect","LinearGradientEffect","stops","colorsL","tmp","rgbas","reduce","acc","concat","fromLinear","toLinear","calcPoint","amount","ColorLoop","GrayscaleEffect","BorderRightEffect","rectDist","BorderTopEffect","BorderBottomEffect","BorderLeftEffect","GlitchEffect","amplitude","narrowness","blockiness","minimizer","now","rand","noise","fbm","FadeOutEffect","fade","RadialGradientEffect","RadialProgressEffect","range","rounded","rotateUV","drawDot","HolePunchEffect","ROUNDED_RECTANGLE_SHADER_TYPE","UnsupportedShader","shType","ShaderController","l","definedProps","DynamicShaderController","effectConstructors","effectType","definedEffectProps","propEntries","propEntriesLength","CoreShaderManager","shCache","shConstructors","attachedShader","registerShaderType","registerEffectType","shClass","effectClass","getRegisteredShaders","loadShader","ShaderClass","_createShaderCtr","loadDynamicShader","cacheKey","_createDynShaderCtr","BufferCollection","config","find","WebGlContextWrapper","gl","activeTextureUnit","texture2dUnits","texture2dParams","scissorEnabled","scissorX","scissorY","scissorWidth","scissorHeight","blendEnabled","blendSrcRgb","blendDstRgb","blendSrcAlpha","blendDstAlpha","boundArrayBuffer","boundElementArrayBuffer","curProgram","programUniforms","UNPACK_FLIP_Y_WEBGL","FLOAT","ONE","ONE_MINUS_SRC_ALPHA","STATIC_DRAW","DYNAMIC_DRAW","COLOR_ATTACHMENT0","ACTIVE_TEXTURE","TEXTURE0","maxTextureUnits","fill","TEXTURE_BINDING_2D","isEnabled","SCISSOR_TEST","scissorBox","SCISSOR_BOX","BLEND","BLEND_SRC_RGB","BLEND_DST_RGB","BLEND_SRC_ALPHA","BLEND_DST_ALPHA","ARRAY_BUFFER_BINDING","ELEMENT_ARRAY_BUFFER_BINDING","CURRENT_PROGRAM","self","WebGL2RenderingContext","textureUnit","TEXTURE_2D","_getActiveTexture","pname","param","textureParams","internalFormat","widthOrFormat","heightOrType","borderOrSource","format","pixels","internalformat","border","viewport","clearColor","enable","disable","setBlend","blend","blendFunc","createFramebuffer","bindFramebuffer","framebuffer","FRAMEBUFFER","framebufferTexture2D","attachment","clear","COLOR_BUFFER_BIT","arrayBufferData","usage","bindBuffer","ARRAY_BUFFER","bufferData","elementArrayBufferData","ELEMENT_ARRAY_BUFFER","uniformArgs","every","compareArrays","count","vertexArray","WebGlCoreCtxRenderTexture","loadKTXData","async","littleEndian","getUint32","pixelWidth","pixelHeight","numberOfMipmapLevels","bytesOfKeyValueData","imageSize","loadPVRData","arrayBuffer","header","Int32Array","dataOffset","pvrtcData","byteOffset","ImageTexture","hasAlphaChannel","mimeType","url","response","fetch","loadCompressedTexture","absoluteSrc","protocol","path","pathname","pop","basePath","baseUrl","charAt","URL","href","convertUrlToAbsolute","imageWorkerManager","getImage","hasCreateImageBitmap","blob","createImageBitmap","colorSpaceConversion","imageOrientation","img","Image","substr","crossOrigin","reject","onload","onerror","WebGlCoreRenderer","quadBuffer","fQuadBuffer","uiQuadBuffer","renderOps","curBufferIdx","curRenderOp","defShaderCtrl","defaultShader","quadBufferCollection","defaultTexture","bufferMemory","contextSpy","antialias","depth","stencil","desynchronized","powerPreference","premultipliedAlpha","preserveDrawingBuffer","getContext","createWebGLContext","maxQuads","indices","Uint16Array","createIndexBuffer","BYTES_PER_ELEMENT","a_position","a_textureCoordinate","a_color","a_textureIndex","getShaderManager","targetDims","targetShader","reuseRenderOp","newRenderOp","flipX","flipY","texCoordX1","texCoordY1","texCoordX2","texCoordY2","parentW","parentH","precision","desiredSize","textureIdx","rightCornerX","rightCornerY","recursive","addRenderOp","surface","arr","unshift","renderRTTNodes","deltaTime","addQuads","getDefShaderCtr","AnimationManager","activeAnimations","createImageWorker","onmessage","xhr","XMLHttpRequest","open","responseType","status","statusText","withAlphaChannel","send","postMessage","ImageWorkerManager","imageWorkersEnabled","messageManager","workers","workerIndex","numImageWorkers","createWorkers","worker","handleMessage","msg","numWorkers","workerCode","Blob","blobURL","webkitURL","createObjectURL","Worker","getNextWorker","nextWorker","NoiseTexture","random","cacheId","CoreTextureManager","keyCache","inverseKeyCache","txConstructors","hasWorker","registerTextureType","textureType","textureClass","TextureClass","initTextureToCache","removeTextureFromCache","weightConversions","normal","bold","bolder","lighter","fontWeightToNumber","weight","resolveFontToUse","fn","head","tail","memoized","arguments","searchCache","prev","maxSize","memize","familyMapsByPriority","family","weightIn","stretch","fontFamiles","fontFaces","weightMap","fontFace","fontFamilyWeight","descriptors","TrFontManager","textRenderers","addFontFace","font","trId","tr","isFontFaceSupported","resolveFontFace","trPropSetterDefaults","text","offsetY","scrollable","textBaseline","TextRenderer","propSetters","getPropertySetters","freeze","fromEntries","setter","setStatus","emitter","setIsRenderable","destroyState","scheduleUpdateState","updateScheduled","updateState","TrFontFace","loaded","metrics","ascender","unitsPerEm","descender","lineGap","convertToCssFontFaceDescriptors","unicodeRange","featureSettings","display","SpecialCodepoints","FontShaper","SdfFontShaper","glyphMap","kernings","kerning","first","shapeText","codepoints","codepointResult","lastGlyphId","peek","done","codepoint","glyph","mapped","glyphId","cluster","lastIndex","xAdvance","xadvance","yAdvance","xOffset","xoffset","yOffset","yoffset","xBearing","yBearing","SdfTrFontFace","maxCharHeight","shaper","atlasUrl","atlasDataUrl","checkLoaded","json","chars","charHeight","lightningMetrics","getAtlasEntry","PeekableIterator","iterator","peekBuffer","_lastIndex","indexBase","nextResult","getUnicodeCodepoints","codePoint","codePointAt","layoutText","curLineIndex","startX","startY","vertexBuffer","lineCache","rwSdf","trFontFace","forceFullLayoutCalc","fontSizeRatio","vertexLineHeight","vertexW","vertexLSpacing","startingLineCacheEntry","startingCodepointIndex","codepointIndex","curX","curY","bufferOffset","lastWord","xStart","shaperProps","glyphResult","glyphs","curLineBufferStart","bufferLineInfos","vertexTruncateHeight","overflowSuffVertexWidth","measureText","moreLines","nextLineWillFit","lineVertexW","xStartLastWordBoundary","lineIsBelowWindowTop","lineIsAboveWindowBottom","lineIsWithinWindow","charEndX","quadX","quadY","atlasEntry","common","scaleW","scaleH","uvWidth","uvHeight","bufferStart","bufferEnd","vertexTextW","line","bufferNumFloats","bufferNumQuads","layoutNumCharacters","fullyProcessed","numLines","setRenderWindow","outRenderWindow","bufferMargin","visibleWindow","screen","sdf","bound","y1Base","multiple","roundUpToMultiple","firstLineIdx","calcDefaultLineHeight","tmpRect","SdfTextRenderer","ssdfFontFamilies","msdfFontFamilies","fontFamilyArray","sdfShader","rendererBounds","releaseFontFace","invalidateLayoutCache","elementBounds","setElementBoundsX","renderWindow","setElementBoundsY","resLineHeight","canRenderFont","familyName","faceSet","createState","webGlBuffers","bufferUploaded","textH","textW","debugData","updateCount","layoutCount","lastLayoutNumCharacters","layoutSum","drawSum","drawCount","bufferSize","sdfFontSize","sdfLineHeight","distanceField","neededLength","rwScreen","startLineIndex","sdfBareLineHeight","sdfVerticalAlignYOffset","sdfOffsetY","sdfEncodedAscender","sdfStartY","sdfX","sdfY","lineIndex","getStartConditions","out2","webGlBuffer","elementRect","sdfShaderDebug","Infinity","WebTrFontFace","fontUrl","fontUrlWithoutParentheses","determinedDescriptors","cssDescriptors","FontFace","calcHeight","LightningTextTextureRenderer","_canvas","_context","_settings","mergeDefaults","getPrecision","setFontProperties","_getFontSetting","ff","ffs","_load","fonts","fontSetting","check","calculateRenderInfo","renderInfo","paddingLeft","paddingRight","wordWrapWidth","cutSx","cutEx","cutSy","cutEy","textIndent","browserMetrics","actualBoundingBoxDescent","actualBoundingBoxAscent","getWebFontMetrics","defLineHeight","maxHeight","containedMaxLines","setMaxLines","calcMaxLines","linesInfo","innerWidth","textOverflow","wordWrap","suffix","wrapWord","wrapText","lines","usedLines","otherLines","al","remainingText","moreTextLines","maxLineWidth","lineWidths","lineWidth","linesOverride","linePositionX","linePositionY","textRenderIssueMargin","globalAlpha","fillRect","drawLines","ascenderPx","bareLineHeightPx","highlight","highlightColor","hlHeight","highlightHeight","highlightOffset","hlPaddingLeft","highlightPaddingLeft","hlPaddingRight","highlightPaddingRight","fillStyle","drawLine","prevShadowSettings","shadow","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","textColor","fillText","textSplit","word","suffixWidth","wordLen","wordWidth","cutoffIndex","truncWordWidth","indent","allLines","realNewlines","resultLines","spaceLeft","words","wordWidthWithSpace","space","char","wordBreak","advancedRenderer","fontBaselineRatio","resolvedGlobal","globalThis","globalFontSet","CanvasTextRenderer","fontFamilies","OffscreenCanvas","willReadFrequently","fontInfo","textureNode","lightning2TextRenderer","renderSingleCanvasPage","loadFont","getImageData","cssString","getFontCssString","onFontLoaded","onFontLoadError","ContextSpy","getData","TextureMemoryManager","memUsed","loadedTextures","criticalThreshold","targetThreshold","cleanupInterval","debugLogging","lastCleanupTime","criticalCleanupRequested","targetFraction","targetThresholdLevel","lastMemUse","setInterval","checkCleanup","cleanup","critical","queueFrameEvent","textureA","textureB","txARenderable","txBRenderable","memTarget","getMemoryInfo","renderableTexturesLoaded","renderableMemUsed","WHITE","isWhite","parseColor","abgr","formatRgba","CanvasCoreTexture","image","tintCache","updateMemSize","mult","hasImage","tintedImage","tintTexture","globalCompositeOperation","drawImage","putImageData","CanvasCoreRenderer","getRgbaComponents","quad","frame","hasTransform","hasClipping","hasGradient","getRadius","save","Path2D","clip","setTransform","roundRect","endColor","endX","endY","gradient","createLinearGradient","addColorStop","CoreTextNode","textRenderer","trState","_textRendererOverride","textRendererOverride","resolvedTextRenderer","textRendererState","resolveTextRendererAndState","onTextLoaded","setWidth","setHeight","calcWidth","onTextFailed","resolveTextRenderer","Stage","fontManager","eventBus","lastFrameTime","currentFrameTime","fpsNumFrames","fpsElapsedTime","renderRequested","frameEventQueue","enableContextSpy","textureMemory","renderMode","bm","rendererOptions","devicePhysicalPixelRatio","rootNode","isIdle","runLoop","updateFrameTime","updateAnimations","hasSceneUpdates","calculateFps","flushFrameEvents","drawFrame","requestAnimationFrame","startLoop","newFrameTime","performance","fpsUpdateInterval","fps","contextSpyData","trProps","rendererId","overrideFallback","possibleRenderer","createShaderCtr","resolveNodeDefaults","validTypes","boolean","string","number","valueType","santizeCustomDataMap","RendererMain","inspector","resolvedTxSettings","resolvedSettings","devicePixelRatio","enableInspector","deviceLogicalWidth","deviceLogicalHeight","targetEl","textNode","shaderType","createDynamicShader","createEffect","getNodeById","findNode","found","toggleFreeze","advanceFrame","rerender","screenResolutions","hd","fhd","fullhd","fontLoader","png","file","shaderLoader","isTransition","isObjectString","parseToObject","parse","parsePercentage","element","unpackTransition","transition","colorMap","bottom","right","textDefaults","propsTransformer","show","eff","wordwrap","maxheight","maxlines","textoverflow","letterspacing","lineheight","align","content","Element","populate","___layout","scheduledTransitions","f","cancel","end","nodeId","filter","engine","assign","create","App","fpsInterval","screenResolution","innerHeight","webWorkersLimit","navigator","hardwareConcurrency","canvasColor","viewportMargin","txMemByteThreshold","gpuMemoryLimit","app","quit","initApp","fadeInFadeOutTransition","before","in","syn","speechSynthesis","isAndroid","userAgent","initialized","infinityTimer","clearTimeout","resumeInfinity","resume","utterProps","lang","pitch","rate","voice","volume","speak","getVoices","utter","SpeechSynthesisUtterance","onstart","onresume","onpause","onend","utterance","debounce","politeness","Announcer","polite","assertive","currentRoute","navigating","cacheMap","history","previousFocus","overrideOptions","navigationData","navigatingBack","normalizePath","removeView","route","setOrAnimate","keepAlive","focus","shouldAnimate","existingEndCallback","to","hash","back","targetRoutePath","Router","navigate","previousRoute","beforeHookOutput","originalPath","matchingRoute","dynamicRouteParts","dynamicRoutePartsRegex","part","regex","matchHash","hooks","isObject","inHistory","toStringTag","default","Focus","oldView","announce","activeView","setFocusTimeout","focusedComponent","focusChain","_hold","hold","unfocus","cmp","lifecycle","KeyboardEvent","dispatchEvent","input","walkChain","componentWithInputEvent","shift","any","eventsMap","registerListener","cb","componentsMap","executeListeners","removeListeners","componentMap","hasFocus","writable","$clearTimeouts","$clearIntervals","deleteChildren","select","selected","$trigger","scheduling","$setTimeout","ms","timeoutId","$clearTimeout","$setInterval","intervalId","$clearInterval","clearInterval","events","$emit","$listen","callback","$log","router","$router","announcer","$announcer","utils","rootParent","forComponent","flat","Base","defineProperties","baseProp","required","setupProps","setupState","setupComputed","computeds","computed","setupWatch","watch","old","setupComponent","getOwnPropertySymbols","registerHooks","setupMethods","setupRoutes","setupInput","Image$1","Component","template","imageSource","host","Circle","handler","RouterView","removeEventListener","Sprite","spriteTexture","defaults","frames","FPScounter","sprite","avg","avgFps","minFps","maxFps","totalFps","fpsUpdateCounter","rM","Layout","direction","gap","globalComponents","opts","parentEl","parentComponent","rootComponent","createHumanReadableId","frameTick","idle","enter","exit","watchKey","factory","componentName","filePath","cursor","prevCursor","tags","currentTag","currentLevel","tagStartRegex","tagEndRegex","attrNameRegex","emptyTagStartRegex","emptyTagEndRegex","parseLoop","clean","templateText","trim","moveCursorOnMatch","parseEmptyTagStart","parseEmptyTagEnd","parseTag","TemplateParseError","parseTagEnd","tagContent","parseAttributes","attrNameMatch","delimiter","attrValueRegex","attrValueMatch","attr","formatAttribute","includes","objectName","processColors","stringTokenRegex","potentialColor","matchIndex","matchLength","parsedData","stack","rootElementDefined","output","currentParent","TemplateStructureError","isStackEmpty","isLevelMismatch","isTagMismatch","newItem","getErrorLocation","contextText","caretPosition","insertContextCaret","generateContext","tag","parser","Application","defaultKeyMap","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter","Backspace","Escape","keyDownHandler","keyUpHandler","holdTimeout","keyMap","keyCode","Launch"],"mappings":"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","x_google_ignoreList":[11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102]}